/*! For license information please see main.957e40df.js.LICENSE.txt */
(()=>{var t={43:(t,e,n)=>{"use strict";t.exports=n(202)},82:()=>{},153:(t,e,n)=>{"use strict";var r=n(43),o=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(t,e,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(l=e.ref),e)a.call(e,r)&&!u.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps)void 0===i[r]&&(i[r]=e[r]);return{$$typeof:o,type:t,key:c,ref:l,props:i,_owner:s.current}}e.Fragment=i,e.jsx=c,e.jsxs=c},202:(t,e)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function v(t,e,n){this.props=t,this.context=e,this.refs=m,this.updater=n||p}function y(){}function b(t,e,n){this.props=t,this.context=e,this.refs=m,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(t,e){if("object"!==typeof t&&"function"!==typeof t&&null!=t)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")},v.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")},y.prototype=v.prototype;var w=b.prototype=new y;w.constructor=b,g(w,v.prototype),w.isPureReactComponent=!0;var x=Array.isArray,E=Object.prototype.hasOwnProperty,A={current:null},C={key:!0,ref:!0,__self:!0,__source:!0};function k(t,e,r){var o,i={},a=null,s=null;if(null!=e)for(o in void 0!==e.ref&&(s=e.ref),void 0!==e.key&&(a=""+e.key),e)E.call(e,o)&&!C.hasOwnProperty(o)&&(i[o]=e[o]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(t&&t.defaultProps)for(o in u=t.defaultProps)void 0===i[o]&&(i[o]=u[o]);return{$$typeof:n,type:t,key:a,ref:s,props:i,_owner:A.current}}function S(t){return"object"===typeof t&&null!==t&&t.$$typeof===n}var I=/\/+/g;function R(t,e){return"object"===typeof t&&null!==t&&null!=t.key?function(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(t){return e[t]})}(""+t.key):e.toString(36)}function T(t,e,o,i,a){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var u=!1;if(null===t)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case n:case r:u=!0}}if(u)return a=a(u=t),t=""===i?"."+R(u,0):i,x(a)?(o="",null!=t&&(o=t.replace(I,"$&/")+"/"),T(a,e,o,"",function(t){return t})):null!=a&&(S(a)&&(a=function(t,e){return{$$typeof:n,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}(a,o+(!a.key||u&&u.key===a.key?"":(""+a.key).replace(I,"$&/")+"/")+t)),e.push(a)),1;if(u=0,i=""===i?".":i+":",x(t))for(var c=0;c<t.length;c++){var l=i+R(s=t[c],c);u+=T(s,e,o,l,a)}else if(l=function(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=f&&t[f]||t["@@iterator"])?t:null}(t),"function"===typeof l)for(t=l.call(t),c=0;!(s=t.next()).done;)u+=T(s=s.value,e,o,l=i+R(s,c++),a);else if("object"===s)throw e=String(t),Error("Objects are not valid as a React child (found: "+("[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return u}function N(t,e,n){if(null==t)return t;var r=[],o=0;return T(t,r,"","",function(t){return e.call(n,t,o++)}),r}function _(t){if(-1===t._status){var e=t._result;(e=e()).then(function(e){0!==t._status&&-1!==t._status||(t._status=1,t._result=e)},function(e){0!==t._status&&-1!==t._status||(t._status=2,t._result=e)}),-1===t._status&&(t._status=0,t._result=e)}if(1===t._status)return t._result.default;throw t._result}var P={current:null},D={transition:null},O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:D,ReactCurrentOwner:A};function F(){throw Error("act(...) is not supported in production builds of React.")}e.Children={map:N,forEach:function(t,e,n){N(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return N(t,function(){e++}),e},toArray:function(t){return N(t,function(t){return t})||[]},only:function(t){if(!S(t))throw Error("React.Children.only expected to receive a single React element child.");return t}},e.Component=v,e.Fragment=o,e.Profiler=a,e.PureComponent=b,e.StrictMode=i,e.Suspense=l,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,e.act=F,e.cloneElement=function(t,e,r){if(null===t||void 0===t)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var o=g({},t.props),i=t.key,a=t.ref,s=t._owner;if(null!=e){if(void 0!==e.ref&&(a=e.ref,s=A.current),void 0!==e.key&&(i=""+e.key),t.type&&t.type.defaultProps)var u=t.type.defaultProps;for(c in e)E.call(e,c)&&!C.hasOwnProperty(c)&&(o[c]=void 0===e[c]&&void 0!==u?u[c]:e[c])}var c=arguments.length-2;if(1===c)o.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];o.children=u}return{$$typeof:n,type:t.type,key:i,ref:a,props:o,_owner:s}},e.createContext=function(t){return(t={$$typeof:u,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:t},t.Consumer=t},e.createElement=k,e.createFactory=function(t){var e=k.bind(null,t);return e.type=t,e},e.createRef=function(){return{current:null}},e.forwardRef=function(t){return{$$typeof:c,render:t}},e.isValidElement=S,e.lazy=function(t){return{$$typeof:d,_payload:{_status:-1,_result:t},_init:_}},e.memo=function(t,e){return{$$typeof:h,type:t,compare:void 0===e?null:e}},e.startTransition=function(t){var e=D.transition;D.transition={};try{t()}finally{D.transition=e}},e.unstable_act=F,e.useCallback=function(t,e){return P.current.useCallback(t,e)},e.useContext=function(t){return P.current.useContext(t)},e.useDebugValue=function(){},e.useDeferredValue=function(t){return P.current.useDeferredValue(t)},e.useEffect=function(t,e){return P.current.useEffect(t,e)},e.useId=function(){return P.current.useId()},e.useImperativeHandle=function(t,e,n){return P.current.useImperativeHandle(t,e,n)},e.useInsertionEffect=function(t,e){return P.current.useInsertionEffect(t,e)},e.useLayoutEffect=function(t,e){return P.current.useLayoutEffect(t,e)},e.useMemo=function(t,e){return P.current.useMemo(t,e)},e.useReducer=function(t,e,n){return P.current.useReducer(t,e,n)},e.useRef=function(t){return P.current.useRef(t)},e.useState=function(t){return P.current.useState(t)},e.useSyncExternalStore=function(t,e,n){return P.current.useSyncExternalStore(t,e,n)},e.useTransition=function(){return P.current.useTransition()},e.version="18.3.1"},234:(t,e)=>{"use strict";function n(t,e){var n=t.length;t.push(e);t:for(;0<n;){var r=n-1>>>1,o=t[r];if(!(0<i(o,e)))break t;t[r]=e,t[n]=o,n=r}}function r(t){return 0===t.length?null:t[0]}function o(t){if(0===t.length)return null;var e=t[0],n=t.pop();if(n!==e){t[0]=n;t:for(var r=0,o=t.length,a=o>>>1;r<a;){var s=2*(r+1)-1,u=t[s],c=s+1,l=t[c];if(0>i(u,n))c<o&&0>i(l,u)?(t[r]=l,t[c]=n,r=c):(t[r]=u,t[s]=n,r=s);else{if(!(c<o&&0>i(l,n)))break t;t[r]=l,t[c]=n,r=c}}}return e}function i(t,e){var n=t.sortIndex-e.sortIndex;return 0!==n?n:t.id-e.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;e.unstable_now=function(){return a.now()}}else{var s=Date,u=s.now();e.unstable_now=function(){return s.now()-u}}var c=[],l=[],h=1,d=null,f=3,p=!1,g=!1,m=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function w(t){for(var e=r(l);null!==e;){if(null===e.callback)o(l);else{if(!(e.startTime<=t))break;o(l),e.sortIndex=e.expirationTime,n(c,e)}e=r(l)}}function x(t){if(m=!1,w(t),!g)if(null!==r(c))g=!0,D(E);else{var e=r(l);null!==e&&O(x,e.startTime-t)}}function E(t,n){g=!1,m&&(m=!1,y(S),S=-1),p=!0;var i=f;try{for(w(n),d=r(c);null!==d&&(!(d.expirationTime>n)||t&&!T());){var a=d.callback;if("function"===typeof a){d.callback=null,f=d.priorityLevel;var s=a(d.expirationTime<=n);n=e.unstable_now(),"function"===typeof s?d.callback=s:d===r(c)&&o(c),w(n)}else o(c);d=r(c)}if(null!==d)var u=!0;else{var h=r(l);null!==h&&O(x,h.startTime-n),u=!1}return u}finally{d=null,f=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var A,C=!1,k=null,S=-1,I=5,R=-1;function T(){return!(e.unstable_now()-R<I)}function N(){if(null!==k){var t=e.unstable_now();R=t;var n=!0;try{n=k(!0,t)}finally{n?A():(C=!1,k=null)}}else C=!1}if("function"===typeof b)A=function(){b(N)};else if("undefined"!==typeof MessageChannel){var _=new MessageChannel,P=_.port2;_.port1.onmessage=N,A=function(){P.postMessage(null)}}else A=function(){v(N,0)};function D(t){k=t,C||(C=!0,A())}function O(t,n){S=v(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(t){t.callback=null},e.unstable_continueExecution=function(){g||p||(g=!0,D(E))},e.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<t?Math.floor(1e3/t):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(t){switch(f){case 1:case 2:case 3:var e=3;break;default:e=f}var n=f;f=e;try{return t()}finally{f=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var n=f;f=t;try{return e()}finally{f=n}},e.unstable_scheduleCallback=function(t,o,i){var a=e.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?a+i:a:i=a,t){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return t={id:h++,callback:o,priorityLevel:t,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>a?(t.sortIndex=i,n(l,t),null===r(c)&&t===r(l)&&(m?(y(S),S=-1):m=!0,O(x,i-a))):(t.sortIndex=s,n(c,t),g||p||(g=!0,D(E))),t},e.unstable_shouldYield=T,e.unstable_wrapCallback=function(t){var e=f;return function(){var n=f;f=e;try{return t.apply(this,arguments)}finally{f=n}}}},254:t=>{"use strict";t.exports=function(){let{mustBeMetaMask:t=!1,silent:e=!1,timeout:n=3e3}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(){if("boolean"!==typeof t)throw new Error("@metamask/detect-provider: Expected option 'mustBeMetaMask' to be a boolean.");if("boolean"!==typeof e)throw new Error("@metamask/detect-provider: Expected option 'silent' to be a boolean.");if("number"!==typeof n)throw new Error("@metamask/detect-provider: Expected option 'timeout' to be a number.")}();let r=!1;return new Promise(o=>{function i(){if(r)return;r=!0,window.removeEventListener("ethereum#initialized",i);const{ethereum:n}=window;if(!n||t&&!n.isMetaMask){const r=t&&n?"Non-MetaMask window.ethereum detected.":"Unable to detect window.ethereum.";!e&&console.error("@metamask/detect-provider:",r),o(null)}else o(n)}window.ethereum?i():(window.addEventListener("ethereum#initialized",i,{once:!0}),setTimeout(()=>{i()},n))})}},318:()=>{},391:(t,e,n)=>{"use strict";var r=n(950);e.createRoot=r.createRoot,e.hydrateRoot=r.hydrateRoot},470:(t,e,n)=>{"use strict";n.d(e,{A:()=>o});class r{constructor(){this.deviceInfo=null,this.detectDevice()}static getInstance(){return r.instance||(r.instance=new r),r.instance}detectDevice(){const t=navigator.userAgent,e={userAgent:t,type:this.getDeviceType(t),os:this.getOperatingSystem(t),browser:this.getBrowser(t),supportsWeb3:this.detectWeb3Support(),recommendedWallet:[],deepLinkSupported:this.supportsDeepLinks(t)};e.recommendedWallet=this.getRecommendedWallets(e),this.deviceInfo=e}getDeviceType(t){return/iPad|Android(?!.*Mobile)|Tablet/i.test(t)?"tablet":/Mobile|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(t)?"mobile":"desktop"}getOperatingSystem(t){return/iPhone|iPad|iPod/i.test(t)?"iOS":/Android/i.test(t)?"Android":/Windows/i.test(t)?"Windows":/Mac/i.test(t)?"MacOS":/Linux|X11/i.test(t)?"Linux":"Unknown"}getBrowser(t){return/Chrome/i.test(t)&&!/Edg/i.test(t)?"Chrome":/Firefox/i.test(t)?"Firefox":/Safari/i.test(t)&&!/Chrome/i.test(t)?"Safari":/Edg/i.test(t)?"Edge":/Opera|OPR/i.test(t)?"Opera":/MetaMask/i.test(t)?"MetaMask Mobile":/Trust/i.test(t)?"Trust Wallet":/Coinbase/i.test(t)?"Coinbase Wallet":"Unknown"}detectWeb3Support(){return!("undefined"===typeof window||!window.ethereum)||(!("undefined"===typeof window||!window.web3)||!!/ethereum|web3/i.test(navigator.userAgent))}supportsDeepLinks(t){return/Mobile|Android|iPhone|iPad|iPod/i.test(t)}getRecommendedWallets(t){const e=[];return"mobile"===t.type?"iOS"===t.os?e.push("MetaMask Mobile","Trust Wallet","Coinbase Wallet"):"Android"===t.os?e.push("MetaMask Mobile","Trust Wallet","Rainbow"):e.push("MetaMask Mobile"):(e.push("MetaMask Extension"),"Chrome"===t.browser?e.push("Coinbase Wallet Extension","Phantom"):"Firefox"===t.browser?e.push("MetaMask Extension"):"Edge"===t.browser&&e.push("MetaMask Extension","Built-in Wallet")),e}getDeviceInfo(){return this.deviceInfo||this.detectDevice(),this.deviceInfo}isMobile(){return"mobile"===this.getDeviceInfo().type}isTablet(){return"tablet"===this.getDeviceInfo().type}isDesktop(){return"desktop"===this.getDeviceInfo().type}supportsWallet(t){return this.getDeviceInfo().recommendedWallet.includes(t)}getWalletOptions(){const t=this.getDeviceInfo(),e="mobile"===t.type;return[{name:"MetaMask",icon:"\ud83e\udd8a",url:e?"https://metamask.app.link/dapp/blockdface.local":"https://metamask.io/download/",deepLink:e?"metamask://dapp/blockdface.local":void 0,description:"Most popular Web3 wallet",platforms:["iOS","Android","Windows","MacOS","Linux"]},{name:"Trust Wallet",icon:"\ud83d\udd12",url:e?"https://link.trustwallet.com/open_url?coin_id=60&url=https://blockdface.local":"https://trustwallet.com/",deepLink:e?"trust://":void 0,description:"Simple and secure mobile wallet",platforms:["iOS","Android"]},{name:"Coinbase Wallet",icon:"\ud83d\udd37",url:e?"https://go.cb-w.com/dapp?cb_url=https://blockdface.local":"https://chrome.google.com/webstore/detail/coinbase-wallet-extension/hnfanknocfeofbddlgijnpbnjdggppjdp",deepLink:e?"cbwallet://dapp/https://blockdface.local":void 0,description:"Wallet from Coinbase exchange",platforms:["iOS","Android","Chrome"]}].filter(n=>n.platforms.includes(t.os)||n.platforms.includes(t.type)||!e)}generateDeepLink(t,e){if(!this.isMobile()||!t.deepLink)return null;switch(t.name){case"MetaMask":return"metamask://dapp/".concat(e);case"Trust Wallet":return"trust://dapp/".concat(e);case"Coinbase Wallet":return"cbwallet://dapp/".concat(e);default:return t.deepLink}}openWallet(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blockdface.local";try{const n=this.generateDeepLink(t,e);return n&&this.isMobile()?(window.location.href=n,setTimeout(()=>{window.open(t.url,"_blank")},2e3)):window.open(t.url,"_blank"),!0}catch(n){return console.error("Failed to open wallet:",n),!1}}getNetworkConfig(){return{chainId:"0x539",chainName:"Ganache Local",rpcUrls:["http://127.0.0.1:8545"],nativeCurrency:{name:"Ether",symbol:"ETH",decimals:18},blockExplorerUrls:null}}getConnectionInstructions(){const t=this.getDeviceInfo();return"mobile"===t.type?"iOS"===t.os?"For best experience, use the MetaMask mobile app or open this link in Safari with MetaMask installed.":"Use MetaMask mobile app or Trust Wallet for the best experience.":"Chrome"===t.browser?"Install MetaMask extension for Chrome browser.":"Firefox"===t.browser?"Install MetaMask extension for Firefox browser.":"Edge"===t.browser?"Use the built-in crypto wallet in Edge or install MetaMask extension.":"Install MetaMask extension for your browser for best compatibility."}isCompatible(){const t=this.getDeviceInfo();return!(!t.supportsWeb3&&"desktop"===t.type)}getCompatibilityScore(){const t=this.getDeviceInfo();let e=0;return t.supportsWeb3&&(e+=40),["Chrome","Firefox","Edge","Safari"].includes(t.browser)&&(e+=20),["iOS","Android","Windows","MacOS"].includes(t.os)&&(e+=20),e+=Math.min(5*t.recommendedWallet.length,20),Math.min(e,100)}}r.instance=void 0;const o=r.getInstance()},579:(t,e,n)=>{"use strict";t.exports=n(153)},730:(t,e,n)=>{"use strict";var r=n(43),o=n(853);function i(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function u(t,e){c(t,e),c(t+"Capture",e)}function c(t,e){for(s[t]=e,t=0;t<e.length;t++)a.add(e[t])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(t,e,n,r,o,i,a){this.acceptsBooleans=2===e||3===e||4===e,this.attributeName=r,this.attributeNamespace=o,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){m[t]=new g(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];m[e]=new g(e,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){m[t]=new g(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){m[t]=new g(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){m[t]=new g(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){m[t]=new g(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){m[t]=new g(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){m[t]=new g(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){m[t]=new g(t,5,!1,t.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(t){return t[1].toUpperCase()}function b(t,e,n,r){var o=m.hasOwnProperty(e)?m[e]:null;(null!==o?0!==o.type:r||!(2<e.length)||"o"!==e[0]&&"O"!==e[0]||"n"!==e[1]&&"N"!==e[1])&&(function(t,e,n,r){if(null===e||"undefined"===typeof e||function(t,e,n,r){if(null!==n&&0===n.type)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(t=t.toLowerCase().slice(0,5))&&"aria-"!==t);default:return!1}}(t,e,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!e;case 4:return!1===e;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}(e,n,o,r)&&(n=null),r||null===o?function(t){return!!h.call(p,t)||!h.call(f,t)&&(d.test(t)?p[t]=!0:(f[t]=!0,!1))}(e)&&(null===n?t.removeAttribute(e):t.setAttribute(e,""+n)):o.mustUseProperty?t[o.propertyName]=null===n?3!==o.type&&"":n:(e=o.attributeName,r=o.attributeNamespace,null===n?t.removeAttribute(e):(n=3===(o=o.type)||4===o&&!0===n?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(v,y);m[e]=new g(e,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(v,y);m[e]=new g(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(v,y);m[e]=new g(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){m[t]=new g(t,1,!1,t.toLowerCase(),null,!1,!1)}),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){m[t]=new g(t,1,!1,t.toLowerCase(),null,!0,!0)});var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),E=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),S=Symbol.for("react.provider"),I=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),_=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function F(t){return null===t||"object"!==typeof t?null:"function"===typeof(t=O&&t[O]||t["@@iterator"])?t:null}var M,B=Object.assign;function L(t){if(void 0===M)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);M=e&&e[1]||""}return"\n"+M+t}var U=!1;function W(t,e){if(!t||U)return"";U=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var o=c.stack.split("\n"),i=r.stack.split("\n"),a=o.length-1,s=i.length-1;1<=a&&0<=s&&o[a]!==i[s];)s--;for(;1<=a&&0<=s;a--,s--)if(o[a]!==i[s]){if(1!==a||1!==s)do{if(a--,0>--s||o[a]!==i[s]){var u="\n"+o[a].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}}while(1<=a&&0<=s);break}}}finally{U=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?L(t):""}function z(t){switch(t.tag){case 5:return L(t.type);case 16:return L("Lazy");case 13:return L("Suspense");case 19:return L("SuspenseList");case 0:case 2:case 15:return t=W(t.type,!1);case 11:return t=W(t.type.render,!1);case 1:return t=W(t.type,!0);default:return""}}function V(t){if(null==t)return null;if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t;switch(t){case A:return"Fragment";case E:return"Portal";case k:return"Profiler";case C:return"StrictMode";case T:return"Suspense";case N:return"SuspenseList"}if("object"===typeof t)switch(t.$$typeof){case I:return(t.displayName||"Context")+".Consumer";case S:return(t._context.displayName||"Context")+".Provider";case R:var e=t.render;return(t=t.displayName)||(t=""!==(t=e.displayName||e.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case _:return null!==(e=t.displayName||null)?e:V(t.type)||"Memo";case P:e=t._payload,t=t._init;try{return V(t(e))}catch(n){}}return null}function j(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=(t=e.render).displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(e);case 8:return e===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e}return null}function G(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":case"object":return t;default:return""}}function H(t){var e=t.type;return(t=t.nodeName)&&"input"===t.toLowerCase()&&("checkbox"===e||"radio"===e)}function q(t){t._valueTracker||(t._valueTracker=function(t){var e=H(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var o=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(t){r=""+t,i.call(this,t)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(t){r=""+t},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}(t))}function K(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=H(t)?t.checked?"true":"false":t.value),(t=r)!==n&&(e.setValue(t),!0)}function Q(t){if("undefined"===typeof(t=t||("undefined"!==typeof document?document:void 0)))return null;try{return t.activeElement||t.body}catch(e){return t.body}}function X(t,e){var n=e.checked;return B({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:t._wrapperState.initialChecked})}function J(t,e){var n=null==e.defaultValue?"":e.defaultValue,r=null!=e.checked?e.checked:e.defaultChecked;n=G(null!=e.value?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}}function Y(t,e){null!=(e=e.checked)&&b(t,"checked",e,!1)}function Z(t,e){Y(t,e);var n=G(e.value),r=e.type;if(null!=n)"number"===r?(0===n&&""===t.value||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if("submit"===r||"reset"===r)return void t.removeAttribute("value");e.hasOwnProperty("value")?tt(t,e.type,n):e.hasOwnProperty("defaultValue")&&tt(t,e.type,G(e.defaultValue)),null==e.checked&&null!=e.defaultChecked&&(t.defaultChecked=!!e.defaultChecked)}function $(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!("submit"!==r&&"reset"!==r||void 0!==e.value&&null!==e.value))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}""!==(n=t.name)&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,""!==n&&(t.name=n)}function tt(t,e,n){"number"===e&&Q(t.ownerDocument)===t||(null==n?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var et=Array.isArray;function nt(t,e,n,r){if(t=t.options,e){e={};for(var o=0;o<n.length;o++)e["$"+n[o]]=!0;for(n=0;n<t.length;n++)o=e.hasOwnProperty("$"+t[n].value),t[n].selected!==o&&(t[n].selected=o),o&&r&&(t[n].defaultSelected=!0)}else{for(n=""+G(n),e=null,o=0;o<t.length;o++){if(t[o].value===n)return t[o].selected=!0,void(r&&(t[o].defaultSelected=!0));null!==e||t[o].disabled||(e=t[o])}null!==e&&(e.selected=!0)}}function rt(t,e){if(null!=e.dangerouslySetInnerHTML)throw Error(i(91));return B({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ot(t,e){var n=e.value;if(null==n){if(n=e.children,e=e.defaultValue,null!=n){if(null!=e)throw Error(i(92));if(et(n)){if(1<n.length)throw Error(i(93));n=n[0]}e=n}null==e&&(e=""),n=e}t._wrapperState={initialValue:G(n)}}function it(t,e){var n=G(e.value),r=G(e.defaultValue);null!=n&&((n=""+n)!==t.value&&(t.value=n),null==e.defaultValue&&t.defaultValue!==n&&(t.defaultValue=n)),null!=r&&(t.defaultValue=""+r)}function at(t){var e=t.textContent;e===t._wrapperState.initialValue&&""!==e&&null!==e&&(t.value=e)}function st(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ut(t,e){return null==t||"http://www.w3.org/1999/xhtml"===t?st(e):"http://www.w3.org/2000/svg"===t&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":t}var ct,lt,ht=(lt=function(t,e){if("http://www.w3.org/2000/svg"!==t.namespaceURI||"innerHTML"in t)t.innerHTML=e;else{for((ct=ct||document.createElement("div")).innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ct.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,e,n,r){MSApp.execUnsafeLocalFunction(function(){return lt(t,e)})}:lt);function dt(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&3===n.nodeType)return void(n.nodeValue=e)}t.textContent=e}var ft={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pt=["Webkit","ms","Moz","O"];function gt(t,e,n){return null==e||"boolean"===typeof e||""===e?"":n||"number"!==typeof e||0===e||ft.hasOwnProperty(t)&&ft[t]?(""+e).trim():e+"px"}function mt(t,e){for(var n in t=t.style,e)if(e.hasOwnProperty(n)){var r=0===n.indexOf("--"),o=gt(n,e[n],r);"float"===n&&(n="cssFloat"),r?t.setProperty(n,o):t[n]=o}}Object.keys(ft).forEach(function(t){pt.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ft[e]=ft[t]})});var vt=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yt(t,e){if(e){if(vt[t]&&(null!=e.children||null!=e.dangerouslySetInnerHTML))throw Error(i(137,t));if(null!=e.dangerouslySetInnerHTML){if(null!=e.children)throw Error(i(60));if("object"!==typeof e.dangerouslySetInnerHTML||!("__html"in e.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=e.style&&"object"!==typeof e.style)throw Error(i(62))}}function bt(t,e){if(-1===t.indexOf("-"))return"string"===typeof e.is;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wt=null;function xt(t){return(t=t.target||t.srcElement||window).correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var Et=null,At=null,Ct=null;function kt(t){if(t=wo(t)){if("function"!==typeof Et)throw Error(i(280));var e=t.stateNode;e&&(e=Eo(e),Et(t.stateNode,t.type,e))}}function St(t){At?Ct?Ct.push(t):Ct=[t]:At=t}function It(){if(At){var t=At,e=Ct;if(Ct=At=null,kt(t),e)for(t=0;t<e.length;t++)kt(e[t])}}function Rt(t,e){return t(e)}function Tt(){}var Nt=!1;function _t(t,e,n){if(Nt)return t(e,n);Nt=!0;try{return Rt(t,e,n)}finally{Nt=!1,(null!==At||null!==Ct)&&(Tt(),It())}}function Pt(t,e){var n=t.stateNode;if(null===n)return null;var r=Eo(n);if(null===r)return null;n=r[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(t=t.type)||"input"===t||"select"===t||"textarea"===t)),t=!r;break t;default:t=!1}if(t)return null;if(n&&"function"!==typeof n)throw Error(i(231,e,typeof n));return n}var Dt=!1;if(l)try{var Ot={};Object.defineProperty(Ot,"passive",{get:function(){Dt=!0}}),window.addEventListener("test",Ot,Ot),window.removeEventListener("test",Ot,Ot)}catch(lt){Dt=!1}function Ft(t,e,n,r,o,i,a,s,u){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(l){this.onError(l)}}var Mt=!1,Bt=null,Lt=!1,Ut=null,Wt={onError:function(t){Mt=!0,Bt=t}};function zt(t,e,n,r,o,i,a,s,u){Mt=!1,Bt=null,Ft.apply(Wt,arguments)}function Vt(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do{0!==(4098&(e=t).flags)&&(n=e.return),t=e.return}while(t)}return 3===e.tag?n:null}function jt(t){if(13===t.tag){var e=t.memoizedState;if(null===e&&(null!==(t=t.alternate)&&(e=t.memoizedState)),null!==e)return e.dehydrated}return null}function Gt(t){if(Vt(t)!==t)throw Error(i(188))}function Ht(t){return null!==(t=function(t){var e=t.alternate;if(!e){if(null===(e=Vt(t)))throw Error(i(188));return e!==t?null:t}for(var n=t,r=e;;){var o=n.return;if(null===o)break;var a=o.alternate;if(null===a){if(null!==(r=o.return)){n=r;continue}break}if(o.child===a.child){for(a=o.child;a;){if(a===n)return Gt(o),t;if(a===r)return Gt(o),e;a=a.sibling}throw Error(i(188))}if(n.return!==r.return)n=o,r=a;else{for(var s=!1,u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s){for(u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?t:e}(t))?qt(t):null}function qt(t){if(5===t.tag||6===t.tag)return t;for(t=t.child;null!==t;){var e=qt(t);if(null!==e)return e;t=t.sibling}return null}var Kt=o.unstable_scheduleCallback,Qt=o.unstable_cancelCallback,Xt=o.unstable_shouldYield,Jt=o.unstable_requestPaint,Yt=o.unstable_now,Zt=o.unstable_getCurrentPriorityLevel,$t=o.unstable_ImmediatePriority,te=o.unstable_UserBlockingPriority,ee=o.unstable_NormalPriority,ne=o.unstable_LowPriority,re=o.unstable_IdlePriority,oe=null,ie=null;var ae=Math.clz32?Math.clz32:function(t){return t>>>=0,0===t?32:31-(se(t)/ue|0)|0},se=Math.log,ue=Math.LN2;var ce=64,le=4194304;function he(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&t;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&t;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function de(t,e){var n=t.pendingLanes;if(0===n)return 0;var r=0,o=t.suspendedLanes,i=t.pingedLanes,a=268435455&n;if(0!==a){var s=a&~o;0!==s?r=he(s):0!==(i&=a)&&(r=he(i))}else 0!==(a=n&~o)?r=he(a):0!==i&&(r=he(i));if(0===r)return 0;if(0!==e&&e!==r&&0===(e&o)&&((o=r&-r)>=(i=e&-e)||16===o&&0!==(4194240&i)))return e;if(0!==(4&r)&&(r|=16&n),0!==(e=t.entangledLanes))for(t=t.entanglements,e&=r;0<e;)o=1<<(n=31-ae(e)),r|=t[n],e&=~o;return r}function fe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;default:return-1}}function pe(t){return 0!==(t=-1073741825&t.pendingLanes)?t:1073741824&t?1073741824:0}function ge(){var t=ce;return 0===(4194240&(ce<<=1))&&(ce=64),t}function me(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ve(t,e,n){t.pendingLanes|=e,536870912!==e&&(t.suspendedLanes=0,t.pingedLanes=0),(t=t.eventTimes)[e=31-ae(e)]=n}function ye(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-ae(n),o=1<<r;o&e|t[r]&e&&(t[r]|=e),n&=~o}}var be=0;function we(t){return 1<(t&=-t)?4<t?0!==(268435455&t)?16:536870912:4:1}var xe,Ee,Ae,Ce,ke,Se=!1,Ie=[],Re=null,Te=null,Ne=null,_e=new Map,Pe=new Map,De=[],Oe="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Fe(t,e){switch(t){case"focusin":case"focusout":Re=null;break;case"dragenter":case"dragleave":Te=null;break;case"mouseover":case"mouseout":Ne=null;break;case"pointerover":case"pointerout":_e.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pe.delete(e.pointerId)}}function Me(t,e,n,r,o,i){return null===t||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[o]},null!==e&&(null!==(e=wo(e))&&Ee(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,null!==o&&-1===e.indexOf(o)&&e.push(o),t)}function Be(t){var e=bo(t.target);if(null!==e){var n=Vt(e);if(null!==n)if(13===(e=n.tag)){if(null!==(e=jt(n)))return t.blockedOn=e,void ke(t.priority,function(){Ae(n)})}else if(3===e&&n.stateNode.current.memoizedState.isDehydrated)return void(t.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}t.blockedOn=null}function Le(t){if(null!==t.blockedOn)return!1;for(var e=t.targetContainers;0<e.length;){var n=Xe(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(null!==n)return null!==(e=wo(n))&&Ee(e),t.blockedOn=n,!1;var r=new(n=t.nativeEvent).constructor(n.type,n);wt=r,n.target.dispatchEvent(r),wt=null,e.shift()}return!0}function Ue(t,e,n){Le(t)&&n.delete(e)}function We(){Se=!1,null!==Re&&Le(Re)&&(Re=null),null!==Te&&Le(Te)&&(Te=null),null!==Ne&&Le(Ne)&&(Ne=null),_e.forEach(Ue),Pe.forEach(Ue)}function ze(t,e){t.blockedOn===e&&(t.blockedOn=null,Se||(Se=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,We)))}function Ve(t){function e(e){return ze(e,t)}if(0<Ie.length){ze(Ie[0],t);for(var n=1;n<Ie.length;n++){var r=Ie[n];r.blockedOn===t&&(r.blockedOn=null)}}for(null!==Re&&ze(Re,t),null!==Te&&ze(Te,t),null!==Ne&&ze(Ne,t),_e.forEach(e),Pe.forEach(e),n=0;n<De.length;n++)(r=De[n]).blockedOn===t&&(r.blockedOn=null);for(;0<De.length&&null===(n=De[0]).blockedOn;)Be(n),null===n.blockedOn&&De.shift()}var je=w.ReactCurrentBatchConfig,Ge=!0;function He(t,e,n,r){var o=be,i=je.transition;je.transition=null;try{be=1,Ke(t,e,n,r)}finally{be=o,je.transition=i}}function qe(t,e,n,r){var o=be,i=je.transition;je.transition=null;try{be=4,Ke(t,e,n,r)}finally{be=o,je.transition=i}}function Ke(t,e,n,r){if(Ge){var o=Xe(t,e,n,r);if(null===o)Gr(t,e,r,Qe,n),Fe(t,r);else if(function(t,e,n,r,o){switch(e){case"focusin":return Re=Me(Re,t,e,n,r,o),!0;case"dragenter":return Te=Me(Te,t,e,n,r,o),!0;case"mouseover":return Ne=Me(Ne,t,e,n,r,o),!0;case"pointerover":var i=o.pointerId;return _e.set(i,Me(_e.get(i)||null,t,e,n,r,o)),!0;case"gotpointercapture":return i=o.pointerId,Pe.set(i,Me(Pe.get(i)||null,t,e,n,r,o)),!0}return!1}(o,t,e,n,r))r.stopPropagation();else if(Fe(t,r),4&e&&-1<Oe.indexOf(t)){for(;null!==o;){var i=wo(o);if(null!==i&&xe(i),null===(i=Xe(t,e,n,r))&&Gr(t,e,r,Qe,n),i===o)break;o=i}null!==o&&r.stopPropagation()}else Gr(t,e,r,null,n)}}var Qe=null;function Xe(t,e,n,r){if(Qe=null,null!==(t=bo(t=xt(r))))if(null===(e=Vt(t)))t=null;else if(13===(n=e.tag)){if(null!==(t=jt(e)))return t;t=null}else if(3===n){if(e.stateNode.current.memoizedState.isDehydrated)return 3===e.tag?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Qe=t,null}function Je(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Zt()){case $t:return 1;case te:return 4;case ee:case ne:return 16;case re:return 536870912;default:return 16}default:return 16}}var Ye=null,Ze=null,$e=null;function tn(){if($e)return $e;var t,e,n=Ze,r=n.length,o="value"in Ye?Ye.value:Ye.textContent,i=o.length;for(t=0;t<r&&n[t]===o[t];t++);var a=r-t;for(e=1;e<=a&&n[r-e]===o[i-e];e++);return $e=o.slice(t,1<e?1-e:void 0)}function en(t){var e=t.keyCode;return"charCode"in t?0===(t=t.charCode)&&13===e&&(t=13):t=e,10===t&&(t=13),32<=t||13===t?t:0}function nn(){return!0}function rn(){return!1}function on(t){function e(e,n,r,o,i){for(var a in this._reactName=e,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=i,this.currentTarget=null,t)t.hasOwnProperty(a)&&(e=t[a],this[a]=e?e(o):o[a]);return this.isDefaultPrevented=(null!=o.defaultPrevented?o.defaultPrevented:!1===o.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return B(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():"unknown"!==typeof t.returnValue&&(t.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():"unknown"!==typeof t.cancelBubble&&(t.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),e}var an,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=on(cn),hn=B({},cn,{view:0,detail:0}),dn=on(hn),fn=B({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kn,button:0,buttons:0,relatedTarget:function(t){return void 0===t.relatedTarget?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==un&&(un&&"mousemove"===t.type?(an=t.screenX-un.screenX,sn=t.screenY-un.screenY):sn=an=0,un=t),an)},movementY:function(t){return"movementY"in t?t.movementY:sn}}),pn=on(fn),gn=on(B({},fn,{dataTransfer:0})),mn=on(B({},hn,{relatedTarget:0})),vn=on(B({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=B({},cn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),bn=on(yn),wn=on(B({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},En={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},An={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Cn(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):!!(t=An[t])&&!!e[t]}function kn(){return Cn}var Sn=B({},hn,{key:function(t){if(t.key){var e=xn[t.key]||t.key;if("Unidentified"!==e)return e}return"keypress"===t.type?13===(t=en(t))?"Enter":String.fromCharCode(t):"keydown"===t.type||"keyup"===t.type?En[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kn,charCode:function(t){return"keypress"===t.type?en(t):0},keyCode:function(t){return"keydown"===t.type||"keyup"===t.type?t.keyCode:0},which:function(t){return"keypress"===t.type?en(t):"keydown"===t.type||"keyup"===t.type?t.keyCode:0}}),In=on(Sn),Rn=on(B({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=on(B({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kn})),Nn=on(B({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),_n=B({},fn,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=on(_n),Dn=[9,13,27,32],On=l&&"CompositionEvent"in window,Fn=null;l&&"documentMode"in document&&(Fn=document.documentMode);var Mn=l&&"TextEvent"in window&&!Fn,Bn=l&&(!On||Fn&&8<Fn&&11>=Fn),Ln=String.fromCharCode(32),Un=!1;function Wn(t,e){switch(t){case"keyup":return-1!==Dn.indexOf(e.keyCode);case"keydown":return 229!==e.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(t){return"object"===typeof(t=t.detail)&&"data"in t?t.data:null}var Vn=!1;var jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return"input"===e?!!jn[t.type]:"textarea"===e}function Hn(t,e,n,r){St(r),0<(e=qr(e,"onChange")).length&&(n=new ln("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var qn=null,Kn=null;function Qn(t){Lr(t,0)}function Xn(t){if(K(xo(t)))return t}function Jn(t,e){if("change"===t)return e}var Yn=!1;if(l){var Zn;if(l){var $n="oninput"in document;if(!$n){var tr=document.createElement("div");tr.setAttribute("oninput","return;"),$n="function"===typeof tr.oninput}Zn=$n}else Zn=!1;Yn=Zn&&(!document.documentMode||9<document.documentMode)}function er(){qn&&(qn.detachEvent("onpropertychange",nr),Kn=qn=null)}function nr(t){if("value"===t.propertyName&&Xn(Kn)){var e=[];Hn(e,Kn,t,xt(t)),_t(Qn,e)}}function rr(t,e,n){"focusin"===t?(er(),Kn=n,(qn=e).attachEvent("onpropertychange",nr)):"focusout"===t&&er()}function or(t){if("selectionchange"===t||"keyup"===t||"keydown"===t)return Xn(Kn)}function ir(t,e){if("click"===t)return Xn(e)}function ar(t,e){if("input"===t||"change"===t)return Xn(e)}var sr="function"===typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t===1/e)||t!==t&&e!==e};function ur(t,e){if(sr(t,e))return!0;if("object"!==typeof t||null===t||"object"!==typeof e||null===e)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var o=n[r];if(!h.call(e,o)||!sr(t[o],e[o]))return!1}return!0}function cr(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function lr(t,e){var n,r=cr(t);for(t=0;r;){if(3===r.nodeType){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=cr(r)}}function hr(t,e){return!(!t||!e)&&(t===e||(!t||3!==t.nodeType)&&(e&&3===e.nodeType?hr(t,e.parentNode):"contains"in t?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))))}function dr(){for(var t=window,e=Q();e instanceof t.HTMLIFrameElement;){try{var n="string"===typeof e.contentWindow.location.href}catch(r){n=!1}if(!n)break;e=Q((t=e.contentWindow).document)}return e}function fr(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&("input"===e&&("text"===t.type||"search"===t.type||"tel"===t.type||"url"===t.type||"password"===t.type)||"textarea"===e||"true"===t.contentEditable)}function pr(t){var e=dr(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(e=r.start,void 0===(t=r.end)&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if((t=(e=n.ownerDocument||document)&&e.defaultView||window).getSelection){t=t.getSelection();var o=n.textContent.length,i=Math.min(r.start,o);r=void 0===r.end?i:Math.min(r.end,o),!t.extend&&i>r&&(o=r,r=i,i=o),o=lr(n,i);var a=lr(n,r);o&&a&&(1!==t.rangeCount||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&((e=e.createRange()).setStart(o.node,o.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}for(e=[],t=n;t=t.parentNode;)1===t.nodeType&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<e.length;n++)(t=e[n]).element.scrollLeft=t.left,t.element.scrollTop=t.top}}var gr=l&&"documentMode"in document&&11>=document.documentMode,mr=null,vr=null,yr=null,br=!1;function wr(t,e,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==Q(r)||("selectionStart"in(r=mr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=qr(vr,"onSelect")).length&&(e=new ln("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=mr)))}function xr(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Er={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},Ar={},Cr={};function kr(t){if(Ar[t])return Ar[t];if(!Er[t])return t;var e,n=Er[t];for(e in n)if(n.hasOwnProperty(e)&&e in Cr)return Ar[t]=n[e];return t}l&&(Cr=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition);var Sr=kr("animationend"),Ir=kr("animationiteration"),Rr=kr("animationstart"),Tr=kr("transitionend"),Nr=new Map,_r="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(t,e){Nr.set(t,e),u(e,[t])}for(var Dr=0;Dr<_r.length;Dr++){var Or=_r[Dr];Pr(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Pr(Sr,"onAnimationEnd"),Pr(Ir,"onAnimationIteration"),Pr(Rr,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Tr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fr));function Br(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,function(t,e,n,r,o,a,s,u,c){if(zt.apply(this,arguments),Mt){if(!Mt)throw Error(i(198));var l=Bt;Mt=!1,Bt=null,Lt||(Lt=!0,Ut=l)}}(r,e,void 0,t),t.currentTarget=null}function Lr(t,e){e=0!==(4&e);for(var n=0;n<t.length;n++){var r=t[n],o=r.event;r=r.listeners;t:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var s=r[a],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&o.isPropagationStopped())break t;Br(o,s,c),i=u}else for(a=0;a<r.length;a++){if(u=(s=r[a]).instance,c=s.currentTarget,s=s.listener,u!==i&&o.isPropagationStopped())break t;Br(o,s,c),i=u}}}if(Lt)throw t=Ut,Lt=!1,Ut=null,t}function Ur(t,e){var n=e[mo];void 0===n&&(n=e[mo]=new Set);var r=t+"__bubble";n.has(r)||(jr(e,t,2,!1),n.add(r))}function Wr(t,e,n){var r=0;e&&(r|=4),jr(n,t,r,e)}var zr="_reactListening"+Math.random().toString(36).slice(2);function Vr(t){if(!t[zr]){t[zr]=!0,a.forEach(function(e){"selectionchange"!==e&&(Mr.has(e)||Wr(e,!1,t),Wr(e,!0,t))});var e=9===t.nodeType?t:t.ownerDocument;null===e||e[zr]||(e[zr]=!0,Wr("selectionchange",!1,e))}}function jr(t,e,n,r){switch(Je(e)){case 1:var o=He;break;case 4:o=qe;break;default:o=Ke}n=o.bind(null,e,n,t),o=void 0,!Dt||"touchstart"!==e&&"touchmove"!==e&&"wheel"!==e||(o=!0),r?void 0!==o?t.addEventListener(e,n,{capture:!0,passive:o}):t.addEventListener(e,n,!0):void 0!==o?t.addEventListener(e,n,{passive:o}):t.addEventListener(e,n,!1)}function Gr(t,e,n,r,o){var i=r;if(0===(1&e)&&0===(2&e)&&null!==r)t:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===o||8===s.nodeType&&s.parentNode===o)break;if(4===a)for(a=r.return;null!==a;){var u=a.tag;if((3===u||4===u)&&((u=a.stateNode.containerInfo)===o||8===u.nodeType&&u.parentNode===o))return;a=a.return}for(;null!==s;){if(null===(a=bo(s)))return;if(5===(u=a.tag)||6===u){r=i=a;continue t}s=s.parentNode}}r=r.return}_t(function(){var r=i,o=xt(n),a=[];t:{var s=Nr.get(t);if(void 0!==s){var u=ln,c=t;switch(t){case"keypress":if(0===en(n))break t;case"keydown":case"keyup":u=In;break;case"focusin":c="focus",u=mn;break;case"focusout":c="blur",u=mn;break;case"beforeblur":case"afterblur":u=mn;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Tn;break;case Sr:case Ir:case Rr:u=vn;break;case Tr:u=Nn;break;case"scroll":u=dn;break;case"wheel":u=Pn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Rn}var l=0!==(4&e),h=!l&&"scroll"===t,d=l?null!==s?s+"Capture":null:s;l=[];for(var f,p=r;null!==p;){var g=(f=p).stateNode;if(5===f.tag&&null!==g&&(f=g,null!==d&&(null!=(g=Pt(p,d))&&l.push(Hr(p,g,f)))),h)break;p=p.return}0<l.length&&(s=new u(s,c,null,n,o),a.push({event:s,listeners:l}))}}if(0===(7&e)){if(u="mouseout"===t||"pointerout"===t,(!(s="mouseover"===t||"pointerover"===t)||n===wt||!(c=n.relatedTarget||n.fromElement)||!bo(c)&&!c[go])&&(u||s)&&(s=o.window===o?o:(s=o.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?bo(c):null)&&(c!==(h=Vt(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=pn,g="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==t&&"pointerover"!==t||(l=Rn,g="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==u?s:xo(u),f=null==c?s:xo(c),(s=new l(g,p+"leave",u,n,o)).target=h,s.relatedTarget=f,g=null,bo(o)===r&&((l=new l(d,p+"enter",c,n,o)).target=f,l.relatedTarget=h,g=l),h=g,u&&c)t:{for(d=c,p=0,f=l=u;f;f=Kr(f))p++;for(f=0,g=d;g;g=Kr(g))f++;for(;0<p-f;)l=Kr(l),p--;for(;0<f-p;)d=Kr(d),f--;for(;p--;){if(l===d||null!==d&&l===d.alternate)break t;l=Kr(l),d=Kr(d)}l=null}else l=null;null!==u&&Qr(a,s,u,l,!1),null!==c&&null!==h&&Qr(a,h,c,l,!0)}if("select"===(u=(s=r?xo(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Jn;else if(Gn(s))if(Yn)m=ar;else{m=or;var v=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ir);switch(m&&(m=m(t,r))?Hn(a,m,n,o):(v&&v(t,s,r),"focusout"===t&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&tt(s,"number",s.value)),v=r?xo(r):window,t){case"focusin":(Gn(v)||"true"===v.contentEditable)&&(mr=v,vr=r,yr=null);break;case"focusout":yr=vr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,wr(a,n,o);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":wr(a,n,o)}var y;if(On)t:{switch(t){case"compositionstart":var b="onCompositionStart";break t;case"compositionend":b="onCompositionEnd";break t;case"compositionupdate":b="onCompositionUpdate";break t}b=void 0}else Vn?Wn(t,n)&&(b="onCompositionEnd"):"keydown"===t&&229===n.keyCode&&(b="onCompositionStart");b&&(Bn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=tn()):(Ze="value"in(Ye=o)?Ye.value:Ye.textContent,Vn=!0)),0<(v=qr(r,b)).length&&(b=new wn(b,t,null,n,o),a.push({event:b,listeners:v}),y?b.data=y:null!==(y=zn(n))&&(b.data=y))),(y=Mn?function(t,e){switch(t){case"compositionend":return zn(e);case"keypress":return 32!==e.which?null:(Un=!0,Ln);case"textInput":return(t=e.data)===Ln&&Un?null:t;default:return null}}(t,n):function(t,e){if(Vn)return"compositionend"===t||!On&&Wn(t,e)?(t=tn(),$e=Ze=Ye=null,Vn=!1,t):null;switch(t){case"paste":default:return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Bn&&"ko"!==e.locale?null:e.data}}(t,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(o=new wn("onBeforeInput","beforeinput",null,n,o),a.push({event:o,listeners:r}),o.data=y))}Lr(a,e)})}function Hr(t,e,n){return{instance:t,listener:e,currentTarget:n}}function qr(t,e){for(var n=e+"Capture",r=[];null!==t;){var o=t,i=o.stateNode;5===o.tag&&null!==i&&(o=i,null!=(i=Pt(t,n))&&r.unshift(Hr(t,i,o)),null!=(i=Pt(t,e))&&r.push(Hr(t,i,o))),t=t.return}return r}function Kr(t){if(null===t)return null;do{t=t.return}while(t&&5!==t.tag);return t||null}function Qr(t,e,n,r,o){for(var i=e._reactName,a=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,o?null!=(u=Pt(n,i))&&a.unshift(Hr(n,u,s)):o||null!=(u=Pt(n,i))&&a.push(Hr(n,u,s))),n=n.return}0!==a.length&&t.push({event:e,listeners:a})}var Xr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function Yr(t){return("string"===typeof t?t:""+t).replace(Xr,"\n").replace(Jr,"")}function Zr(t,e,n){if(e=Yr(e),Yr(t)!==e&&n)throw Error(i(425))}function $r(){}var to=null,eo=null;function no(t,e){return"textarea"===t||"noscript"===t||"string"===typeof e.children||"number"===typeof e.children||"object"===typeof e.dangerouslySetInnerHTML&&null!==e.dangerouslySetInnerHTML&&null!=e.dangerouslySetInnerHTML.__html}var ro="function"===typeof setTimeout?setTimeout:void 0,oo="function"===typeof clearTimeout?clearTimeout:void 0,io="function"===typeof Promise?Promise:void 0,ao="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof io?function(t){return io.resolve(null).then(t).catch(so)}:ro;function so(t){setTimeout(function(){throw t})}function uo(t,e){var n=e,r=0;do{var o=n.nextSibling;if(t.removeChild(n),o&&8===o.nodeType)if("/$"===(n=o.data)){if(0===r)return t.removeChild(o),void Ve(e);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=o}while(n);Ve(e)}function co(t){for(;null!=t;t=t.nextSibling){var e=t.nodeType;if(1===e||3===e)break;if(8===e){if("$"===(e=t.data)||"$!"===e||"$?"===e)break;if("/$"===e)return null}}return t}function lo(t){t=t.previousSibling;for(var e=0;t;){if(8===t.nodeType){var n=t.data;if("$"===n||"$!"===n||"$?"===n){if(0===e)return t;e--}else"/$"===n&&e++}t=t.previousSibling}return null}var ho=Math.random().toString(36).slice(2),fo="__reactFiber$"+ho,po="__reactProps$"+ho,go="__reactContainer$"+ho,mo="__reactEvents$"+ho,vo="__reactListeners$"+ho,yo="__reactHandles$"+ho;function bo(t){var e=t[fo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[go]||n[fo]){if(n=e.alternate,null!==e.child||null!==n&&null!==n.child)for(t=lo(t);null!==t;){if(n=t[fo])return n;t=lo(t)}return e}n=(t=n).parentNode}return null}function wo(t){return!(t=t[fo]||t[go])||5!==t.tag&&6!==t.tag&&13!==t.tag&&3!==t.tag?null:t}function xo(t){if(5===t.tag||6===t.tag)return t.stateNode;throw Error(i(33))}function Eo(t){return t[po]||null}var Ao=[],Co=-1;function ko(t){return{current:t}}function So(t){0>Co||(t.current=Ao[Co],Ao[Co]=null,Co--)}function Io(t,e){Co++,Ao[Co]=t.current,t.current=e}var Ro={},To=ko(Ro),No=ko(!1),_o=Ro;function Po(t,e){var n=t.type.contextTypes;if(!n)return Ro;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var o,i={};for(o in n)i[o]=e[o];return r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Do(t){return null!==(t=t.childContextTypes)&&void 0!==t}function Oo(){So(No),So(To)}function Fo(t,e,n){if(To.current!==Ro)throw Error(i(168));Io(To,e),Io(No,n)}function Mo(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var o in r=r.getChildContext())if(!(o in e))throw Error(i(108,j(t)||"Unknown",o));return B({},n,r)}function Bo(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ro,_o=To.current,Io(To,t),Io(No,No.current),!0}function Lo(t,e,n){var r=t.stateNode;if(!r)throw Error(i(169));n?(t=Mo(t,e,_o),r.__reactInternalMemoizedMergedChildContext=t,So(No),So(To),Io(To,t)):So(No),Io(No,n)}var Uo=null,Wo=!1,zo=!1;function Vo(t){null===Uo?Uo=[t]:Uo.push(t)}function jo(){if(!zo&&null!==Uo){zo=!0;var t=0,e=be;try{var n=Uo;for(be=1;t<n.length;t++){var r=n[t];do{r=r(!0)}while(null!==r)}Uo=null,Wo=!1}catch(o){throw null!==Uo&&(Uo=Uo.slice(t+1)),Kt($t,jo),o}finally{be=e,zo=!1}}return null}var Go=[],Ho=0,qo=null,Ko=0,Qo=[],Xo=0,Jo=null,Yo=1,Zo="";function $o(t,e){Go[Ho++]=Ko,Go[Ho++]=qo,qo=t,Ko=e}function ti(t,e,n){Qo[Xo++]=Yo,Qo[Xo++]=Zo,Qo[Xo++]=Jo,Jo=t;var r=Yo;t=Zo;var o=32-ae(r)-1;r&=~(1<<o),n+=1;var i=32-ae(e)+o;if(30<i){var a=o-o%5;i=(r&(1<<a)-1).toString(32),r>>=a,o-=a,Yo=1<<32-ae(e)+o|n<<o|r,Zo=i+t}else Yo=1<<i|n<<o|r,Zo=t}function ei(t){null!==t.return&&($o(t,1),ti(t,1,0))}function ni(t){for(;t===qo;)qo=Go[--Ho],Go[Ho]=null,Ko=Go[--Ho],Go[Ho]=null;for(;t===Jo;)Jo=Qo[--Xo],Qo[Xo]=null,Zo=Qo[--Xo],Qo[Xo]=null,Yo=Qo[--Xo],Qo[Xo]=null}var ri=null,oi=null,ii=!1,ai=null;function si(t,e){var n=_c(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,null===(e=t.deletions)?(t.deletions=[n],t.flags|=16):e.push(n)}function ui(t,e){switch(t.tag){case 5:var n=t.type;return null!==(e=1!==e.nodeType||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e)&&(t.stateNode=e,ri=t,oi=co(e.firstChild),!0);case 6:return null!==(e=""===t.pendingProps||3!==e.nodeType?null:e)&&(t.stateNode=e,ri=t,oi=null,!0);case 13:return null!==(e=8!==e.nodeType?null:e)&&(n=null!==Jo?{id:Yo,overflow:Zo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},(n=_c(18,null,null,0)).stateNode=e,n.return=t,t.child=n,ri=t,oi=null,!0);default:return!1}}function ci(t){return 0!==(1&t.mode)&&0===(128&t.flags)}function li(t){if(ii){var e=oi;if(e){var n=e;if(!ui(t,e)){if(ci(t))throw Error(i(418));e=co(n.nextSibling);var r=ri;e&&ui(t,e)?si(r,n):(t.flags=-4097&t.flags|2,ii=!1,ri=t)}}else{if(ci(t))throw Error(i(418));t.flags=-4097&t.flags|2,ii=!1,ri=t}}}function hi(t){for(t=t.return;null!==t&&5!==t.tag&&3!==t.tag&&13!==t.tag;)t=t.return;ri=t}function di(t){if(t!==ri)return!1;if(!ii)return hi(t),ii=!0,!1;var e;if((e=3!==t.tag)&&!(e=5!==t.tag)&&(e="head"!==(e=t.type)&&"body"!==e&&!no(t.type,t.memoizedProps)),e&&(e=oi)){if(ci(t))throw fi(),Error(i(418));for(;e;)si(t,e),e=co(e.nextSibling)}if(hi(t),13===t.tag){if(!(t=null!==(t=t.memoizedState)?t.dehydrated:null))throw Error(i(317));t:{for(t=t.nextSibling,e=0;t;){if(8===t.nodeType){var n=t.data;if("/$"===n){if(0===e){oi=co(t.nextSibling);break t}e--}else"$"!==n&&"$!"!==n&&"$?"!==n||e++}t=t.nextSibling}oi=null}}else oi=ri?co(t.stateNode.nextSibling):null;return!0}function fi(){for(var t=oi;t;)t=co(t.nextSibling)}function pi(){oi=ri=null,ii=!1}function gi(t){null===ai?ai=[t]:ai.push(t)}var mi=w.ReactCurrentBatchConfig;function vi(t,e,n){if(null!==(t=n.ref)&&"function"!==typeof t&&"object"!==typeof t){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,t));var o=r,a=""+t;return null!==e&&null!==e.ref&&"function"===typeof e.ref&&e.ref._stringRef===a?e.ref:(e=function(t){var e=o.refs;null===t?delete e[a]:e[a]=t},e._stringRef=a,e)}if("string"!==typeof t)throw Error(i(284));if(!n._owner)throw Error(i(290,t))}return t}function yi(t,e){throw t=Object.prototype.toString.call(e),Error(i(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function bi(t){return(0,t._init)(t._payload)}function wi(t){function e(e,n){if(t){var r=e.deletions;null===r?(e.deletions=[n],e.flags|=16):r.push(n)}}function n(n,r){if(!t)return null;for(;null!==r;)e(n,r),r=r.sibling;return null}function r(t,e){for(t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function o(t,e){return(t=Dc(t,e)).index=0,t.sibling=null,t}function a(e,n,r){return e.index=r,t?null!==(r=e.alternate)?(r=r.index)<n?(e.flags|=2,n):r:(e.flags|=2,n):(e.flags|=1048576,n)}function s(e){return t&&null===e.alternate&&(e.flags|=2),e}function u(t,e,n,r){return null===e||6!==e.tag?((e=Bc(n,t.mode,r)).return=t,e):((e=o(e,n)).return=t,e)}function c(t,e,n,r){var i=n.type;return i===A?h(t,e,n.props.children,r,n.key):null!==e&&(e.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===P&&bi(i)===e.type)?((r=o(e,n.props)).ref=vi(t,e,n),r.return=t,r):((r=Oc(n.type,n.key,n.props,null,t.mode,r)).ref=vi(t,e,n),r.return=t,r)}function l(t,e,n,r){return null===e||4!==e.tag||e.stateNode.containerInfo!==n.containerInfo||e.stateNode.implementation!==n.implementation?((e=Lc(n,t.mode,r)).return=t,e):((e=o(e,n.children||[])).return=t,e)}function h(t,e,n,r,i){return null===e||7!==e.tag?((e=Fc(n,t.mode,r,i)).return=t,e):((e=o(e,n)).return=t,e)}function d(t,e,n){if("string"===typeof e&&""!==e||"number"===typeof e)return(e=Bc(""+e,t.mode,n)).return=t,e;if("object"===typeof e&&null!==e){switch(e.$$typeof){case x:return(n=Oc(e.type,e.key,e.props,null,t.mode,n)).ref=vi(t,null,e),n.return=t,n;case E:return(e=Lc(e,t.mode,n)).return=t,e;case P:return d(t,(0,e._init)(e._payload),n)}if(et(e)||F(e))return(e=Fc(e,t.mode,n,null)).return=t,e;yi(t,e)}return null}function f(t,e,n,r){var o=null!==e?e.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==o?null:u(t,e,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===o?c(t,e,n,r):null;case E:return n.key===o?l(t,e,n,r):null;case P:return f(t,e,(o=n._init)(n._payload),r)}if(et(n)||F(n))return null!==o?null:h(t,e,n,r,null);yi(t,n)}return null}function p(t,e,n,r,o){if("string"===typeof r&&""!==r||"number"===typeof r)return u(e,t=t.get(n)||null,""+r,o);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return c(e,t=t.get(null===r.key?n:r.key)||null,r,o);case E:return l(e,t=t.get(null===r.key?n:r.key)||null,r,o);case P:return p(t,e,n,(0,r._init)(r._payload),o)}if(et(r)||F(r))return h(e,t=t.get(n)||null,r,o,null);yi(e,r)}return null}function g(o,i,s,u){for(var c=null,l=null,h=i,g=i=0,m=null;null!==h&&g<s.length;g++){h.index>g?(m=h,h=null):m=h.sibling;var v=f(o,h,s[g],u);if(null===v){null===h&&(h=m);break}t&&h&&null===v.alternate&&e(o,h),i=a(v,i,g),null===l?c=v:l.sibling=v,l=v,h=m}if(g===s.length)return n(o,h),ii&&$o(o,g),c;if(null===h){for(;g<s.length;g++)null!==(h=d(o,s[g],u))&&(i=a(h,i,g),null===l?c=h:l.sibling=h,l=h);return ii&&$o(o,g),c}for(h=r(o,h);g<s.length;g++)null!==(m=p(h,o,g,s[g],u))&&(t&&null!==m.alternate&&h.delete(null===m.key?g:m.key),i=a(m,i,g),null===l?c=m:l.sibling=m,l=m);return t&&h.forEach(function(t){return e(o,t)}),ii&&$o(o,g),c}function m(o,s,u,c){var l=F(u);if("function"!==typeof l)throw Error(i(150));if(null==(u=l.call(u)))throw Error(i(151));for(var h=l=null,g=s,m=s=0,v=null,y=u.next();null!==g&&!y.done;m++,y=u.next()){g.index>m?(v=g,g=null):v=g.sibling;var b=f(o,g,y.value,c);if(null===b){null===g&&(g=v);break}t&&g&&null===b.alternate&&e(o,g),s=a(b,s,m),null===h?l=b:h.sibling=b,h=b,g=v}if(y.done)return n(o,g),ii&&$o(o,m),l;if(null===g){for(;!y.done;m++,y=u.next())null!==(y=d(o,y.value,c))&&(s=a(y,s,m),null===h?l=y:h.sibling=y,h=y);return ii&&$o(o,m),l}for(g=r(o,g);!y.done;m++,y=u.next())null!==(y=p(g,o,m,y.value,c))&&(t&&null!==y.alternate&&g.delete(null===y.key?m:y.key),s=a(y,s,m),null===h?l=y:h.sibling=y,h=y);return t&&g.forEach(function(t){return e(o,t)}),ii&&$o(o,m),l}return function t(r,i,a,u){if("object"===typeof a&&null!==a&&a.type===A&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case x:t:{for(var c=a.key,l=i;null!==l;){if(l.key===c){if((c=a.type)===A){if(7===l.tag){n(r,l.sibling),(i=o(l,a.props.children)).return=r,r=i;break t}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&bi(c)===l.type){n(r,l.sibling),(i=o(l,a.props)).ref=vi(r,l,a),i.return=r,r=i;break t}n(r,l);break}e(r,l),l=l.sibling}a.type===A?((i=Fc(a.props.children,r.mode,u,a.key)).return=r,r=i):((u=Oc(a.type,a.key,a.props,null,r.mode,u)).ref=vi(r,i,a),u.return=r,r=u)}return s(r);case E:t:{for(l=a.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===a.containerInfo&&i.stateNode.implementation===a.implementation){n(r,i.sibling),(i=o(i,a.children||[])).return=r,r=i;break t}n(r,i);break}e(r,i),i=i.sibling}(i=Lc(a,r.mode,u)).return=r,r=i}return s(r);case P:return t(r,i,(l=a._init)(a._payload),u)}if(et(a))return g(r,i,a,u);if(F(a))return m(r,i,a,u);yi(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==i&&6===i.tag?(n(r,i.sibling),(i=o(i,a)).return=r,r=i):(n(r,i),(i=Bc(a,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var xi=wi(!0),Ei=wi(!1),Ai=ko(null),Ci=null,ki=null,Si=null;function Ii(){Si=ki=Ci=null}function Ri(t){var e=Ai.current;So(Ai),t._currentValue=e}function Ti(t,e,n){for(;null!==t;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,null!==r&&(r.childLanes|=e)):null!==r&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Ni(t,e){Ci=t,Si=ki=null,null!==(t=t.dependencies)&&null!==t.firstContext&&(0!==(t.lanes&e)&&(bs=!0),t.firstContext=null)}function _i(t){var e=t._currentValue;if(Si!==t)if(t={context:t,memoizedValue:e,next:null},null===ki){if(null===Ci)throw Error(i(308));ki=t,Ci.dependencies={lanes:0,firstContext:t}}else ki=ki.next=t;return e}var Pi=null;function Di(t){null===Pi?Pi=[t]:Pi.push(t)}function Oi(t,e,n,r){var o=e.interleaved;return null===o?(n.next=n,Di(e)):(n.next=o.next,o.next=n),e.interleaved=n,Fi(t,r)}function Fi(t,e){t.lanes|=e;var n=t.alternate;for(null!==n&&(n.lanes|=e),n=t,t=t.return;null!==t;)t.childLanes|=e,null!==(n=t.alternate)&&(n.childLanes|=e),n=t,t=t.return;return 3===n.tag?n.stateNode:null}var Mi=!1;function Bi(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Li(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ui(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Wi(t,e,n){var r=t.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Ru)){var o=r.pending;return null===o?e.next=e:(e.next=o.next,o.next=e),r.pending=e,Fi(t,n)}return null===(o=r.interleaved)?(e.next=e,Di(r)):(e.next=o.next,o.next=e),r.interleaved=e,Fi(t,n)}function zi(t,e,n){if(null!==(e=e.updateQueue)&&(e=e.shared,0!==(4194240&n))){var r=e.lanes;n|=r&=t.pendingLanes,e.lanes=n,ye(t,n)}}function Vi(t,e){var n=t.updateQueue,r=t.alternate;if(null!==r&&n===(r=r.updateQueue)){var o=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?o=i=a:i=i.next=a,n=n.next}while(null!==n);null===i?o=i=e:i=i.next=e}else o=i=e;return n={baseState:r.baseState,firstBaseUpdate:o,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(t.updateQueue=n)}null===(t=n.lastBaseUpdate)?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function ji(t,e,n,r){var o=t.updateQueue;Mi=!1;var i=o.firstBaseUpdate,a=o.lastBaseUpdate,s=o.shared.pending;if(null!==s){o.shared.pending=null;var u=s,c=u.next;u.next=null,null===a?i=c:a.next=c,a=u;var l=t.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==a&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==i){var h=o.baseState;for(a=0,l=c=u=null,s=i;;){var d=s.lane,f=s.eventTime;if((r&d)===d){null!==l&&(l=l.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});t:{var p=t,g=s;switch(d=e,f=n,g.tag){case 1:if("function"===typeof(p=g.payload)){h=p.call(f,h,d);break t}h=p;break t;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=g.payload)?p.call(f,h,d):p)||void 0===d)break t;h=B({},h,d);break t;case 2:Mi=!0}}null!==s.callback&&0!==s.lane&&(t.flags|=64,null===(d=o.effects)?o.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=f,u=h):l=l.next=f,a|=d;if(null===(s=s.next)){if(null===(s=o.shared.pending))break;s=(d=s).next,d.next=null,o.lastBaseUpdate=d,o.shared.pending=null}}if(null===l&&(u=h),o.baseState=u,o.firstBaseUpdate=c,o.lastBaseUpdate=l,null!==(e=o.shared.interleaved)){o=e;do{a|=o.lane,o=o.next}while(o!==e)}else null===i&&(o.shared.lanes=0);Mu|=a,t.lanes=a,t.memoizedState=h}}function Gi(t,e,n){if(t=e.effects,e.effects=null,null!==t)for(e=0;e<t.length;e++){var r=t[e],o=r.callback;if(null!==o){if(r.callback=null,r=n,"function"!==typeof o)throw Error(i(191,o));o.call(r)}}}var Hi={},qi=ko(Hi),Ki=ko(Hi),Qi=ko(Hi);function Xi(t){if(t===Hi)throw Error(i(174));return t}function Ji(t,e){switch(Io(Qi,e),Io(Ki,t),Io(qi,Hi),t=e.nodeType){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ut(null,"");break;default:e=ut(e=(t=8===t?e.parentNode:e).namespaceURI||null,t=t.tagName)}So(qi),Io(qi,e)}function Yi(){So(qi),So(Ki),So(Qi)}function Zi(t){Xi(Qi.current);var e=Xi(qi.current),n=ut(e,t.type);e!==n&&(Io(Ki,t),Io(qi,n))}function $i(t){Ki.current===t&&(So(qi),So(Ki))}var ta=ko(0);function ea(t){for(var e=t;null!==e;){if(13===e.tag){var n=e.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return e}else if(19===e.tag&&void 0!==e.memoizedProps.revealOrder){if(0!==(128&e.flags))return e}else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var na=[];function ra(){for(var t=0;t<na.length;t++)na[t]._workInProgressVersionPrimary=null;na.length=0}var oa=w.ReactCurrentDispatcher,ia=w.ReactCurrentBatchConfig,aa=0,sa=null,ua=null,ca=null,la=!1,ha=!1,da=0,fa=0;function pa(){throw Error(i(321))}function ga(t,e){if(null===e)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!sr(t[n],e[n]))return!1;return!0}function ma(t,e,n,r,o,a){if(aa=a,sa=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,oa.current=null===t||null===t.memoizedState?$a:ts,t=n(r,o),ha){a=0;do{if(ha=!1,da=0,25<=a)throw Error(i(301));a+=1,ca=ua=null,e.updateQueue=null,oa.current=es,t=n(r,o)}while(ha)}if(oa.current=Za,e=null!==ua&&null!==ua.next,aa=0,ca=ua=sa=null,la=!1,e)throw Error(i(300));return t}function va(){var t=0!==da;return da=0,t}function ya(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ca?sa.memoizedState=ca=t:ca=ca.next=t,ca}function ba(){if(null===ua){var t=sa.alternate;t=null!==t?t.memoizedState:null}else t=ua.next;var e=null===ca?sa.memoizedState:ca.next;if(null!==e)ca=e,ua=t;else{if(null===t)throw Error(i(310));t={memoizedState:(ua=t).memoizedState,baseState:ua.baseState,baseQueue:ua.baseQueue,queue:ua.queue,next:null},null===ca?sa.memoizedState=ca=t:ca=ca.next=t}return ca}function wa(t,e){return"function"===typeof e?e(t):e}function xa(t){var e=ba(),n=e.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=t;var r=ua,o=r.baseQueue,a=n.pending;if(null!==a){if(null!==o){var s=o.next;o.next=a.next,a.next=s}r.baseQueue=o=a,n.pending=null}if(null!==o){a=o.next,r=r.baseState;var u=s=null,c=null,l=a;do{var h=l.lane;if((aa&h)===h)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var d={lane:h,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=d,s=r):c=c.next=d,sa.lanes|=h,Mu|=h}l=l.next}while(null!==l&&l!==a);null===c?s=r:c.next=u,sr(r,e.memoizedState)||(bs=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=c,n.lastRenderedState=r}if(null!==(t=n.interleaved)){o=t;do{a=o.lane,sa.lanes|=a,Mu|=a,o=o.next}while(o!==t)}else null===o&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ea(t){var e=ba(),n=e.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=t;var r=n.dispatch,o=n.pending,a=e.memoizedState;if(null!==o){n.pending=null;var s=o=o.next;do{a=t(a,s.action),s=s.next}while(s!==o);sr(a,e.memoizedState)||(bs=!0),e.memoizedState=a,null===e.baseQueue&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function Aa(){}function Ca(t,e){var n=sa,r=ba(),o=e(),a=!sr(r.memoizedState,o);if(a&&(r.memoizedState=o,bs=!0),r=r.queue,Ma(Ia.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||null!==ca&&1&ca.memoizedState.tag){if(n.flags|=2048,_a(9,Sa.bind(null,n,r,o,e),void 0,null),null===Tu)throw Error(i(349));0!==(30&aa)||ka(n,e,o)}return o}function ka(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},null===(e=sa.updateQueue)?(e={lastEffect:null,stores:null},sa.updateQueue=e,e.stores=[t]):null===(n=e.stores)?e.stores=[t]:n.push(t)}function Sa(t,e,n,r){e.value=n,e.getSnapshot=r,Ra(e)&&Ta(t)}function Ia(t,e,n){return n(function(){Ra(e)&&Ta(t)})}function Ra(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!sr(t,n)}catch(r){return!0}}function Ta(t){var e=Fi(t,1);null!==e&&nc(e,t,1,-1)}function Na(t){var e=ya();return"function"===typeof t&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:wa,lastRenderedState:t},e.queue=t,t=t.dispatch=Qa.bind(null,sa,t),[e.memoizedState,t]}function _a(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},null===(e=sa.updateQueue)?(e={lastEffect:null,stores:null},sa.updateQueue=e,e.lastEffect=t.next=t):null===(n=e.lastEffect)?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t),t}function Pa(){return ba().memoizedState}function Da(t,e,n,r){var o=ya();sa.flags|=t,o.memoizedState=_a(1|e,n,void 0,void 0===r?null:r)}function Oa(t,e,n,r){var o=ba();r=void 0===r?null:r;var i=void 0;if(null!==ua){var a=ua.memoizedState;if(i=a.destroy,null!==r&&ga(r,a.deps))return void(o.memoizedState=_a(e,n,i,r))}sa.flags|=t,o.memoizedState=_a(1|e,n,i,r)}function Fa(t,e){return Da(8390656,8,t,e)}function Ma(t,e){return Oa(2048,8,t,e)}function Ba(t,e){return Oa(4,2,t,e)}function La(t,e){return Oa(4,4,t,e)}function Ua(t,e){return"function"===typeof e?(t=t(),e(t),function(){e(null)}):null!==e&&void 0!==e?(t=t(),e.current=t,function(){e.current=null}):void 0}function Wa(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Oa(4,4,Ua.bind(null,e,t),n)}function za(){}function Va(t,e){var n=ba();e=void 0===e?null:e;var r=n.memoizedState;return null!==r&&null!==e&&ga(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function ja(t,e){var n=ba();e=void 0===e?null:e;var r=n.memoizedState;return null!==r&&null!==e&&ga(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Ga(t,e,n){return 0===(21&aa)?(t.baseState&&(t.baseState=!1,bs=!0),t.memoizedState=n):(sr(n,e)||(n=ge(),sa.lanes|=n,Mu|=n,t.baseState=!0),e)}function Ha(t,e){var n=be;be=0!==n&&4>n?n:4,t(!0);var r=ia.transition;ia.transition={};try{t(!1),e()}finally{be=n,ia.transition=r}}function qa(){return ba().memoizedState}function Ka(t,e,n){var r=ec(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Xa(t))Ja(e,n);else if(null!==(n=Oi(t,e,n,r))){nc(n,t,r,tc()),Ya(n,e,r)}}function Qa(t,e,n){var r=ec(t),o={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Xa(t))Ja(e,o);else{var i=t.alternate;if(0===t.lanes&&(null===i||0===i.lanes)&&null!==(i=e.lastRenderedReducer))try{var a=e.lastRenderedState,s=i(a,n);if(o.hasEagerState=!0,o.eagerState=s,sr(s,a)){var u=e.interleaved;return null===u?(o.next=o,Di(e)):(o.next=u.next,u.next=o),void(e.interleaved=o)}}catch(c){}null!==(n=Oi(t,e,o,r))&&(nc(n,t,r,o=tc()),Ya(n,e,r))}}function Xa(t){var e=t.alternate;return t===sa||null!==e&&e===sa}function Ja(t,e){ha=la=!0;var n=t.pending;null===n?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Ya(t,e,n){if(0!==(4194240&n)){var r=e.lanes;n|=r&=t.pendingLanes,e.lanes=n,ye(t,n)}}var Za={readContext:_i,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},$a={readContext:_i,useCallback:function(t,e){return ya().memoizedState=[t,void 0===e?null:e],t},useContext:_i,useEffect:Fa,useImperativeHandle:function(t,e,n){return n=null!==n&&void 0!==n?n.concat([t]):null,Da(4194308,4,Ua.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Da(4194308,4,t,e)},useInsertionEffect:function(t,e){return Da(4,2,t,e)},useMemo:function(t,e){var n=ya();return e=void 0===e?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ya();return e=void 0!==n?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Ka.bind(null,sa,t),[r.memoizedState,t]},useRef:function(t){return t={current:t},ya().memoizedState=t},useState:Na,useDebugValue:za,useDeferredValue:function(t){return ya().memoizedState=t},useTransition:function(){var t=Na(!1),e=t[0];return t=Ha.bind(null,t[1]),ya().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=sa,o=ya();if(ii){if(void 0===n)throw Error(i(407));n=n()}else{if(n=e(),null===Tu)throw Error(i(349));0!==(30&aa)||ka(r,e,n)}o.memoizedState=n;var a={value:n,getSnapshot:e};return o.queue=a,Fa(Ia.bind(null,r,a,t),[t]),r.flags|=2048,_a(9,Sa.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=ya(),e=Tu.identifierPrefix;if(ii){var n=Zo;e=":"+e+"R"+(n=(Yo&~(1<<32-ae(Yo)-1)).toString(32)+n),0<(n=da++)&&(e+="H"+n.toString(32)),e+=":"}else e=":"+e+"r"+(n=fa++).toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ts={readContext:_i,useCallback:Va,useContext:_i,useEffect:Ma,useImperativeHandle:Wa,useInsertionEffect:Ba,useLayoutEffect:La,useMemo:ja,useReducer:xa,useRef:Pa,useState:function(){return xa(wa)},useDebugValue:za,useDeferredValue:function(t){return Ga(ba(),ua.memoizedState,t)},useTransition:function(){return[xa(wa)[0],ba().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Ca,useId:qa,unstable_isNewReconciler:!1},es={readContext:_i,useCallback:Va,useContext:_i,useEffect:Ma,useImperativeHandle:Wa,useInsertionEffect:Ba,useLayoutEffect:La,useMemo:ja,useReducer:Ea,useRef:Pa,useState:function(){return Ea(wa)},useDebugValue:za,useDeferredValue:function(t){var e=ba();return null===ua?e.memoizedState=t:Ga(e,ua.memoizedState,t)},useTransition:function(){return[Ea(wa)[0],ba().memoizedState]},useMutableSource:Aa,useSyncExternalStore:Ca,useId:qa,unstable_isNewReconciler:!1};function ns(t,e){if(t&&t.defaultProps){for(var n in e=B({},e),t=t.defaultProps)void 0===e[n]&&(e[n]=t[n]);return e}return e}function rs(t,e,n,r){n=null===(n=n(r,e=t.memoizedState))||void 0===n?e:B({},e,n),t.memoizedState=n,0===t.lanes&&(t.updateQueue.baseState=n)}var os={isMounted:function(t){return!!(t=t._reactInternals)&&Vt(t)===t},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=tc(),o=ec(t),i=Ui(r,o);i.payload=e,void 0!==n&&null!==n&&(i.callback=n),null!==(e=Wi(t,i,o))&&(nc(e,t,o,r),zi(e,t,o))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=tc(),o=ec(t),i=Ui(r,o);i.tag=1,i.payload=e,void 0!==n&&null!==n&&(i.callback=n),null!==(e=Wi(t,i,o))&&(nc(e,t,o,r),zi(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=tc(),r=ec(t),o=Ui(n,r);o.tag=2,void 0!==e&&null!==e&&(o.callback=e),null!==(e=Wi(t,o,r))&&(nc(e,t,r,n),zi(e,t,r))}};function is(t,e,n,r,o,i,a){return"function"===typeof(t=t.stateNode).shouldComponentUpdate?t.shouldComponentUpdate(r,i,a):!e.prototype||!e.prototype.isPureReactComponent||(!ur(n,r)||!ur(o,i))}function as(t,e,n){var r=!1,o=Ro,i=e.contextType;return"object"===typeof i&&null!==i?i=_i(i):(o=Do(e)?_o:To.current,i=(r=null!==(r=e.contextTypes)&&void 0!==r)?Po(t,o):Ro),e=new e(n,i),t.memoizedState=null!==e.state&&void 0!==e.state?e.state:null,e.updater=os,t.stateNode=e,e._reactInternals=t,r&&((t=t.stateNode).__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=i),e}function ss(t,e,n,r){t=e.state,"function"===typeof e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r),"function"===typeof e.UNSAFE_componentWillReceiveProps&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&os.enqueueReplaceState(e,e.state,null)}function us(t,e,n,r){var o=t.stateNode;o.props=n,o.state=t.memoizedState,o.refs={},Bi(t);var i=e.contextType;"object"===typeof i&&null!==i?o.context=_i(i):(i=Do(e)?_o:To.current,o.context=Po(t,i)),o.state=t.memoizedState,"function"===typeof(i=e.getDerivedStateFromProps)&&(rs(t,e,i,n),o.state=t.memoizedState),"function"===typeof e.getDerivedStateFromProps||"function"===typeof o.getSnapshotBeforeUpdate||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||(e=o.state,"function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),e!==o.state&&os.enqueueReplaceState(o,o.state,null),ji(t,n,o,r),o.state=t.memoizedState),"function"===typeof o.componentDidMount&&(t.flags|=4194308)}function cs(t,e){try{var n="",r=e;do{n+=z(r),r=r.return}while(r);var o=n}catch(i){o="\nError generating stack: "+i.message+"\n"+i.stack}return{value:t,source:e,stack:o,digest:null}}function ls(t,e,n){return{value:t,source:null,stack:null!=n?n:null,digest:null!=e?e:null}}function hs(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var ds="function"===typeof WeakMap?WeakMap:Map;function fs(t,e,n){(n=Ui(-1,n)).tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Gu||(Gu=!0,Hu=r),hs(0,e)},n}function ps(t,e,n){(n=Ui(-1,n)).tag=3;var r=t.type.getDerivedStateFromError;if("function"===typeof r){var o=e.value;n.payload=function(){return r(o)},n.callback=function(){hs(0,e)}}var i=t.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){hs(0,e),"function"!==typeof r&&(null===qu?qu=new Set([this]):qu.add(this));var t=e.stack;this.componentDidCatch(e.value,{componentStack:null!==t?t:""})}),n}function gs(t,e,n){var r=t.pingCache;if(null===r){r=t.pingCache=new ds;var o=new Set;r.set(e,o)}else void 0===(o=r.get(e))&&(o=new Set,r.set(e,o));o.has(n)||(o.add(n),t=kc.bind(null,t,e,n),e.then(t,t))}function ms(t){do{var e;if((e=13===t.tag)&&(e=null===(e=t.memoizedState)||null!==e.dehydrated),e)return t;t=t.return}while(null!==t);return null}function vs(t,e,n,r,o){return 0===(1&t.mode)?(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((e=Ui(-1,1)).tag=2,Wi(n,e,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=o,t)}var ys=w.ReactCurrentOwner,bs=!1;function ws(t,e,n,r){e.child=null===t?Ei(e,null,n,r):xi(e,t.child,n,r)}function xs(t,e,n,r,o){n=n.render;var i=e.ref;return Ni(e,o),r=ma(t,e,n,r,i,o),n=va(),null===t||bs?(ii&&n&&ei(e),e.flags|=1,ws(t,e,r,o),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Gs(t,e,o))}function Es(t,e,n,r,o){if(null===t){var i=n.type;return"function"!==typeof i||Pc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((t=Oc(n.type,null,r,e,e.mode,o)).ref=e.ref,t.return=e,e.child=t):(e.tag=15,e.type=i,As(t,e,i,r,o))}if(i=t.child,0===(t.lanes&o)){var a=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(a,r)&&t.ref===e.ref)return Gs(t,e,o)}return e.flags|=1,(t=Dc(i,r)).ref=e.ref,t.return=e,e.child=t}function As(t,e,n,r,o){if(null!==t){var i=t.memoizedProps;if(ur(i,r)&&t.ref===e.ref){if(bs=!1,e.pendingProps=r=i,0===(t.lanes&o))return e.lanes=t.lanes,Gs(t,e,o);0!==(131072&t.flags)&&(bs=!0)}}return Ss(t,e,n,r,o)}function Cs(t,e,n){var r=e.pendingProps,o=r.children,i=null!==t?t.memoizedState:null;if("hidden"===r.mode)if(0===(1&e.mode))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Io(Du,Pu),Pu|=n;else{if(0===(1073741824&n))return t=null!==i?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Io(Du,Pu),Pu|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Io(Du,Pu),Pu|=r}else null!==i?(r=i.baseLanes|n,e.memoizedState=null):r=n,Io(Du,Pu),Pu|=r;return ws(t,e,o,n),e.child}function ks(t,e){var n=e.ref;(null===t&&null!==n||null!==t&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Ss(t,e,n,r,o){var i=Do(n)?_o:To.current;return i=Po(e,i),Ni(e,o),n=ma(t,e,n,r,i,o),r=va(),null===t||bs?(ii&&r&&ei(e),e.flags|=1,ws(t,e,n,o),e.child):(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Gs(t,e,o))}function Is(t,e,n,r,o){if(Do(n)){var i=!0;Bo(e)}else i=!1;if(Ni(e,o),null===e.stateNode)js(t,e),as(e,n,r),us(e,n,r,o),r=!0;else if(null===t){var a=e.stateNode,s=e.memoizedProps;a.props=s;var u=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=_i(c):c=Po(e,c=Do(n)?_o:To.current);var l=n.getDerivedStateFromProps,h="function"===typeof l||"function"===typeof a.getSnapshotBeforeUpdate;h||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==r||u!==c)&&ss(e,a,r,c),Mi=!1;var d=e.memoizedState;a.state=d,ji(e,r,a,o),u=e.memoizedState,s!==r||d!==u||No.current||Mi?("function"===typeof l&&(rs(e,n,l,r),u=e.memoizedState),(s=Mi||is(e,n,s,r,d,u,c))?(h||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(e.flags|=4194308)):("function"===typeof a.componentDidMount&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),a.props=r,a.state=u,a.context=c,r=s):("function"===typeof a.componentDidMount&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Li(t,e),s=e.memoizedProps,c=e.type===e.elementType?s:ns(e.type,s),a.props=c,h=e.pendingProps,d=a.context,"object"===typeof(u=n.contextType)&&null!==u?u=_i(u):u=Po(e,u=Do(n)?_o:To.current);var f=n.getDerivedStateFromProps;(l="function"===typeof f||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==h||d!==u)&&ss(e,a,r,u),Mi=!1,d=e.memoizedState,a.state=d,ji(e,r,a,o);var p=e.memoizedState;s!==h||d!==p||No.current||Mi?("function"===typeof f&&(rs(e,n,f,r),p=e.memoizedState),(c=Mi||is(e,n,c,r,d,p,u)||!1)?(l||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,p,u),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof a.componentDidUpdate&&(e.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(e.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),a.props=r,a.state=p,a.context=u,r=c):("function"!==typeof a.componentDidUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),r=!1)}return Rs(t,e,n,r,i,o)}function Rs(t,e,n,r,o,i){ks(t,e);var a=0!==(128&e.flags);if(!r&&!a)return o&&Lo(e,n,!1),Gs(t,e,i);r=e.stateNode,ys.current=e;var s=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return e.flags|=1,null!==t&&a?(e.child=xi(e,t.child,null,i),e.child=xi(e,null,s,i)):ws(t,e,s,i),e.memoizedState=r.state,o&&Lo(e,n,!0),e.child}function Ts(t){var e=t.stateNode;e.pendingContext?Fo(0,e.pendingContext,e.pendingContext!==e.context):e.context&&Fo(0,e.context,!1),Ji(t,e.containerInfo)}function Ns(t,e,n,r,o){return pi(),gi(o),e.flags|=256,ws(t,e,n,r),e.child}var _s,Ps,Ds,Os,Fs={dehydrated:null,treeContext:null,retryLane:0};function Ms(t){return{baseLanes:t,cachePool:null,transitions:null}}function Bs(t,e,n){var r,o=e.pendingProps,a=ta.current,s=!1,u=0!==(128&e.flags);if((r=u)||(r=(null===t||null!==t.memoizedState)&&0!==(2&a)),r?(s=!0,e.flags&=-129):null!==t&&null===t.memoizedState||(a|=1),Io(ta,1&a),null===t)return li(e),null!==(t=e.memoizedState)&&null!==(t=t.dehydrated)?(0===(1&e.mode)?e.lanes=1:"$!"===t.data?e.lanes=8:e.lanes=1073741824,null):(u=o.children,t=o.fallback,s?(o=e.mode,s=e.child,u={mode:"hidden",children:u},0===(1&o)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Mc(u,o,0,null),t=Fc(t,o,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Ms(n),e.memoizedState=Fs,t):Ls(e,u));if(null!==(a=t.memoizedState)&&null!==(r=a.dehydrated))return function(t,e,n,r,o,a,s){if(n)return 256&e.flags?(e.flags&=-257,Us(t,e,s,r=ls(Error(i(422))))):null!==e.memoizedState?(e.child=t.child,e.flags|=128,null):(a=r.fallback,o=e.mode,r=Mc({mode:"visible",children:r.children},o,0,null),(a=Fc(a,o,s,null)).flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,0!==(1&e.mode)&&xi(e,t.child,null,s),e.child.memoizedState=Ms(s),e.memoizedState=Fs,a);if(0===(1&e.mode))return Us(t,e,s,null);if("$!"===o.data){if(r=o.nextSibling&&o.nextSibling.dataset)var u=r.dgst;return r=u,Us(t,e,s,r=ls(a=Error(i(419)),r,void 0))}if(u=0!==(s&t.childLanes),bs||u){if(null!==(r=Tu)){switch(s&-s){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(o=0!==(o&(r.suspendedLanes|s))?0:o)&&o!==a.retryLane&&(a.retryLane=o,Fi(t,o),nc(r,t,o,-1))}return gc(),Us(t,e,s,r=ls(Error(i(421))))}return"$?"===o.data?(e.flags|=128,e.child=t.child,e=Ic.bind(null,t),o._reactRetry=e,null):(t=a.treeContext,oi=co(o.nextSibling),ri=e,ii=!0,ai=null,null!==t&&(Qo[Xo++]=Yo,Qo[Xo++]=Zo,Qo[Xo++]=Jo,Yo=t.id,Zo=t.overflow,Jo=e),e=Ls(e,r.children),e.flags|=4096,e)}(t,e,u,o,r,a,n);if(s){s=o.fallback,u=e.mode,r=(a=t.child).sibling;var c={mode:"hidden",children:o.children};return 0===(1&u)&&e.child!==a?((o=e.child).childLanes=0,o.pendingProps=c,e.deletions=null):(o=Dc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?s=Dc(r,s):(s=Fc(s,u,n,null)).flags|=2,s.return=e,o.return=e,o.sibling=s,e.child=o,o=s,s=e.child,u=null===(u=t.child.memoizedState)?Ms(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=t.childLanes&~n,e.memoizedState=Fs,o}return t=(s=t.child).sibling,o=Dc(s,{mode:"visible",children:o.children}),0===(1&e.mode)&&(o.lanes=n),o.return=e,o.sibling=null,null!==t&&(null===(n=e.deletions)?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=o,e.memoizedState=null,o}function Ls(t,e){return(e=Mc({mode:"visible",children:e},t.mode,0,null)).return=t,t.child=e}function Us(t,e,n,r){return null!==r&&gi(r),xi(e,t.child,null,n),(t=Ls(e,e.pendingProps.children)).flags|=2,e.memoizedState=null,t}function Ws(t,e,n){t.lanes|=e;var r=t.alternate;null!==r&&(r.lanes|=e),Ti(t.return,e,n)}function zs(t,e,n,r,o){var i=t.memoizedState;null===i?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:o}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=o)}function Vs(t,e,n){var r=e.pendingProps,o=r.revealOrder,i=r.tail;if(ws(t,e,r.children,n),0!==(2&(r=ta.current)))r=1&r|2,e.flags|=128;else{if(null!==t&&0!==(128&t.flags))t:for(t=e.child;null!==t;){if(13===t.tag)null!==t.memoizedState&&Ws(t,n,e);else if(19===t.tag)Ws(t,n,e);else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Io(ta,r),0===(1&e.mode))e.memoizedState=null;else switch(o){case"forwards":for(n=e.child,o=null;null!==n;)null!==(t=n.alternate)&&null===ea(t)&&(o=n),n=n.sibling;null===(n=o)?(o=e.child,e.child=null):(o=n.sibling,n.sibling=null),zs(e,!1,o,n,i);break;case"backwards":for(n=null,o=e.child,e.child=null;null!==o;){if(null!==(t=o.alternate)&&null===ea(t)){e.child=o;break}t=o.sibling,o.sibling=n,n=o,o=t}zs(e,!0,n,null,i);break;case"together":zs(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function js(t,e){0===(1&e.mode)&&null!==t&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Gs(t,e,n){if(null!==t&&(e.dependencies=t.dependencies),Mu|=e.lanes,0===(n&e.childLanes))return null;if(null!==t&&e.child!==t.child)throw Error(i(153));if(null!==e.child){for(n=Dc(t=e.child,t.pendingProps),e.child=n,n.return=e;null!==t.sibling;)t=t.sibling,(n=n.sibling=Dc(t,t.pendingProps)).return=e;n.sibling=null}return e.child}function Hs(t,e){if(!ii)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;null!==e;)null!==e.alternate&&(n=e),e=e.sibling;null===n?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?e||null===t.tail?t.tail=null:t.tail.sibling=null:r.sibling=null}}function qs(t){var e=null!==t.alternate&&t.alternate.child===t.child,n=0,r=0;if(e)for(var o=t.child;null!==o;)n|=o.lanes|o.childLanes,r|=14680064&o.subtreeFlags,r|=14680064&o.flags,o.return=t,o=o.sibling;else for(o=t.child;null!==o;)n|=o.lanes|o.childLanes,r|=o.subtreeFlags,r|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Ks(t,e,n){var r=e.pendingProps;switch(ni(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qs(e),null;case 1:case 17:return Do(e.type)&&Oo(),qs(e),null;case 3:return r=e.stateNode,Yi(),So(No),So(To),ra(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==t&&null!==t.child||(di(e)?e.flags|=4:null===t||t.memoizedState.isDehydrated&&0===(256&e.flags)||(e.flags|=1024,null!==ai&&(ac(ai),ai=null))),Ps(t,e),qs(e),null;case 5:$i(e);var o=Xi(Qi.current);if(n=e.type,null!==t&&null!=e.stateNode)Ds(t,e,n,r,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(null===e.stateNode)throw Error(i(166));return qs(e),null}if(t=Xi(qi.current),di(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[fo]=e,r[po]=a,t=0!==(1&e.mode),n){case"dialog":Ur("cancel",r),Ur("close",r);break;case"iframe":case"object":case"embed":Ur("load",r);break;case"video":case"audio":for(o=0;o<Fr.length;o++)Ur(Fr[o],r);break;case"source":Ur("error",r);break;case"img":case"image":case"link":Ur("error",r),Ur("load",r);break;case"details":Ur("toggle",r);break;case"input":J(r,a),Ur("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Ur("invalid",r);break;case"textarea":ot(r,a),Ur("invalid",r)}for(var u in yt(n,a),o=null,a)if(a.hasOwnProperty(u)){var c=a[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,c,t),o=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Zr(r.textContent,c,t),o=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Ur("scroll",r)}switch(n){case"input":q(r),$(r,a,!0);break;case"textarea":q(r),at(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=$r)}r=o,e.updateQueue=r,null!==r&&(e.flags|=4)}else{u=9===o.nodeType?o:o.ownerDocument,"http://www.w3.org/1999/xhtml"===t&&(t=st(n)),"http://www.w3.org/1999/xhtml"===t?"script"===n?((t=u.createElement("div")).innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):"string"===typeof r.is?t=u.createElement(n,{is:r.is}):(t=u.createElement(n),"select"===n&&(u=t,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):t=u.createElementNS(t,n),t[fo]=e,t[po]=r,_s(t,e,!1,!1),e.stateNode=t;t:{switch(u=bt(n,r),n){case"dialog":Ur("cancel",t),Ur("close",t),o=r;break;case"iframe":case"object":case"embed":Ur("load",t),o=r;break;case"video":case"audio":for(o=0;o<Fr.length;o++)Ur(Fr[o],t);o=r;break;case"source":Ur("error",t),o=r;break;case"img":case"image":case"link":Ur("error",t),Ur("load",t),o=r;break;case"details":Ur("toggle",t),o=r;break;case"input":J(t,r),o=X(t,r),Ur("invalid",t);break;case"option":default:o=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},o=B({},r,{value:void 0}),Ur("invalid",t);break;case"textarea":ot(t,r),o=rt(t,r),Ur("invalid",t)}for(a in yt(n,o),c=o)if(c.hasOwnProperty(a)){var l=c[a];"style"===a?mt(t,l):"dangerouslySetInnerHTML"===a?null!=(l=l?l.__html:void 0)&&ht(t,l):"children"===a?"string"===typeof l?("textarea"!==n||""!==l)&&dt(t,l):"number"===typeof l&&dt(t,""+l):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=l&&"onScroll"===a&&Ur("scroll",t):null!=l&&b(t,a,l,u))}switch(n){case"input":q(t),$(t,r,!1);break;case"textarea":q(t),at(t);break;case"option":null!=r.value&&t.setAttribute("value",""+G(r.value));break;case"select":t.multiple=!!r.multiple,null!=(a=r.value)?nt(t,!!r.multiple,a,!1):null!=r.defaultValue&&nt(t,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof o.onClick&&(t.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break t;case"img":r=!0;break t;default:r=!1}}r&&(e.flags|=4)}null!==e.ref&&(e.flags|=512,e.flags|=2097152)}return qs(e),null;case 6:if(t&&null!=e.stateNode)Os(t,e,t.memoizedProps,r);else{if("string"!==typeof r&&null===e.stateNode)throw Error(i(166));if(n=Xi(Qi.current),Xi(qi.current),di(e)){if(r=e.stateNode,n=e.memoizedProps,r[fo]=e,(a=r.nodeValue!==n)&&null!==(t=ri))switch(t.tag){case 3:Zr(r.nodeValue,n,0!==(1&t.mode));break;case 5:!0!==t.memoizedProps.suppressHydrationWarning&&Zr(r.nodeValue,n,0!==(1&t.mode))}a&&(e.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[fo]=e,e.stateNode=r}return qs(e),null;case 13:if(So(ta),r=e.memoizedState,null===t||null!==t.memoizedState&&null!==t.memoizedState.dehydrated){if(ii&&null!==oi&&0!==(1&e.mode)&&0===(128&e.flags))fi(),pi(),e.flags|=98560,a=!1;else if(a=di(e),null!==r&&null!==r.dehydrated){if(null===t){if(!a)throw Error(i(318));if(!(a=null!==(a=e.memoizedState)?a.dehydrated:null))throw Error(i(317));a[fo]=e}else pi(),0===(128&e.flags)&&(e.memoizedState=null),e.flags|=4;qs(e),a=!1}else null!==ai&&(ac(ai),ai=null),a=!0;if(!a)return 65536&e.flags?e:null}return 0!==(128&e.flags)?(e.lanes=n,e):((r=null!==r)!==(null!==t&&null!==t.memoizedState)&&r&&(e.child.flags|=8192,0!==(1&e.mode)&&(null===t||0!==(1&ta.current)?0===Ou&&(Ou=3):gc())),null!==e.updateQueue&&(e.flags|=4),qs(e),null);case 4:return Yi(),Ps(t,e),null===t&&Vr(e.stateNode.containerInfo),qs(e),null;case 10:return Ri(e.type._context),qs(e),null;case 19:if(So(ta),null===(a=e.memoizedState))return qs(e),null;if(r=0!==(128&e.flags),null===(u=a.rendering))if(r)Hs(a,!1);else{if(0!==Ou||null!==t&&0!==(128&t.flags))for(t=e.child;null!==t;){if(null!==(u=ea(t))){for(e.flags|=128,Hs(a,!1),null!==(r=u.updateQueue)&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;null!==n;)t=r,(a=n).flags&=14680066,null===(u=a.alternate)?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,t=u.dependencies,a.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Io(ta,1&ta.current|2),e.child}t=t.sibling}null!==a.tail&&Yt()>Vu&&(e.flags|=128,r=!0,Hs(a,!1),e.lanes=4194304)}else{if(!r)if(null!==(t=ea(u))){if(e.flags|=128,r=!0,null!==(n=t.updateQueue)&&(e.updateQueue=n,e.flags|=4),Hs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!u.alternate&&!ii)return qs(e),null}else 2*Yt()-a.renderingStartTime>Vu&&1073741824!==n&&(e.flags|=128,r=!0,Hs(a,!1),e.lanes=4194304);a.isBackwards?(u.sibling=e.child,e.child=u):(null!==(n=a.last)?n.sibling=u:e.child=u,a.last=u)}return null!==a.tail?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Yt(),e.sibling=null,n=ta.current,Io(ta,r?1&n|2:1&n),e):(qs(e),null);case 22:case 23:return hc(),r=null!==e.memoizedState,null!==t&&null!==t.memoizedState!==r&&(e.flags|=8192),r&&0!==(1&e.mode)?0!==(1073741824&Pu)&&(qs(e),6&e.subtreeFlags&&(e.flags|=8192)):qs(e),null;case 24:case 25:return null}throw Error(i(156,e.tag))}function Qs(t,e){switch(ni(e),e.tag){case 1:return Do(e.type)&&Oo(),65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 3:return Yi(),So(No),So(To),ra(),0!==(65536&(t=e.flags))&&0===(128&t)?(e.flags=-65537&t|128,e):null;case 5:return $i(e),null;case 13:if(So(ta),null!==(t=e.memoizedState)&&null!==t.dehydrated){if(null===e.alternate)throw Error(i(340));pi()}return 65536&(t=e.flags)?(e.flags=-65537&t|128,e):null;case 19:return So(ta),null;case 4:return Yi(),null;case 10:return Ri(e.type._context),null;case 22:case 23:return hc(),null;default:return null}}_s=function(t,e){for(var n=e.child;null!==n;){if(5===n.tag||6===n.tag)t.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ps=function(){},Ds=function(t,e,n,r){var o=t.memoizedProps;if(o!==r){t=e.stateNode,Xi(qi.current);var i,a=null;switch(n){case"input":o=X(t,o),r=X(t,r),a=[];break;case"select":o=B({},o,{value:void 0}),r=B({},r,{value:void 0}),a=[];break;case"textarea":o=rt(t,o),r=rt(t,r),a=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(t.onclick=$r)}for(l in yt(n,r),n=null,o)if(!r.hasOwnProperty(l)&&o.hasOwnProperty(l)&&null!=o[l])if("style"===l){var u=o[l];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?a||(a=[]):(a=a||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=o?o[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(i in u)!u.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&u[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(a||(a=[]),a.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(a=a||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Ur("scroll",t),a||u===c||(a=[])):(a=a||[]).push(l,c))}n&&(a=a||[]).push("style",n);var l=a;(e.updateQueue=l)&&(e.flags|=4)}},Os=function(t,e,n,r){n!==r&&(e.flags|=4)};var Xs=!1,Js=!1,Ys="function"===typeof WeakSet?WeakSet:Set,Zs=null;function $s(t,e){var n=t.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Cc(t,e,r)}else n.current=null}function tu(t,e,n){try{n()}catch(r){Cc(t,e,r)}}var eu=!1;function nu(t,e,n){var r=e.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var o=r=r.next;do{if((o.tag&t)===t){var i=o.destroy;o.destroy=void 0,void 0!==i&&tu(e,n,i)}o=o.next}while(o!==r)}}function ru(t,e){if(null!==(e=null!==(e=e.updateQueue)?e.lastEffect:null)){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function ou(t){var e=t.ref;if(null!==e){var n=t.stateNode;t.tag,t=n,"function"===typeof e?e(t):e.current=t}}function iu(t){var e=t.alternate;null!==e&&(t.alternate=null,iu(e)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&(null!==(e=t.stateNode)&&(delete e[fo],delete e[po],delete e[mo],delete e[vo],delete e[yo])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function au(t){return 5===t.tag||3===t.tag||4===t.tag}function su(t){t:for(;;){for(;null===t.sibling;){if(null===t.return||au(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue t;if(null===t.child||4===t.tag)continue t;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function uu(t,e,n){var r=t.tag;if(5===r||6===r)t=t.stateNode,e?8===n.nodeType?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(8===n.nodeType?(e=n.parentNode).insertBefore(t,n):(e=n).appendChild(t),null!==(n=n._reactRootContainer)&&void 0!==n||null!==e.onclick||(e.onclick=$r));else if(4!==r&&null!==(t=t.child))for(uu(t,e,n),t=t.sibling;null!==t;)uu(t,e,n),t=t.sibling}function cu(t,e,n){var r=t.tag;if(5===r||6===r)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(4!==r&&null!==(t=t.child))for(cu(t,e,n),t=t.sibling;null!==t;)cu(t,e,n),t=t.sibling}var lu=null,hu=!1;function du(t,e,n){for(n=n.child;null!==n;)fu(t,e,n),n=n.sibling}function fu(t,e,n){if(ie&&"function"===typeof ie.onCommitFiberUnmount)try{ie.onCommitFiberUnmount(oe,n)}catch(s){}switch(n.tag){case 5:Js||$s(n,e);case 6:var r=lu,o=hu;lu=null,du(t,e,n),hu=o,null!==(lu=r)&&(hu?(t=lu,n=n.stateNode,8===t.nodeType?t.parentNode.removeChild(n):t.removeChild(n)):lu.removeChild(n.stateNode));break;case 18:null!==lu&&(hu?(t=lu,n=n.stateNode,8===t.nodeType?uo(t.parentNode,n):1===t.nodeType&&uo(t,n),Ve(t)):uo(lu,n.stateNode));break;case 4:r=lu,o=hu,lu=n.stateNode.containerInfo,hu=!0,du(t,e,n),lu=r,hu=o;break;case 0:case 11:case 14:case 15:if(!Js&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){o=r=r.next;do{var i=o,a=i.destroy;i=i.tag,void 0!==a&&(0!==(2&i)||0!==(4&i))&&tu(n,e,a),o=o.next}while(o!==r)}du(t,e,n);break;case 1:if(!Js&&($s(n,e),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Cc(n,e,s)}du(t,e,n);break;case 21:du(t,e,n);break;case 22:1&n.mode?(Js=(r=Js)||null!==n.memoizedState,du(t,e,n),Js=r):du(t,e,n);break;default:du(t,e,n)}}function pu(t){var e=t.updateQueue;if(null!==e){t.updateQueue=null;var n=t.stateNode;null===n&&(n=t.stateNode=new Ys),e.forEach(function(e){var r=Rc.bind(null,t,e);n.has(e)||(n.add(e),e.then(r,r))})}}function gu(t,e){var n=e.deletions;if(null!==n)for(var r=0;r<n.length;r++){var o=n[r];try{var a=t,s=e,u=s;t:for(;null!==u;){switch(u.tag){case 5:lu=u.stateNode,hu=!1;break t;case 3:case 4:lu=u.stateNode.containerInfo,hu=!0;break t}u=u.return}if(null===lu)throw Error(i(160));fu(a,s,o),lu=null,hu=!1;var c=o.alternate;null!==c&&(c.return=null),o.return=null}catch(l){Cc(o,e,l)}}if(12854&e.subtreeFlags)for(e=e.child;null!==e;)mu(e,t),e=e.sibling}function mu(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(gu(e,t),vu(t),4&r){try{nu(3,t,t.return),ru(3,t)}catch(m){Cc(t,t.return,m)}try{nu(5,t,t.return)}catch(m){Cc(t,t.return,m)}}break;case 1:gu(e,t),vu(t),512&r&&null!==n&&$s(n,n.return);break;case 5:if(gu(e,t),vu(t),512&r&&null!==n&&$s(n,n.return),32&t.flags){var o=t.stateNode;try{dt(o,"")}catch(m){Cc(t,t.return,m)}}if(4&r&&null!=(o=t.stateNode)){var a=t.memoizedProps,s=null!==n?n.memoizedProps:a,u=t.type,c=t.updateQueue;if(t.updateQueue=null,null!==c)try{"input"===u&&"radio"===a.type&&null!=a.name&&Y(o,a),bt(u,s);var l=bt(u,a);for(s=0;s<c.length;s+=2){var h=c[s],d=c[s+1];"style"===h?mt(o,d):"dangerouslySetInnerHTML"===h?ht(o,d):"children"===h?dt(o,d):b(o,h,d,l)}switch(u){case"input":Z(o,a);break;case"textarea":it(o,a);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!a.multiple;var p=a.value;null!=p?nt(o,!!a.multiple,p,!1):f!==!!a.multiple&&(null!=a.defaultValue?nt(o,!!a.multiple,a.defaultValue,!0):nt(o,!!a.multiple,a.multiple?[]:"",!1))}o[po]=a}catch(m){Cc(t,t.return,m)}}break;case 6:if(gu(e,t),vu(t),4&r){if(null===t.stateNode)throw Error(i(162));o=t.stateNode,a=t.memoizedProps;try{o.nodeValue=a}catch(m){Cc(t,t.return,m)}}break;case 3:if(gu(e,t),vu(t),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Ve(e.containerInfo)}catch(m){Cc(t,t.return,m)}break;case 4:default:gu(e,t),vu(t);break;case 13:gu(e,t),vu(t),8192&(o=t.child).flags&&(a=null!==o.memoizedState,o.stateNode.isHidden=a,!a||null!==o.alternate&&null!==o.alternate.memoizedState||(zu=Yt())),4&r&&pu(t);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&t.mode?(Js=(l=Js)||h,gu(e,t),Js=l):gu(e,t),vu(t),8192&r){if(l=null!==t.memoizedState,(t.stateNode.isHidden=l)&&!h&&0!==(1&t.mode))for(Zs=t,h=t.child;null!==h;){for(d=Zs=h;null!==Zs;){switch(p=(f=Zs).child,f.tag){case 0:case 11:case 14:case 15:nu(4,f,f.return);break;case 1:$s(f,f.return);var g=f.stateNode;if("function"===typeof g.componentWillUnmount){r=f,n=f.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(m){Cc(r,n,m)}}break;case 5:$s(f,f.return);break;case 22:if(null!==f.memoizedState){xu(d);continue}}null!==p?(p.return=f,Zs=p):xu(d)}h=h.sibling}t:for(h=null,d=t;;){if(5===d.tag){if(null===h){h=d;try{o=d.stateNode,l?"function"===typeof(a=o.style).setProperty?a.setProperty("display","none","important"):a.display="none":(u=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=gt("display",s))}catch(m){Cc(t,t.return,m)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(m){Cc(t,t.return,m)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===t)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===t)break t;for(;null===d.sibling;){if(null===d.return||d.return===t)break t;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:gu(e,t),vu(t),4&r&&pu(t);case 21:}}function vu(t){var e=t.flags;if(2&e){try{t:{for(var n=t.return;null!==n;){if(au(n)){var r=n;break t}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var o=r.stateNode;32&r.flags&&(dt(o,""),r.flags&=-33),cu(t,su(t),o);break;case 3:case 4:var a=r.stateNode.containerInfo;uu(t,su(t),a);break;default:throw Error(i(161))}}catch(s){Cc(t,t.return,s)}t.flags&=-3}4096&e&&(t.flags&=-4097)}function yu(t,e,n){Zs=t,bu(t,e,n)}function bu(t,e,n){for(var r=0!==(1&t.mode);null!==Zs;){var o=Zs,i=o.child;if(22===o.tag&&r){var a=null!==o.memoizedState||Xs;if(!a){var s=o.alternate,u=null!==s&&null!==s.memoizedState||Js;s=Xs;var c=Js;if(Xs=a,(Js=u)&&!c)for(Zs=o;null!==Zs;)u=(a=Zs).child,22===a.tag&&null!==a.memoizedState?Eu(o):null!==u?(u.return=a,Zs=u):Eu(o);for(;null!==i;)Zs=i,bu(i,e,n),i=i.sibling;Zs=o,Xs=s,Js=c}wu(t)}else 0!==(8772&o.subtreeFlags)&&null!==i?(i.return=o,Zs=i):wu(t)}}function wu(t){for(;null!==Zs;){var e=Zs;if(0!==(8772&e.flags)){var n=e.alternate;try{if(0!==(8772&e.flags))switch(e.tag){case 0:case 11:case 15:Js||ru(5,e);break;case 1:var r=e.stateNode;if(4&e.flags&&!Js)if(null===n)r.componentDidMount();else{var o=e.elementType===e.type?n.memoizedProps:ns(e.type,n.memoizedProps);r.componentDidUpdate(o,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;null!==a&&Gi(e,a,r);break;case 3:var s=e.updateQueue;if(null!==s){if(n=null,null!==e.child)switch(e.child.tag){case 5:case 1:n=e.child.stateNode}Gi(e,s,n)}break;case 5:var u=e.stateNode;if(null===n&&4&e.flags){n=u;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===e.memoizedState){var l=e.alternate;if(null!==l){var h=l.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Ve(d)}}}break;default:throw Error(i(163))}Js||512&e.flags&&ou(e)}catch(f){Cc(e,e.return,f)}}if(e===t){Zs=null;break}if(null!==(n=e.sibling)){n.return=e.return,Zs=n;break}Zs=e.return}}function xu(t){for(;null!==Zs;){var e=Zs;if(e===t){Zs=null;break}var n=e.sibling;if(null!==n){n.return=e.return,Zs=n;break}Zs=e.return}}function Eu(t){for(;null!==Zs;){var e=Zs;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ru(4,e)}catch(u){Cc(e,n,u)}break;case 1:var r=e.stateNode;if("function"===typeof r.componentDidMount){var o=e.return;try{r.componentDidMount()}catch(u){Cc(e,o,u)}}var i=e.return;try{ou(e)}catch(u){Cc(e,i,u)}break;case 5:var a=e.return;try{ou(e)}catch(u){Cc(e,a,u)}}}catch(u){Cc(e,e.return,u)}if(e===t){Zs=null;break}var s=e.sibling;if(null!==s){s.return=e.return,Zs=s;break}Zs=e.return}}var Au,Cu=Math.ceil,ku=w.ReactCurrentDispatcher,Su=w.ReactCurrentOwner,Iu=w.ReactCurrentBatchConfig,Ru=0,Tu=null,Nu=null,_u=0,Pu=0,Du=ko(0),Ou=0,Fu=null,Mu=0,Bu=0,Lu=0,Uu=null,Wu=null,zu=0,Vu=1/0,ju=null,Gu=!1,Hu=null,qu=null,Ku=!1,Qu=null,Xu=0,Ju=0,Yu=null,Zu=-1,$u=0;function tc(){return 0!==(6&Ru)?Yt():-1!==Zu?Zu:Zu=Yt()}function ec(t){return 0===(1&t.mode)?1:0!==(2&Ru)&&0!==_u?_u&-_u:null!==mi.transition?(0===$u&&($u=ge()),$u):0!==(t=be)?t:t=void 0===(t=window.event)?16:Je(t.type)}function nc(t,e,n,r){if(50<Ju)throw Ju=0,Yu=null,Error(i(185));ve(t,n,r),0!==(2&Ru)&&t===Tu||(t===Tu&&(0===(2&Ru)&&(Bu|=n),4===Ou&&sc(t,_u)),rc(t,r),1===n&&0===Ru&&0===(1&e.mode)&&(Vu=Yt()+500,Wo&&jo()))}function rc(t,e){var n=t.callbackNode;!function(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,o=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-ae(i),s=1<<a,u=o[a];-1===u?0!==(s&n)&&0===(s&r)||(o[a]=fe(s,e)):u<=e&&(t.expiredLanes|=s),i&=~s}}(t,e);var r=de(t,t===Tu?_u:0);if(0===r)null!==n&&Qt(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(null!=n&&Qt(n),1===e)0===t.tag?function(t){Wo=!0,Vo(t)}(uc.bind(null,t)):Vo(uc.bind(null,t)),ao(function(){0===(6&Ru)&&jo()}),n=null;else{switch(we(r)){case 1:n=$t;break;case 4:n=te;break;case 16:default:n=ee;break;case 536870912:n=re}n=Tc(n,oc.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function oc(t,e){if(Zu=-1,$u=0,0!==(6&Ru))throw Error(i(327));var n=t.callbackNode;if(Ec()&&t.callbackNode!==n)return null;var r=de(t,t===Tu?_u:0);if(0===r)return null;if(0!==(30&r)||0!==(r&t.expiredLanes)||e)e=mc(t,r);else{e=r;var o=Ru;Ru|=2;var a=pc();for(Tu===t&&_u===e||(ju=null,Vu=Yt()+500,dc(t,e));;)try{yc();break}catch(u){fc(t,u)}Ii(),ku.current=a,Ru=o,null!==Nu?e=0:(Tu=null,_u=0,e=Ou)}if(0!==e){if(2===e&&(0!==(o=pe(t))&&(r=o,e=ic(t,o))),1===e)throw n=Fu,dc(t,0),sc(t,r),rc(t,Yt()),n;if(6===e)sc(t,r);else{if(o=t.current.alternate,0===(30&r)&&!function(t){for(var e=t;;){if(16384&e.flags){var n=e.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var o=n[r],i=o.getSnapshot;o=o.value;try{if(!sr(i(),o))return!1}catch(s){return!1}}}if(n=e.child,16384&e.subtreeFlags&&null!==n)n.return=e,e=n;else{if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}(o)&&(2===(e=mc(t,r))&&(0!==(a=pe(t))&&(r=a,e=ic(t,a))),1===e))throw n=Fu,dc(t,0),sc(t,r),rc(t,Yt()),n;switch(t.finishedWork=o,t.finishedLanes=r,e){case 0:case 1:throw Error(i(345));case 2:case 5:xc(t,Wu,ju);break;case 3:if(sc(t,r),(130023424&r)===r&&10<(e=zu+500-Yt())){if(0!==de(t,0))break;if(((o=t.suspendedLanes)&r)!==r){tc(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=ro(xc.bind(null,t,Wu,ju),e);break}xc(t,Wu,ju);break;case 4:if(sc(t,r),(4194240&r)===r)break;for(e=t.eventTimes,o=-1;0<r;){var s=31-ae(r);a=1<<s,(s=e[s])>o&&(o=s),r&=~a}if(r=o,10<(r=(120>(r=Yt()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Cu(r/1960))-r)){t.timeoutHandle=ro(xc.bind(null,t,Wu,ju),r);break}xc(t,Wu,ju);break;default:throw Error(i(329))}}}return rc(t,Yt()),t.callbackNode===n?oc.bind(null,t):null}function ic(t,e){var n=Uu;return t.current.memoizedState.isDehydrated&&(dc(t,e).flags|=256),2!==(t=mc(t,e))&&(e=Wu,Wu=n,null!==e&&ac(e)),t}function ac(t){null===Wu?Wu=t:Wu.push.apply(Wu,t)}function sc(t,e){for(e&=~Lu,e&=~Bu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ae(e),r=1<<n;t[n]=-1,e&=~r}}function uc(t){if(0!==(6&Ru))throw Error(i(327));Ec();var e=de(t,0);if(0===(1&e))return rc(t,Yt()),null;var n=mc(t,e);if(0!==t.tag&&2===n){var r=pe(t);0!==r&&(e=r,n=ic(t,r))}if(1===n)throw n=Fu,dc(t,0),sc(t,e),rc(t,Yt()),n;if(6===n)throw Error(i(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,xc(t,Wu,ju),rc(t,Yt()),null}function cc(t,e){var n=Ru;Ru|=1;try{return t(e)}finally{0===(Ru=n)&&(Vu=Yt()+500,Wo&&jo())}}function lc(t){null!==Qu&&0===Qu.tag&&0===(6&Ru)&&Ec();var e=Ru;Ru|=1;var n=Iu.transition,r=be;try{if(Iu.transition=null,be=1,t)return t()}finally{be=r,Iu.transition=n,0===(6&(Ru=e))&&jo()}}function hc(){Pu=Du.current,So(Du)}function dc(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(-1!==n&&(t.timeoutHandle=-1,oo(n)),null!==Nu)for(n=Nu.return;null!==n;){var r=n;switch(ni(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Oo();break;case 3:Yi(),So(No),So(To),ra();break;case 5:$i(r);break;case 4:Yi();break;case 13:case 19:So(ta);break;case 10:Ri(r.type._context);break;case 22:case 23:hc()}n=n.return}if(Tu=t,Nu=t=Dc(t.current,null),_u=Pu=e,Ou=0,Fu=null,Lu=Bu=Mu=0,Wu=Uu=null,null!==Pi){for(e=0;e<Pi.length;e++)if(null!==(r=(n=Pi[e]).interleaved)){n.interleaved=null;var o=r.next,i=n.pending;if(null!==i){var a=i.next;i.next=o,r.next=a}n.pending=r}Pi=null}return t}function fc(t,e){for(;;){var n=Nu;try{if(Ii(),oa.current=Za,la){for(var r=sa.memoizedState;null!==r;){var o=r.queue;null!==o&&(o.pending=null),r=r.next}la=!1}if(aa=0,ca=ua=sa=null,ha=!1,da=0,Su.current=null,null===n||null===n.return){Ou=1,Fu=e,Nu=null;break}t:{var a=t,s=n.return,u=n,c=e;if(e=_u,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,h=u,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=ms(s);if(null!==p){p.flags&=-257,vs(p,s,u,0,e),1&p.mode&&gs(a,l,e),c=l;var g=(e=p).updateQueue;if(null===g){var m=new Set;m.add(c),e.updateQueue=m}else g.add(c);break t}if(0===(1&e)){gs(a,l,e),gc();break t}c=Error(i(426))}else if(ii&&1&u.mode){var v=ms(s);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vs(v,s,u,0,e),gi(cs(c,u));break t}}a=c=cs(c,u),4!==Ou&&(Ou=2),null===Uu?Uu=[a]:Uu.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e,Vi(a,fs(0,c,e));break t;case 1:u=c;var y=a.type,b=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===qu||!qu.has(b)))){a.flags|=65536,e&=-e,a.lanes|=e,Vi(a,ps(a,u,e));break t}}a=a.return}while(null!==a)}wc(n)}catch(w){e=w,Nu===n&&null!==n&&(Nu=n=n.return);continue}break}}function pc(){var t=ku.current;return ku.current=Za,null===t?Za:t}function gc(){0!==Ou&&3!==Ou&&2!==Ou||(Ou=4),null===Tu||0===(268435455&Mu)&&0===(268435455&Bu)||sc(Tu,_u)}function mc(t,e){var n=Ru;Ru|=2;var r=pc();for(Tu===t&&_u===e||(ju=null,dc(t,e));;)try{vc();break}catch(o){fc(t,o)}if(Ii(),Ru=n,ku.current=r,null!==Nu)throw Error(i(261));return Tu=null,_u=0,Ou}function vc(){for(;null!==Nu;)bc(Nu)}function yc(){for(;null!==Nu&&!Xt();)bc(Nu)}function bc(t){var e=Au(t.alternate,t,Pu);t.memoizedProps=t.pendingProps,null===e?wc(t):Nu=e,Su.current=null}function wc(t){var e=t;do{var n=e.alternate;if(t=e.return,0===(32768&e.flags)){if(null!==(n=Ks(n,e,Pu)))return void(Nu=n)}else{if(null!==(n=Qs(n,e)))return n.flags&=32767,void(Nu=n);if(null===t)return Ou=6,void(Nu=null);t.flags|=32768,t.subtreeFlags=0,t.deletions=null}if(null!==(e=e.sibling))return void(Nu=e);Nu=e=t}while(null!==e);0===Ou&&(Ou=5)}function xc(t,e,n){var r=be,o=Iu.transition;try{Iu.transition=null,be=1,function(t,e,n,r){do{Ec()}while(null!==Qu);if(0!==(6&Ru))throw Error(i(327));n=t.finishedWork;var o=t.finishedLanes;if(null===n)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(i(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var o=31-ae(n),i=1<<o;e[o]=0,r[o]=-1,t[o]=-1,n&=~i}}(t,a),t===Tu&&(Nu=Tu=null,_u=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Ku||(Ku=!0,Tc(ee,function(){return Ec(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=Iu.transition,Iu.transition=null;var s=be;be=1;var u=Ru;Ru|=4,Su.current=null,function(t,e){if(to=Ge,fr(t=dr())){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{var r=(n=(n=t.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var o=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(x){n=null;break t}var s=0,u=-1,c=-1,l=0,h=0,d=t,f=null;e:for(;;){for(var p;d!==n||0!==o&&3!==d.nodeType||(u=s+o),d!==a||0!==r&&3!==d.nodeType||(c=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===t)break e;if(f===n&&++l===o&&(u=s),f===a&&++h===r&&(c=s),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(eo={focusedElem:t,selectionRange:n},Ge=!1,Zs=e;null!==Zs;)if(t=(e=Zs).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,Zs=t;else for(;null!==Zs;){e=Zs;try{var g=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,v=g.memoizedState,y=e.stateNode,b=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:ns(e.type,m),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=e.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(i(163))}}catch(x){Cc(e,e.return,x)}if(null!==(t=e.sibling)){t.return=e.return,Zs=t;break}Zs=e.return}g=eu,eu=!1}(t,n),mu(n,t),pr(eo),Ge=!!to,eo=to=null,t.current=n,yu(n,t,o),Jt(),Ru=u,be=s,Iu.transition=a}else t.current=n;if(Ku&&(Ku=!1,Qu=t,Xu=o),a=t.pendingLanes,0===a&&(qu=null),function(t){if(ie&&"function"===typeof ie.onCommitFiberRoot)try{ie.onCommitFiberRoot(oe,t,void 0,128===(128&t.current.flags))}catch(e){}}(n.stateNode),rc(t,Yt()),null!==e)for(r=t.onRecoverableError,n=0;n<e.length;n++)o=e[n],r(o.value,{componentStack:o.stack,digest:o.digest});if(Gu)throw Gu=!1,t=Hu,Hu=null,t;0!==(1&Xu)&&0!==t.tag&&Ec(),a=t.pendingLanes,0!==(1&a)?t===Yu?Ju++:(Ju=0,Yu=t):Ju=0,jo()}(t,e,n,r)}finally{Iu.transition=o,be=r}return null}function Ec(){if(null!==Qu){var t=we(Xu),e=Iu.transition,n=be;try{if(Iu.transition=null,be=16>t?16:t,null===Qu)var r=!1;else{if(t=Qu,Qu=null,Xu=0,0!==(6&Ru))throw Error(i(331));var o=Ru;for(Ru|=4,Zs=t.current;null!==Zs;){var a=Zs,s=a.child;if(0!==(16&Zs.flags)){var u=a.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for(Zs=l;null!==Zs;){var h=Zs;switch(h.tag){case 0:case 11:case 15:nu(8,h,a)}var d=h.child;if(null!==d)d.return=h,Zs=d;else for(;null!==Zs;){var f=(h=Zs).sibling,p=h.return;if(iu(h),h===l){Zs=null;break}if(null!==f){f.return=p,Zs=f;break}Zs=p}}}var g=a.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(null!==m)}}Zs=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,Zs=s;else t:for(;null!==Zs;){if(0!==(2048&(a=Zs).flags))switch(a.tag){case 0:case 11:case 15:nu(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Zs=y;break t}Zs=a.return}}var b=t.current;for(Zs=b;null!==Zs;){var w=(s=Zs).child;if(0!==(2064&s.subtreeFlags)&&null!==w)w.return=s,Zs=w;else t:for(s=b;null!==Zs;){if(0!==(2048&(u=Zs).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(E){Cc(u,u.return,E)}if(u===s){Zs=null;break t}var x=u.sibling;if(null!==x){x.return=u.return,Zs=x;break t}Zs=u.return}}if(Ru=o,jo(),ie&&"function"===typeof ie.onPostCommitFiberRoot)try{ie.onPostCommitFiberRoot(oe,t)}catch(E){}r=!0}return r}finally{be=n,Iu.transition=e}}return!1}function Ac(t,e,n){t=Wi(t,e=fs(0,e=cs(n,e),1),1),e=tc(),null!==t&&(ve(t,1,e),rc(t,e))}function Cc(t,e,n){if(3===t.tag)Ac(t,t,n);else for(;null!==e;){if(3===e.tag){Ac(e,t,n);break}if(1===e.tag){var r=e.stateNode;if("function"===typeof e.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===qu||!qu.has(r))){e=Wi(e,t=ps(e,t=cs(n,t),1),1),t=tc(),null!==e&&(ve(e,1,t),rc(e,t));break}}e=e.return}}function kc(t,e,n){var r=t.pingCache;null!==r&&r.delete(e),e=tc(),t.pingedLanes|=t.suspendedLanes&n,Tu===t&&(_u&n)===n&&(4===Ou||3===Ou&&(130023424&_u)===_u&&500>Yt()-zu?dc(t,0):Lu|=n),rc(t,e)}function Sc(t,e){0===e&&(0===(1&t.mode)?e=1:(e=le,0===(130023424&(le<<=1))&&(le=4194304)));var n=tc();null!==(t=Fi(t,e))&&(ve(t,e,n),rc(t,n))}function Ic(t){var e=t.memoizedState,n=0;null!==e&&(n=e.retryLane),Sc(t,n)}function Rc(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,o=t.memoizedState;null!==o&&(n=o.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(e),Sc(t,n)}function Tc(t,e){return Kt(t,e)}function Nc(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _c(t,e,n,r){return new Nc(t,e,n,r)}function Pc(t){return!(!(t=t.prototype)||!t.isReactComponent)}function Dc(t,e){var n=t.alternate;return null===n?((n=_c(t.tag,e,t.key,t.mode)).elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&t.flags,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Oc(t,e,n,r,o,a){var s=2;if(r=t,"function"===typeof t)Pc(t)&&(s=1);else if("string"===typeof t)s=5;else t:switch(t){case A:return Fc(n.children,o,a,e);case C:s=8,o|=8;break;case k:return(t=_c(12,n,e,2|o)).elementType=k,t.lanes=a,t;case T:return(t=_c(13,n,e,o)).elementType=T,t.lanes=a,t;case N:return(t=_c(19,n,e,o)).elementType=N,t.lanes=a,t;case D:return Mc(n,o,a,e);default:if("object"===typeof t&&null!==t)switch(t.$$typeof){case S:s=10;break t;case I:s=9;break t;case R:s=11;break t;case _:s=14;break t;case P:s=16,r=null;break t}throw Error(i(130,null==t?t:typeof t,""))}return(e=_c(s,n,e,o)).elementType=t,e.type=r,e.lanes=a,e}function Fc(t,e,n,r){return(t=_c(7,t,r,e)).lanes=n,t}function Mc(t,e,n,r){return(t=_c(22,t,r,e)).elementType=D,t.lanes=n,t.stateNode={isHidden:!1},t}function Bc(t,e,n){return(t=_c(6,t,null,e)).lanes=n,t}function Lc(t,e,n){return(e=_c(4,null!==t.children?t.children:[],t.key,e)).lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Uc(t,e,n,r,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=me(0),this.expirationTimes=me(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=me(0),this.identifierPrefix=r,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Wc(t,e,n,r,o,i,a,s,u){return t=new Uc(t,e,n,s,u),1===e?(e=1,!0===i&&(e|=8)):e=0,i=_c(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bi(i),t}function zc(t){if(!t)return Ro;t:{if(Vt(t=t._reactInternals)!==t||1!==t.tag)throw Error(i(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(Do(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(null!==e);throw Error(i(171))}if(1===t.tag){var n=t.type;if(Do(n))return Mo(t,n,e)}return e}function Vc(t,e,n,r,o,i,a,s,u){return(t=Wc(n,r,!0,t,0,i,0,s,u)).context=zc(null),n=t.current,(i=Ui(r=tc(),o=ec(n))).callback=void 0!==e&&null!==e?e:null,Wi(n,i,o),t.current.lanes=o,ve(t,o,r),rc(t,r),t}function jc(t,e,n,r){var o=e.current,i=tc(),a=ec(o);return n=zc(n),null===e.context?e.context=n:e.pendingContext=n,(e=Ui(i,a)).payload={element:t},null!==(r=void 0===r?null:r)&&(e.callback=r),null!==(t=Wi(o,e,a))&&(nc(t,o,a,i),zi(t,o,a)),a}function Gc(t){return(t=t.current).child?(t.child.tag,t.child.stateNode):null}function Hc(t,e){if(null!==(t=t.memoizedState)&&null!==t.dehydrated){var n=t.retryLane;t.retryLane=0!==n&&n<e?n:e}}function qc(t,e){Hc(t,e),(t=t.alternate)&&Hc(t,e)}Au=function(t,e,n){if(null!==t)if(t.memoizedProps!==e.pendingProps||No.current)bs=!0;else{if(0===(t.lanes&n)&&0===(128&e.flags))return bs=!1,function(t,e,n){switch(e.tag){case 3:Ts(e),pi();break;case 5:Zi(e);break;case 1:Do(e.type)&&Bo(e);break;case 4:Ji(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,o=e.memoizedProps.value;Io(Ai,r._currentValue),r._currentValue=o;break;case 13:if(null!==(r=e.memoizedState))return null!==r.dehydrated?(Io(ta,1&ta.current),e.flags|=128,null):0!==(n&e.child.childLanes)?Bs(t,e,n):(Io(ta,1&ta.current),null!==(t=Gs(t,e,n))?t.sibling:null);Io(ta,1&ta.current);break;case 19:if(r=0!==(n&e.childLanes),0!==(128&t.flags)){if(r)return Vs(t,e,n);e.flags|=128}if(null!==(o=e.memoizedState)&&(o.rendering=null,o.tail=null,o.lastEffect=null),Io(ta,ta.current),r)break;return null;case 22:case 23:return e.lanes=0,Cs(t,e,n)}return Gs(t,e,n)}(t,e,n);bs=0!==(131072&t.flags)}else bs=!1,ii&&0!==(1048576&e.flags)&&ti(e,Ko,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;js(t,e),t=e.pendingProps;var o=Po(e,To.current);Ni(e,n),o=ma(null,e,r,t,o,n);var a=va();return e.flags|=1,"object"===typeof o&&null!==o&&"function"===typeof o.render&&void 0===o.$$typeof?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Do(r)?(a=!0,Bo(e)):a=!1,e.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,Bi(e),o.updater=os,e.stateNode=o,o._reactInternals=e,us(e,r,t,n),e=Rs(null,e,r,!0,a,n)):(e.tag=0,ii&&a&&ei(e),ws(null,e,o,n),e=e.child),e;case 16:r=e.elementType;t:{switch(js(t,e),t=e.pendingProps,r=(o=r._init)(r._payload),e.type=r,o=e.tag=function(t){if("function"===typeof t)return Pc(t)?1:0;if(void 0!==t&&null!==t){if((t=t.$$typeof)===R)return 11;if(t===_)return 14}return 2}(r),t=ns(r,t),o){case 0:e=Ss(null,e,r,t,n);break t;case 1:e=Is(null,e,r,t,n);break t;case 11:e=xs(null,e,r,t,n);break t;case 14:e=Es(null,e,r,ns(r.type,t),n);break t}throw Error(i(306,r,""))}return e;case 0:return r=e.type,o=e.pendingProps,Ss(t,e,r,o=e.elementType===r?o:ns(r,o),n);case 1:return r=e.type,o=e.pendingProps,Is(t,e,r,o=e.elementType===r?o:ns(r,o),n);case 3:t:{if(Ts(e),null===t)throw Error(i(387));r=e.pendingProps,o=(a=e.memoizedState).element,Li(t,e),ji(e,r,null,n);var s=e.memoizedState;if(r=s.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=a,e.memoizedState=a,256&e.flags){e=Ns(t,e,r,n,o=cs(Error(i(423)),e));break t}if(r!==o){e=Ns(t,e,r,n,o=cs(Error(i(424)),e));break t}for(oi=co(e.stateNode.containerInfo.firstChild),ri=e,ii=!0,ai=null,n=Ei(e,null,r,n),e.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(pi(),r===o){e=Gs(t,e,n);break t}ws(t,e,r,n)}e=e.child}return e;case 5:return Zi(e),null===t&&li(e),r=e.type,o=e.pendingProps,a=null!==t?t.memoizedProps:null,s=o.children,no(r,o)?s=null:null!==a&&no(r,a)&&(e.flags|=32),ks(t,e),ws(t,e,s,n),e.child;case 6:return null===t&&li(e),null;case 13:return Bs(t,e,n);case 4:return Ji(e,e.stateNode.containerInfo),r=e.pendingProps,null===t?e.child=xi(e,null,r,n):ws(t,e,r,n),e.child;case 11:return r=e.type,o=e.pendingProps,xs(t,e,r,o=e.elementType===r?o:ns(r,o),n);case 7:return ws(t,e,e.pendingProps,n),e.child;case 8:case 12:return ws(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(r=e.type._context,o=e.pendingProps,a=e.memoizedProps,s=o.value,Io(Ai,r._currentValue),r._currentValue=s,null!==a)if(sr(a.value,s)){if(a.children===o.children&&!No.current){e=Gs(t,e,n);break t}}else for(null!==(a=e.child)&&(a.return=e);null!==a;){var u=a.dependencies;if(null!==u){s=a.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=Ui(-1,n&-n)).tag=2;var l=a.updateQueue;if(null!==l){var h=(l=l.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),l.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Ti(a.return,n,e),u.lanes|=n;break}c=c.next}}else if(10===a.tag)s=a.type===e.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Ti(s,n,e),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===e){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}ws(t,e,o.children,n),e=e.child}return e;case 9:return o=e.type,r=e.pendingProps.children,Ni(e,n),r=r(o=_i(o)),e.flags|=1,ws(t,e,r,n),e.child;case 14:return o=ns(r=e.type,e.pendingProps),Es(t,e,r,o=ns(r.type,o),n);case 15:return As(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,o=e.pendingProps,o=e.elementType===r?o:ns(r,o),js(t,e),e.tag=1,Do(r)?(t=!0,Bo(e)):t=!1,Ni(e,n),as(e,r,o),us(e,r,o,n),Rs(null,e,r,!0,t,n);case 19:return Vs(t,e,n);case 22:return Cs(t,e,n)}throw Error(i(156,e.tag))};var Kc="function"===typeof reportError?reportError:function(t){console.error(t)};function Qc(t){this._internalRoot=t}function Xc(t){this._internalRoot=t}function Jc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)}function Yc(t){return!(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType&&(8!==t.nodeType||" react-mount-point-unstable "!==t.nodeValue))}function Zc(){}function $c(t,e,n,r,o){var i=n._reactRootContainer;if(i){var a=i;if("function"===typeof o){var s=o;o=function(){var t=Gc(a);s.call(t)}}jc(e,a,t,o)}else a=function(t,e,n,r,o){if(o){if("function"===typeof r){var i=r;r=function(){var t=Gc(a);i.call(t)}}var a=Vc(e,r,t,0,null,!1,0,"",Zc);return t._reactRootContainer=a,t[go]=a.current,Vr(8===t.nodeType?t.parentNode:t),lc(),a}for(;o=t.lastChild;)t.removeChild(o);if("function"===typeof r){var s=r;r=function(){var t=Gc(u);s.call(t)}}var u=Wc(t,0,!1,null,0,!1,0,"",Zc);return t._reactRootContainer=u,t[go]=u.current,Vr(8===t.nodeType?t.parentNode:t),lc(function(){jc(e,u,n,r)}),u}(n,e,t,o,r);return Gc(a)}Xc.prototype.render=Qc.prototype.render=function(t){var e=this._internalRoot;if(null===e)throw Error(i(409));jc(t,e,null,null)},Xc.prototype.unmount=Qc.prototype.unmount=function(){var t=this._internalRoot;if(null!==t){this._internalRoot=null;var e=t.containerInfo;lc(function(){jc(null,t,null,null)}),e[go]=null}},Xc.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ce();t={blockedOn:null,target:t,priority:e};for(var n=0;n<De.length&&0!==e&&e<De[n].priority;n++);De.splice(n,0,t),0===n&&Be(t)}},xe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=he(e.pendingLanes);0!==n&&(ye(e,1|n),rc(e,Yt()),0===(6&Ru)&&(Vu=Yt()+500,jo()))}break;case 13:lc(function(){var e=Fi(t,1);if(null!==e){var n=tc();nc(e,t,1,n)}}),qc(t,1)}},Ee=function(t){if(13===t.tag){var e=Fi(t,134217728);if(null!==e)nc(e,t,134217728,tc());qc(t,134217728)}},Ae=function(t){if(13===t.tag){var e=ec(t),n=Fi(t,e);if(null!==n)nc(n,t,e,tc());qc(t,e)}},Ce=function(){return be},ke=function(t,e){var n=be;try{return be=t,e()}finally{be=n}},Et=function(t,e,n){switch(e){case"input":if(Z(t,n),e=n.name,"radio"===n.type&&null!=e){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var o=Eo(r);if(!o)throw Error(i(90));K(r),Z(r,o)}}}break;case"textarea":it(t,n);break;case"select":null!=(e=n.value)&&nt(t,!!n.multiple,e,!1)}},Rt=cc,Tt=lc;var tl={usingClientEntryPoint:!1,Events:[wo,xo,Eo,St,It,cc]},el={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nl={bundleType:el.bundleType,version:el.version,rendererPackageName:el.rendererPackageName,rendererConfig:el.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return null===(t=Ht(t))?null:t.stateNode},findFiberByHostInstance:el.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rl.isDisabled&&rl.supportsFiber)try{oe=rl.inject(nl),ie=rl}catch(lt){}}e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,e.createPortal=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jc(e))throw Error(i(200));return function(t,e,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:t,containerInfo:e,implementation:n}}(t,e,null,n)},e.createRoot=function(t,e){if(!Jc(t))throw Error(i(299));var n=!1,r="",o=Kc;return null!==e&&void 0!==e&&(!0===e.unstable_strictMode&&(n=!0),void 0!==e.identifierPrefix&&(r=e.identifierPrefix),void 0!==e.onRecoverableError&&(o=e.onRecoverableError)),e=Wc(t,1,!1,null,0,n,0,r,o),t[go]=e.current,Vr(8===t.nodeType?t.parentNode:t),new Qc(e)},e.findDOMNode=function(t){if(null==t)return null;if(1===t.nodeType)return t;var e=t._reactInternals;if(void 0===e){if("function"===typeof t.render)throw Error(i(188));throw t=Object.keys(t).join(","),Error(i(268,t))}return t=null===(t=Ht(e))?null:t.stateNode},e.flushSync=function(t){return lc(t)},e.hydrate=function(t,e,n){if(!Yc(e))throw Error(i(200));return $c(null,t,e,!0,n)},e.hydrateRoot=function(t,e,n){if(!Jc(t))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,o=!1,a="",s=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(o=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),e=Vc(e,null,t,1,null!=n?n:null,o,0,a,s),t[go]=e.current,Vr(t),r)for(t=0;t<r.length;t++)o=(o=(n=r[t])._getVersion)(n._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[n,o]:e.mutableSourceEagerHydrationData.push(n,o);return new Xc(e)},e.render=function(t,e,n){if(!Yc(e))throw Error(i(200));return $c(null,t,e,!1,n)},e.unmountComponentAtNode=function(t){if(!Yc(t))throw Error(i(40));return!!t._reactRootContainer&&(lc(function(){$c(null,null,t,!1,function(){t._reactRootContainer=null,t[go]=null})}),!0)},e.unstable_batchedUpdates=cc,e.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Yc(n))throw Error(i(200));if(null==t||void 0===t._reactInternals)throw Error(i(38));return $c(t,e,n,!1,r)},e.version="18.3.1-next-f1338f8080-20240426"},745:()=>{},853:(t,e,n)=>{"use strict";t.exports=n(234)},950:(t,e,n)=>{"use strict";!function t(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}(),t.exports=n(730)}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},(()=>{var t,e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__;n.t=function(r,o){if(1&o&&(r=this(r)),8&o)return r;if("object"===typeof r&&r){if(4&o&&r.__esModule)return r;if(16&o&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var a={};t=t||[null,e({}),e([]),e(e)];for(var s=2&o&&r;("object"==typeof s||"function"==typeof s)&&!~t.indexOf(s);s=e(s))Object.getOwnPropertyNames(s).forEach(t=>a[t]=()=>r[t]);return a.default=()=>r,n.d(i,a),i}})(),n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};n.r(t),n.d(t,{OG:()=>tS,My:()=>Hk,Ph:()=>Qk,lX:()=>Xk,Id:()=>$k,fg:()=>rS,qj:()=>Zk,aT:()=>Kk,lq:()=>Jk,z:()=>Yk,Q5:()=>iS});var e,r=n(43),o=n.t(r,2),i=n(391),a=n(950),s=n.t(a,2);function u(){return u=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},u.apply(this,arguments)}!function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"}(e||(e={}));const c="popstate";function l(t,e){if(!1===t||null===t||"undefined"===typeof t)throw new Error(e)}function h(t,e){if(!t){"undefined"!==typeof console&&console.warn(e);try{throw new Error(e)}catch(Nt){}}}function d(t,e){return{usr:t.state,key:t.key,idx:e}}function f(t,e,n,r){return void 0===n&&(n=null),u({pathname:"string"===typeof t?t:t.pathname,search:"",hash:""},"string"===typeof e?g(e):e,{state:n,key:e&&e.key||r||Math.random().toString(36).substr(2,8)})}function p(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&"?"!==n&&(e+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(e+="#"===r.charAt(0)?r:"#"+r),e}function g(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function m(t,n,r,o){void 0===o&&(o={});let{window:i=document.defaultView,v5Compat:a=!1}=o,s=i.history,h=e.Pop,g=null,m=v();function v(){return(s.state||{idx:null}).idx}function y(){h=e.Pop;let t=v(),n=null==t?null:t-m;m=t,g&&g({action:h,location:w.location,delta:n})}function b(t){let e="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof t?t:p(t);return n=n.replace(/ $/,"%20"),l(e,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,e)}null==m&&(m=0,s.replaceState(u({},s.state,{idx:m}),""));let w={get action(){return h},get location(){return t(i,s)},listen(t){if(g)throw new Error("A history only accepts one active listener");return i.addEventListener(c,y),g=t,()=>{i.removeEventListener(c,y),g=null}},createHref:t=>n(i,t),createURL:b,encodeLocation(t){let e=b(t);return{pathname:e.pathname,search:e.search,hash:e.hash}},push:function(t,n){h=e.Push;let o=f(w.location,t,n);r&&r(o,t),m=v()+1;let u=d(o,m),c=w.createHref(o);try{s.pushState(u,"",c)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;i.location.assign(c)}a&&g&&g({action:h,location:w.location,delta:1})},replace:function(t,n){h=e.Replace;let o=f(w.location,t,n);r&&r(o,t),m=v();let i=d(o,m),u=w.createHref(o);s.replaceState(i,"",u),a&&g&&g({action:h,location:w.location,delta:0})},go:t=>s.go(t)};return w}var v;!function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"}(v||(v={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function y(t,e,n){return void 0===n&&(n="/"),b(t,e,n,!1)}function b(t,e,n,r){let o=D(("string"===typeof e?g(e):e).pathname||"/",n);if(null==o)return null;let i=w(t);!function(t){t.sort((t,e)=>t.score!==e.score?e.score-t.score:function(t,e){let n=t.length===e.length&&t.slice(0,-1).every((t,n)=>t===e[n]);return n?t[t.length-1]-e[e.length-1]:0}(t.routesMeta.map(t=>t.childrenIndex),e.routesMeta.map(t=>t.childrenIndex)))}(i);let a=null;for(let s=0;null==a&&s<i.length;++s){let t=P(o);a=N(i[s],t,r)}return a}function w(t,e,n,r){void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===r&&(r="");let o=(t,o,i)=>{let a={relativePath:void 0===i?t.path||"":i,caseSensitive:!0===t.caseSensitive,childrenIndex:o,route:t};a.relativePath.startsWith("/")&&(l(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let s=L([r,a.relativePath]),u=n.concat(a);t.children&&t.children.length>0&&(l(!0!==t.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),w(t.children,e,u,s)),(null!=t.path||t.index)&&e.push({path:s,score:T(s,t.index),routesMeta:u})};return t.forEach((t,e)=>{var n;if(""!==t.path&&null!=(n=t.path)&&n.includes("?"))for(let r of x(t.path))o(t,e,r);else o(t,e)}),e}function x(t){let e=t.split("/");if(0===e.length)return[];let[n,...r]=e,o=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===r.length)return o?[i,""]:[i];let a=x(r.join("/")),s=[];return s.push(...a.map(t=>""===t?i:[i,t].join("/"))),o&&s.push(...a),s.map(e=>t.startsWith("/")&&""===e?"/":e)}const E=/^:[\w-]+$/,A=3,C=2,k=1,S=10,I=-2,R=t=>"*"===t;function T(t,e){let n=t.split("/"),r=n.length;return n.some(R)&&(r+=I),e&&(r+=C),n.filter(t=>!R(t)).reduce((t,e)=>t+(E.test(e)?A:""===e?k:S),r)}function N(t,e,n){void 0===n&&(n=!1);let{routesMeta:r}=t,o={},i="/",a=[];for(let s=0;s<r.length;++s){let t=r[s],u=s===r.length-1,c="/"===i?e:e.slice(i.length)||"/",l=_({path:t.relativePath,caseSensitive:t.caseSensitive,end:u},c),h=t.route;if(!l&&u&&n&&!r[r.length-1].route.index&&(l=_({path:t.relativePath,caseSensitive:t.caseSensitive,end:!1},c)),!l)return null;Object.assign(o,l.params),a.push({params:o,pathname:L([i,l.pathname]),pathnameBase:U(L([i,l.pathnameBase])),route:h}),"/"!==l.pathnameBase&&(i=L([i,l.pathnameBase]))}return a}function _(t,e){"string"===typeof t&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=function(t,e,n){void 0===e&&(e=!1);void 0===n&&(n=!0);h("*"===t||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were "'+t.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+t.replace(/\*$/,"/*")+'".');let r=[],o="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(t,e,n)=>(r.push({paramName:e,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));t.endsWith("*")?(r.push({paramName:"*"}),o+="*"===t||"/*"===t?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?o+="\\/*$":""!==t&&"/"!==t&&(o+="(?:(?=\\/|$))");let i=new RegExp(o,e?void 0:"i");return[i,r]}(t.path,t.caseSensitive,t.end),o=e.match(n);if(!o)return null;let i=o[0],a=i.replace(/(.)\/+$/,"$1"),s=o.slice(1);return{params:r.reduce((t,e,n)=>{let{paramName:r,isOptional:o}=e;if("*"===r){let t=s[n]||"";a=i.slice(0,i.length-t.length).replace(/(.)\/+$/,"$1")}const u=s[n];return t[r]=o&&!u?void 0:(u||"").replace(/%2F/g,"/"),t},{}),pathname:i,pathnameBase:a,pattern:t}}function P(t){try{return t.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(e){return h(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+e+")."),t}}function D(t,e){if("/"===e)return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&"/"!==r?null:t.slice(n)||"/"}function O(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified `to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function F(t){return t.filter((t,e)=>0===e||t.route.path&&t.route.path.length>0)}function M(t,e){let n=F(t);return e?n.map((t,e)=>e===n.length-1?t.pathname:t.pathnameBase):n.map(t=>t.pathnameBase)}function B(t,e,n,r){let o;void 0===r&&(r=!1),"string"===typeof t?o=g(t):(o=u({},t),l(!o.pathname||!o.pathname.includes("?"),O("?","pathname","search",o)),l(!o.pathname||!o.pathname.includes("#"),O("#","pathname","hash",o)),l(!o.search||!o.search.includes("#"),O("#","search","hash",o)));let i,a=""===t||""===o.pathname,s=a?"/":o.pathname;if(null==s)i=n;else{let t=e.length-1;if(!r&&s.startsWith("..")){let e=s.split("/");for(;".."===e[0];)e.shift(),t-=1;o.pathname=e.join("/")}i=t>=0?e[t]:"/"}let c=function(t,e){void 0===e&&(e="/");let{pathname:n,search:r="",hash:o=""}="string"===typeof t?g(t):t,i=n?n.startsWith("/")?n:function(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(t=>{".."===t?n.length>1&&n.pop():"."!==t&&n.push(t)}),n.length>1?n.join("/"):"/"}(n,e):e;return{pathname:i,search:W(r),hash:z(o)}}(o,i),h=s&&"/"!==s&&s.endsWith("/"),d=(a||"."===s)&&n.endsWith("/");return c.pathname.endsWith("/")||!h&&!d||(c.pathname+="/"),c}const L=t=>t.join("/").replace(/\/\/+/g,"/"),U=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),W=t=>t&&"?"!==t?t.startsWith("?")?t:"?"+t:"",z=t=>t&&"#"!==t?t.startsWith("#")?t:"#"+t:"";Error;function V(t){return null!=t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"boolean"===typeof t.internal&&"data"in t}const j=["post","put","patch","delete"],G=(new Set(j),["get",...j]);new Set(G),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function H(){return H=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},H.apply(this,arguments)}const q=r.createContext(null);const K=r.createContext(null);const Q=r.createContext(null);const X=r.createContext(null);const J=r.createContext({outlet:null,matches:[],isDataRoute:!1});const Y=r.createContext(null);function Z(){return null!=r.useContext(X)}function $(){return Z()||l(!1),r.useContext(X).location}function tt(t){r.useContext(Q).static||r.useLayoutEffect(t)}function et(){let{isDataRoute:t}=r.useContext(J);return t?function(){let{router:t}=lt(ut.UseNavigateStable),e=dt(ct.UseNavigateStable),n=r.useRef(!1);tt(()=>{n.current=!0});let o=r.useCallback(function(r,o){void 0===o&&(o={}),n.current&&("number"===typeof r?t.navigate(r):t.navigate(r,H({fromRouteId:e},o)))},[t,e]);return o}():function(){Z()||l(!1);let t=r.useContext(q),{basename:e,future:n,navigator:o}=r.useContext(Q),{matches:i}=r.useContext(J),{pathname:a}=$(),s=JSON.stringify(M(i,n.v7_relativeSplatPath)),u=r.useRef(!1);tt(()=>{u.current=!0});let c=r.useCallback(function(n,r){if(void 0===r&&(r={}),!u.current)return;if("number"===typeof n)return void o.go(n);let i=B(n,JSON.parse(s),a,"path"===r.relative);null==t&&"/"!==e&&(i.pathname="/"===i.pathname?e:L([e,i.pathname])),(r.replace?o.replace:o.push)(i,r.state,r)},[e,o,s,a,t]);return c}()}function nt(t,n,o,i){Z()||l(!1);let{navigator:a}=r.useContext(Q),{matches:s}=r.useContext(J),u=s[s.length-1],c=u?u.params:{},h=(u&&u.pathname,u?u.pathnameBase:"/");u&&u.route;let d,f=$();if(n){var p;let t="string"===typeof n?g(n):n;"/"===h||(null==(p=t.pathname)?void 0:p.startsWith(h))||l(!1),d=t}else d=f;let m=d.pathname||"/",v=m;if("/"!==h){let t=h.replace(/^\//,"").split("/");v="/"+m.replace(/^\//,"").split("/").slice(t.length).join("/")}let b=y(t,{pathname:v});let w=st(b&&b.map(t=>Object.assign({},t,{params:Object.assign({},c,t.params),pathname:L([h,a.encodeLocation?a.encodeLocation(t.pathname).pathname:t.pathname]),pathnameBase:"/"===t.pathnameBase?h:L([h,a.encodeLocation?a.encodeLocation(t.pathnameBase).pathname:t.pathnameBase])})),s,o,i);return n&&w?r.createElement(X.Provider,{value:{location:H({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:e.Pop}},w):w}function rt(){let t=function(){var t;let e=r.useContext(Y),n=ht(ct.UseRouteError),o=dt(ct.UseRouteError);if(void 0!==e)return e;return null==(t=n.errors)?void 0:t[o]}(),e=V(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,o="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:o};return r.createElement(r.Fragment,null,r.createElement("h2",null,"Unexpected Application Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},e),n?r.createElement("pre",{style:i},n):null,null)}const ot=r.createElement(rt,null);class it extends r.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||"idle"!==e.revalidation&&"idle"===t.revalidation?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:void 0!==t.error?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return void 0!==this.state.error?r.createElement(J.Provider,{value:this.props.routeContext},r.createElement(Y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function at(t){let{routeContext:e,match:n,children:o}=t,i=r.useContext(q);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),r.createElement(J.Provider,{value:e},o)}function st(t,e,n,o){var i;if(void 0===e&&(e=[]),void 0===n&&(n=null),void 0===o&&(o=null),null==t){var a;if(!n)return null;if(n.errors)t=n.matches;else{if(!(null!=(a=o)&&a.v7_partialHydration&&0===e.length&&!n.initialized&&n.matches.length>0))return null;t=n.matches}}let s=t,u=null==(i=n)?void 0:i.errors;if(null!=u){let t=s.findIndex(t=>t.route.id&&void 0!==(null==u?void 0:u[t.route.id]));t>=0||l(!1),s=s.slice(0,Math.min(s.length,t+1))}let c=!1,h=-1;if(n&&o&&o.v7_partialHydration)for(let r=0;r<s.length;r++){let t=s[r];if((t.route.HydrateFallback||t.route.hydrateFallbackElement)&&(h=r),t.route.id){let{loaderData:e,errors:r}=n,o=t.route.loader&&void 0===e[t.route.id]&&(!r||void 0===r[t.route.id]);if(t.route.lazy||o){c=!0,s=h>=0?s.slice(0,h+1):[s[0]];break}}}return s.reduceRight((t,o,i)=>{let a,l=!1,d=null,f=null;var p;n&&(a=u&&o.route.id?u[o.route.id]:void 0,d=o.route.errorElement||ot,c&&(h<0&&0===i?(p="route-fallback",!1||ft[p]||(ft[p]=!0),l=!0,f=null):h===i&&(l=!0,f=o.route.hydrateFallbackElement||null)));let g=e.concat(s.slice(0,i+1)),m=()=>{let e;return e=a?d:l?f:o.route.Component?r.createElement(o.route.Component,null):o.route.element?o.route.element:t,r.createElement(at,{match:o,routeContext:{outlet:t,matches:g,isDataRoute:null!=n},children:e})};return n&&(o.route.ErrorBoundary||o.route.errorElement||0===i)?r.createElement(it,{location:n.location,revalidation:n.revalidation,component:d,error:a,children:m(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):m()},null)}var ut=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(ut||{}),ct=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(ct||{});function lt(t){let e=r.useContext(q);return e||l(!1),e}function ht(t){let e=r.useContext(K);return e||l(!1),e}function dt(t){let e=function(){let t=r.useContext(J);return t||l(!1),t}(),n=e.matches[e.matches.length-1];return n.route.id||l(!1),n.route.id}const ft={};function pt(t,e){null==t||t.v7_startTransition,void 0===(null==t?void 0:t.v7_relativeSplatPath)&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}o.startTransition;function gt(t){let{to:e,replace:n,state:o,relative:i}=t;Z()||l(!1);let{future:a,static:s}=r.useContext(Q),{matches:u}=r.useContext(J),{pathname:c}=$(),h=et(),d=B(e,M(u,a.v7_relativeSplatPath),c,"path"===i),f=JSON.stringify(d);return r.useEffect(()=>h(JSON.parse(f),{replace:n,state:o,relative:i}),[h,f,i,n,o]),null}function mt(t){l(!1)}function vt(t){let{basename:n="/",children:o=null,location:i,navigationType:a=e.Pop,navigator:s,static:u=!1,future:c}=t;Z()&&l(!1);let h=n.replace(/^\/*/,"/"),d=r.useMemo(()=>({basename:h,navigator:s,static:u,future:H({v7_relativeSplatPath:!1},c)}),[h,c,s,u]);"string"===typeof i&&(i=g(i));let{pathname:f="/",search:p="",hash:m="",state:v=null,key:y="default"}=i,b=r.useMemo(()=>{let t=D(f,h);return null==t?null:{location:{pathname:t,search:p,hash:m,state:v,key:y},navigationType:a}},[h,f,p,m,v,y,a]);return null==b?null:r.createElement(Q.Provider,{value:d},r.createElement(X.Provider,{children:o,value:b}))}function yt(t){let{children:e,location:n}=t;return nt(bt(e),n)}new Promise(()=>{});r.Component;function bt(t,e){void 0===e&&(e=[]);let n=[];return r.Children.forEach(t,(t,o)=>{if(!r.isValidElement(t))return;let i=[...e,o];if(t.type===r.Fragment)return void n.push.apply(n,bt(t.props.children,i));t.type!==mt&&l(!1),t.props.index&&t.props.children&&l(!1);let a={id:t.props.id||i.join("-"),caseSensitive:t.props.caseSensitive,element:t.props.element,Component:t.props.Component,index:t.props.index,path:t.props.path,loader:t.props.loader,action:t.props.action,errorElement:t.props.errorElement,ErrorBoundary:t.props.ErrorBoundary,hasErrorBoundary:null!=t.props.ErrorBoundary||null!=t.props.errorElement,shouldRevalidate:t.props.shouldRevalidate,handle:t.props.handle,lazy:t.props.lazy};t.props.children&&(a.children=bt(t.props.children,i)),n.push(a)}),n}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(Nt){}new Map;const wt=o.startTransition;s.flushSync,o.useId;function xt(t){let{basename:e,children:n,future:o,window:i}=t,a=r.useRef();var s;null==a.current&&(a.current=(void 0===(s={window:i,v5Compat:!0})&&(s={}),m(function(t,e){let{pathname:n,search:r,hash:o}=t.location;return f("",{pathname:n,search:r,hash:o},e.state&&e.state.usr||null,e.state&&e.state.key||"default")},function(t,e){return"string"===typeof e?e:p(e)},null,s)));let u=a.current,[c,l]=r.useState({action:u.action,location:u.location}),{v7_startTransition:h}=o||{},d=r.useCallback(t=>{h&&wt?wt(()=>l(t)):l(t)},[l,h]);return r.useLayoutEffect(()=>u.listen(d),[u,d]),r.useEffect(()=>pt(o),[o]),r.createElement(vt,{basename:e,children:n,location:c.location,navigationType:c.action,navigator:u,future:o})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var Et,At;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Et||(Et={})),function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"}(At||(At={}));function Ct(t){return Ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ct(t)}function kt(t){var e=function(t,e){if("object"!=Ct(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=Ct(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ct(e)?e:e+""}function St(t,e,n){return(e=kt(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function It(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Rt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?It(Object(n),!0).forEach(function(e){St(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var Tt=function(t,e){return(Tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Nt(t,e){function n(){this.constructor=t}Tt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function _t(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function Pt(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var Dt=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.get=function(t){return t in this.flags||(this.flags[t]=this.evaluateFlag(t)),this.flags[t]},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e,n,r=(e=this.global.location.search,n={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return function(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}(n,e[0],e[1]),e.join("=")}),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach(function(e){var n=e.split(":"),r=n[0],o=n[1];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,o)})}},t}();function Ot(){return Ft}var Ft=null,Mt=new Map,Bt=new Map;function Lt(t,e){var n=Vt(t,e);return Mt.get(n)}function Ut(t){for(var e=Mt.entries(),n=[];;){var r=e.next(),o=r.done,i=r.value;if(o)break;var a=i[0],s=i[1];a.split("_")[0]===t&&n.push(s)}return n}function Wt(t){var e=t.kernelName,n=t.backendName,r=Vt(e,n);if(Mt.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");Mt.set(r,t)}function zt(t){var e=t.kernelName;Bt.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),Bt.set(e,t)}function Vt(t,e){return e+"_"+t}function jt(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function Gt(t,e,n){return Math.max(t,Math.min(e,n))}function Ht(t){return t%2==0?t:t+1}function qt(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function Kt(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function Qt(t,e,n){void 0===n&&(n=""),Kt(Zt(t,e),function(){return n+" Shapes "+t+" and "+e+" must match"})}function Xt(t){Kt(null!=t,function(){return"The input to the tensor constructor must be a non-null value."})}function Jt(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||de(t)&&!n)for(var r=0;r<t.length;++r)Jt(t[r],e,n);else e.push(t);return e}function Yt(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function Zt(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function $t(t){return t%1==0}function te(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function ee(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function ne(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function re(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise(function(r,o){var i=0,a=function(){if(t())r();else{i++;var s=e(i);null!=n&&i>=n?o():setTimeout(a,s)}};a()})}function oe(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var i=t.slice();return i[r]=e/n,i}function ie(t,e){var n=e.length;return Kt((t=null==t?e.map(function(t,e){return e}):[].concat(t)).every(function(t){return t>=-n&&t<n}),function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t}),Kt(t.every(function(t){return $t(t)}),function(){return"All values in axis param must be integers but got axis "+t}),t.map(function(t){return t<0?n+t:t})}function ae(t,e){for(var n=[],r=[],o=null!=e&&Array.isArray(e)&&0===e.length,i=null==e||o?null:ie(e,t).sort(),a=0,s=0;s<t.length;++s){if(null!=i){if(i[a]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==i[a]||i[a]>s)&&1===t[s]&&(n.push(t[s]),r.push(s)),i[a]<=s&&a++}1!==t[s]&&(n.push(t[s]),r.push(s))}return{newShape:n,keptDims:r}}function se(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function ue(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function ce(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function le(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function he(t,e){return"complex64"!==e&&("float32"!==e||"complex64"===t)&&("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)}function de(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function fe(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function pe(t){if(null==t)return 0;var e=0;return t.forEach(function(t){return e+=t.length}),e}function ge(t){return"string"==typeof t||t instanceof String}function me(t){return"boolean"==typeof t}function ve(t){return"number"==typeof t}function ye(t){return Array.isArray(t)?ye(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":ve(t)?"float32":ge(t)?"string":me(t)?"bool":"float32"}function be(t){return!!(t&&t.constructor&&t.call&&t.apply)}function we(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function xe(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function Ee(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Jt(t)),n&&ce(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function Ae(t,e){if(0===t.length)return e[0];var n=t.reduce(function(t,e){return t*e});if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var o=new Array;if(1===n.length)for(var i=n[0],a=0;a<i;a++)o[a]=r[e+a];else{i=n[0];var s=n.slice(1),u=s.reduce(function(t,e){return t*e});for(a=0;a<i;a++)o[a]=t(e+a*u,s,r)}return o}(0,t,e)}function Ce(t,e){for(var n=ke(t,e),r=0;r<n.length;r++)n[r]=1;return n}function ke(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function Se(){return Ot().platform.now()}function Ie(t){t.forEach(function(e){Kt(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."})})}function Re(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",Ot().platform.encode(t,e)}function Te(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",Ot().platform.decode(t,e)}function Ne(t,e,n){if(0===e)return 0;if(1===e)return t[0];for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=n[o]*t[o];return r}function _e(t,e,n){if(0===e)return[];if(1===e)return[t];for(var r=new Array(e),o=0;o<r.length-1;++o)r[o]=Math.floor(t/n[o]),t-=r[o]*n[o];return r[r.length-1]=t,r}Object.freeze({shuffle:jt,clamp:Gt,nearestLargerEven:Ht,sum:qt,randUniform:function(t,e){var n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},assert:Kt,assertShapesMatch:Qt,assertNonNull:Xt,flatten:Jt,sizeFromShape:Yt,isScalarShape:function(t){return 0===t.length},arraysEqual:Zt,isInt:$t,tanh:te,sizeToSquarishShape:ee,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return jt(e),e},rightPad:ne,repeatedTry:re,inferFromImplicitShape:oe,parseAxisParam:ie,squeezeShape:ae,getTypedArrayFromDType:se,getArrayFromDType:ue,checkConversionForErrors:ce,isValidDtype:le,hasEncodingLoss:he,isTypedArray:de,bytesPerElement:fe,bytesFromStringArray:pe,isString:ge,isBoolean:me,isNumber:ve,inferDtype:ye,isFunction:be,nearestDivisor:we,computeStrides:xe,toTypedArray:Ee,toNestedArray:Ae,makeOnesTypedArray:Ce,makeZerosTypedArray:ke,now:Se,assertNonNegativeIntegerDimensions:Ie,fetch:function(t,e){return Ot().platform.fetch(t,e)},encodeString:Re,decodeString:Te,locToIndex:Ne,indexToLoc:_e});var Pe=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new De)}return t.prototype.profileKernel=function(t,e,n){var r,o=this,i=this.backendTimer.time(function(){r=n()});return r.forEach(function(n){n.data().then(function(r){!function(t,e,n){if("float32"!==e)return!1;for(var r=0;r<t.length;r++){var o=t[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,t),i.then(function(i){var a="";null!=i.getExtraProfileInfo&&(a=i.getExtraProfileInfo()),o.logger.logKernelProfile(t,n,r,i.kernelMs,e,a)})})}),r},t}(),De=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,o,i){var a="number"==typeof r?ne(r+"ms",9):r.error,s=ne(t,25),u=e.rank,c=e.size,l=ne(e.shape.toString(),14),h="";for(var d in o){var f=o[d].shape||e.shape,p=f.length;h+=d+": "+p+"D "+(p>0?f:"")+" "}console.log("%c"+s+"\t%c"+a+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+h+"\t%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}();function Oe(t,e,n){return ne(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":ge(t)?"'"+t+"'":"bool"===n?Fe(t):parseFloat(t.toFixed(7)).toString(),e)}function Fe(t){return 0===t?"false":"true"}function Me(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var Be=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=Yt(t),null!=n){var o=n.length;Kt(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."})}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||ue(e,this.size),this.strides=xe(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),Kt(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(n);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=0,r=0,o=t;r<o.length;r++){var i=o[r];if(i<0||i>=this.shape[n]){var a="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(a)}n++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return Le().makeTensor(this.values,this.shape,this.dtype)},t}(),Le=null,Ue=null,We=null,ze=function(){function t(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=Yt(t),this.strides=xe(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),Kt(1===this.size,function(){return"The array must have only 1 element."}),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),Ue.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return _t(this,void 0,void 0,function(){var t;return Pt(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Ue.buffer(this.shape,this.dtype,t)]}})})},t.prototype.bufferSync=function(){return Ue.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return _t(this,void 0,void 0,function(){var t;return Pt(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Ae(this.shape,t)]}})})},t.prototype.arraySync=function(){return Ae(this.shape,this.dataSync())},t.prototype.data=function(){return _t(this,void 0,void 0,function(){var t,e;return Pt(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=Le().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map(function(t){return Te(t)})]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}case 2:return[2,t]}})})},t.prototype.dataSync=function(){this.throwIfDisposed();var t=Le().readSync(this.dataId);if("string"===this.dtype)try{return t.map(function(t){return Te(t)})}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return _t(this,void 0,void 0,function(){var t;return Pt(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,Le().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}})})},t.prototype.dispose=function(){this.isDisposed||(Le().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),Ue.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),Ue.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),Ue.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),Ue.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),Ue.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),Ue.clone(this)},t.prototype.oneHot=function(t,e,n){return this.throwIfDisposed(),Ue.oneHot(this,t,e,n)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var o=xe(e),i=function(t,e,n,r){var o=Yt(e),i=r[r.length-1],a=new Array(i).fill(0),s=e.length,u="complex64"===n?Me(t):t;if(s>1)for(var c=0;c<o/i;c++)for(var l=c*i,h=0;h<i;h++)a[h]=Math.max(a[h],Oe(u[l+h],0,n).length);return a}(t,e,n,o),a=e.length,s=function t(e,n,r,o,i,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[Oe(Me(e)[0],0,r)]:"bool"===r?[Fe(e[0])]:[e[0].toString()];if(1===c){if(u>20){var l=3*s,h=Array.from(e.slice(0,l)),d=Array.from(e.slice((u-3)*s,u*s));return"complex64"===r&&(h=Me(h),d=Me(d)),["["+h.map(function(t,e){return Oe(t,i[e],r)}).join(", ")+", ..., "+d.map(function(t,e){return Oe(t,i[u-3+e],r)}).join(", ")+"]"]}return["["+("complex64"===r?Me(e):Array.from(e)).map(function(t,e){return Oe(t,i[e],r)}).join(", ")+"]"]}var f=n.slice(1),p=o.slice(1),g=o[0]*s,m=[];if(u>20){for(var v=0;v<3;v++){var y=(b=v*g)+g;m.push.apply(m,t(e.slice(b,y),f,r,p,i,!1))}for(m.push("..."),v=u-3;v<u;v++)y=(b=v*g)+g,m.push.apply(m,t(e.slice(b,y),f,r,p,i,v===u-1))}else for(v=0;v<u;v++){var b;y=(b=v*g)+g,m.push.apply(m,t(e.slice(b,y),f,r,p,i,v===u-1))}var w=2===c?",":"";for(m[0]="["+m[0]+w,v=1;v<m.length-1;v++)m[v]=" "+m[v]+w;var x=",\n";for(v=2;v<c;v++)x+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(a?"":x),m}(t,e,n,o,i),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(t){return"    "+t}).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.tile=function(t){return this.throwIfDisposed(),Ue.tile(this,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),Ue.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),Ue.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),Ue.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),Ue.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),Ue.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),Ue.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),Ue.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),Ue.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),Ue.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),Ue.unstack(this,t)},t.prototype.pad=function(t,e){return void 0===e&&(e=0),Ue.pad(this,t,e)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),We("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,r,n)},t.prototype.batchNorm=function(t,e,n,r,o){return void 0===o&&(o=.001),this.throwIfDisposed(),Ue.batchNorm(this,t,e,n,r,o)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ue.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ue.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ue.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ue.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ue.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ue.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ue.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),Ue.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Ue.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),Ue.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),Ue.cast(this,t)},t.prototype.add=function(t){return this.throwIfDisposed(),Ue.add(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),Ue.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),Ue.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),Ue.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),Ue.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),Ue.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),Ue.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),Ue.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),Ue.mulStrict(this,t)},t.prototype.div=function(t){return this.throwIfDisposed(),Ue.div(this,t)},t.prototype.divNoNan=function(t){return this.throwIfDisposed(),Ue.divNoNan(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),Ue.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),Ue.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),Ue.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Ue.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),Ue.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Ue.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),Ue.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),Ue.modStrict(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Ue.squaredDifferenceStrict(this,t)},t.prototype.transpose=function(t){return this.throwIfDisposed(),Ue.transpose(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),Ue.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Ue.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),Ue.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),Ue.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),Ue.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),Ue.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),Ue.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Ue.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),Ue.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Ue.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Ue.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Ue.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Ue.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),Ue.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),Ue.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),Ue.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),Ue.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),Ue.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),Ue.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),Ue.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),Ue.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),Ue.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),Ue.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),Ue.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),Ue.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),Ue.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),Ue.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),Ue.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),Ue.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),Ue.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),Ue.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),Ue.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),Ue.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Ue.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),Ue.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),Ue.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),Ue.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),Ue.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),Ue.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),Ue.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),Ue.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ue.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),Ue.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),Ue.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),Ue.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),Ue.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),Ue.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),Ue.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),Ue.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),Ue.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),Ue.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),Ue.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),Ue.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),Ue.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),Ue.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),Ue.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),Ue.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),Ue.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),Ue.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),Ue.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Ue.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),Ue.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Ue.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),Ue.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,i){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),Ue.conv1d(this,t,e,n,r,o,i)},t.prototype.conv2d=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Ue.conv2d(this,t,e,n,r,o,i)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),Ue.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,i){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),Ue.depthwiseConv2d(this,t,e,n,r,o,i)},t.prototype.separableConv2d=function(t,e,n,r,o,i){return void 0===o&&(o=[1,1]),void 0===i&&(i="NHWC"),this.throwIfDisposed(),Ue.separableConv2d(this,t,e,n,r,o,i)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),Ue.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),Ue.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),Ue.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),Ue.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),Le().makeVariable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Ue.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Ue.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Ue.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),Ue.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o,i,a,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),Ue.stridedSlice(this,t,e,n,r,o,i,a,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),Ue.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),Ue.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),Ue.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),Ue.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),Ue.spectral.irfft(this)},t}();Object.defineProperty(ze,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var Ve,je,Ge,He,qe,Ke=function(t){function e(e,n,r,o){var i=t.call(this,e.shape,e.dtype,e.dataId,o)||this;return i.trainable=n,i.name=r,i}return Nt(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Zt(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Le().disposeTensor(this),this.dataId=t.dataId,Le().incRef(this,null)},e.prototype.dispose=function(){Le().disposeVariable(this),this.isDisposedInternal=!0},e}(ze);Object.defineProperty(Ke,Symbol.hasInstance,{value:function(t){return t instanceof ze&&null!=t.assign&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(Ve||(Ve={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(je||(je={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Ge||(Ge={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(He||(He={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(qe||(qe={}));var Qe={float32:He,int32:je,bool:Ge,complex64:qe};function Xe(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return Qe[t][e]}function Je(t){return Xe(t,"int32")}function Ye(t,e){if(t.dtype===e.dtype)return[t,e];var n=Xe(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Ze(t,e){Kt(t.dtype===e.dtype,function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"})}function $e(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof ze)n.push(e);else if(o=e,Array.isArray(o)||"object"==typeof o){var o,i=e;for(var a in i){var s=i[a];r.has(s)||(r.add(s),t(s,n,r))}}}(t,e,new Set),e}Object.freeze({makeTypesMatch:Ye,assertTypesMatch:Ze,isTensorInList:function(t,e){return e.some(function(e){return e.id===t.id})},getTensorsInContainer:$e});var tn,en=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),nn=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new en}return t.prototype.ready=function(){return _t(this,void 0,void 0,function(){var t,e,n;return Pt(this,function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then(function(){})];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return _t(this,void 0,void 0,function(){var e,n,r;return Pt(this,function(o){switch(o.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Pe(this.backendInstance),[2,!0]}})})},t.prototype.setupRegisteredKernels=function(){var t=this;Ut(this.backendName).forEach(function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)})},t.prototype.disposeRegisteredKernels=function(t){var e=this;Ut(t).forEach(function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])})},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,i=r.then(function(n){return!(o<e.pendingBackendInitId)&&(e.registry[t]=n,e.pendingBackendInit=null,!0)}).catch(function(n){return!(o<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(n.stack||n.message),!1)});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority})},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),o=r.success,i=r.asyncInit;if(i||o)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,o=this.readSync(e);r.disposeData(e),n.backend=t,t.move(e,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,o=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun(function(){return r.startScope(o)},function(){return r.endScope(n)},function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],function(t){return{x:function(){return t.toFloat()}}},[]),e},t.prototype.runKernel=function(t,e,n,r,o){return this.runKernelFunc(null,e,null,t,n,r,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),o=0;n.forEach(function(t){o+="complex64"===t.dtype?3:1});var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-e-o-i;if(a>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+a+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t,e,n,r,o,i,a){var s,u=this;void 0===i&&(i=[]),void 0===a&&(a=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,d=function(t){l&&(c=t.map(function(t){return u.keep(u.clone(t))}))},f=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,m=Lt(r,this.backendName);return h=null!=m?function(){var t=u.backend.numDataIds();g=m.kernelFunc({inputs:e,attrs:o,backend:u.backend});var n=Array.isArray(g)?g:[g];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n);var s=n.map(function(t){var e=t.dataId,n=t.shape,r=t.dtype;return u.makeTensorFromDataId(e,n,r)}),c=s.filter(function(t,e){return a[e]});return d((i||[]).slice().concat(c)),s}:function(){var e=u.backend.numDataIds();g=u.tidy(function(){return t(u.backend,d)});var n=Array.isArray(g)?g:[g];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n),n},this.scopedRun(function(){return u.state.kernelDepth++},function(){return u.state.kernelDepth--},function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,e,function(){return h()}):h()}),l&&this.addTapeNode(r,e,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(t){return e[t].shape}),outputShapes:s.map(function(t){return t.shape})}),Array.isArray(g)?s:s[0]},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=t;"string"===n&&ge(t[0])&&(o=t.map(function(t){return Re(t)}));var i=r.write(o,e,n),a=new ze(e,n,i,this.nextTensorId());if(this.incRef(a,r),"string"===n){var s=this.state.tensorInfo.get(i),u=pe(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return a},t.prototype.makeTensorFromDataId=function(t,e,n,r){var o=new ze(e,n=n||"float32",t,this.nextTensorId());return this.incRef(o,r),o},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.asType(r));var o=new Ke(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*fe(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Ke||this.track(t)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return _t(this,void 0,void 0,function(){var e,n;return Pt(this,function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(t){return t.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,o){var i=this,a={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:o},s=function(t){return Bt.get(t)}(t);null!=s&&(r=s.gradFunc),null!=r&&(a.gradient=function(t){return t=t.map(function(t,e){if(null==t){var r=n[e],o=ke(r.size,r.dtype);return i.makeTensor(o,r.shape,r.dtype)}return t}),r(t.length>1?t:t[0],o)}),this.state.activeTape.push(a)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=$e(t),r=new Set(n.map(function(t){return t.id})),o=0;o<this.state.activeScope.track.length;o++){var i=this.state.activeScope.track[o];i.kept||r.has(i.id)||i.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(t){t.kept||t.scopeId!==a.id||e.track(t)})},t.prototype.gradients=function(t,e,n,r){var o=this;if(void 0===r&&(r=!1),Kt(e.length>0,function(){return"gradients() received an empty list of xs."}),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var i=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",t)});Kt(i instanceof ze,function(){return"The result y returned by f() must be a tensor."});var a=function(t,e,n){for(var r={},o={},i=0;i<e.length;i++)r[e[i].id]=!0;for(i=0;i<t.length;i++){var a=(p=t[i]).inputs;for(var s in a){for(var u=a[s],c=!1,l=0;l<e.length;l++)if(r[u.id]){p.outputs.forEach(function(t){return r[t.id]=!0}),c=!0,o[p.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;var d={};for(i=t.length-1;i>=0;i--)for(a=(p=t[i]).inputs,l=0;l<p.outputs.length;l++)if(h[p.outputs[l].id]){for(var s in a)h[a[s].id]=!0,d[p.id]=!0;break}var f=[];for(i=0;i<t.length;i++){var p;if(o[(p=t[i]).id]&&d[p.id]){var g={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(g[s]=m)}var v=Object.assign({},p);v.inputs=g,v.outputs=p.outputs,f.push(v)}}return f}(this.state.activeTape,e,i);if(!r&&0===a.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var t,r,s={};s[i.id]=null==n?(r=Ce(Yt(t=i.shape),"float32"),rn.makeTensor(r,t,"float32")):n,function(t,e,n){for(var r=function(r){var o=e[r],i=[];if(o.outputs.forEach(function(e){var n=t[e.id];null!=n?i.push(n):i.push(null)}),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var a=o.gradient(i),s=function(e){if(!(e in a))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(a)+".");var r=n(function(){return a[e]()});if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+e+" must have 'float32' dtype, but has '"+r.dtype+"'");var i=o.inputs[e];if(!Zt(r.shape,i.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+e+"' has shape '"+r.shape+"', which does not match the shape of the input '"+i.shape+"'");if(null==t[i.id])t[i.id]=r;else{var s=t[i.id];t[i.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=e.length-1;o>=0;o--)r(o)}(s,a,function(t){return o.tidy(t)});var u=e.map(function(t){return s[t.id]});return 0===o.state.gradientDepth&&(o.state.activeTape.forEach(function(t){for(var e=0,n=t.saved;e<n.length;e++)n[e].dispose()}),o.state.activeTape=null),{value:i,grads:u}})},t.prototype.customGrad=function(t){var e=this;return Kt(be(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];Kt(r.every(function(t){return t instanceof ze}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return r.forEach(function(t,e){i[e]=t}),e.runKernelFunc(function(e,o){return Kt((n=t.apply(void 0,r.concat([o]))).value instanceof ze,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Kt(be(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},i,function(t,e){var o=n.gradFunc(t,e),i=Array.isArray(o)?o:[o];Kt(i.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Kt(i.every(function(t){return t instanceof ze}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var a={};return i.forEach(function(t,e){a[e]=function(){return t}}),a})}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.time=function(t){return _t(this,void 0,void 0,function(){var e,n;return Pt(this,function(r){switch(r.label){case 0:return e=Se(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=Se()-e,[2,n]}})})},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new en,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),rn=function(){var t=function(){if(null==tn){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof n.g)t=n.g;else if("undefined"!=typeof process)t=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");t=self}tn=t}return tn}();if(null==t._tfengine){var e=new Dt(t);t._tfengine=new nn(e)}return function(t){Ft=t}(t._tfengine.ENV),Le=function(){return t._tfengine},t._tfengine}();function on(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var an=Ot();an.registerFlag("DEBUG",function(){return!1},function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),an.registerFlag("IS_BROWSER",function(){return on()}),an.registerFlag("IS_NODE",function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node}),an.registerFlag("IS_CHROME",function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),an.registerFlag("PROD",function(){return!1}),an.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return an.getBool("DEBUG")}),an.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),an.registerFlag("IS_TEST",function(){return!1});var sn,un,cn,ln={},hn={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function dn(t,e){ln[t]=e}function fn(t){t in ln||(ln[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return e.addEventListener("webglcontextlost",function(e){e.preventDefault(),delete ln[t]},!1),1===t?e.getContext("webgl",hn)||e.getContext("experimental-webgl",hn):e.getContext("webgl2",hn)}(t));var e=ln[t];return e.isContextLost()?(delete ln[t],fn(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),ln[t])}function pn(t,e){return[e,t]}function gn(t){var e=Yt(t);return ee(Math.ceil(e/4))}function mn(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function vn(t,e){var n,r,o,i,a,s,u,c,l,h=t;return 2===Ot().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,o=h.RGBA16F,i=h.RGBA32F,a=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=t.RGBA,r=t.RGBA,o=t.RGBA,i=h.RGBA,a=t.RGBA,s=4,u=4,c=null!=e?e.HALF_FLOAT_OES:null,l=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function yn(t,e,n){var r=n();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+wn(t,e))}(t),r}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(sn||(sn={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(un||(un={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(cn||(cn={}));function bn(t){return!!(Ot().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function wn(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function xn(t,e,n){return Gn(t,e,function(){return t.getExtension(n)},'Extension "'+n+'" not supported on this browser.')}function En(t,e,n){var r=Gn(t,e,function(){return t.createShader(t.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(yn(t,e,function(){return t.shaderSource(r,n)}),yn(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function An(t,e,n){var r=Gn(t,e,function(){return t.createShader(t.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(yn(t,e,function(){return t.shaderSource(r,n)}),yn(t,e,function(){return t.compileShader(r)}),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(t,e){var n=Sn.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),i=o.length.toString().length+2,a=o.map(function(t,e){return ne((e+1).toString(),i)+t}),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var c=a.slice(0,r-1),l=a.slice(r-1,r),h=a.slice(r);console.log(c.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+ne(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Cn,kn,Sn=/ERROR: [0-9]+:([0-9]+):/g;function In(t,e){return Gn(t,e,function(){return t.createProgram()},"Unable to create WebGLProgram.")}function Rn(t,e,n){if(yn(t,e,function(){return t.linkProgram(n)}),!1===t.getProgramParameter(n,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function Tn(t,e,n){if(yn(t,e,function(){return t.validateProgram(n)}),!1===t.getProgramParameter(n,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function Nn(t,e,n){var r=Gn(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return yn(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),yn(t,e,function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function _n(t,e,n){var r=Gn(t,e,function(){return t.createBuffer()},"Unable to create WebGLBuffer");return yn(t,e,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)}),yn(t,e,function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)}),r}function Pn(t,e){return Gn(t,e,function(){return t.createTexture()},"Unable to create WebGLTexture.")}function Dn(t,e){var n=Ot().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function On(t,e){return Gn(t,e,function(){return t.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Fn(t,e,n,r,o,i,a,s){var u=t.getAttribLocation(n,r);return-1!==u&&(yn(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,o)}),yn(t,e,function(){return t.vertexAttribPointer(u,i,t.FLOAT,!1,a,s)}),yn(t,e,function(){return t.enableVertexAttribArray(u)}),!0)}function Mn(t,e,n,r){Hn(t,r),yn(t,e,function(){return t.activeTexture(t.TEXTURE0+r)}),yn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)})}function Bn(t,e,n,r){return Gn(t,e,function(){return t.getUniformLocation(n,r)},'uniform "'+r+'" not present in program.')}function Ln(t,e,n){return t.getUniformLocation(e,n)}function Un(t,e,n,r,o,i){yn(t,e,function(){return Mn(t,e,r,i)}),yn(t,e,function(){return t.uniform1i(o,i)})}function Wn(t,e,n,r){yn(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)}),yn(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)})}function zn(t,e,n){yn(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)}),yn(t,e,function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)})}function Vn(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+jn(t,e))}function jn(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Gn(t,e,n,r){var o=yn(t,e,function(){return n()});if(null==o)throw new Error(r);return o}function Hn(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function qn(t,e){return void 0===e&&(e=2),Yt(t.slice(0,t.length-e))}function Kn(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Qn(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[qn(t)].concat(Kn(t))),e}function Xn(t,e){var n;void 0===e&&(e=!1);var r=Ot().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map(function(e,n){return n>=t.length-2?Ht(t[n]):t[n]})).length&&(t=[2,t[0]])),2!==t.length){var o=ae(t);t=o.newShape}var i=Yt(t);if(t.length<=1&&i<=r)return[1,i];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var a=qn(t),s=2,u=2;return t.length&&(s=(n=Kn(t))[0],u=n[1]),ee(i=a*(s/2)*(u/2)).map(function(t){return 2*t})}return ee(i)}function Jn(t){return t%2==0}function Yn(t,e){if(Zt(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(Jn(n)&&Jn(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&Jn(t[0])&&Jn(e[0])}function Zn(t){if(null==Cn){var e=fn(t);Cn=e.getParameter(e.MAX_TEXTURE_SIZE)}return Cn}function $n(t){if(null==kn){var e=fn(t);kn=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,kn)}function tr(t){if(0===t)return 0;var e=fn(t);return er(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:er(e,"EXT_disjoint_timer_query")?1:0}function er(t,e){return null!=t.getExtension(e)}function nr(t){try{if(null!=fn(t))return!0}catch(t){return!1}return!1}function rr(t){if(0===t)return!1;var e=fn(t);if(1===t){if(!er(e,"OES_texture_float"))return!1}else if(!er(e,"EXT_color_buffer_float"))return!1;return ir(e)}function or(t){if(0===t)return!1;var e=fn(t);if(1!==t){if(er(e,"EXT_color_buffer_float"))return ir(e);if(er(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(t,e){var n=vn(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),i}(e,n)}return!1}return!!er(e,"OES_texture_float")&&!!er(e,"WEBGL_color_buffer_float")&&ir(e)}function ir(t){var e=vn(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),o}function ar(t){return 2===t&&null!=fn(t).fenceSync}var sr=Object.freeze({callAndCheck:yn,canBeRepresented:bn,getWebGLErrorMessage:wn,getExtensionOrThrow:xn,createVertexShader:En,createFragmentShader:An,createProgram:In,linkProgram:Rn,validateProgram:Tn,createStaticVertexBuffer:Nn,createStaticIndexBuffer:_n,getNumChannels:function(){return 2===Ot().getNumber("WEBGL_VERSION")?1:4},createTexture:Pn,validateTextureSize:Dn,createFramebuffer:On,bindVertexBufferToProgramAttribute:Fn,bindTextureUnit:Mn,unbindTextureUnit:function(t,e,n){Hn(t,n),yn(t,e,function(){return t.activeTexture(t.TEXTURE0+n)}),yn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})},getProgramUniformLocationOrThrow:Bn,getProgramUniformLocation:Ln,bindTextureToProgramUniformSampler:Un,bindCanvasToFramebuffer:function(t,e){yn(t,e,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),yn(t,e,function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)}),yn(t,e,function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)})},bindColorTextureToFramebuffer:Wn,unbindColorTextureFromFramebuffer:zn,validateFramebuffer:Vn,getFramebufferErrorMessage:jn,getBatchDim:qn,getRowsCols:Kn,getShapeAs3D:Qn,getTextureShapeFromLogicalShape:Xn,isReshapeFree:Yn,getWebGLMaxTextureSize:Zn,resetMaxTextureSize:function(){Cn=null},resetMaxTexturesInShader:function(){kn=null},getMaxTexturesInShader:$n,getWebGLDisjointQueryTimerVersion:tr,hasExtension:er,isWebGLVersionEnabled:nr,isCapableOfRenderingToFloatTexture:rr,isDownloadFloatTextureEnabled:or,isWebGLFenceEnabled:ar}),ur=Ot();function cr(t){Ot().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function lr(t,e){return rn.tidy(t,e)}function hr(t){$e(t).forEach(function(t){return t.dispose()})}function dr(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ot().getBool("IS_TEST")||console.warn.apply(console,t)}function fr(t,e){var n=t;if(de(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||de(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&Ot().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||de(e)){Kt(n.length>0,function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"}),Kt(e.length===n[0],function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"});for(var o=n.slice(1),i=0;i<e.length;++i)t(e[i],o,r.concat(i))}else Kt(0===n.length,function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"})}(t,r,[]),r}function pr(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function gr(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof ze)return pr(r,t.dtype,e,n),t;var o=ye(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),pr(r,o,e,n),null==t||!de(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){var i=null==t?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+i+"'")}var a=fr(t,o);de(t)||Array.isArray(t)||(t=[t]);var s="string"!==o?Ee(t,o,Ot().getBool("DEBUG")):Jt(t,[],!0);return rn.makeTensor(s,a,o)}function mr(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map(function(t,r){return gr(t,e+"["+r+"]",n)},r)}function vr(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function yr(t,e,n){for(var r=t.length+e.length,o=[],i=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(t[i++]):o.push(e[a++]);return o}function br(t,e){for(var n=[],r=t.length,o=0;o<r;o++)-1===e.indexOf(o)&&n.push(t[o]);return[n,e.map(function(e){return t[e]})]}function wr(t,e){return yr(t,e.map(function(t){return 1}),e)}function xr(t,e,n){Kt(vr(e,n),function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."})}function Er(t,e){if(vr(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach(function(t){return n.push(t)}),n}function Ar(t){return t.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function Cr(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function kr(t,e){var n=t[0].length;t.forEach(function(t,e){Kt(t.length===n,function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"})}),Kt(e>=0&&e<n,function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."});var r=t[0];t.forEach(function(t,o){for(var i=0;i<n;i++)Kt(i===e||t[i]===r[i],function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Sr(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function Ir(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];rn.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),rn.endScope(o),o}catch(t){throw rn.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}ur.registerFlag("HAS_WEBGL",function(){return ur.getNumber("WEBGL_VERSION")>0}),ur.registerFlag("WEBGL_VERSION",function(){return nr(2)?2:nr(1)?1:0}),ur.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return 2===ur.get("WEBGL_VERSION")}),ur.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),ur.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),ur.registerFlag("WEBGL_PACK",function(){return ur.getBool("HAS_WEBGL")}),ur.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_PACK_CLIP",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),ur.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_PACK_REDUCE",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_LAZILY_UNPACK",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_CONV_IM2COL",function(){return ur.getBool("WEBGL_PACK")}),ur.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return Zn(ur.getNumber("WEBGL_VERSION"))}),ur.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return $n(ur.getNumber("WEBGL_VERSION"))}),ur.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var t=ur.getNumber("WEBGL_VERSION");return 0===t?0:tr(t)}),ur.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return ur.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t}),ur.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return rr(ur.getNumber("WEBGL_VERSION"))}),ur.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!ur.getBool("WEBGL_FORCE_F16_TEXTURES")&&ur.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),ur.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return or(ur.getNumber("WEBGL_VERSION"))}),ur.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ar(ur.getNumber("WEBGL_VERSION"))}),ur.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return ur.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),We=cr;var Rr=Ir({complex_:function(t,e){var n=gr(t,"real","complex"),r=gr(e,"imag","complex");return Qt(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),rn.runKernelFunc(function(t){return t.complex(n,r)},{$real:n,$imag:r})}}),Tr=Ir({real_:function(t){var e=gr(t,"input","real");return rn.runKernelFunc(function(t){return t.real(e)},{$input:e})}}),Nr=Ir({imag_:function(t){var e=gr(t,"input","imag");return rn.runKernelFunc(function(t){return t.imag(e)},{$input:e})}});function _r(t,e,n){return Pr(t,e,fr(t,n),n)}function Pr(t,e,n,r){if(null==r&&(r=ye(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!de(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Ie(e);var o=Yt(e),i=Yt(n);Kt(o===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+i});for(var a=0;a<n.length;++a){var s=n[a],u=a!==n.length-1||s!==Yt(e.slice(a));Kt(n[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "})}}return de(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?Ee(t,r,Ot().getBool("DEBUG")):Jt(t,[],!0),rn.makeTensor(t,e,r)}function Dr(t,e){if((de(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&de(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Pr(t,[],[],e)}function Or(t,e){Xt(t);var n=fr(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Pr(t,null,n,e)}function Fr(t,e,n){if(Xt(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=fr(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Pr(t,e,r,n)}function Mr(t,e,n){if(Xt(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=fr(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Pr(t,e,r,n)}function Br(t,e,n){if(Xt(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=fr(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Pr(t,e,r,n)}function Lr(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=Lr(t,"float32"),r=Ur(t,"float32");return Rr(n,r)}var o=Ce(Yt(t),e);return rn.makeTensor(o,t,e)}function Ur(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=Ur(t,"float32"),r=Ur(t,"float32");return Rr(n,r)}var o=ke(Yt(t),e);return rn.makeTensor(o,t,e)}function Wr(t,e,n){return rn.runKernelFunc(function(r){return r.fill(t,e,n)},{})}function zr(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return Ur([0],r);var o=ke(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+n;return Or(o,r)}var Vr=Ir({onesLike_:function(t){var e=gr(t,"x","onesLike");if("complex64"===e.dtype){var n=Vr(Tr(e)),r=jr(Nr(e));return Rr(n,r)}return rn.runKernelFunc(function(t){return t.onesLike(e)},{$x:e},function(t,e){return{$x:function(){return jr(t)}}})}}),jr=Ir({zerosLike_:function(t){var e=gr(t,"x","zerosLike");return rn.runKernelFunc(function(t){return t.zerosLike(e)},{$x:e},function(t,e){return{$x:function(){return jr(t)}}})}}),Gr=Ir({concat_:function(t,e){void 0===e&&(e=0),Kt(t.length>=1,function(){return"Pass at least one tensor to concat"});var n=mr(t,"tensors","concat");"complex64"===n[0].dtype&&n.forEach(function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")}),e=ie(e,n[0].shape)[0];var r=Sr(n.map(function(t){return t.shape}),e);if(0===Yt(r))return _r([],r);if(1===(n=n.filter(function(t){return t.size>0})).length)return n[0];var o=n.map(function(t){return t.shape});kr(o,e);var i=n,a={axis:e};return rn.runKernelFunc(function(t){return t.concat(n,e)},i,function(t){var n=o.map(function(t){return t[e]});return Xr(t,n,e).map(function(t){return function(){return t}})},"Concat",a)}}),Hr=Ir({concat1d_:function(t){return Gr(t,0)}}),qr=Ir({concat2d_:function(t,e){return Gr(t,e)}}),Kr=Ir({concat3d_:function(t,e){return Gr(t,e)}}),Qr=Ir({concat4d_:function(t,e){return Gr(t,e)}}),Xr=Ir({split_:function(t,e,n){void 0===n&&(n=0);var r,o=gr(t,"x","split");return n=ie(n,o.shape)[0],"number"==typeof e?(Kt(o.shape[n]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(o.shape[n]/e)):(Kt(o.shape[n]===e.reduce(function(t,e){return t+e}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),rn.runKernelFunc(function(t){return t.split(o,r,n)},{$x:o},function(t){return{$x:function(){return Gr(t,n)}}})}});function Jr(t,e){return t(e={exports:{}},e.exports),e.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self&&self;var Yr=Jr(function(t){!function(t,e){function n(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function r(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function o(t,e){var o=new n(t),i=e&&e.state,a=o.next;return a.int32=function(){return 4294967296*o.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,i&&("object"==typeof i&&r(i,o),a.state=function(){return r(o,{})}),a}e&&e.exports?e.exports=o:this.alea=o}(0,t)}),Zr=Jr(function(t){!function(t,e){function n(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function o(t,e){var o=new n(t),i=e&&e.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var t=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=o.next,a.quick=a,i&&("object"==typeof i&&r(i,o),a.state=function(){return r(o,{})}),a}e&&e.exports?e.exports=o:this.xor128=o}(0,t)}),$r=Jr(function(t){!function(t,e){function n(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function r(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function o(t,e){var o=new n(t),i=e&&e.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var t=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=o.next,a.quick=a,i&&("object"==typeof i&&r(i,o),a.state=function(){return r(o,{})}),a}e&&e.exports?e.exports=o:this.xorwow=o}(0,t)}),to=Jr(function(t){!function(t,e){function n(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function r(t,e){return e.x=t.x.slice(),e.i=t.i,e}function o(t,e){null==t&&(t=+new Date);var o=new n(t),i=e&&e.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var t=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=o.next,a.quick=a,i&&(i.x&&r(i,o),a.state=function(){return r(o,{})}),a}e&&e.exports?e.exports=o:this.xorshift7=o}(0,t)}),eo=Jr(function(t){!function(t,e){function n(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,i=e.i;return e.w=r=r+1640531527|0,n=o[i+34&127],t=o[i=i+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=o[i]=n^t,e.i=i,n+(r^r>>>16)|0},function(t,e){var n,r,o,i,a,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,i=-32;i<u;++i)e&&(r^=e.charCodeAt((i+32)%e.length)),0===i&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(a=a+1640531527|0,o=0==(n=s[127&i]^=r+a)?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,i=512;i>0;--i)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;t.w=a,t.X=s,t.i=o}(e,t)}function r(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function o(t,e){null==t&&(t=+new Date);var o=new n(t),i=e&&e.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var t=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=o.next,a.quick=a,i&&(i.X&&r(i,o),a.state=function(){return r(o,{})}),a}e&&e.exports?e.exports=o:this.xor4096=o}(0,t)}),no=Jr(function(t){!function(t,e){function n(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function r(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function o(t,e){var o=new n(t),i=e&&e.state,a=function(){return(o.next()>>>0)/4294967296};return a.double=function(){do{var t=((o.next()>>>11)+(o.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},a.int32=o.next,a.quick=a,i&&("object"==typeof i&&r(i,o),a.state=function(){return r(o,{})}),a}e&&e.exports?e.exports=o:this.tychei=o}(0,t)}),ro=Jr(function(t){!function(e,r){var o,i=this,a=256,s="random",u=r.pow(a,6),c=r.pow(2,52),l=2*c,h=255;function d(t,n,h){var d=[],v=g(function t(e,n){var r,o=[],i=typeof e;if(n&&"object"==i)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==i?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,m(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(i.crypto||i.msCrypto).getRandomValues(t)),m(t)}catch(t){var n=i.navigator,r=n&&n.plugins;return[+new Date,i,r,i.screen,m(e)]}}():t,3),d),y=new f(d),b=function(){for(var t=y.g(6),e=u,n=0;t<c;)t=(t+n)*a,e*=a,n=y.g(1);for(;t>=l;)t/=2,e/=2,n>>>=1;return(t+n)/e};return b.int32=function(){return 0|y.g(4)},b.quick=function(){return y.g(4)/4294967296},b.double=b,g(m(y.S),e),(n.pass||h||function(t,e,n,o){return o&&(o.S&&p(o,y),t.state=function(){return p(y,{})}),n?(r[s]=t,e):t})(b,v,"global"in n?n.global:this==r,n.state)}function f(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=h&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=h&o+1],n=n*a+s[h&(s[o]=s[i=h&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}function p(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function g(t,e){for(var n,r=t+"",o=0;o<r.length;)e[h&o]=h&(n^=19*e[h&o])+r.charCodeAt(o++);return m(e)}function m(t){return String.fromCharCode.apply(0,t)}if(r["seed"+s]=d,g(r.random(),e),t.exports){t.exports=d;try{o=n(82)}catch(t){}}}([],Math)});ro.alea=Yr,ro.xor128=Zr,ro.xorwow=$r,ro.xorshift7=to,ro.xor4096=eo,ro.tychei=no;var oo=ro.alea,io=function(){function t(t,e,n,r,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=oo(i.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var o=void 0,i=void 0,a=void 0;do{a=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);e=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),ao=function(){function t(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;var o=r||Math.random();this.randu=oo(o.toString()),this.randn=new io(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,n,r,o,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,e=1-.331*(t=r*r)*t,n=.5*t+this.d*(1-i+Math.log(i)),(o=this.randu())<e||Math.log(o)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}(),so=function(){function t(t,e,n,r){var o=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=oo(r)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}();function uo(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",Ie(t),new Be(t,e,n)}var co=Ir({batchToSpaceND_:function(t,e,n){var r=gr(t,"x","batchToSpaceND"),o=e.reduce(function(t,e){return t*e});return Kt(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),Kt(n.length===e.length,function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length}),Kt(r.shape[0]%o==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o}),rn.runKernelFunc(function(t){return t.batchToSpaceND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}})}}),lo=Ir({broadcastTo_:function(t,e){var n=gr(t,"broadcastTo","x"),r=n.shape;if(e.some(function(t){return!(t>0)||t%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var o=n.shape.slice();o.length<e.length;)o.unshift(1);n=n.reshape(o)}for(var i=Array.from(e),a=e.length-1;a>=0;a--)if(n.shape[a]===e[a])i[a]=1;else if(1!==n.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var s=i.map(function(t,e){return t>1?e:-1}).filter(function(t){return t>=0});return 0===s.length?n.clone():rn.runKernelFunc(function(t){return t.tile(n,i)},{input:n},function(t){return{input:function(){return t.sum(s,!0)}}})}}),ho=Ir({cast_:function(t,e){var n=gr(t,"x","cast");if(!le(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:e};return rn.runKernelFunc(function(t){return t.cast(n,e)},{x:n},function(t){return{x:function(){return t.clone()}}},"Cast",r)}}),fo=Ir({clone_:function(t){var e=gr(t,"x","clone",null);return rn.runKernelFunc(function(){return rn.makeTensorFromDataId(e.dataId,e.shape,e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),po=Ir({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=gr(t,"x","cumsum"),i=Er([e|=0],o.rank),a=o;null!=i&&(a=o.transpose(i));var s=Cr(1,o.rank)[0],u=rn.runKernelFunc(function(t){return t.cumsum(a,s,n,r)},{permutedX:a},function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}});return null!=i&&(u=u.transpose(i)),u}}),go=Ir({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=gr(t,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return Kt(o*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape}),Kt(i*e>=0,function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+e+" for depthToSpace with input shape\n          "+r.shape}),Kt(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),rn.runKernelFunc(function(t){return t.depthToSpace(r,e,n)},{$x:r})}}),mo=Ir({expandDims_:function(t,e){void 0===e&&(e=0);var n=gr(t,"x","expandDims",null);Kt(e<=n.rank,function(){return"Axis must be <= rank of the tensor"});var r=n.shape.slice();return e<0&&(Kt(-(n.rank+1)<=e,function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"}),e=n.rank+e+1),r.splice(e,0,1),To(n,r)}}),vo=Ir({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var o=uo([t,e],r),i=t<=e?t:e,a=0;a<i;++a)o.set(1,a,a);var s=o.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return Do(mo(s,0),[n[0],1,1]);if(2===n.length)return Do(mo(mo(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return Do(mo(mo(mo(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),yo=Ir({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var o=gr(t,"logits","multinomial"),i=o.size,a=o.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+i+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?o.as2D(1,-1):o,u=rn.runKernelFunc(function(t){return t.multinomial(s,r,e,n)},{logits2D:s});return 1===a?u.as1D():u}}),bo=Ir({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=gr(t,"indices","oneHot","int32"),i=o.shape.concat([e]);return o=o.flatten(),rn.runKernelFunc(function(t){return t.oneHot(o,e,n,r)},{$indices:o},function(t){return{$indices:function(){return Ur(o.shape,"float32")}}}).reshape(i)}}),wo=Ir({pad_:function(t,e,n){void 0===n&&(n=0);var r=gr(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:e,constantValue:n};return rn.runKernelFunc(function(t){return t.pad(r,e,n)},{x:r},function(t){var n=e.map(function(t){return t[0]});return{x:function(){return t.slice(n,r.shape)}}},"PadV2",o)}}),xo=Ir({pad1d_:function(t,e,n){return void 0===n&&(n=0),Kt(2===e.length,function(){return"Invalid number of paddings. Must be length of 2."}),wo(t,[e],n)}}),Eo=Ir({pad2d_:function(t,e,n){return void 0===n&&(n=0),Kt(2===e.length&&2===e[0].length&&2===e[1].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),wo(t,e,n)}}),Ao=Ir({pad3d_:function(t,e,n){return void 0===n&&(n=0),Kt(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),wo(t,e,n)}}),Co=Ir({pad4d_:function(t,e,n){return void 0===n&&(n=0),Kt(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,function(){return"Invalid number of paddings. Must be length of 2 each."}),wo(t,e,n)}}),ko=Ir({rand_:function(t,e,n){var r=Yt(t),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var i=0;i<r;i++)o[i]=e();return rn.makeTensor(o,t,n)}}),So=Ir({randomNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new io(e,n,r,!1,o),a=uo(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Io=Ir({randomGamma_:function(t,e,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var i=new ao(e,n,r,o),a=uo(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Ro=Ir({randomUniform_:function(t,e,n,r,o){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var i=uo(t,r),a=new so(e,n,null,o),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),To=Ir({reshape_:function(t,e){var n=gr(t,"x","reshape",null);e=oe(e,n.size),Kt(n.size===Yt(e),function(){return"new shape and old shape must have the same number of elements."});var r={shape:e};return rn.runKernelFunc(function(t){return t.reshape(n,e)},{x:n},function(t){return{x:function(){return t.reshape(n.shape)}}},"Reshape",r)}}),No=Ir({spaceToBatchND_:function(t,e,n){var r=gr(t,"x","spaceToBatchND");return Kt(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),Kt(n.length===e.length,function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length}),Kt(r.shape.reduce(function(t,r,o){return o>0&&o<=e.length?t&&(r+n[o-1][0]+n[o-1][1])%e[o-1]==0:t},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()}),rn.runKernelFunc(function(t){return t.spaceToBatchND(r,e,n)},{$x:r},function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}})}}),_o=Ir({squeeze_:function(t,e){var n=gr(t,"x","squeeze");return To(n,ae(n.shape,e).newShape)}}),Po=Ir({stack_:function(t,e){void 0===e&&(e=0);var n=mr(t,"tensors","stack");if(Kt(n.length>=1,function(){return"Pass at least one tensor to tf.stack"}),1===n.length)return n[0].expandDims(e);var r=n[0].rank,o=n[0].shape,i=n[0].dtype;Kt(e<=r,function(){return"Axis must be <= rank of the tensor"}),n.forEach(function(t){Qt(o,t.shape,"All tensors passed to stack must have matching shapes")}),n.forEach(function(t){Kt(i===t.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=n.map(function(t){return t.expandDims(e)});return Gr(a,e)}}),Do=Ir({tile_:function(t,e){var n=gr(t,"x","tile",null);Kt(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."});var r=[n],o={reps:e};return rn.runKernelFunc(function(t,r){var o=t.tile(n,e);return r([n]),o},{x:n},function(t,n){var r=n[0];return{x:function(){var n=jr(r);if(1===r.rank)for(var o=0;o<e[0];++o)n=n.add(t.slice([o*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(o=0;o<e[0];++o)for(var i=0;i<e[1];++i)n=n.add(t.slice([o*r.shape[0],i*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(var a=0;a<e[2];++a)n=n.add(t.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(o=0;o<e[0];++o)for(i=0;i<e[1];++i)for(a=0;a<e[2];++a)for(var s=0;s<e[3];++s)n=n.add(t.slice([o*r.shape[0],i*r.shape[1],a*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}},"Tile",o,r)}}),Oo=Ir({truncatedNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var i=new io(e,n,r,!0,o),a=uo(t,r),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Fo=Ir({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=gr(t,"x","unstack");Kt(e>=-n.shape.length&&e<n.shape.length,function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"}),e<0&&(e+=n.shape.length);var r={axis:e};return rn.runKernelFunc(function(t){return t.unstack(n,e)},{x:n},function(t){return{x:function(){return Po(t,e)}}},"Unpack",r)}});function Mo(t,e,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var i=e.length,a=0;a<i;++a)o=o.concat([t[a+1]/e[a],e[a]]);o=o.concat(t.slice(i+1))}return o}function Bo(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var o=e+1;o<t;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var i=[],a=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?a.push(o):i.push(o);r.push.apply(r,i),r.push(0),r.push.apply(r,a)}return r}function Lo(t,e,n,r){void 0===r&&(r=!0);var o=[];r?o.push(t[0]/n):o.push(t[0]*n);for(var i=1;i<t.length;++i)i<=e.length?r?o.push(e[i-1]*t[i]):o.push(t[i]/e[i-1]):o.push(t[i]);return o}function Uo(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function Wo(t,e,n){for(var r=t.slice(0,1),o=0;o<n;++o)r.push(t[o+1]-e[o][0]-e[o][1]);return r}function zo(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],o=1,i=0;i<n.length-1;++i)o*=n[i];var a=t.shape,s=n.slice();s.pop();var u=1;for(i=r;i<t.rank;++i)u*=a[i],s.push(a[i]);var c=xe(t.shape).map(function(t){return t/u}).concat([1]).slice(0,r);return[s,o,u,c]}Object.freeze({prepareAndValidate:zo});function Vo(t){return t<=30?t:we(t,Math.floor(Math.sqrt(t)))}function jo(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(i+" update.rank < "+o+". ");if(t.length<r+(n.rank-o))throw new Error(i+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+t.length-r)throw new Error(i+" update.rank != "+(o+t.length-r));for(var a=0;a<o;++a)if(n.shape[a]!==e.shape[a])throw new Error(i+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<n.rank-o;++a)if(n.shape[a+o]!==t[a+r])throw new Error(i+" updates.shape["+(a+o)+"] ("+n.shape[a+o]+") != shape["+(a+o)+"] ("+t[a+o]+")")}function Go(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}jo(n,e,t)}function Ho(t,e,n){for(var r=e.shape.length,o=r>1?e.shape[r-1]:1,i=n.length,a=1,s=o;s<i;++s)a*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:Yt(e.shape)/u,sliceSize:a,strides:xe(n.slice(0,o)).concat([1]),outputSize:Yt(n)}}Object.freeze({validateUpdateShape:jo,validateInput:Go,calculateShapes:Ho});function qo(t,e,n){Kt(t.rank===e.length,function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."}),Kt(t.rank===n.length,function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."});for(var r=function(r){Kt(e[r]+n[r]<=t.shape[r],function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"})},o=0;o<t.rank;++o)r(o)}function Ko(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function Qo(t,e,n){for(var r=[],o=0;o<t.length;o++)r[o]=Math.ceil((e[o]-t[o])/n[o]);return r}function Xo(t,e,n,r,o){var i=e[o],a=n[o]||1;(t&1<<o||null==i)&&(i=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),Gt(0,i,s-1)}function Jo(t,e,n,r,o){var i=e[o],a=n[o]||1;(t&1<<o||null==i)&&(i=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return i<0&&(i+=s),a>0?Gt(0,i,s):Gt(-1,i,s-1)}function Yo(t,e,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function Zo(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}Object.freeze({assertParamsValid:qo,maskToAxes:Ko,computeOutShape:Qo,startForAxis:Xo,stopForAxis:Jo,isSliceContinous:Yo,computeFlatOffset:Zo});function $o(t){return rn.customGrad(t)}var ti=Ir({softmax_:function(t,e){void 0===e&&(e=-1);var n=gr(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return rn.runKernelFunc(function(t,r){var o=t.softmax(n,e);return r([o]),o},{logits:n},function(t,n){var r=n[0],o=t.mul(r);return{logits:function(){return o.sub(o.sum([e],!0).mul(r))}}},"Softmax",{dim:e},[],[!0])}}),ei=Ir({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=gr(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return $o(function(t,n){var r=t.max(e,!0),o=t.sub(r),i=o.toFloat().sub(o.exp().sum(e,!0).log());return n([i]),{value:i,gradFunc:function(t,n){var r=n[0].exp();return t.sub(t.sum(e,!0).mul(r))}}})(n)}}),ni=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),ri=function(){function t(){}return t.prototype.time=function(t){return oi("time")},t.prototype.read=function(t){return oi("read")},t.prototype.readSync=function(t){return oi("readSync")},t.prototype.numDataIds=function(){return oi("numDataIds")},t.prototype.disposeData=function(t){return oi("disposeData")},t.prototype.write=function(t,e,n){return oi("write")},t.prototype.move=function(t,e,n,r){return oi("move")},t.prototype.memory=function(){return oi("memory")},t.prototype.floatPrecision=function(){return oi("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,n,r){return oi("batchMatMul")},t.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,oi("fusedBatchMatMul")},t.prototype.slice=function(t,e,n){return oi("slice")},t.prototype.stridedSlice=function(t,e,n,r){return oi("stridedSlice")},t.prototype.unstack=function(t,e){return oi("unstack")},t.prototype.reverse=function(t,e){return oi("reverse")},t.prototype.concat=function(t,e){return oi("concat")},t.prototype.neg=function(t){return oi("neg")},t.prototype.add=function(t,e){return oi("add")},t.prototype.addN=function(t){return oi("addN")},t.prototype.subtract=function(t,e){return oi("subtract")},t.prototype.multiply=function(t,e){return oi("multiply")},t.prototype.realDivide=function(t,e){return oi("realDivide")},t.prototype.floorDiv=function(t,e){return oi("floorDiv")},t.prototype.sum=function(t,e){return oi("sum")},t.prototype.prod=function(t,e){return oi("prod")},t.prototype.unsortedSegmentSum=function(t,e,n){return oi("unsortedSegmentSum")},t.prototype.argMin=function(t,e){return oi("argMin")},t.prototype.argMax=function(t,e){return oi("argMax")},t.prototype.equal=function(t,e){return oi("equal")},t.prototype.notEqual=function(t,e){return oi("notEqual")},t.prototype.less=function(t,e){return oi("less")},t.prototype.lessEqual=function(t,e){return oi("lessEqual")},t.prototype.greater=function(t,e){return oi("greater")},t.prototype.greaterEqual=function(t,e){return oi("greaterEqual")},t.prototype.logicalNot=function(t){return oi("logicalNot")},t.prototype.logicalAnd=function(t,e){return oi("logicalAnd")},t.prototype.logicalOr=function(t,e){return oi("logicalOr")},t.prototype.where=function(t){return oi("where")},t.prototype.select=function(t,e,n){return oi("select")},t.prototype.topk=function(t,e,n){return oi("topk")},t.prototype.min=function(t,e){return oi("min")},t.prototype.minimum=function(t,e){return oi("minimum")},t.prototype.mod=function(t,e){return oi("mod")},t.prototype.max=function(t,e){return oi("max")},t.prototype.maximum=function(t,e){return oi("maximum")},t.prototype.all=function(t,e){return oi("all")},t.prototype.any=function(t,e){return oi("any")},t.prototype.squaredDifference=function(t,e){return oi("squaredDifference")},t.prototype.ceil=function(t){return oi("ceil")},t.prototype.floor=function(t){return oi("floor")},t.prototype.round=function(t){return oi("round")},t.prototype.sign=function(t){return oi("sign")},t.prototype.isNaN=function(t){return oi("isNaN")},t.prototype.isInf=function(t){return oi("isInf")},t.prototype.isFinite=function(t){return oi("isFinite")},t.prototype.pow=function(t,e){return oi("pow")},t.prototype.exp=function(t){return oi("exp")},t.prototype.expm1=function(t){return oi("expm1")},t.prototype.softmax=function(t,e){return oi("softmax")},t.prototype.log=function(t){return oi("log")},t.prototype.log1p=function(t){return oi("log1p")},t.prototype.sqrt=function(t){return oi("sqrt")},t.prototype.rsqrt=function(t){return oi("rsqrt")},t.prototype.square=function(t){return oi("square")},t.prototype.reciprocal=function(t){return oi("reciprocal")},t.prototype.relu=function(t){return oi("relu")},t.prototype.relu6=function(t){return oi("relu6")},t.prototype.prelu=function(t,e){return oi("prelu")},t.prototype.elu=function(t){return oi("elu")},t.prototype.eluDer=function(t,e){return oi("eluDer")},t.prototype.selu=function(t){return oi("selu")},t.prototype.int=function(t){return oi("int")},t.prototype.clip=function(t,e,n){return oi("clip")},t.prototype.abs=function(t){return oi("abs")},t.prototype.complexAbs=function(t){return oi("complexAbs")},t.prototype.sigmoid=function(t){return oi("sigmoid")},t.prototype.softplus=function(t){return oi("softplus")},t.prototype.sin=function(t){return oi("sin")},t.prototype.cos=function(t){return oi("cos")},t.prototype.tan=function(t){return oi("tan")},t.prototype.asin=function(t){return oi("asin")},t.prototype.acos=function(t){return oi("acos")},t.prototype.atan=function(t){return oi("atan")},t.prototype.atan2=function(t,e){return oi("atan2")},t.prototype.sinh=function(t){return oi("sinh")},t.prototype.cosh=function(t){return oi("cosh")},t.prototype.tanh=function(t){return oi("tanh")},t.prototype.asinh=function(t){return oi("asinh")},t.prototype.acosh=function(t){return oi("acosh")},t.prototype.atanh=function(t){return oi("atanh")},t.prototype.erf=function(t){return oi("erf")},t.prototype.step=function(t,e){return oi("step")},t.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,oi("fusedConv2d")},t.prototype.conv2d=function(t,e,n){return oi("conv2d")},t.prototype.conv2dDerInput=function(t,e,n){return oi("conv2dDerInput")},t.prototype.conv2dDerFilter=function(t,e,n){return oi("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,oi("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(t,e,n){return oi("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){return oi("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){return oi("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(t,e,n){return oi("conv3d")},t.prototype.conv3dDerInput=function(t,e,n){return oi("conv3dDerInput")},t.prototype.conv3dDerFilter=function(t,e,n){return oi("conv3dDerFilter")},t.prototype.maxPool=function(t,e){return oi("maxPool")},t.prototype.maxPoolBackprop=function(t,e,n,r){return oi("maxPoolBackprop")},t.prototype.avgPool=function(t,e){return oi("avgPool")},t.prototype.avgPoolBackprop=function(t,e,n){return oi("avgPoolBackprop")},t.prototype.avgPool3d=function(t,e){return oi("avgPool3d")},t.prototype.avgPool3dBackprop=function(t,e,n){return oi("avgPool3dBackprop")},t.prototype.maxPool3d=function(t,e){return oi("maxPool3d")},t.prototype.maxPool3dBackprop=function(t,e,n,r){return oi("maxPool3dBackprop")},t.prototype.reshape=function(t,e){return oi("reshape")},t.prototype.cast=function(t,e){return oi("cast")},t.prototype.tile=function(t,e){return oi("tile")},t.prototype.pad=function(t,e,n){return oi("pad")},t.prototype.transpose=function(t,e){return oi("transpose")},t.prototype.gather=function(t,e,n){return oi("gather")},t.prototype.gatherND=function(t,e){return oi("gatherND")},t.prototype.scatterND=function(t,e,n){return oi("scatterND")},t.prototype.batchToSpaceND=function(t,e,n){return oi("batchToSpaceND")},t.prototype.spaceToBatchND=function(t,e,n){return oi("spaceToBatchND")},t.prototype.resizeBilinear=function(t,e,n,r){return oi("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(t,e,n){return oi("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){return oi("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){return oi("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(t,e,n,r,o,i){return oi("batchNormalization")},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){return oi("localResponseNormalization4D")},t.prototype.LRNGrad=function(t,e,n,r,o,i,a){return oi("LRNGrad")},t.prototype.multinomial=function(t,e,n,r){return oi("multinomial")},t.prototype.oneHot=function(t,e,n,r){return oi("oneHot")},t.prototype.cumsum=function(t,e,n,r){return oi("cumsum")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return oi("nonMaxSuppression")},t.prototype.fft=function(t){return oi("fft")},t.prototype.ifft=function(t){return oi("ifft")},t.prototype.complex=function(t,e){return oi("complex")},t.prototype.real=function(t){return oi("real")},t.prototype.imag=function(t){return oi("imag")},t.prototype.cropAndResize=function(t,e,n,r,o,i){return oi("cropAndResize")},t.prototype.depthToSpace=function(t,e,n){return oi("depthToSpace")},t.prototype.split=function(t,e,n){return oi("split")},t.prototype.sparseToDense=function(t,e,n,r){return oi("sparseToDense")},t.prototype.diag=function(t){return oi("diag")},t.prototype.fill=function(t,e,n){return oi("fill")},t.prototype.onesLike=function(t){return oi("onesLike")},t.prototype.zerosLike=function(t){return oi("zerosLike")},t.prototype.linspace=function(t,e,n){return oi("linspace")},t.prototype.dispose=function(){return oi("dispose")},t}();function oi(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function ii(t,e){for(var n=t.length,r=[],o=0;o<n;o++){var i=n-1-o,a=t[i]||1;(e[e.length-1-o]||1)>1&&1===a&&r.unshift(i)}return r}function ai(t,e){for(var n=[],r=0;r<e.length;r++){var o=t[t.length-r-1],i=e.length-r-1,a=e[i];(null==o||1===o&&a>1)&&n.unshift(i)}return n}function si(t,e){for(var n=[],r=Math.max(t.length,e.length),o=0;o<r;o++){var i=t[t.length-o-1];null==i&&(i=1);var a=e[e.length-o-1];if(null==a&&(a=1),1===i)n.unshift(a);else if(1===a)n.unshift(i);else{if(i!==a)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(i)}}return n}function ui(t,e,n,r,o,i,a){void 0===a&&(a="channelsLast");var s,u=fi(e),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,t[1],t[1]]}return li(t,s,n,r,o,i,!1,a)}function ci(t,e,n,r,o,i,a){void 0===a&&(a="NDHWC");var s,u,c=pi(e),l=c[0],h=c[1],d=c[2];if("NDHWC"===a)u="channelsLast",s=[l,h,d,t[4],t[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,h,d,t[1],t[1]]}return hi(t,s,n,r,o,!1,u,i)}function li(t,e,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3];if("channelsLast"===s)c=t[0],l=t[1],h=t[2],d=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],d=t[1],l=t[2],h=t[3]}var f,p=e[0],g=e[1],m=e[3],v=fi(n),y=v[0],b=v[1],w=fi(r),x=w[0],E=w[1],A=gi(p,x),C=gi(g,E),k=function(t,e,n,r,o,i,a,s){var u,c,l;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var h=function(t,e,n,r,o){null==r&&(r=di(t,e,n));var i=t[1],a=mi((t[0]-e+2*r)/n+1,o);Kt($t(a),function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"});var s=mi((i-e+2*r)/n+1,o);return Kt($t(s),function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"}),[a,s]}([e,n],i,r,t,s);c=h[0],l=h[1]}else if("same"===t){c=Math.ceil(e/r),l=Math.ceil(n/o);var d=Math.max(0,(c-1)*r+i-e),f=Math.max(0,(l-1)*o+a-n),p=Math.floor(d/2),g=d-p,m=Math.floor(f/2);u={top:p,bottom:g,left:m,right:f-m,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/r),l=Math.ceil((n-a+1)/o)}return{padInfo:u,outHeight:c,outWidth:l}}(o,l,h,y,b,A,C,i),S=k.padInfo,I=k.outHeight,R=k.outWidth,T=a?m*d:m;return"channelsFirst"===s?f=[c,T,I,R]:"channelsLast"===s&&(f=[c,I,R,T]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:d,outHeight:I,outWidth:R,outChannels:T,padInfo:S,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:g,effectiveFilterHeight:A,effectiveFilterWidth:C,dilationHeight:x,dilationWidth:E,inShape:t,outShape:f,filterShape:e}}function hi(t,e,n,r,o,i,a,s){void 0===i&&(i=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3],f=u[4];if("channelsLast"===a)c=t[0],l=t[1],h=t[2],d=t[3],f=t[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=t[0],f=t[1],l=t[2],h=t[3],d=t[4]}var p,g=e[0],m=e[1],v=e[2],y=e[4],b=pi(n),w=b[0],x=b[1],E=b[2],A=pi(r),C=A[0],k=A[1],S=A[2],I=gi(g,C),R=gi(m,k),T=gi(v,S),N=function(t,e,n,r,o,i,a,s,u,c,l){var h,d,f,p;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var g=function(t,e,n,r,o,i){null==o&&(o=di(t,e,r));var a=t[1],s=t[2],u=mi((t[0]-e+2*o)/r+1,i);Kt($t(u),function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"});var c=mi((a-e+2*o)/r+1,i);Kt($t(c),function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"});var l=mi((s-e+2*o)/r+1,i);return Kt($t(l),function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"}),[u,c,l,1]}([e,n,r,1],s,0,o,t,l);d=g[0],f=g[1],p=g[2]}else if("same"===t){var m=((d=Math.ceil(e/o))-1)*o+s-e,v=((f=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/a))-1)*a+c-r,b=Math.floor(m/2),w=m-b,x=Math.floor(v/2),E=v-x,A=Math.floor(y/2);h={top:x,bottom:E,left:A,right:y-A,front:b,back:w,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((e-s+1)/o),f=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/a)}return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}(o,l,h,d,w,x,E,I,R,T,s),_=N.padInfo,P=N.outDepth,D=N.outHeight,O=N.outWidth,F=i?y*f:y;return"channelsFirst"===a?p=[c,F,P,D,O]:"channelsLast"===a&&(p=[c,P,D,O,F]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:h,inWidth:d,inChannels:f,outDepth:P,outHeight:D,outWidth:O,outChannels:F,padInfo:_,strideDepth:w,strideHeight:x,strideWidth:E,filterDepth:g,filterHeight:m,filterWidth:v,effectiveFilterDepth:I,effectiveFilterHeight:R,effectiveFilterWidth:T,dilationDepth:C,dilationHeight:k,dilationWidth:S,inShape:t,outShape:p,filterShape:e}}function di(t,e,n,r){void 0===r&&(r=1);var o=gi(e,r);return Math.floor((t[0]*(n-1)-n+o)/2)}function fi(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function pi(t){return"number"==typeof t?[t,t,t]:t}function gi(t,e){return e<=1?t:t+(t-1)*(e-1)}function mi(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function vi(t){var e=fi(t),n=e[0],r=e[1],o=e[2];return 1===n&&1===r&&1===o}function yi(t,e){return vi(t)||vi(e)}function bi(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function wi(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=Ur(t.shape),o=t.toFloat(),i=n.complex(o,r);return r.dispose(),o.dispose(),i}if(!he(t.dtype,e))return rn.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){var a=n.real(t);return i=a.cast(e),a.dispose(),i}if("int32"===e)return n.int(t);if("bool"===e){var s=Dr(0,t.dtype);return i=n.notEqual(t,s),s.dispose(),i}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function xi(t,e){return rn.makeTensorFromDataId(t.dataId,e,t.dtype)}function Ei(t,e,n){var r=(e-t)/(n-1),o=ke(n,"float32");o[0]=t;for(var i=1;i<o.length;i++)o[i]=o[i-1]+r;return Or(o,"float32")}Object.freeze({castTensor:wi,reshapeTensor:xi,linspaceImpl:Ei,upcastType:Xe,axesAreInnerMostDims:vr,combineLocations:yr,computeOutAndReduceShapes:br,expandShapeToKeepDim:wr,assertAxesAreInnerMostDims:xr,getAxesPermutation:Er,getUndoAxesPermutation:Ar,getInnerMostAxes:Cr,getBroadcastDims:ii,getReductionAxes:ai,assertAndGetBroadcastShape:si,assertParamsConsistent:kr,computeOutShape:Sr,computePool2DInfo:ui,computePool3DInfo:ci,computeConv2DInfo:li,computeConv3DInfo:hi,computeDefaultPad:di,tupleValuesAreOne:vi,eitherStridesOrDilationsAreOne:yi,convertConv2DDataFormat:bi,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:Vo});function Ai(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function Ci(t,e){return{real:t[2*e],imag:t[2*e+1]}}function ki(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function Si(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function Ii(t,e,n){var r=function(t,e,n){return function(t,e,n){for(var r=0,o=t.length,i=0,a=!1;r<o;){var s=n(e,t[i=r+(o-r>>>1)]);s>0?r=i+1:(o=i,a=!s)}return a?r:-r-1}(t,e,n||Ri)}(t,e,n),o=r<0?-(r+1):r;t.splice(o,0,e)}function Ri(t,e){return t>e?1:t<e?-1:0}function Ti(t,e,n,r,o){return _i(t,e,n,r,o,0).selectedIndices}function Ni(t,e,n,r,o,i){var a=_i(t,e,n,r,o,i,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function _i(t,e,n,r,o,i,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);for(var u=Array.from(e).map(function(t,e){return{score:t,boxIndex:e,suppressBeginIndex:0}}).filter(function(t){return t.score>o}).sort(Oi),c=i>0?-.5/i:0,l=[],h=[];l.length<n&&u.length>0;){var d=u.pop(),f=d.score,p=d.boxIndex,g=d.suppressBeginIndex;if(f<o)break;for(var m=!1,v=l.length-1;v>=g;--v){var y=Pi(t,p,l[v]);if(y>=r){m=!0;break}if(d.score=d.score*Di(r,c,y),d.score<=o)break}d.suppressBeginIndex=l.length,m||(d.score===f?(l.push(p),h.push(d.score)):d.score>o&&Ii(u,d,Oi))}var b=l.length;return s&&(l.fill(0,b),h.fill(0,b)),{selectedIndices:Or(l,"int32"),selectedScores:Or(h,"float32"),numValidOutputs:Dr(b,"int32")}}function Pi(t,e,n){var r=t.subarray(4*e,4*e+4),o=t.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),f=(s-i)*(u-a),p=(h-c)*(d-l);if(f<=0||p<=0)return 0;var g=Math.max(i,c),m=Math.max(a,l),v=Math.min(s,h),y=Math.min(u,d),b=Math.max(v-g,0)*Math.max(y-m,0);return b/(f+p-b)}function Di(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function Oi(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function Fi(t,e,n){var r=new Array(t.rank).fill(0),o=t.shape.slice();return e.map(function(e){o[n]=e;var i=t.slice(r,o);return r[n]+=e,i})}function Mi(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var o=uo(n,t.dtype);for(r=0;r<o.values.length;++r){for(var i=o.indexToLoc(r),a=new Array(t.rank),s=0;s<a.length;s++)a[s]=i[s]%t.shape[s];var u=t.locToIndex(a);o.values[r]=t.values[u]}return o.toTensor()}function Bi(t,e,n,r,o){for(var i=e[e.length-1],a=[t.length/i,i],s=a[0],u=a[1],c=se(n,s*r),l=se("int32",s*r),h=0;h<s;h++){for(var d=h*u,f=t.subarray(d,d+u),p=[],g=0;g<f.length;g++)p.push({value:f[g],index:g});p.sort(function(t,e){return e.value-t.value});var m=h*r,v=c.subarray(m,m+r),y=l.subarray(m,m+r);for(g=0;g<r;g++)v[g]=p[g].value,y[g]=p[g].index}var b=e.slice();return b[b.length-1]=r,[_r(c,b,n),_r(l,b,"int32")]}function Li(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var o=uo(t,"int32"),i=uo([n.length,t.length],"int32");for(r=0;r<n.length;r++){var a=o.indexToLoc(n[r]),s=r*t.length;i.values.set(a,s)}return i.toTensor()}var Ui=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("float v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},Wi=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(function(t,e){return"T"+e});var n=[];this.variableNames.forEach(function(t){n.push("vec4 v"+t+" = get"+t+"AtOutCoords();")});var r=this.variableNames.map(function(t){return"v"+t}).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},zi=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,i=t.inSize,a=Math.ceil(i/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,a];var s="max"===e?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function Vi(t,e){return["x","y","z","w","u","v"].slice(0,e).map(function(e){return t+"."+e})}function ji(t,e){return 1===e?[t]:Vi(t,e)}function Gi(){var t,e,n,r,o,i,a,s,u,c;return 2===Ot().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",o="texture",i="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",o="texture2D",i="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:o,output:i,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function Hi(t,e,n){void 0===n&&(n="index");var r=xe(e);return r.map(function(e,o){return"int "+t[o]+" = "+n+" / "+e+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"}).join("")}function qi(t){var e=xe(t).map(function(t){return t.toString()});return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var Ki="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function Qi(t,e,n,r){var o=[];t.forEach(function(t){var e=Yt(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?o.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(o.push("uniform sampler2D "+t.name+";"),o.push("uniform int offset"+t.name+";"))});var i,a,s=o.join("\n"),u=t.map(function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";r+=n?Ji(t):Xi(t);var o=t.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(r+=n?function(t,e){var n,r=t.name,o=r.charAt(0).toUpperCase()+r.slice(1),i="get"+o+"AtOutCoords",a=t.shapeInfo.logicalShape.length,s=e.logicalShape.length,u=ii(t.shapeInfo.logicalShape,e.logicalShape),c=ra(s),l=s-a,h=["x","y","z","w","u","v"];n=0===a?"":s<2&&u.length>=1?"coords = 0;":u.map(function(t){return"coords."+h[t+l]+" = 0;"}).join("\n");var d;d=s<2&&a>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+h[e+l]}).join(", ");var f="return outputValue;",p=1===Yt(t.shapeInfo.logicalShape),g=1===Yt(e.logicalShape);if(1!==a||p||g){if(p&&!g)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=a-2,v=a-1;u.indexOf(m)>-1&&u.indexOf(v)>-1?f="return vec4(outputValue.x);":u.indexOf(m)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(v)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+i+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+f+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",i=e.texShape,a=t.shapeInfo.texShape,s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&s===u&&null==t.shapeInfo.flatOffset&&Zt(a,i))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c,l=ra(u),h=ii(t.shapeInfo.logicalShape,e.logicalShape),d=u-s,f=["x","y","z","w","u","v"];c=0===s?"":u<2&&h.length>=1?"coords = 0;":h.map(function(t){return"coords."+f[t+d]+" = 0;"}).join("\n");var p;return p=u<2&&s>0?"coords":t.shapeInfo.logicalShape.map(function(t,e){return"coords."+f[e+d]}).join(", "),"\n    float "+o+"() {\n      "+l+" coords = getOutputCoords();\n      "+c+"\n      return get"+r+"("+p+");\n    }\n  "}(t,e)),r}(t,e,r)}).join("\n"),c=e.texShape,l=Gi(),h=function(t){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+t.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),d=function(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+Yi+"\n    "+Zi+"\n    "+$i+"\n  "}(l);return e.isPacked?(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Zt(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=t,r=e,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=(i=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+i+");\n      int c = imod(index, "+i+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,a="",s="b, r, c",u=2;u<t.length-1;u++)a="\n      int b"+u+" = index / "+(i*=t[t.length-u-1])+";\n      index -= b"+u+" * "+i+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}var n,r,o,i,a}(e.logicalShape,c),a=function(t){return"\n    void setOutput(vec4 val) {\n      "+t.output+" = val;\n    }\n  "}(l)):(i=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return Zt(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=e,r=Hi(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=Hi(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=Hi(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=Hi(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r}(e.logicalShape,c),a=function(t){return"\n    void setOutput(float val) {\n      "+t.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(d+=ta),[d,h,a,s,i,u,n].join("\n")}function Xi(t){var e=t.shapeInfo.logicalShape;switch(e.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape,o=r[0],i=r[1];if(1===o&&1===i)return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=t.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+a[0]+", "+a[1]+", "+ea(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+na(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,o=r[0],i=r[1];if(1===i&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var a=ea(e);return 1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+i+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+i+", index + "+a+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(t);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape;if(null!=o&&Zt(e,o)){var i=o[0];return"\n    float "+r+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+i+".0);\n      return sampleTexture("+n+", uv);\n    }\n  "}var a=ae(e),s=a.newShape,u=a.keptDims,c=s;if(c.length<e.length)return"\n      "+Xi(oa(t,c))+"\n      float "+r+"(int row, int col) {\n        return "+r+"("+ia(["row","col"],u)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+e[1]+", 1)));\n        "+na(t)+"\n      }\n    ";var l=o[0],h=o[1],d=ea(n);return 1===h?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":1===l?"\n    float "+r+"(int row, int col) {\n      float index = dot(vec3(row, col, "+d+"), vec3("+e[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n  float "+r+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+e[1]+" + col + "+d+";\n    vec2 uv = uvFromFlat("+l+", "+h+", index);\n    return sampleTexture("+n+", uv);\n  }\n"}(t);case 3:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[1]*e[2],i=e[2],a=ae(e),s=a.newShape,u=a.keptDims,c=s;if(c.length<e.length)return"\n        "+Xi(oa(t,c))+"\n        float "+r+"(int row, int col, int depth) {\n          return "+r+"("+ia(["row","col","depth"],u)+");\n        }\n      ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+i+", 1)));\n        "+na(t)+"\n      }\n    ";var l=t.shapeInfo.texShape,h=l[0],d=l[1],f=t.shapeInfo.flatOffset;return d===o&&null==f?"\n        float "+r+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+i+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+h+".0);\n          return sampleTexture("+n+", uv);\n        }\n      ":d===i&&null==f?"\n    float "+r+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+e[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+h+".0);\n      return sampleTexture("+n+", uv);\n    }\n  ":"\n      float "+r+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+i+" + depth + "+ea(n)+";\n        vec2 uv = uvFromFlat("+h+", "+d+", index);\n        return sampleTexture("+n+", uv);\n      }\n  "}(t);case 4:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[3],i=e[2]*o,a=e[1]*i,s=ae(e),u=s.newShape,c=s.keptDims;if(u.length<e.length)return"\n      "+Xi(oa(t,u))+"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        return "+r+"("+ia(["row","col","depth","depth2"],c)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+a+", "+i+", "+o+", 1)));\n        "+na(t)+"\n      }\n    ";var l=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,d=h[0],f=h[1];return f===a&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+i+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+f+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":f===o&&null==l?"\n      float "+r+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+e[1]*e[2]+", "+e[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+f+".0, "+d+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+a+" + col * "+i+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+d+", "+f+", index + "+ea(n)+");\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);case 5:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=e[4],i=e[3]*o,a=e[2]*i,s=e[1]*a,u=ae(e),c=u.newShape,l=u.keptDims;if(c.length<e.length)return"\n      "+Xi(oa(t,c))+"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+r+"("+ia(["row","col","depth","depth2","depth3"],l)+");\n      }\n    ";if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+a+", "+i+", "+o+")) +\n          depth3;\n        "+na(t)+"\n      }\n    ";var h=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,f=d[0],p=d[1];return p===s&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+a+", "+i+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":p===o&&null==h?"\n      float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]+",\n               "+e[2]*e[3]+", "+e[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+f+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" + depth * "+i+" +\n          depth2 * "+o+" + depth3 + "+ea(n)+";\n      vec2 uv = uvFromFlat("+f+", "+p+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);case 6:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=ae(e),i=o.newShape,a=o.keptDims;if(i.length<e.length)return"\n      "+Xi(oa(t,i))+"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+r+"("+ia(["row","col","depth","depth2","depth3","depth4"],a)+");\n      }\n    ";var s=e[5],u=e[4]*s,c=e[3]*u,l=e[2]*c,h=e[1]*l;if(t.shapeInfo.isUniform)return"\n      float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+h+", "+l+", "+c+", "+u+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+s+", 1)));\n        "+na(t)+"\n      }\n    ";var d=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,p=f[0],g=f[1];return g===h&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+l+", "+c+", "+u+", "+s+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":g===s&&null==d?"\n      float "+r+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+e[1]*e[2]*e[3]*e[4]+",\n               "+e[2]*e[3]*e[4]+",\n               "+e[3]*e[4]+",\n               "+e[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+p+".0);\n        return sampleTexture("+n+", uv);\n      }\n    ":"\n    float "+r+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+h+" + col * "+l+" + depth * "+c+" +\n          depth2 * "+u+" + depth3 * "+s+" + depth4 + "+ea(n)+";\n      vec2 uv = uvFromFlat("+p+", "+g+", index);\n      return sampleTexture("+n+", uv);\n    }\n  "}(t);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function Ji(t){var e;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 "+("get"+(e=t.name).charAt(0).toUpperCase()+e.slice(1))+"() {\n      return "+Gi().texture2D+"("+e+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=Gi();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+i.texture2D+"("+e+", uv);\n    }\n  "}(t);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],s=Gi();if(null!=o&&Zt(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+i+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(t);case 3:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===e[0])return"\n        "+Ji(oa(t,e.slice(1)))+"\n        vec4 "+r+"(int b, int row, int col) {\n          return "+r+"("+ia(["b","row","col"],[1,2])+");\n        }\n      ";var a=i[0],s=i[1],u=Math.ceil(e[2]/2);return"\n    vec4 "+r+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+a+", "+s+", "+u*Math.ceil(e[1]/2)+", "+u+", b, row, col);\n      return "+Gi().texture2D+"("+n+", uv);\n    }\n  "}(t);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,a=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=a[0],u=a[1],c=Math.ceil(e[n-1]/2),l=c*Math.ceil(e[n-2]/2),h="int b, int row, int col",d="b * "+l+" + (row / 2) * "+c+" + (col / 2)",f=2;f<n-1;f++)h="int b"+f+", "+h,d="b"+f+" * "+(l*=e[n-f-1])+" + "+d;return"\n    vec4 "+o+"("+h+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+Gi().texture2D+"("+r+", uv);\n    }\n  "}(t)}}var Yi="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Zi="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",$i="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ta="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function ea(t){return"offset"+t}function na(t){var e=t.name,n=Yt(t.shapeInfo.logicalShape);return n<2?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function ra(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function oa(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function ia(t,e){return e.map(function(e){return t[e]}).join(", ")}var aa=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Kt(t.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var o=t[t.length-1],i=Math.ceil(o/e);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,c=u.length,l=ra(c),h=ji("coords",c);if(1===i){var d=ra(s=c+1);a="\n        "+d+" sourceLocR = "+d+"("+h.join()+", 0);\n        ++"+h[c-1]+";\n        "+d+" sourceLocG = "+d+"("+h.join()+", 0);\n        ++"+h[c-2]+";\n        "+d+" sourceLocA = "+d+"("+h.join()+", 0);\n        --"+h[c-1]+";\n        "+d+" sourceLocB = "+d+"("+h.join()+", 0);\n        --"+h[c-2]+";"}else s=c,a="\n        "+l+" sourceLocR = coords;\n        ++"+h[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+h[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+h[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+h[c-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],g=f.map(function(t){return"int "+t}),m=ji("sourceLocR",s-1).concat("inIdx.r"),v=ji("sourceLocG",s-1).concat("inIdx.g"),y=ji("sourceLocB",s-1).concat("inIdx.b"),b=ji("sourceLocA",s-1).concat("inIdx.a"),w="max"===n?"greaterThan":"lessThan",x=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+b.join()+")));",E="vec4(\n            getAChannel("+m.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+b.join()+") : 0.)",A=r?"":"\n      float getBestIndicesAChannel("+g.join()+") {\n        return getChannel(getBestIndicesA("+f.join()+"),\n                                          vec2("+f.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+g.join()+") {\n        return getChannel(getA("+f.join()+"),\n                               vec2("+f.slice(-2).join()+"));\n      }\n      "+A+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+h[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+h[c-2]+" < "+(u[c-2]-1)+";\n        "+a+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+E+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+x+"\n          vec4 candidate = "+E+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+w+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},sa=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=s-1-t.padInfo.top,l=u-1-t.padInfo.left,h=1/(e*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+i+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+a+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ua=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=l-1-t.padInfo.front,p=h-1-t.padInfo.top,g=d-1-t.padInfo.left,m=1/(e*n*r);this.userCode="\n      const ivec3 pads = ivec3("+f+", "+p+", "+g+");\n      const float avgMultiplier = float("+m+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+h+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},ca=function(t,e,n,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],si(t,e),si(t,n);var a="0.0";null!=r&&(si(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=o&&(si(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+i+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},la=function(t,e,n,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],si(t,e),si(t,n);var a="vec4(0.0)";null!=r&&(si(t,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(si(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+i+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},ha=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=si(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},da="return a + b;",fa="return a - b;",pa="return a * b;",ga="return (a < 0.) ? b * a : a;",ma=function(t,e,n){this.variableNames=["A","B"],this.outputShape=si(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},va="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",ya=function(t,e,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=si(e,n);var o=this.outputShape.length,i="";if(r)if(0===o||1===Yt(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          "+ra(o)+" coords = getOutputCoords();\n        ",1===o)i+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=ji("coords",o);i+="\n            bool nextRowOutOfBounds =\n              ("+a[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+a[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+i+"\n\n        setOutput(result);\n      }\n    "},ba=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),wa=function(){function t(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),xa=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Ea=function(t){this.outputShape=[],this.outputShape=Sr(t,1),this.variableNames=t.map(function(t,e){return"T"+e});var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var o=e[n-1];r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var i=e.length,a=e[e.length-1];r.push("else setOutput(getT"+i+"(yR, yC-"+a+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Aa=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Sr(t,e);var n=this.outputShape,r=n.length,o=ra(r),i=ji("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map(function(t,e){return"T"+e});var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var c=a[e],l=a.slice(-2),h=a.join(),d="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var f=s[u-1];d+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+Ca(a,c,f)+"),\n            vec2("+Ca(l,c,f)+"));\n        }"}var p=s.length,g=s[s.length-1];d+="\n        return getChannel(\n          getT"+p+"("+Ca(a,c,g)+"),\n          vec2("+Ca(l,c,g)+"));",this.userCode="\n      float getValue("+a.map(function(t){return"int "+t})+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+i+"), 0., 0., 0.);\n\n        "+i[r-1]+" = "+i[r-1]+" + 1;\n        if ("+i[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+i+");\n        }\n\n        "+i[r-2]+" = "+i[r-2]+" + 1;\n        if ("+i[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+i+");\n        }\n\n        "+i[r-1]+" = "+i[r-1]+" - 1;\n        if ("+i[r-2]+" < "+n[r-2]+" &&\n            "+i[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+i+");\n        }\n        setOutput(result);\n      }\n    "};function Ca(t,e,n){var r=t.indexOf(e);return t.map(function(t,e){return e===r?t+" - "+n:t}).join()}var ka=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,i="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+i+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Sa=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i="channelsLast"===t.dataFormat,a=e-1-t.padInfo.top,s=n-1-t.padInfo.left,u=i?1:2,c=i?2:3,l=i?3:1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+i+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ia=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,o=t.padInfo.front,i=t.padInfo.top,a=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+e+" - "+o+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+i+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+a+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ra=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=e-1-t.padInfo.front,u=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+i+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+a+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ta=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,i=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+i+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Na=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,i=e-1-t.padInfo.top,a=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},_a=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,i=t.padInfo.left,a=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,h=t.filterWidth,d=4*Math.floor(t.inChannels/4),f=t.inChannels%4,p="channelsLast"===t.dataFormat,g=p?1:2,m=p?2:3,v=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+g+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===f)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===f)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===f)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+w+"\n        "+b+"\n        setOutput(result);\n      }\n    "},Pa=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Da=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,p=t.outChannels/t.inChannels,g="",m="";n&&(g=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+g+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+i+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+m+"\n        setOutput(result);\n      }\n    "},Oa=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,i=t.inWidth,a=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,p=f,g="int xR; int xC; int xCOffset;",m=0;m<d;m++)for(var v=0;v<f;v++)g+="\n          vec4 xTexelR"+m+"C"+2*v+" = vec4(0.);\n          vec4 wR"+m+"C"+v+" = vec4(0.);\n          vec4 xR"+m+"C"+v+" = vec4(0.);";for(m=0;m<d;m++)for(var y=0;y<p;y++){if(g+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(v=2*y)*h+";\n        ",1===c){if(v<f&&(g+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    xTexelR"+m+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+i+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+i+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+v+" = vec4(previous.zw, xTexelR"+m+"C"+v+".xy);\n                } else {\n                  xR"+m+"C"+v+" = vec4(0, 0, xTexelR"+m+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = xTexelR"+m+"C"+v+";\n              ",v+1<f)){var b=s%2==0?Ht(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(g+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+i+") {\n                      xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+v+" = vec4(0.);\n                    }\n                  "),g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".xy);\n                "):g+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+i+") {\n                    xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(v+1)+" = xTexelR"+m+"C"+(v+2)+";\n                "}}else v<f&&(g+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(g+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+i+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n              ",v+1<f&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+i+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(v+1)+" = vec4(xTexelR"+m+"C"+(v+2)+".xy, final.xy);\n                ")):(g+="\n                if(xC >= 0 && xC < "+i+") {\n                  xTexelR"+m+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+i+") {\n                  xTexelR"+m+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+v+" = vec4(\n                  xTexelR"+m+"C"+v+".xy, xTexelR"+m+"C"+(v+2)+".xy);\n              ",v+1<f&&(g+="\n                  xR"+m+"C"+(v+1)+" = vec4(\n                    xTexelR"+m+"C"+v+".zw, xTexelR"+m+"C"+(v+2)+".zw);\n                ")),g+="}");v<f&&(g+="\n            vec4 wTexelR"+m+"C"+v+" = getW("+m+", "+v+", d1, q);\n            wR"+m+"C"+v+" = vec4(wTexelR"+m+"C"+v+".xz, wTexelR"+m+"C"+v+".xz);\n          ",v+1<f&&(g+="\n              vec4 wTexelR"+m+"C"+(v+1)+" = getW("+m+", "+(v+1)+", d1, q);\n              wR"+m+"C"+(v+1)+" =\n                vec4(wTexelR"+m+"C"+(v+1)+".xz, wTexelR"+m+"C"+(v+1)+".xz);"))}for(m=0;m<d;m++)for(v=0;v<f;v++)g+="dotProd += xR"+m+"C"+v+" * wR"+m+"C"+v+";";var w="",x="";n&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",x="result = activation(result);");var E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+g+"\n\n        vec4 result = dotProd;\n        "+E+"\n        "+x+"\n        setOutput(result);\n      }\n    "},Fa=function(t,e,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=t[0],a=t[1],s=t[2],u=t[3],c=e[0],l=n[0],h=n[1];this.outputShape=[c,l,h,u];var d="bilinear"===r?1:0,f=[a-1+".0",s-1+".0"],p=f[0],g=f[1],m=l>1?[""+(a-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=m[0],y=m[1],b=m[2],w=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+g+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+g],x=w[0],E=w[1],A=w[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+x+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+i+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+E+";\n\n        float in_y = "+b+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+A+";\n        if( in_x < 0.0 || in_x > "+g+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Ma=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],i=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+ra(r)+" coords = getOutputCoords();\n        int end = "+Ba(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+i+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+Ba(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===t)return""+e;if(2===t)return e+".x, "+e+".y";if(3===t)return e+".x, "+e+".y, "+e+".z";if(4===t)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Ba(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var La=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=sn.DENSE;var e=gn(t),n=Gi();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Hi(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},Ua=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=sn.DENSE;var e=gn(t),n=Gi();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+Hi(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},Wa=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),za=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},Va=function(t){this.variableNames=["A"],this.outTexUsage=un.DOWNLOAD;var e=Gi();this.outputShape=t,this.userCode="\n      "+Ki+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},ja=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=un.DOWNLOAD;var e=Gi();this.outputShape=t,this.userCode="\n      "+Ki+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},Ga=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=Gi(),o=e[0],i=e[1];this.outputShape=t;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+qi(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+i+";\n        int c = imod(flatIndex, "+i+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},Ha=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Gi(),o=e[0],i=e[1];this.outputShape=t;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+i+";\n              c = imod(flatIndex, "+i+");\n              uv = (vec2(c, r) + halfCR) / vec2("+i+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+qi(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},qa=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,i=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+i+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},Ka=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),Qa=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var o=ra(this.rank),i=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],i=0;i<t.length;i++)i===e?o.push("int(getIndices("+r[i]+"))"):o.push(""+r[i]);return o.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Xa=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=ra(e.length),o=ra(n.length),i=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+i+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function Ja(t,e){var n=Gi();return En(t,e,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function Ya(t,e){return Nn(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function Za(t,e){return _n(t,e,new Uint16Array([0,1,2,2,1,3]))}function $a(t,e,n,r,o,i,a){Dn(n,r);var s=Pn(t,e),u=t.TEXTURE_2D;return yn(t,e,function(){return t.bindTexture(u,s)}),yn(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)}),yn(t,e,function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}),yn(t,e,function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)}),yn(t,e,function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)}),yn(t,e,function(){return t.texImage2D(u,0,o,n,r,0,i,a,null)}),yn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)}),s}function ts(t,e,n,r,o){var i=pn(n,r);return $a(t,e,i[0],i[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function es(t,e,n,r,o){var i=pn(n,r);return $a(t,e,i[0],i[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function ns(t,e,n,r,o){var i=pn(n,r);return $a(t,e,i[0],i[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function rs(t,e,n,r,o){var i=mn(n,r);return $a(t,e,i[0],i[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function os(t,e,n,r,o){var i=mn(n,r);return $a(t,e,i[0],i[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function is(t,e,n,r){return yn(t,e,function(){return t.bindBuffer(t.ARRAY_BUFFER,r)}),Fn(t,e,n,"clipSpacePos",r,3,20,0)&&Fn(t,e,n,"uv",r,2,20,12)}function as(t,e,n,r,o,i,a){var s,u,c;yn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),i instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,c=a.internalFormatPackedFloat),s.set(i),yn(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,o,0,t.RGBA,u,s)}),yn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function ss(t,e,n,r){yn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,n)}),r.data instanceof Uint8Array?yn(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)}):yn(t,e,function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}),yn(t,e,function(){return t.bindTexture(t.TEXTURE_2D,null)})}function us(t,e,n,r,o){var i=t.createBuffer();yn(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,i)});var a=16*n*r;return yn(t,e,function(){return t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)}),yn(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)}),yn(t,e,function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}),i}function cs(t,e,n){var r=t,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function ls(t,e,n,r,o){var i=pn(n,r),a=i[0],s=i[1],u=new Uint8Array(n*r*4);return yn(t,e,function(){return t.readPixels(0,0,a,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function hs(t,e,n,r,o,i,a,s){var u=t,c=new Float32Array(function(t,e){var n=mn(t,e);return n[0]*n[1]*4}(i,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function ds(t,e,n,r){var o=new Float32Array(n*r*4);return yn(t,e,function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,o)}),o}var fs=Object.freeze({createVertexShader:Ja,createVertexBuffer:Ya,createIndexBuffer:Za,createFloat32MatrixTexture:ts,createFloat16MatrixTexture:es,createUnsignedBytesMatrixTexture:ns,createPackedMatrixTexture:rs,createFloat16PackedMatrixTexture:os,bindVertexProgramAttributeStreams:is,uploadDenseMatrixToTexture:as,uploadPixelDataToTexture:ss,createBufferFromOutputTexture:us,downloadFloat32MatrixFromBuffer:cs,downloadByteEncodedFloatMatrixFromOutputTexture:ls,downloadPackedMatrixFromBuffer:hs,downloadMatrixFromPackedOutputTexture:ds}),ps=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=Ot().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,dn(e,t)):this.gl=fn(e);var n="WEBGL_color_buffer_float";if(1===Ot().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=xn(this.gl,this.debug,"OES_texture_float"),er(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=xn(this.gl,this.debug,"OES_texture_half_float");else if(Ot().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),er(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=xn(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Ot().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",er(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!er(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=Ya(this.gl,this.debug),this.indexBuffer=Za(this.gl,this.debug),this.framebuffer=On(this.gl,this.debug),this.textureConfig=vn(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return Ot().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;yn(e,this.debug,function(){return e.finish()}),yn(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),yn(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),yn(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),yn(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),yn(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),ts(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),es(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),ns(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),ss(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,n,r){this.throwIfDisposed(),as(this.gl,this.debug,t,e,n,r,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),os(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),rs(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(zn(this.gl,this.debug,this.framebuffer),this.outputTexture=null),yn(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return ls(r.gl,r.debug,e,n,r.textureConfig)})},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,o,i){return hs(this.gl,t,0,0,0,o,i,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return cs(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=us(this.gl,this.debug,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(Ot().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=o.clientWaitSync(i,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=i}else Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,function(){return ds(r.gl,r.debug,e,n)})},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=An(e,this.debug,t),r=Ja(e,this.debug),o=In(e,this.debug);return yn(e,this.debug,function(){return e.attachShader(o,r)}),yn(e,this.debug,function(){return e.attachShader(o,n)}),Rn(e,this.debug,o),this.debug&&Tn(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=is(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&yn(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&Tn(this.gl,this.debug,this.program),yn(this.gl,this.debug,function(){return e.gl.useProgram(t)})},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?Bn(this.gl,this.debug,t,e):Ln(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),yn(this.gl,this.debug,function(){return n.gl.getAttribLocation(t,e)})},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),Un(this.gl,this.debug,this.program,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=mn(e,n),o=r[0],i=r[1];this.setOutputMatrixTextureDriver(t,o,i)},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&Tn(this.gl,this.debug,this.program),Vn(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),yn(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),yn(this.gl,this.debug,function(){return t.gl.finish()})},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=xn(this.gl,this.debug,2===Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return _t(this,void 0,void 0,function(){var e=this;return Pt(this,function(n){switch(n.label){case 0:return[4,re(function(){return e.disposed||e.isQueryAvailable(t,Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(t,Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise(function(n){e.addItemToPoll(function(){return t.isFencePassed()},function(){return n()})})},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map(function(t){return t.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||re(function(){return n.pollItems(),0===n.itemsToPoll.length})},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Wn(this.gl,this.debug,t,this.framebuffer),this.debug&&Vn(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(Wn(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Vn(this.gl)):zn(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;Wn(r,this.debug,t,this.framebuffer),this.debug&&Vn(r),this.outputTexture=t,yn(r,this.debug,function(){return r.viewport(0,0,e,n)}),yn(r,this.debug,function(){return r.scissor(0,0,e,n)})},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var o=this;this.throwIfDisposed(),yn(this.gl,this.debug,function(){return o.gl.scissor(t,e,n,r)})},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function gs(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach(function(t,n){var r=t.logicalShape,o=e[n],i=o.shape;if(!Zt(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+i+" must match");if(!t.isUniform||!o.isUniform){var a=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!Zt(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}})}var ms=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.filterWidth,o=n.inChannels,i=n.strideWidth,a=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,h=n.dataFormat,d=s.left,f=s.top,p=o*r,g=Gi(),m="channelsLast"===h,v=m?0:1,y=m?1:2,b="",w=0;w<=1;w++)for(var x=0;x<=1;x++)b+="\n          blockIndex = rc.y + "+x+";\n          pos = rc.x + "+w+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+a+" - "+f+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+e[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+i+". - "+d+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+e[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+m+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*w+x)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+b+"\n\n        "+g.output+" = result;\n      }\n    "},vs=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[];var i,a=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";i=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+a+"; j <= "+a+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+i+";\n        setOutput(val);\n      }\n    "},ys=function(t,e,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},bs=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,a=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";i=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+a+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+a+"; j <= "+a+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+i+";\n        setOutput(result);\n      }\n    "},ws=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,o=t.effectiveFilterHeight,i=t.effectiveFilterWidth,a=o-1-t.padInfo.top,s=i-1-t.padInfo.left,u=o*i-1;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+i+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+i+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},xs=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,o=t.dilationDepth,i=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=s-1-t.padInfo.front,h=u-1-t.padInfo.top,d=c-1-t.padInfo.left,f=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+h+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+e+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+i+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+a+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+f+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Es=function(t,e,n,r,o,i,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===i&&(i=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=n?t[1]:t[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";i&&(f=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+i+"\n        }":"vec4 activation(vec4 x) {\n          "+i+"\n        }",p="result = activation(result);");var g=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+f+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+h[0]+" * "+d[0]+");\n          result += ("+h[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+g+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},As=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),Cs=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},ks=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=ji("rc",e),r=ra(e),o=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",o=t-2;o<t;o++)r+=n[o]+" >= "+e[o],o<t-1&&(r+="||");return r}(e,t,n),i=function(t,e,n,r){if(1===t)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),a=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var i=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),a=2;a<t;a++)i=e[e.length-1-a]+","+i;n.push(i)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+i+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},Ss=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});var r=t.length,o=ra(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+i+");\n      "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+i+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Is=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(function(e,n){return e[0]+t[n]+e[1]});for(var r=t.length,o=ra(r),i=e.map(function(t){return t[0]}).join(","),a=e.map(function(e,n){return e[0]+t[n]}).join(","),s=ji("rc",r),u=ji("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",h=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,g=1===r?2:4;p<g;p++)f+="\n        "+h[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";f+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+i+");\n      const "+o+" end = "+o+"("+a+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+f+"\n        setOutput(result);\n      }\n    "},Rs=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideHeight,i=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=t.padInfo.top,h=t.padInfo.left;this.outputShape=t.outShape;var d="avg"===e,f="0.0";if(d||(f="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+o+", "+i+");\n        const ivec2 pads = ivec2("+l+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(p="avgValue / count");var g=4*Math.floor(r/4),m=r%4,v="\n      if ("+d+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+o+", "+i+");\n      const ivec2 pads = ivec2("+l+", "+h+");\n      const float initializationValue = "+f+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+f+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+g+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+v+"\n          }\n\n          int xC = xCCorner + "+g+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+v+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+v+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},Ts=function(t,e,n){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var r=t.filterWidth,o=t.strideDepth,i=t.strideHeight,a=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.front,p=t.padInfo.top,g=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===e,v="0.0";if(m||(v="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+o+", "+i+", "+a+");\n        const ivec3 pads = ivec3("+f+", "+p+", "+g+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+d+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+d+" +\n                      wR * "+d+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var b=4*Math.floor(r/4),w=r%4,x="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+o+", "+i+", "+a+");\n      const ivec3 pads = ivec3("+f+", "+p+", "+g+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+x+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(2===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+x+"\n            } else if ("+(3===w)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+x+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},Ns=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=Math.ceil(o/n);this.outputShape=[r,i];var a="0.0",s="";"prod"===e?a="1.0":"min"===e?(a="1.0 / 1e-20",s="min"):"max"===e&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,h="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===e?(a="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(a="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},_s=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+Hi(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+qi(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Ps=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[n&&s>1?o-1:o,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,g=2*Math.ceil(f)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(i-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Ds=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[0],i=t[1],a=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?i-1:i,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},Os=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=t[0],i=t[1],a=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?i-1:i,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+a+".0,\n                                     "+a+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},Fs=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],i=r[2],a=t.shape,s=a[1],u=a[2],c=[n&&s>1?o-1:o,n&&u>1?i-1:i],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,g=2*Math.ceil(f)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+g+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Ms=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[0],i=t[1],a=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?i-1:i,r&&n>1?a-1:a],c=[r&&e>1?e-1:e,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+a+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Bs=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map(function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)}).join(","),o=ra(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},Ls=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=ji("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],i=r[n-2]+" + 1 < "+this.outputShape[n-2],a=ra(n);function s(n){var r=t.map(function(r,o){return function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)});return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(t){return s(t)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",s(t)}(r.slice())+";\n          }\n          if("+i+") {\n            result.b = "+function(t){return t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Us=function(t,e,n,r,o,i,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=ra(o.length),u=ra(i.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",h="";1===r?h="i":2===r&&(h="i, coords[1]");var d="getUpdates("+h+")",f=e>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+f+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},Ws=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,o=t.inSize,i=t.numSegments,a=i*Math.ceil(o/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+i+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+i+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},zs=function(t,e,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+i[u]),u<t&&a.push(""+i[u]);r=a.join(),o=s.join()}var c=ra(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},Vs=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=ra(this.rank),r="uniform int start["+this.rank+"];",o=function(t){if(1===t)return"sourceLoc";if(t<=6)return js.slice(0,t).map(function(t){return"sourceLoc."+t}).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map(function(t,e){return"sourceLoc."+js[e]+" = start["+e+"] + coords."+js[e]+";"}).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),js=["x","y","z","w","u","v"],Gs=function(){function t(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=ra(this.rank),n=ji("coords",this.rank),r=ji("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",i="getChannel(getSource("+r.join()+"), "+o+")",a="\n      result.x = "+i+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+i+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+i+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+i+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map(function(t,e){return"start["+e+"]"}).join()+");":t.map(function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"}).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),Hs=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=ra(n.length),i=ra(n.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=n.map(function(t,e){return s++,1===n.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(s-1)+"] * strides["+e+"] + begin["+e+"]"}).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+t+");\n      "+o+" strides = "+o+"("+e+");\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},qs=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,o=Ks(e,n),i=Qs(t,o,n);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[i].shift();return this.usedTextures[i].push(a),a}return this.numUsedTextures++,this.log(),o===cn.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===cn.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===cn.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===cn.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===cn.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var o=Qs(e,Ks(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],a=i.indexOf(t);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(a,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(e){t.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function Ks(t,e){if(t===un.UPLOAD)return cn.PACKED_2X2_FLOAT32;if(t===un.RENDER||null==t)return function(t){return Ot().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?cn.PACKED_2X2_FLOAT32:cn.UNPACKED_FLOAT32:t?cn.PACKED_2X2_FLOAT16:cn.UNPACKED_FLOAT16}(e);if(t===un.DOWNLOAD||t===un.PIXELS)return cn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function Qs(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var Xs=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var o=ra(this.rank),i=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<t.length;o++)r.push("imod("+n[o]+", "+t[o]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+i+"));\n      }\n    "},Js=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var o=ra(this.rank),i=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<t.length;o++)r[t[o]]=n[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+i+"));\n    }\n    "},Ys=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=ra(this.rank),i=Vi("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=i[r];var s="vec2("+a.slice(-2).join()+")",u="++"+i[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+i[this.rank-1]+";\n      if(++"+i[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Zs=1.7580993408473768,$s=1.0507009873554805,tu=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},eu="if (isnan(x)) return x;",nu="return abs(x);",ru=eu+"\n  return (x < 0.0) ? 0.0 : x;\n",ou=eu+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",iu="return (x >= 0.0) ? x : (exp(x) - 1.0);",au="\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = "+Zs+";\n  float scale = "+$s+";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n",su="return -x;",uu="return ceil(x);",cu="return floor(x);",lu="return exp(x);",hu="return exp(x) - 1.0;",du=eu+"\n  return sin(x);\n",fu=eu+"\n  return cos(x);\n",pu=eu+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",gu=eu+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",mu=eu+"\n  return atan(x);\n",vu=eu+"return log(x + sqrt(x * x + 1.0));",yu=eu+"\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));",bu=eu+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;",wu="return x;",xu="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Eu="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Au="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Cu=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},ku=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=ji("rc",e),r=ra(e),o=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),i=n.slice(-2),a=e<=1?"rc":"vec2("+i.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},Su={};function Iu(t,e){if(void 0===e&&(e=!1),"linear"===t)return"return x;";if("relu"===t)return e?xu:ru;if("elu"===t)return e?Au:iu;if("relu6"===t)return e?Eu:ou;if("prelu"===t)return e?va:ga;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var Ru=function(t){function e(e){var n,r=t.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Ot().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var o=fn(Ot().getNumber("WEBGL_VERSION"));r.binaryCache=((n=Ot().getNumber("WEBGL_VERSION"))in Su||(Su[n]={}),Su[n]),r.gpgpu=new ps(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new qs(r.gpgpu),r.numMBBeforeWarning=null==Ot().global.screen?1024:Ot().global.screen.height*Ot().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new ni(r,rn),r}return Nt(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,e,n){if(Ot().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:un.UPLOAD}),r},e.prototype.move=function(t,e,n,r){if(Ot().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:un.UPLOAD})},e.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,o=e.complexTensors,i=e.slice,a=e.shape,s=e.isPacked;if(null!=i){var u;u=s?new Cu(a,wu):new tu(a,wu);var c=this.runWebGLProgram(u,[{dataId:t,shape:a,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var h,d,f=null!=this.activeTimers;return f&&(h=Se()),d="complex64"===r?Ai(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),f&&(this.downloadWaitMs+=Se()-h),this.convertAndCacheOnCPU(t,d)},e.prototype.read=function(t){return _t(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,c,l,h,d,f,p,g,m,v,y,b,w,x,E;return Pt(this,function(A){switch(A.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise(function(t){return e.push(t)})];if(n=this.texData.get(t),r=n.values,o=n.shape,i=n.slice,a=n.dtype,s=n.complexTensors,u=n.isPacked,null!=i)return void 0,c=u?new Cu(o,wu):new tu(o,wu),l=this.runWebGLProgram(c,[{dataId:t,shape:o,dtype:a}],a),h=this.read(l.dataId),this.disposeData(l.dataId),[2,h];if(null!=r)return[2,this.convertAndCacheOnCPU(t)];if(!Ot().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===Ot().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,"complex64"!==a&&Ot().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(t),p=this.texData.get(f.dataId),d=(E=this.gpgpu).createBufferFromTexture.apply(E,[p.texture].concat(gn(o)))),this.pendingRead.set(t,[]),"complex64"===a?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:A.sent(),A.label=2;case 2:return"complex64"!==a?[3,4]:[4,Promise.all([s.real.data(),s.imag.data()])];case 3:return m=A.sent(),v=m[0],y=m[1],g=Ai(v,y),[3,5];case 4:null==d?g=this.getValuesFromTexture(t):(b=Yt(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,b)),A.label=5;case 5:return null!=f&&this.disposeData(f.dataId),w=this.convertAndCacheOnCPU(t,g),x=this.pendingRead.get(t),this.pendingRead.delete(t),x.forEach(function(t){return t(w)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,w]}})})},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var e=0;e<t.length;e++){var n=t[e];if(!bn(n)){if(Ot().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},e.prototype.getValuesFromTexture=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,i=n.isPacked,a=Yt(r);if(Ot().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(t),u=this.texData.get(s.dataId),c=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[u.texture].concat(gn(r))).subarray(0,a);return this.disposeData(s.dataId),c}var l=Ot().getBool("WEBGL_PACK")&&!0===i,h=l?Qn(r):r,d=l?new ja(h):new Va(h),f=this.runWebGLProgram(d,[{shape:h,dtype:o,dataId:t}],"float32"),p=this.texData.get(f.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,a);return this.disposeData(f.dataId),g},e.prototype.time=function(t){return _t(this,void 0,void 0,function(){var e,n,r,o,i,a,s;return Pt(this,function(u){switch(u.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),o=Jt(this.activeTimers.map(function(t){return t.query})).filter(function(t){return null!=t}),i=Jt(this.activeTimers.map(function(t){return t.name})).filter(function(t){return null!=t}),this.activeTimers=e,r&&(this.programTimersStack=null),a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(o)]:[3,2];case 1:return s=u.sent(),a.kernelMs=qt(s),a.getExtraProfileInfo=function(){return s.map(function(t,e){return{name:i[e],ms:t}}).map(function(t){return t.name+": "+t.ms}).join(", ")},[3,3];case 2:a.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,a]}})})},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Se(),endMs:null}},e.prototype.endTimer=function(t){return Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Se(),t)},e.prototype.getQueryTime=function(t){return _t(this,void 0,void 0,function(){var e;return Pt(this,function(n){return Ot().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]})})},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var e=this.texData.get(t),n=e.texture,r=e.dtype,o=e.texShape,i=e.usage,a=e.isPacked,s=e.slice,u=s&&s.origDataId||t,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,i,a)));var l=this.texData.get(t);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return Ot().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=rn.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every(function(t){return null==n.texData.get(t.dataId).texture&&t.size<e})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,e){var n=this.makeOutput(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:rn.keep(t.clone()),imag:rn.keep(e.clone())},n},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===Yt(n))return _r([],n,t.dtype);var r=this.texData.get(t.dataId).isPacked,o=Yo(t.shape,e,n);if(r||!o){var i=Ot().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Gs(n):new Vs(n),a=i.getCustomSetupFunc(e);return this.compileAndRun(i,[t],null,a)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},e.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),o=this.makeOutput(n,t.dtype),i=this.texData.get(o.dataId);Object.assign(i,r),i.shape=n,i.dtype=t.dtype;var a=Zo(e,t.strides);r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};var s=this.dataRefCount.get(i.slice.origDataId)||1;return this.dataRefCount.set(i.slice.origDataId,s+1),o},e.prototype.stridedSlice=function(t,e,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r);var o=Qo(e,n,r);if(o.some(function(t){return 0===t}))return _r([],o);var i=new Hs(e,r,o);return this.compileAndRun(i,[t])},e.prototype.reverse=function(t,e){var n=Ot().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ls(t.shape,e):new Bs(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.concat=function(t,e){if("complex64"===t[0].dtype){var n=t.map(function(t){return Tr(t)}),r=t.map(function(t){return Nr(t)});return Rr(this.concat(n,e),this.concat(r,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>Ot().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),i=this.concat(t.slice(0,o),e),a=this.concat(t.slice(o),e);return this.concat([i,a],e)}if(Ot().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var s=new Aa(t.map(function(t){return t.shape}),e);return this.compileAndRun(s,t)}var u=Sr(t.map(function(t){return t.shape}),e),c=t.map(function(t){return t.as2D(-1,Yt(t.shape.slice(e)))}),l=new Ea(c.map(function(t){return t.shape}));return this.compileAndRun(l,c).reshape(u)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Ot().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,su,t.dtype);var e=new tu(t.shape,su);return this.compileAndRun(e,[t])},e.prototype.batchMatMul=function(t,e,n,r){var o=n?t.shape[2]:t.shape[1],i=r?e.shape[1]:e.shape[2],a=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===i)&&a>1e3){n&&(t=t.transpose([0,2,1])),r&&(e=e.transpose([0,2,1]));var u=1===i?t:t.as3D(s,a,1),c=1===i?2:1,l=1===i?e.as3D(s,1,a):e;return this.multiply(u,l).sum(c,!0)}var h=Xe(t.dtype,e.dtype),d=new Es(t.shape,[s,o,i],n,r);return this.compileAndRun(d,[t,e],h)},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,o=t.transposeB,i=t.bias,a=t.activation,s=t.preluActivationWeights,u=r?e.shape[2]:e.shape[1],c=o?n.shape[1]:n.shape[2],l=e.shape[0],h=Xe(e.dtype,n.dtype),d=null!=i,f=null!=s,p=a?Iu(a,!0):null,g=new Es(e.shape,[l,u,c],r,o,d,p,f),m=[e,n];return i&&m.push(i),s&&m.push(s),this.compileAndRun(g,m,h)},e.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),o=new ha("return areal * breal - aimag * bimag;",t.shape,e.shape),i=new ha("return areal * bimag + aimag * breal;",t.shape,e.shape),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag),this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)],s=this.compileAndRun(o,a),u=this.compileAndRun(i,a),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,pa,t.dtype);var l=new ma(pa,t.shape,e.shape);return this.compileAndRun(l,[t,e],t.dtype)},e.prototype.batchNormalization=function(t,e,n,r,o,i){var a=[t,e,n],s=null;null!=i&&(s=i.shape,a.push(i));var u=null;if(null!=o&&(u=o.shape,a.push(o)),Ot().getBool("WEBGL_PACK_NORMALIZATION")){var c=new la(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(c,a)}var l=new ca(t.shape,e.shape,n.shape,s,u,r);return this.compileAndRun(l,a)},e.prototype.localResponseNormalization4D=function(t,e,n,r,o){var i=Ot().getBool("WEBGL_PACK_NORMALIZATION")?new bs(t.shape,e,n,r,o):new vs(t.shape,e,n,r,o);return this.compileAndRun(i,[t])},e.prototype.LRNGrad=function(t,e,n,r,o,i,a){var s=new ys(e.shape,r,o,i,a);return this.compileAndRun(s,[e,n,t])},e.prototype.tile=function(t,e){if("string"===t.dtype){var n=this.readSync(t.dataId).map(function(t){return Te(t)});return Mi(uo(t.shape,t.dtype,n),e)}var r=new Xs(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.pad=function(t,e,n){var r=Ot().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Is(t.shape,e,n):new Ss(t.shape,e,n);return this.compileAndRun(r,[t])},e.prototype.transpose=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.transpose(t,e);var n=Ot().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ys(t.shape,e):new Js(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new Qa(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},e.prototype.batchToSpaceND=function(t,e,n){Kt(t.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),o=Mo(t.shape,e,r),i=Bo(o.length,e.length),a=Lo(t.shape,e,r),s=Uo(n,e.length),u=Wo(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){Kt(t.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=Mo(a.shape,e,r,!1),u=Bo(s.length,e.length,!1),c=Lo(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(c)},e.prototype.reduce=function(t,e,n){var r=t.shape[0],o=t.shape[1],i=Vo(o),a=new Ns({windowSize:i,inSize:o,batchSize:r},e),s=this.compileAndRun(a,[t],n);return 1===s.shape[1]?s:this.reduce(s,e,n)},e.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],o=t.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var i=Vo(o),a=new zi({windowSize:i,inSize:o,batchSize:r},e,null==n),s=[t];null!=n&&s.push(n);var u=this.compileAndRun(a,s,"int32");return 1===u.shape[1]?u:this.argReduce(t,e,u)},e.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,o=Vo(r[r.length-1]),i=new aa(r,o,e,null==n),a=null==n?[t]:[t,n],s=this.compileAndRun(i,a,"int32");return s.rank===t.rank?this.argReducePacked(t,e,s):s},e.prototype.sum=function(t,e){xr("sum",e,t.rank);var n=br(t.shape,e),r=n[0],o=Yt(n[1]),i=t.as2D(-1,o),a=Je(t.dtype);return this.reduce(i,"sum",a).reshape(r)},e.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=br(t.shape,e),r=n[0],o=Yt(n[1]),i=t.as2D(-1,o),a=Je(t.dtype);return this.reduce(i,"prod",a).reshape(r)},e.prototype.unsortedSegmentSum=function(t,e,n){var r=0,o=Er([r],t.rank),i=t;null!=o&&(i=t.transpose(o),r=Cr(1,t.rank)[0]);var a=function(t,e,n){for(var r=[],o=t.length,i=0;i<o;i++)i!==e?r.push(t[i]):r.push(n);return r}(i.shape,r,n),s=Yt([i.shape[r]]),u=i.as2D(-1,s),c=Je(t.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",e,c,n).reshape(a);return null!=o&&(l=l.transpose(Ar(o))),l},e.prototype.segOpCompute=function(t,e,n,r,o){var i=t.shape[0],a=t.shape[1],s=function(t,e){var n,r=!1;for(t<=30?(n=t,r=!0):n=we(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=we(t,n+1);return n}(a,o),u=new Ws({windowSize:s,inSize:a,batchSize:i,numSegments:o},e),c=this.compileAndRun(u,[t,n],r);return c.shape[1]===o?c:(n=zr(0,o).tile([a/s]),this.segOpCompute(c,e,n,r,o))},e.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if(xr("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!Ot().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=br(t.shape,r),i=o[0],a=Yt(o[1]),s=t.as2D(-1,a);return this.argReduce(s,n).reshape(i)}return this.argReducePacked(t,n)},e.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},e.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},e.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new Ma(t.shape,n,r);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,e){if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new ma("return float(a == b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.notEqual=function(t,e){if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new ma("return float(a != b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new ma("return float(a < b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.lessEqual=function(t,e){if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new ma("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new ma("return float(a > b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greaterEqual=function(t,e){if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new ma("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalNot=function(t){var e=new tu(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},e.prototype.logicalAnd=function(t,e){if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new ma("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalOr=function(t,e){if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new ma("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.select=function(t,e,n){var r=new zs(t.rank,e.shape,e.rank);return this.compileAndRun(r,[t,e,n],Xe(e.dtype,n.dtype))},e.prototype.where=function(t){dr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return Li(t.shape,e)},e.prototype.topk=function(t,e,n){return Bi(t.dataSync(),t.shape,t.dtype,e)},e.prototype.min=function(t,e){xr("min",e,t.rank);var n=br(t.shape,e),r=n[0],o=Yt(n[1]),i=t.as2D(-1,o);return this.reduce(i,"min",i.dtype).reshape(r)},e.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ya("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new ma("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.mod=function(t,e){var n=Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ya("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new ma("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);xr("max",e,t.rank);var n=br(t.shape,e),r=n[0],o=Yt(n[1]),i=t.as2D(-1,o);return this.reduce(i,"max",i.dtype).reshape(r)},e.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ya("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new ma("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.all=function(t,e){xr("all",e,t.rank);var n=br(t.shape,e),r=n[0],o=Yt(n[1]),i=t.as2D(-1,o);return this.reduce(i,"all",i.dtype).reshape(r)},e.prototype.any=function(t,e){xr("any",e,t.rank);var n=br(t.shape,e),r=n[0],o=Yt(n[1]),i=t.as2D(-1,o);return this.reduce(i,"any",i.dtype).reshape(r)},e.prototype.realDivide=function(t,e){if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new ma("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape);return this.compileAndRun(n,[t,e],"float32")},e.prototype.floorDiv=function(t,e){if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new ma("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape);return this.compileAndRun(n,[t,e],"int32")},e.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,da);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=Xe(t.dtype,e.dtype);if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,da,n);var r=new ma(da,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.packedUnaryOp=function(t,e,n){var r=new Cu(t.shape,e);return this.compileAndRun(r,[t],n)},e.prototype.packedBinaryOp=function(t,e,n,r,o){void 0===o&&(o=!1);var i=new ya(n,t.shape,e.shape,o);return this.compileAndRun(i,[t,e],r)},e.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,o=this.texData.get(t.dataId),i=this.texData.get(e.dataId),a=[[o.complexTensors.real,i.complexTensors.real],[o.complexTensors.imag,i.complexTensors.imag]].map(function(o){var i=o[0],a=o[1],s=r.makeComplexComponentTensorInfo(t,i),u=r.makeComplexComponentTensorInfo(e,a),c=new ma(n,t.shape,e.shape);return r.compileAndRun(c,[s,u],Xe(i.dtype,a.dtype))}),s=a[0],u=a[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},e.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>Ot().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}var o=t.map(function(t){return t.dtype}).reduce(function(t,e){return Xe(t,e)}),i=t.map(function(t){return t.shape}),a=Ot().getBool("WEBGL_PACK")?new Wi(t[0].shape,i):new Ui(t[0].shape,i);return this.compileAndRun(a,t,o)},e.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,fa);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=Xe(t.dtype,e.dtype);if(Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,fa,t.dtype);var r=new ma(fa,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.pow=function(t,e){var n=Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ya("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new ma("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=Xe(t.dtype,e.dtype);return this.compileAndRun(n,[t,e],r)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Ot().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,uu,t.dtype);var e=new tu(t.shape,uu);return this.compileAndRun(e,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Ot().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,cu,t.dtype);var e=new tu(t.shape,cu);return this.compileAndRun(e,[t])},e.prototype.sign=function(t){var e=new tu(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},e.prototype.isNaN=function(t){var e=new tu(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isInf=function(t){var e=new tu(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isFinite=function(t){var e=new tu(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.round=function(t){var e=new tu(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Ot().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,lu,t.dtype);var e=new tu(t.shape,lu);return this.compileAndRun(e,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Ot().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,hu,t.dtype);var e=new tu(t.shape,hu);return this.compileAndRun(e,[t])},e.prototype.softmax=function(t,e){var n=ie([e],t.shape),r=this.max(t,n),o=wr(r.shape,n),i=this.subtract(t,r.reshape(o)),a=this.exp(i),s=this.sum(a,n).reshape(o);return this.realDivide(a,s)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Ot().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var e=new tu(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(e,[t])},e.prototype.log1p=function(t){var e=new tu(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},e.prototype.sqrt=function(t){var e=new tu(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new tu(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},e.prototype.reciprocal=function(t){var e=new tu(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},e.prototype.relu=function(t){var e;return e=Ot().getBool("WEBGL_PACK")?new Cu(t.shape,xu):new tu(t.shape,ru),this.compileAndRun(e,[t])},e.prototype.relu6=function(t){var e;return e=Ot().getBool("WEBGL_PACK")?new Cu(t.shape,Eu):new tu(t.shape,ou),this.compileAndRun(e,[t])},e.prototype.prelu=function(t,e){var n=Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ya(va,t.shape,e.shape):new ma(ga,t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.elu=function(t){if(Ot().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Au,t.dtype);var e=new tu(t.shape,iu);return this.compileAndRun(e,[t])},e.prototype.eluDer=function(t,e){var n=Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ya("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new ma("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.selu=function(t){var e=new tu(t.shape,au);return this.compileAndRun(e,[t])},e.prototype.int=function(t){var e=new tu(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},e.prototype.clip=function(t,e,n){var r,o=(r=Ot().getBool("WEBGL_PACK_CLIP")?new wa(t.shape):new ba(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Ot().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,nu,t.dtype);var e=new tu(t.shape,nu);return this.compileAndRun(e,[t])},e.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new xa(t.shape),r=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(t){var e=new tu(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},e.prototype.softplus=function(t){var e=new tu(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},e.prototype.sin=function(t){var e=new tu(t.shape,du);return this.compileAndRun(e,[t])},e.prototype.cos=function(t){var e=new tu(t.shape,fu);return this.compileAndRun(e,[t])},e.prototype.tan=function(t){var e=new tu(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},e.prototype.asin=function(t){var e=new tu(t.shape,pu);return this.compileAndRun(e,[t])},e.prototype.acos=function(t){var e=new tu(t.shape,gu);return this.compileAndRun(e,[t])},e.prototype.atan=function(t){var e=new tu(t.shape,mu);return this.compileAndRun(e,[t])},e.prototype.atan2=function(t,e){var n=Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ya("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new ma("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.sinh=function(t){var e=new tu(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.cosh=function(t){var e=new tu(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.tanh=function(t){var e=new tu(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},e.prototype.asinh=function(t){var e=new tu(t.shape,vu);return this.compileAndRun(e,[t])},e.prototype.acosh=function(t){var e=new tu(t.shape,yu);return this.compileAndRun(e,[t])},e.prototype.atanh=function(t){var e=new tu(t.shape,bu);return this.compileAndRun(e,[t])},e.prototype.erf=function(t){var e=new tu(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(e,[t])},e.prototype.step=function(t,e){var n=new tu(t.shape,function(t){return void 0===t&&(t=0),eu+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},e.prototype.conv2dByMatMul=function(t,e,n,r,o,i){var a=t.shape,s=this.texData.get(t.dataId),u=n.inChannels,c=a[0]*a[1]*a[2],l=n.outChannels,h="channelsLast"===n.dataFormat,d=(1===c||1===l)&&u>1e3,f=a[2]%2!=0&&!!s.isPacked;if(d||!Ot().getBool("WEBGL_LAZILY_UNPACK")||!Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!f){var p=h?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],g=this.reshape(t,[1,p,n.inChannels]),m=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:m,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:i}),n.outShape)}var v=h?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),y={dataId:t.dataId,shape:[1,v,n.inChannels],dtype:t.dtype},b=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,Kt(Yn(s.shape,y.shape),function(){return"packed reshape "+s.shape+" to "+y.shape+" isn't free"});var w=this.reshape(e,[1,n.inChannels,n.outChannels]),x=this.fusedBatchMatMul({a:y,b:w,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:i}),E=this.texData.get(x.dataId);return Kt(E.isPacked,function(){return"batchMatMul result is expected to be packed"}),s.shape=b,E.shape=n.outShape,rn.makeTensorFromDataId(x.dataId,n.outShape,x.dtype)},e.prototype.conv2dWithIm2Row=function(t,e,n,r,o,i){var a=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,h="channelsLast"===n.dataFormat,d=a*s*u,f=l*c,p=[d,f],g=t.squeeze([0]),m=e.reshape([1,d,-1]),v=new ms(p,g.shape,n),y=this.compileAndRun(v,[g]).reshape([1,p[0],p[1]]),b=null!=r,w=null!=i,x=o?Iu(o,!0):null,E=new Es(y.shape,[1,f,n.outChannels],!0,!1,b,x,w),A=[y,m];r&&A.push(r),w&&A.push(i);var C=this.compileAndRun(E,A);return h?C.reshape([1,l,c,n.outChannels]):C.reshape([1,n.outChannels,l,c])},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,i=t.activation,a=t.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(e,n,r,o,i,a);if(Ot().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,n,r,o,i,a);var s=null!=o,u=null!=a,c=i?Iu(i,!1):null,l=new _a(r,s,c,u),h=[e,n];return o&&h.push(o),a&&h.push(a),this.compileAndRun(l,h)},e.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(Ot().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new _a(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerInput=function(t,e,n){var r=new Sa(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerFilter=function(t,e,n){var r=new ka(n);return this.compileAndRun(r,[t,e])},e.prototype.fusedDepthwiseConv2D=function(t){var e,n=t.input,r=t.filter,o=t.convInfo,i=t.bias,a=t.activation,s=t.preluActivationWeights,u=Ot().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,c=a?Iu(a,u):null,l=[n,r],h=null!=i,d=null!=s;return h&&l.push(i),d&&l.push(s),u?(e=new Oa(o,h,c,d),this.compileAndRun(e,l)):(e=new Da(o,h,c,d),this.compileAndRun(e,l))},e.prototype.depthwiseConv2D=function(t,e,n){var r;return Ot().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Oa(n),this.compileAndRun(r,[t,e])):(r=new Da(n),this.compileAndRun(r,[t,e]))},e.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new Na(n);return this.compileAndRun(r,[t,e])},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new Ta(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3d=function(t,e,n){var r=new Pa(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerInput=function(t,e,n){var r=new Ra(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerFilter=function(t,e,n){var r=new Ia(n);return this.compileAndRun(r,[t,e])},e.prototype.maxPool=function(t,e){var n=new Rs(e,"max",!1);return this.compileAndRun(n,[t])},e.prototype.avgPool=function(t,e){var n=new Rs(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPoolBackprop=function(t,e,n,r){var o=new Rs(r,"max",!0),i=this.compileAndRun(o,[e]),a=new ws(r),s=this.compileAndRun(a,[t,i],e.dtype);return i.dispose(),s},e.prototype.avgPoolBackprop=function(t,e,n){var r=new sa(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.cast=function(t,e){return wi(t,e,this)},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},e.prototype.avgPool3d=function(t,e){var n=new Ts(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,e,n){var r=new ua(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.maxPool3d=function(t,e){var n=new Ts(e,"max",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,e,n,r){var o=new Ts(r,"max",!0),i=this.compileAndRun(o,[e]),a=new xs(r),s=this.compileAndRun(a,[t,i],e.dtype);return i.dispose(),s},e.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);if(n.isPacked&&!Yn(t.shape,e)&&(null===n.texture||!Yn(n.shape,e))){var r=this.packedReshape(t,e);return rn.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return xi(t,e)},e.prototype.resizeBilinear=function(t,e,n,r){var o=Ot().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Os(t.shape,e,n,r):new Ds(t.shape,e,n,r);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,e,n){var r=new Ps(t,e,n);return this.compileAndRun(r,[t])},e.prototype.resizeNearestNeighbor=function(t,e,n,r){var o=new Ms(t.shape,e,n,r);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new Fs(t,e,n);return this.compileAndRun(r,[t])},e.prototype.multinomial=function(t,e,n,r){var o=e?t:ti(t),i=o.shape[0],a=o.shape[1],s=new As(i,a,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},e.prototype.oneHot=function(t,e,n,r){var o=new Cs(t.size,e,n,r);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var e=new za(t.size);return this.compileAndRun(e,[t])},e.prototype.nonMaxSuppression=function(t,e,n,r,o){return dr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ti(t.dataSync(),e.dataSync(),n,r,o)},e.prototype.cropAndResize=function(t,e,n,r,o,i){var a=new Fa(t.shape,e.shape,r,o,i);return this.compileAndRun(a,[t,e,n],"float32")},e.prototype.depthToSpace=function(t,e,n){Kt(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});var r=t.shape[0],o="NHWC"===n?t.shape[1]:t.shape[2],i="NHWC"===n?t.shape[2]:t.shape[3],a="NHWC"===n?t.shape[3]:t.shape[1],s=o*e,u=i*e,c=a/(e*e),l=new Wa("NHWC"===n?[r,s,u,c]:[r,c,s,u],e,n);return this.compileAndRun(l,[t])},e.prototype.split=function(t,e,n){return Fi(t,e,n)},e.prototype.scatterND=function(t,e,n){var r=Ho(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/a,a],l=t.reshape([i,o]),h=e.reshape([i,a]);if(0===u)return xi(_r([]),n);var d=Dr(0),f=new Us(i,o,l.rank,h.rank,s,c);return this.compileAndRun(f,[h,l,d]).reshape(n)},e.prototype.sparseToDense=function(t,e,n,r){var o=Ho(0,t,n),i=o.sliceRank,a=o.numUpdates,s=o.strides,u=o.outputSize,c=new Us(a,i,t.rank,e.rank,s,[u,1],!1);return this.compileAndRun(c,[e,t,r]).reshape(n)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new qa("return real * expR - imag * expI;",t.shape,e),o=new qa("return real * expI + imag * expR;",t.shape,e),i=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)],a=this.compileAndRun(r,i),s=this.compileAndRun(o,i),u=this.complex(a,s).as2D(t.shape[0],t.shape[1]);return a.dispose(),s.dispose(),u},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=zo(t,e),i=o[0],a=o[1],s=o[2],u=o[3],c=e.reshape([a,r]),l=t.reshape([t.size/s,s]),h=new Xa(r,u,[a,s]);return this.compileAndRun(h,[l,c]).reshape(i)},e.prototype.fill=function(t,e,n){if("string"===(n=n||ye(e))){var r=ue(n,Yt(t));return r.fill(e),rn.makeTensor(r,t,n,this)}var o=new Ka(t,e),i=o.getCustomSetupFunc(e);return this.compileAndRun(o,[],n,i)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,e,n){return Ei(t,e,n)},e.prototype.makeTensorInfo=function(t,e){var n=this.write(null,t,e);return this.texData.get(n).usage=null,{dataId:n,shape:t,dtype:e}},e.prototype.makeOutput=function(t,e){var n=this.makeTensorInfo(t,e).dataId;return rn.makeTensorFromDataId(n,t,e,this)},e.prototype.unpackTensor=function(t){var e=new ku(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},e.prototype.packTensor=function(t){var e=new ks(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,e){var n=[qn(t.shape)].concat(Kn(t.shape)),r={dtype:t.dtype,shape:n,dataId:t.dataId},o=[qn(e)].concat(Kn(e)),i=new _s(o,n),a=this.runWebGLProgram(i,[r],t.dtype,null,!0);return{dataId:a.dataId,shape:e,dtype:a.dtype}},e.prototype.decode=function(t){var e,n=this.texData.get(t),r=n.isPacked,o=n.shape,i=n.dtype,a=Qn(o);return e=r?new Ua(a):new La(a),{dtype:i,shape:o,dataId:this.runWebGLProgram(e,[{shape:a,dtype:i,dataId:t}],i,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,e,n,r,o){var i=this;void 0===o&&(o=!1);var a=this.makeTensorInfo(t.outputShape,n),s=this.texData.get(a.dataId);if(t.packedOutput&&(s.isPacked=!0),t.outPackingScheme===sn.DENSE){var u=gn(t.outputShape);s.texShape=u.map(function(t){return 2*t})}if(null!=t.outTexUsage&&(s.usage=t.outTexUsage),0===Yt(a.shape))return s.values=se(a.dtype,0),a;var c=[],l=e.map(function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=i.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&Yt(e.shape)<=Ot().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.packedInputs)e=n.isPacked?i.unpackTensor(e):i.packTensor(e),c.push(e),n=i.texData.get(e.dataId);else if(n.isPacked&&!Yn(n.shape,e.shape)){var r=e,o=e.shape;e.shape=n.shape,e=i.packedReshape(e,o),c.push(e),n=i.texData.get(e.dataId),r.shape=o}return i.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}});this.uploadToGPU(a.dataId);var h,d={shape:a.shape,texData:s,isUniform:!1},f=function(t,e,n){var r="";e.concat(n).forEach(function(t){var e=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0,n=t.isUniform?"uniform":t.texData.texShape;r+=t.shape+"_"+n+"_"+e});var o=t.userCode;return t.constructor.name+"_"+r+"_"+o}(t,l,d),p=this.getAndSaveBinary(f,function(){return function(t,e,n,r){var o=e.userCode,i=n.map(function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}}),a=i.map(function(t){return t.shapeInfo}),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Qi(i,s,o,e.packedInputs),c=t.createProgram(u),l=null,h=t.getUniformLocation(c,"NAN",!1);1===Ot().getNumber("WEBGL_VERSION")&&(l=t.getUniformLocation(c,"INFINITY",!1));for(var d={},f=0;f<e.variableNames.length;f++){var p=e.variableNames[f];d[p]=t.getUniformLocation(c,p,!1),d["offset"+p]=t.getUniformLocation(c,"offset"+p,!1)}return{program:e,source:u,webGLProgram:c,uniformLocations:d,inShapeInfos:a,outShapeInfo:s,infLoc:l,nanLoc:h}}(i.gpgpu,t,l,d)}),g=null!=this.activeTimers;if(g&&(h=this.startTimer()),function(t,e,n,r,o){gs(e.inShapeInfos,n),gs([e.outShapeInfo],[r]);var i=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,a[0],a[1]):t.setOutputMatrixTexture(i,a[0],a[1]),t.setProgram(e.webGLProgram),1===Ot().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(function(n,r){var o=e.program.variableNames[r],i=e.uniformLocations[o],a=e.uniformLocations["offset"+o];if(null!=i)if(n.isUniform)if(Yt(n.shape)<2)t.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),t.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=a&&t.gl.uniform1i(a,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,i,r)}),null!=o&&o(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,p,l,d,r),c.forEach(function(t){return i.disposeData(t.dataId)}),g&&(h=this.endTimer(h),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(h)})),!Ot().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===o){var m=this.unpackTensor(a);return this.disposeData(a.dataId),m}return a},e.prototype.compileAndRun=function(t,e,n,r,o){void 0===o&&(o=!1),n=n||e[0].dtype;var i=this.runWebGLProgram(t,e,n,r,o);return rn.makeTensorFromDataId(i.dataId,i.shape,i.dtype)},e.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(Ot().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(e){t.gpgpu.deleteProgram(t.binaryCache[e].webGLProgram),delete t.binaryCache[e]}),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=lr(function(){if(!Ot().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=Ot().getBool("DEBUG");Ot().set("DEBUG",!1);var n=t.abs(Dr(1e-8)).dataSync()[0];if(Ot().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,i=n.values,a=n.texture,s=n.usage,u=n.isPacked;if(null==a){var c,l=null!=this.activeTimers;l&&(c=Se());var h=n.texShape;if(null==h&&(h=Xn(r,u),n.texShape=h),null!=i){var d=Qn(r),f=void 0,p=h[1],g=h[0],m=i instanceof Uint8Array;u?(p=(e=mn(h[0],h[1]))[0],g=e[1],f=new Ha(d,[g,p],m)):f=new Ga(d,[g,p],m);var v=this.makeTensorInfo([g,p],o);this.texData.get(v.dataId).usage=m?un.PIXELS:un.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),p,g,i);var y=this.runWebGLProgram(f,[v],o,null,!0),b=this.texData.get(y.dataId);n.texture=b.texture,n.texShape=b.texShape,n.isPacked=b.isPacked,n.usage=b.usage,this.disposeData(v.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=Se()-c)}else{var w=this.acquireTexture(h,s,o,u);n.texture=w}}},e.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.dtype;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values},e.prototype.acquireTexture=function(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,r)},e.prototype.computeBytes=function(t,e){return t[0]*t[1]*fe(e)},e}(ri);on()&&rn.registerBackend("webgl",function(){return new Ru},2);var Tu=Ir({square_:function(t){var e=gr(t,"x","square"),n=[e];return rn.runKernelFunc(function(t,n){return n([e]),t.square(e)},{x:e},null,"Square",{},n,[])}}),Nu="SquaredDifference",_u=Ir({squaredDifference_:function(t,e){var n,r=gr(t,"a","squaredDifference"),o=gr(e,"b","squaredDifference");n=Ye(r,o),r=n[0],o=n[1],si(r.shape,o.shape);var i={a:r,b:o},a=[r,o];return rn.runKernelFunc(function(t,e){var n=t.squaredDifference(r,o);return e([r,o]),n},i,function(t,e){var n=e[0],r=e[1],o=Dr(2);return{a:function(){return t.mul(n.sub(r).mul(o))},b:function(){return t.mul(r.sub(n).mul(o))}}},Nu,{},a,[])}}),Pu=Ir({abs_:function(t){var e=gr(t,"x","abs");return"complex64"===e.dtype?rn.runKernelFunc(function(t){return t.complexAbs(e)},{$x:e}):rn.runKernelFunc(function(t,n){var r=t.abs(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().step(-1))}}},"Abs")}}),Du=Ir({acos_:function(t){var e=gr(t,"x","acos");return rn.runKernelFunc(function(t,n){var r=t.acos(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(Dr(1).sub(n.toFloat().square()).sqrt()).neg()}}})}}),Ou=Ir({acosh_:function(t){var e=gr(t,"x","acosh");return rn.runKernelFunc(function(t,n){var r=t.acosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(n.toFloat().square().sub(1).sqrt())}}})}}),Fu=Ir({asin_:function(t){var e=gr(t,"x","asin");return rn.runKernelFunc(function(t,n){var r=t.asin(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(Dr(1).sub(n.toFloat().square()).sqrt())}}})}}),Mu=Ir({asinh_:function(t){var e=gr(t,"x","asinh");return rn.runKernelFunc(function(t,n){var r=t.asinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.divStrict(Dr(1).add(n.toFloat().square()).sqrt())}}})}}),Bu=Ir({atan_:function(t){var e=gr(t,"x","atan");return rn.runKernelFunc(function(t,n){var r=t.atan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().square().add(1))}}})}}),Lu=Ir({atanh_:function(t){var e=gr(t,"x","atanh");return rn.runKernelFunc(function(t,n){var r=t.atanh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(Dr(1).sub(n.toFloat().square()))}}})}}),Uu=Ir({ceil_:function(t){var e=gr(t,"x","ceil");return rn.runKernelFunc(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return jr(t)}}})}}),Wu=Ir({clipByValue_:function(t,e,n){var r=gr(t,"x","clipByValue");Kt(e<=n,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."});var o=[r],i={min:e,max:n};return rn.runKernelFunc(function(t,o){var i=t.clip(r,e,n);return o([r]),i},{x:r},function(t,r){var o=r[0];return{x:function(){return t.where(o.greaterEqual(e).logicalAnd(o.lessEqual(n)),jr(t))}}},"ClipByValue",i,o)}}),zu=Ir({cos_:function(t){var e=gr(t,"x","cos"),n=[e];return rn.runKernelFunc(function(t,n){var r=t.cos(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return n.toFloat().sin().neg().mul(t)}}},"Cos",{},n)}}),Vu=Ir({cosh_:function(t){var e=gr(t,"x","cosh");return rn.runKernelFunc(function(t,n){var r=t.cosh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sinh().mulStrict(t)}}})}}),ju=Ir({erf_:function(t){var e=gr(t,"x","erf");return Kt("int32"===e.dtype||"float32"===e.dtype,function(){return"Input dtype must be `int32` or `float32`."}),"int32"===e.dtype&&(e=e.toFloat()),rn.runKernelFunc(function(t,n){var r=t.erf(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Gu=Ir({exp_:function(t){var e=gr(t,"x","exp");return rn.runKernelFunc(function(t,n){var r=t.exp(e);return n([r]),r},{x:e},function(t,e){return{x:function(){return t.mulStrict(e[0])}}},"Exp",{},[],[!0])}}),Hu=Ir({expm1_:function(t){var e=gr(t,"x","expm1");return rn.runKernelFunc(function(t,n){var r=t.expm1(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.exp())}}})}}),qu=Ir({floor_:function(t){var e=gr(t,"x","floor");return rn.runKernelFunc(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return jr(t)}}})}}),Ku=Ir({log_:function(t){var e=gr(t,"x","log"),n=[e];return rn.runKernelFunc(function(t,n){var r=t.log(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.div(n.toFloat())}}},"Log",{},n)}}),Qu=Ir({log1p_:function(t){var e=gr(t,"x","log1p");return rn.runKernelFunc(function(t,n){var r=t.log1p(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.add(1))}}})}}),Xu=Ir({logSigmoid_:function(t){var e=gr(t,"x","logSigmoid");return rn.runKernelFunc(function(t,n){var r=t.softplus(e.neg()).neg();return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.neg().sigmoid())}}})}}),Ju=Ir({neg_:function(t){var e=gr(t,"x","neg"),n=[e];return rn.runKernelFunc(function(t){return t.neg(e)},{x:e},function(t){return{x:function(){return t.neg()}}},"Neg",{},n)}}),Yu=Ir({reciprocal_:function(t){var e=gr(t,"x","reciprocal");return rn.runKernelFunc(function(t,n){var r=t.reciprocal(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.square().neg())}}})}}),Zu=Ir({round_:function(t){var e=gr(t,"x","round");return rn.runKernelFunc(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return jr(t)}}})}}),$u=Ir({rsqrt_:function(t){var e=gr(t,"x","rsqrt"),n=[e];return rn.runKernelFunc(function(t,n){var r=t.rsqrt(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.div(n.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},n)}}),tc=Ir({sigmoid_:function(t){var e=gr(t,"x","sigmoid");return rn.runKernelFunc(function(t,n){var r=t.sigmoid(e);return n([r]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mul(n.mul(Dr(1).sub(n)))}}},"Sigmoid")}}),ec=Ir({sign_:function(t){var e=gr(t,"x","sign");return rn.runKernelFunc(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return jr(t)}}})}}),nc=Ir({isNaN_:function(t){var e=gr(t,"x","isNaN");return rn.runKernelFunc(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return jr(t)}}})}}),rc=Ir({isInf_:function(t){var e=gr(t,"x","isInf");return rn.runKernelFunc(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return jr(t)}}})}}),oc=Ir({isFinite_:function(t){var e=gr(t,"x","isFinite");return rn.runKernelFunc(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return jr(t)}}})}}),ic=Ir({sin_:function(t){var e=gr(t,"x","sin"),n=[e];return rn.runKernelFunc(function(t,n){var r=t.sin(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return n.toFloat().cos().mul(t)}}},"Sin",{},n)}}),ac=Ir({sinh_:function(t){var e=gr(t,"x","sinh");return rn.runKernelFunc(function(t,n){var r=t.sinh(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cosh().mulStrict(t)}}})}}),sc=Ir({softplus_:function(t){var e=gr(t,"x","softplus");return rn.runKernelFunc(function(t,n){var r=t.softplus(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.mul(n.sigmoid())}}})}}),uc=Ir({sqrt_:function(t){var e=gr(t,"x","sqrt");return rn.runKernelFunc(function(t,n){var r=t.sqrt(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().sqrt().mul(2))}}})}}),cc=Ir({step_:function(t,e){void 0===e&&(e=0);var n=gr(t,"x","step");return rn.runKernelFunc(function(t){return t.step(n,e)},{$x:n},function(t){return{$x:function(){return jr(t)}}})}}),lc=Ir({tan_:function(t){var e=gr(t,"x","tan");return rn.runKernelFunc(function(t,n){var r=t.tan(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return t.div(n.cos().square())}}})}}),hc=Ir({tanh_:function(t){var e=gr(t,"x","tanh");return rn.runKernelFunc(function(t,n){var r=t.tanh(e);return n([r]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return Dr(1).sub(n.square()).mulStrict(t)}}},"Tanh",{},null,[!0])}});function dc(t,e,n,r,o,i){var a,s,u=gr(t,"x","batchNorm"),c=gr(e,"mean","batchNorm"),l=gr(n,"variance","batchNorm");return null!=o&&(a=gr(o,"scale","batchNorm")),null!=r&&(s=gr(r,"offset","batchNorm")),Kt(2===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Kt(2===c.rank||1===c.rank,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."}),Kt(2===l.rank||1===l.rank,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."}),null!=a&&Kt(2===a.rank||1===a.rank,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),null!=s&&Kt(2===s.rank||1===s.rank,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),gc(u,c,l,s,a,i)}function fc(t,e,n,r,o,i){var a,s,u=gr(t,"x","batchNorm"),c=gr(e,"mean","batchNorm"),l=gr(n,"variance","batchNorm");return null!=o&&(a=gr(o,"scale","batchNorm")),null!=r&&(s=gr(r,"offset","batchNorm")),Kt(3===u.rank,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),Kt(3===c.rank||1===c.rank,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."}),Kt(3===l.rank||1===l.rank,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."}),null!=a&&Kt(3===a.rank||1===a.rank,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),null!=s&&Kt(3===s.rank||1===s.rank,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),gc(u,c,l,s,a,i)}function pc(t,e,n,r,o,i){var a,s,u=gr(t,"x","batchNorm"),c=gr(e,"mean","batchNorm"),l=gr(n,"variance","batchNorm");return null!=o&&(a=gr(o,"scale","batchNorm")),null!=r&&(s=gr(r,"offset","batchNorm")),Kt(4===u.rank,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),Kt(4===c.rank||1===c.rank,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."}),Kt(4===l.rank||1===l.rank,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."}),null!=a&&Kt(4===a.rank||1===a.rank,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),null!=s&&Kt(4===s.rank||1===s.rank,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),gc(u,c,l,s,a,i)}function gc(t,e,n,r,o,i){null==i&&(i=.001);var a,s,u,c=gr(t,"x","batchNorm"),l=gr(e,"mean","batchNorm"),h=gr(n,"variance","batchNorm");null!=o&&(a=gr(o,"scale","batchNorm")),null!=r&&(s=gr(r,"offset","batchNorm")),Kt(l.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),Kt(null==s||l.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),Kt(null==a||l.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c;var d=[c,l,h,a];return rn.runKernelFunc(function(t,e){var n=t.batchNormalization(u,mc(l),mc(h),i,mc(a),mc(s));return e([c,l,h,a]),n},{x:c,mean:l,variance:h,scale:a,offset:s},function(t,e){var n=e,r=n[0],o=n[1],a=n[2],s=n[3],c=null==s?Dr(1):s,l=ai(o.shape,u.shape),h=[];if(1===o.rank){for(var d=0;d<u.shape.length-1;++d)h.push(u.shape[d]);h.push(1)}var f=r.sub(o),p=t.mul(c),g=$u(a.add(Dr(i))),m=g.mul(g).mul(g).mul(Dr(-.5));return{x:function(){return 1===o.rank?t.mul(Do(g.as4D(1,1,1,o.shape[0]),h)).mul(c).reshape(r.shape):t.mul(g).mul(c).reshape(r.shape)},mean:function(){var t=g.mul(Dr(-1)).mul(p);return 1===o.rank&&(t=t.sum(l)),t.reshape(o.shape)},variance:function(){var t=m.mul(f).mul(p);return 1===o.rank&&(t=t.sum(l)),t.reshape(o.shape)},scale:function(){var e=f.mul(g),n=t.mul(e);return 1===o.rank&&(n=n.sum(l)),n.reshape(o.shape)},offset:function(){var e=t;return 1===o.rank&&(e=e.sum(l)),e.reshape(o.shape)}}},"BatchNormalization",{varianceEpsilon:i},d).reshape(c.shape)}function mc(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function vc(){cr("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var yc=Ir({batchNormalization2d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),vc(),dc(t,e,n,i,o,r)}}),bc=Ir({batchNormalization3d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),vc(),fc(t,e,n,i,o,r)}}),wc=Ir({batchNormalization4d_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),vc(),pc(t,e,n,i,o,r)}}),xc=Ir({batchNormalization_:function(t,e,n,r,o,i){return void 0===r&&(r=.001),vc(),gc(t,e,n,i,o,r)}}),Ec=Ir({batchNorm_:gc}),Ac=Ir({batchNorm2d_:dc}),Cc=Ir({batchNorm3d_:fc}),kc=Ir({batchNorm4d_:pc}),Sc=Ir({logicalAnd_:function(t,e){var n=gr(t,"a","logicalAnd","bool"),r=gr(e,"b","logicalAnd","bool");return si(n.shape,r.shape),rn.runKernelFunc(function(t){return t.logicalAnd(n,r)},{a:n,b:r},null,"LogicalAnd")}}),Ic=Ir({logicalNot_:function(t){var e=gr(t,"x","logicalNot","bool");return rn.runKernelFunc(function(t){return t.logicalNot(e)},{$x:e})}}),Rc=Ir({logicalOr_:function(t,e){var n=gr(t,"a","logicalOr","bool"),r=gr(e,"b","logicalOr","bool");return si(n.shape,r.shape),rn.runKernelFunc(function(t){return t.logicalOr(n,r)},{$a:n,$b:r})}}),Tc=Ir({logicalXor_:function(t,e){var n=gr(t,"a","logicalXor","bool"),r=gr(e,"b","logicalXor","bool");return si(n.shape,r.shape),Rc(t,e).logicalAnd(Sc(t,e).logicalNot())}}),Nc=Ir({where_:function(t,e,n){var r=gr(e,"a","where"),o=gr(n,"b","where"),i=gr(t,"condition","where","bool");return Qt(r.shape,o.shape,"Error in where: "),1===i.rank?Kt(i.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Qt(i.shape,o.shape,"Error in where: "),rn.runKernelFunc(function(t,e){var n=t.select(i,r,o);return e([i]),n},{$condition:i,$a:r,$b:o},function(t,e){var n=e[0];return{$condition:function(){return jr(n).toFloat()},$a:function(){return t.mul(n.cast(t.dtype))},$b:function(){return t.mul(n.logicalNot().cast(t.dtype))}}})}}),_c=function(t){return _t(this,void 0,void 0,function(){var e,n,r;return Pt(this,function(o){switch(o.label){case 0:return[4,(e=gr(t,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=Li(e.shape,n),t!==e&&e.dispose(),[2,r]}})})},Pc=Ir({add_:function(t,e){var n,r=gr(t,"a","add"),o=gr(e,"b","add");n=Ye(r,o),r=n[0],o=n[1];var i=si(r.shape,o.shape);return rn.runKernelFunc(function(t){return t.add(r,o)},{a:r,b:o},function(t){return{a:function(){var e=t,n=ai(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=ai(o.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(o.shape)}}},"Add")}}),Dc=Ir({addN_:function(t){Kt(Array.isArray(t),function(){return"The argument passed to tf.addN() must be a list of tensors"}),Kt(t.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length});var e=t.map(function(t,e){return gr(t,"tensors"+e,"addN")}),n=e[0];e.forEach(function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(t){if(!Zt(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return rn.runKernelFunc(function(t){return t.addN(e)},r,function(t){var n={};return e.forEach(function(e,r){n[r]=function(){return t.clone()}}),n},"AddN")}}),Oc=Ir({addStrict_:function(t,e){var n=gr(t,"a","addStrict"),r=gr(e,"b","addStrict");return Qt(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Fc=Ir({atan2_:function(t,e){var n,r=gr(t,"a","atan2"),o=gr(e,"b","atan2");n=Ye(r,o),r=n[0],o=n[1];var i=si(r.shape,o.shape);return rn.runKernelFunc(function(t,e){var n=t.atan2(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=Pc(n.square(),r.square()),o=t.mul(r.div(e)),a=ai(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)},$b:function(){var e=Pc(n.square(),r.square()),o=Ju(t.mul(n.div(e))),a=ai(r.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(r.shape)}}})}}),Mc=Ir({div_:function(t,e){var n,r=gr(t,"a","div"),o=gr(e,"b","div");if(n=Ye(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return Uc(r,o);var i=si(r.shape,o.shape);return rn.runKernelFunc(function(t,e){var n=t.realDivide(r,o);return e([r,o]),n},{a:r,b:o},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),o=ai(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=ai(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}},"Div")}}),Bc=Ir({divNoNan_:function(t,e){var n,r=gr(t,"a","div"),o=gr(e,"b","div");r=(n=Ye(r,o))[0],o=n[1];var i=Mc(r,o),a=jr(i),s=o.equal(a);return Nc(s,a,i)}}),Lc=Ir({divStrict_:function(t,e){var n=gr(t,"a","div"),r=gr(e,"b","div");return Qt(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Uc=Ir({floorDiv_:function(t,e){var n,r=gr(t,"a","floorDiv"),o=gr(e,"b","floorDiv");n=Ye(r,o),r=n[0],o=n[1];var i=si(r.shape,o.shape);return rn.runKernelFunc(function(t,e){var n=t.floorDiv(r,o);return e([r,o]),n},{a:r,b:o},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),o=ai(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=ai(r.shape,i);o.length>0&&(e=e.sum(o).reshape(r.shape));var a=r.square();return e.div(a.toFloat()).neg()}}},"FloorDiv")}}),Wc=Ir({maximum_:function(t,e){var n,r=gr(t,"a","maximum"),o=gr(e,"b","maximum");return n=Ye(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),si(r.shape,o.shape),rn.runKernelFunc(function(t,e){var n=t.maximum(r,o);return e([r,o]),n},{a:r,b:o},function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.greaterEqual(r).toFloat())},b:function(){return t.mul(n.less(r).toFloat())}}},"Maximum")}}),zc=Ir({maximumStrict_:function(t,e){var n=gr(t,"a","maximumStrict"),r=gr(e,"b","maximumStrict");return Qt(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Vc=Ir({minimum_:function(t,e){var n,r=gr(t,"a","minimum"),o=gr(e,"b","minimum");return n=Ye(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),si(r.shape,o.shape),rn.runKernelFunc(function(t,e){var n=t.minimum(r,o);return e([r,o]),n},{a:r,b:o},function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.lessEqual(r).toFloat())},b:function(){return t.mul(n.greater(r).toFloat())}}},"Minimum")}}),jc=Ir({minimumStrict_:function(t,e){var n=gr(t,"a","minimumStrict"),r=gr(e,"b","minimumStrict");return Qt(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Gc=Ir({mod_:function(t,e){var n,r=gr(t,"a","mod"),o=gr(e,"b","mod");n=Ye(r,o),r=n[0],o=n[1];var i=si(r.shape,o.shape);return rn.runKernelFunc(function(t,e){var n=t.mod(r,o);return e([r,o]),n},{$a:r,$b:o},function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=ai(n.shape,i);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),o=ai(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}})}}),Hc=Ir({modStrict_:function(t,e){var n=gr(t,"a","modStrict"),r=gr(e,"b","modStrict");return Qt(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),qc=Ir({mul_:function(t,e){var n,r=gr(t,"a","mul"),o=gr(e,"b","mul");n=Ye(r,o),r=n[0],o=n[1];var i=si(r.shape,o.shape);return rn.runKernelFunc(function(t,e){var n=t.multiply(r,o);return e([r,o]),n},{a:r,b:o},function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.mul(r.toFloat()),o=ai(n.shape,i);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=ai(r.shape,i);return o.length>0?e.sum(o).reshape(r.shape):e}}},"Mul")}}),Kc=Ir({mulStrict_:function(t,e){var n=gr(t,"a","mul"),r=gr(e,"b","mul");return Qt(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Qc=Ir({pow_:function(t,e){var n,r=gr(t,"base","pow"),o=gr(e,"exp","pow");n=Ye(r,o),r=n[0],o=n[1];var i=si(r.shape,o.shape),a=[r,o];return rn.runKernelFunc(function(t,e){var n=t.pow(r,o);return e([r,o,n]),n},{a:r,b:o},function(t,e){var n=e[0],r=e[1],o=e[2];return{a:function(){var e=r.toFloat(),o=t.mul(e.mul(n.pow(e.sub(Dr(1))))),a=ai(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)},b:function(){var e=n.greater(0),a=n.log().where(e,jr(n)),s=t.mul(o.mul(a)),u=ai(r.shape,i);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}},"Pow",{},a,[!0])}}),Xc=Ir({powStrict_:function(t,e){return Qt(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),Jc=Ir({squaredDifferenceStrict_:function(t,e){var n=gr(t,"a","squaredDifferenceStrict"),r=gr(e,"b","squaredDifferenceStrict");return Qt(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Yc=Ir({sub_:function(t,e){var n,r=gr(t,"a","sub"),o=gr(e,"b","sub");n=Ye(r,o),r=n[0],o=n[1];var i=si(r.shape,o.shape);return rn.runKernelFunc(function(t){return t.subtract(r,o)},{a:r,b:o},function(t){return{a:function(){var e=t,n=ai(r.shape,i);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=ai(o.shape,i);return n.length>0&&(e=e.sum(n)),e.neg().reshape(o.shape)}}},"Sub")}}),Zc=Ir({subStrict_:function(t,e){var n=gr(t,"a","subStrict"),r=gr(e,"b","subStrict");return Qt(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),$c=Ir({equal_:function(t,e){var n,r=gr(t,"a","equal"),o=gr(e,"b","equal");return n=Ye(r,o),r=n[0],o=n[1],si(r.shape,o.shape),rn.runKernelFunc(function(t){return t.equal(r,o)},{$a:r,$b:o})}}),tl=Ir({equalStrict_:function(t,e){var n=gr(t,"a","equalStrict"),r=gr(e,"b","equalStrict");return Qt(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),el=Ir({greater_:function(t,e){var n,r=gr(t,"a","greater"),o=gr(e,"b","greater");return n=Ye(r,o),r=n[0],o=n[1],si(r.shape,o.shape),rn.runKernelFunc(function(t){return t.greater(r,o)},{a:r,b:o},null,"Greater")}}),nl=Ir({greaterEqual_:function(t,e){var n,r=gr(t,"a","greaterEqual"),o=gr(e,"b","greaterEqual");return n=Ye(r,o),r=n[0],o=n[1],si(r.shape,o.shape),rn.runKernelFunc(function(t,e){var n=t.greaterEqual(r,o);return e([r,o]),n},{a:r,b:o},function(t,e){var n=e[0],r=e[1];return{a:function(){return jr(n)},b:function(){return jr(r)}}},"GreaterEqual")}}),rl=Ir({greaterEqualStrict_:function(t,e){var n=gr(t,"a","greaterEqualStrict"),r=gr(e,"b","greaterEqualStrict");return Qt(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),ol=Ir({greaterStrict_:function(t,e){var n=gr(t,"a","greaterStrict"),r=gr(e,"b","greaterStrict");return Qt(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),il=Ir({less_:function(t,e){var n,r=gr(t,"a","less"),o=gr(e,"b","less");return n=Ye(r,o),r=n[0],o=n[1],si(r.shape,o.shape),rn.runKernelFunc(function(t){return t.less(r,o)},{a:r,b:o},null,"Less")}}),al=Ir({lessEqual_:function(t,e){var n,r=gr(t,"a","lessEqual"),o=gr(e,"b","lessEqual");return n=Ye(r,o),r=n[0],o=n[1],si(r.shape,o.shape),rn.runKernelFunc(function(t,e){var n=t.lessEqual(r,o);return e([r,o]),n},{a:r,b:o},null,"LessEqual")}}),sl=Ir({lessEqualStrict_:function(t,e){var n=gr(t,"a","lessEqualStrict"),r=gr(e,"b","lessEqualStrict");return Qt(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),ul=Ir({lessStrict_:function(t,e){var n=gr(t,"a","lessStrict"),r=gr(e,"b","lessStrict");return Qt(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),cl=Ir({notEqual_:function(t,e){var n,r=gr(t,"a","notEqual"),o=gr(e,"b","notEqual");return n=Ye(r,o),r=n[0],o=n[1],si(r.shape,o.shape),rn.runKernelFunc(function(t){return t.notEqual(r,o)},{a:r,b:o},null,"NotEqual")}}),ll=Ir({notEqualStrict_:function(t,e){var n=gr(t,"a","notEqualStrict"),r=gr(e,"b","notEqualStrict");return Qt(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function hl(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function dl(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var fl=Ir({gather_:function(t,e,n){void 0===n&&(n=0);var r=gr(t,"x","gather"),o=gr(e,"indices","gather","int32");n=ie(n,r.shape)[0];var i=function(t,e,n){for(var r=t.shape[n],o=[],i=1,a=1,s=0;s<n;s++)o.push(t.shape[s]),i*=t.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=n+1;s<t.rank;s++)o.push(t.shape[s]),a*=t.shape[s];return{batchSize:i,sliceSize:a,dimSize:r,outputShape:o}}(r,o,n);return rn.runKernelFunc(function(t,e){var i=t.gather(r,o.flatten(),n);return e([o]),i},{x:r,indices:o},function(t,e){var o=e[0];return{x:function(){var e=r.shape,i=o.size,a=e.slice(0,n),s=a.length,u=e.slice(n,e.length).slice(1),c=u.length,l=hl(0,s),h=hl(s+1,s+1+c),d=dl([a,[i],u]),f=t.reshape(d),p=o.reshape([i]),g=dl([[s],l,h]),m=f.transpose(g),v=pl(m,p,r.shape[n]),y=Ar(g);return v.transpose(y)},indices:function(){return o}}},"Gather",{axis:n}).reshape(i.outputShape)}}),pl=Ir({unsortedSegmentSum_:function(t,e,n){var r=gr(t,"x","unsortedSegmentSum"),o=gr(e,"segmentIds","unsortedSegmentSum","int32");return Kt($t(n),function(){return"numSegments must be of dtype int"}),rn.runKernelFunc(function(t,e){var i=t.unsortedSegmentSum(r,o,n);return e([o]),i},{$x:r},function(t,e){var n=e[0];return{$x:function(){return function(t,e){for(var n=Wc(e,jr(e)),r=fl(t,n),o=nl(e,Dr(0,"int32")),i=r.rank-o.rank,a=0;a<i;++a)o=mo(o,a+1);o=Sc(o,Lr(r.shape,"bool"));var s=jr(r);return Nc(o,r,s)}(t,n)}}})}});function gl(t,e,n,r,o,i,a){void 0===i&&(i="NHWC"),Kt(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var s=t,u=e,c=!1;3===e.rank&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,t[0],t[1],t[2]]),Kt(4===s.length,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),Kt(4===u.rank,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),Kt(4===n.rank,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank});var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];Kt(l===n.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."}),Kt(h===n.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."}),null!=a&&Kt($t(o),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var d=bi(i),f=li(s,n.shape,r,1,o,a,!1,d),p=rn.runKernelFunc(function(t,e){var r=t.conv2dDerInput(u,n,f);return e([n,u]),r},{dy4D:u,filter:n},function(t,e){var n=e[0],s=e[1];return{dy4D:function(){return bl(t,n,r,o,i,1,a)},filter:function(){return xl(t,s,n.shape,r,o,i,a)}}});return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function ml(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t),n=e[0],r=e[1],o=e[2];return 1===n&&1===r&&1===o}function vl(t,e,n,r,o){Kt(t.length===e.rank,function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"});var i=t,a=e,s=!1;4===e.rank&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),i=[1,t[0],t[1],t[2],t[3]]);var u=i[4],c=a.shape[4];Kt(5===i.length,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+i.length+"."}),Kt(5===a.rank,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank}),Kt(5===n.rank,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank}),Kt(u===n.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."}),Kt(c===n.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."});var l=hi(i,n.shape,r,1,o),h=rn.runKernelFunc(function(t){return t.conv3dDerInput(a,n,l)},{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var yl=Ir({conv1d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NWC"),void 0===i&&(i=1);var s=gr(t,"x","conv1d"),u=gr(e,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),Kt(3===c.rank,function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."}),Kt(3===u.rank,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),null!=a&&Kt($t(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),Kt(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),Kt(yi(n,i),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+i+"'"}),Kt("NWC"===o,function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),f=bl(d,h,[1,n],r,"NHWC",[1,i],a);return l?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),bl=Ir({conv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=gr(t,"x","conv2d"),u=gr(e,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Kt(4===c.rank,function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."}),Kt(4===u.rank,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),null!=a&&Kt($t(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h="NHWC"===o?c.shape[3]:c.shape[1];Kt(h===u.shape[2],function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."}),Kt(yi(n,i),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"});var d=bi(o),f=li(c.shape,u.shape,n,i,r,a,!1,d),p=[u,c],g=rn.runKernelFunc(function(t,e){var n=t.conv2d(c,u,f);return e([u,c]),n},{x:c,filter:u},function(t,e){var a=e,s=a[0],u=a[1];return Kt(vi(i),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"}),{x:function(){return El(u.shape,t,s,n,r,o)},filter:function(){return xl(u,t,s.shape,n,r,o)}}},"Conv2D",f,p);return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),wl=Ir({conv3d_:function(t,e,n,r,o,i){void 0===o&&(o="NDHWC"),void 0===i&&(i=[1,1,1]);var a=gr(t,"x","conv3d"),s=gr(e,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),Kt(5===u.rank,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),Kt(5===s.rank,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),Kt(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),Kt(function(t,e){return ml(t)||ml(e)}(n,i),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),Kt("NDHWC"===o,function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."});var l=hi(u.shape,s.shape,n,i,r),h=rn.runKernelFunc(function(t,e){var n=t.conv3d(u,s,l);return e([u,s]),n},{x:u,$filter:s},function(t,e){Kt(ml(i),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+i+"'"});var o=e[0],a=e[1];return{x:function(){return vl(o.shape,t,a,n,r)},$filter:function(){return function(t,e,n,r,o){var i=t;4===t.rank&&(i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var a=e;4===a.rank&&(a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),Kt(5===i.rank,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+i.shape+"."}),Kt(5===a.rank,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."}),Kt(5===n.length,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."}),Kt(i.shape[4]===n[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must match input depth in filter ("+n[3]+"."}),Kt(a.shape[4]===n[4],function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."});var s=hi(i.shape,n,r,1,o);return rn.runKernelFunc(function(t){return t.conv3dDerFilter(i,a,s)},{x5D:i,dy5D:a})}(o,t,a.shape,n,r)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),xl=Ir({conv2dDerFilter_:function(t,e,n,r,o,i,a){void 0===i&&(i="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),Kt(4===s.rank,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),Kt(4===u.rank,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),Kt(4===n.length,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."});var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];Kt(c===n[2],function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."}),Kt(l===n[3],function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."}),null!=a&&Kt($t(o),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."});var h=bi(i),d=li(s.shape,n,r,1,o,a,!1,h);return rn.runKernelFunc(function(t){return t.conv2dDerFilter(s,u,d)},{x4D:s,dy4D:u})}}),El=Ir({conv2dDerInput_:gl}),Al=Ir({depthwiseConv2d_:function(t,e,n,r,o,i,a){void 0===o&&(o="NHWC"),void 0===i&&(i=[1,1]);var s=gr(t,"x","depthwiseConv2d"),u=gr(e,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),Kt(4===c.rank,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."}),Kt(4===u.rank,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),Kt(c.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),null==i&&(i=[1,1]),Kt(yi(n,i),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"}),null!=a&&Kt($t(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=li(c.shape,u.shape,n,i,r,a,!0),d=[c,u],f=rn.runKernelFunc(function(t,e){var n=t.depthwiseConv2D(c,u,h);return e([c,u]),n},{x:c,filter:u},function(t,e){Kt(vi(i),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+i+"'"});var n=e[0],r=e[1];return{x:function(){return Cl(n.shape,t,r,h)},filter:function(){return kl(n,t,r.shape,h)}}},"DepthwiseConv2dNative",h,d);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),Cl=Ir({depthwiseConv2dDerInput_:function(t,e,n,r){var o=e,i=!1;3===e.rank&&(i=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=rn.runKernelFunc(function(t){return t.depthwiseConv2DDerInput(o,n,r)},{dy4D:o});return i?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),kl=Ir({depthwiseConv2dDerFilter_:function(t,e,n,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=e;return 3===i.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),rn.runKernelFunc(function(t){return t.depthwiseConv2DDerFilter(o,i,r)},{x4D:o,dy4D:i})}}),Sl=Ir({separableConv2d_:function(t,e,n,r,o,i,a){void 0===i&&(i=[1,1]),void 0===a&&(a="NHWC");var s=gr(t,"x","separableConv2d"),u=gr(e,"depthwiseFilter","separableConv2d"),c=gr(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Kt(4===l.rank,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."}),Kt(4===u.rank,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),Kt(4===c.rank,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),Kt(1===c.shape[0],function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."}),Kt(1===c.shape[1],function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."});var d=u.shape[2],f=u.shape[3];Kt(c.shape[2]===d*f,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+c.shape[2]+"."});var p=Al(l,u,r,o,a,i),g=bl(p,c,1,"valid",a);return h?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}}),Il=Ir({conv2dTranspose_:function(t,e,n,r,o,i){return gl(n,gr(t,"x","conv2dTranspose"),gr(e,"filter","conv2dTranspose"),r,o,"NHWC",i)}}),Rl=Ir({conv3dTranspose_:function(t,e,n,r,o){return vl(n,gr(t,"x","conv3dTranspose"),gr(e,"filter","conv3dTranspose"),r,o)}}),Tl=Ir({matMul_:function(t,e,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var i=gr(t,"a","matMul"),a=gr(e,"b","matMul");o=Ye(i,a),i=o[0],a=o[1];var s=n?i.shape[i.rank-2]:i.shape[i.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=n?i.shape[i.rank-1]:i.shape[i.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=i.shape.slice(0,-2),d=a.shape.slice(0,-2),f=Yt(h),p=Yt(d);Kt(i.rank>=2&&a.rank>=2&&i.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+i.rank+" and "+a.rank+"."}),Kt(Zt(h,d),function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+i.shape+" and "+a.shape+" must match."}),Kt(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+i.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."});var g=i.shape.slice(0,-2).concat([c,l]),m=n?i.as3D(f,s,c):i.as3D(f,c,s),v=r?a.as3D(p,l,u):a.as3D(p,u,l),y={transposeA:n,transposeB:r};return rn.runKernelFunc(function(t,e){var o=t.batchMatMul(m,v,n,r);return e([m,v]),o},{a:m,b:v},function(t,e){var o=e,i=o[0],a=o[1];return n||r?!n&&r?{a:function(){return t.matMul(a,!1,!1)},b:function(){return t.matMul(i,!0,!1)}}:n&&!r?{a:function(){return a.matMul(t,!1,!0)},b:function(){return i.matMul(t,!1,!1)}}:{a:function(){return a.matMul(t,!0,!0)},b:function(){return t.matMul(i,!0,!0)}}:{a:function(){return t.matMul(a,!1,!0)},b:function(){return i.matMul(t,!0,!1)}}},"BatchMatMul",y).reshape(g)}}),Nl=Ir({dot_:function(t,e){var n=gr(t,"t1","dot"),r=gr(e,"t2","dot");Kt(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."});var o=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];return Kt(o===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+i+"."}),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),_l=Ir({outerProduct_:function(t,e){var n=gr(t,"v1","outerProduct"),r=gr(e,"v2","outerProduct");return Kt(1===n.rank&&1===r.rank,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."}),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Pl=Ir({reverse_:function(t,e){var n=gr(t,"x","reverse");if(0===n.rank)return n.clone();var r=ie(e,n.shape);return rn.runKernelFunc(function(t){return t.reverse(n,r)},{$x:n},function(t){return{$x:function(){return t.reverse(r)}}}).reshapeAs(n)}}),Dl=Ir({reverse1d_:function(t){var e=gr(t,"x","reverse");return Kt(1===e.rank,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Pl(e,0)}}),Ol=Ir({reverse2d_:function(t,e){var n=gr(t,"x","reverse");return Kt(2===n.rank,function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."}),Pl(n,e)}}),Fl=Ir({reverse3d_:function(t,e){var n=gr(t,"x","reverse");return Kt(3===n.rank,function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."}),Pl(n,e)}}),Ml=Ir({reverse4d_:function(t,e){var n=gr(t,"x","reverse");return Kt(4===n.rank,function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."}),Pl(n,e)}});function Bl(t,e,n,r,o,i){var a=gr(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),Kt(4===s.rank,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),Kt(yi(n,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}),null!=i&&Kt($t(o),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=ui(s.shape,e,n,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&Zt(c.inShape,c.outShape))return a.clone();var l=[s],h=rn.runKernelFunc(function(t,e){var n=t.maxPool(s,c);return e([s,n]),n},{x:s},function(t,i){var a=i[0],s=i[1];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=gr(t,"dy","maxPoolBackprop"),c=gr(e,"input","maxPoolBackprop"),l=gr(n,"output","maxPoolBackprop");Kt(c.rank===u.rank,function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"}),null==i&&(i=[1,1]),Kt(yi(o,i),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),Kt(4===u.rank,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."}),Kt(4===c.rank,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."});var h=ui(c.shape,r,o,i,a,s);return rn.runKernelFunc(function(t){return t.maxPoolBackprop(u,c,l,h)},{$dy:u,$input:c})}(t,a,s,e,n,r,o)}}},"MaxPool",c,l);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Ll(t,e,n,r,o,i){var a=gr(t,"x","avgPool","float32");null==r&&(r=[1,1]),Kt(yi(n,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"});var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Kt(4===s.rank,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),null!=i&&Kt($t(o),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."});var c=ui(s.shape,e,n,r,o,i);if(1===c.filterWidth&&1===c.filterHeight&&Zt(c.inShape,c.outShape))return a.clone();var l=rn.runKernelFunc(function(t){return t.avgPool(s,c)},{x:s},function(t){return{x:function(){return function(t,e,n,r,o,i){var a=gr(t,"dy","avgPoolBackprop"),s=gr(e,"input","avgPoolBackprop");Kt(s.rank===a.rank,function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"}),null==o&&(o=[1,1]),Kt(yi(r,o),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"});var u=s,c=a,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Kt(4===c.rank,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."}),Kt(4===u.rank,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."});var h=ui(u.shape,n,r,o,i),d=rn.runKernelFunc(function(t){return t.avgPoolBackprop(c,u,h)},{dy4D:c,input4D:u});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(t,s,e,n,r,o)}}},"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Ul=Ir({maxPool_:function(t,e,n,r,o){return Bl(t,e,n,1,r,o)}}),Wl=Ir({avgPool_:function(t,e,n,r,o){return Ll(t,e,n,1,r,o)}}),zl=Ir({pool_:function(t,e,n,r,o,i){null==o&&(o=[1,1]),null==i&&(i=1),0===r&&(r="valid");var a=gr(t,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),Kt(yi(i,o),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"});var c,l=ui(s.shape,e,i,o,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(t,e){var n=t.map(function(t,n){return t+(t-1)*(e[n]-1)}).map(function(t){return t-1}),r=n.map(function(t){return Math.floor(t/2)}),o=n.map(function(t,e){return t-r[e]});return n.map(function(t,e){return[r[e],o[e]]})}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var d=1===h[0]&&1===h[1],f=function(t,e,n){var r=n.map(function(t){return t[0]}),o=n.map(function(t){return t[1]}),i=t.concat(r,o),a=e.map(function(t,e){return(t-i[e]%t)%t}),s=o.map(function(t,e){return t+a[e]});return[e.map(function(t,e){return[r[e],s[e]]}),e.map(function(t,e){return[0,a[e]]})]}([l.inHeight,l.inWidth],h,c),p=f[0],g=f[1],m=d?r:"valid",v=d?s:No(s,h,p),y=("avg"===n?function(){return Ll(v,e,i,1,m)}:function(){return Bl(v,e,i,1,m)})(),b=d?y:co(y,h,g);return u?b.as3D(b.shape[1],b.shape[2],b.shape[3]):b}}),Vl=Ir({maxPool3d_:function(t,e,n,r,o,i,a){void 0===i&&(i="NDHWC");var s=gr(t,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),Kt(5===u.rank,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),Kt("NDHWC"===i,function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),Kt(yi(n,a),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=o&&Kt($t(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=ci(u.shape,e,n,a,r,o,i),h=rn.runKernelFunc(function(t,e){var n=t.maxPool3d(u,l);return e([u,n]),n},{x:u},function(t,i){var s=i[0],u=i[1];return{x:function(){return function(t,e,n,r,o,i,a,s){var u=gr(t,"dy","maxPool3dBackprop"),c=gr(e,"input","maxPool3dBackprop"),l=gr(n,"output","maxPool3dBackprop"),h=u,d=c,f=l,p=!1;4===c.rank&&(p=!0,h=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),f=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),Kt(5===h.rank,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."}),Kt(5===d.rank,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."}),Kt(5===f.rank,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."}),null==i&&(i=[1,1,1]),Kt(yi(o,i),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}),null!=s&&Kt($t(a),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."});var g=ci(d.shape,r,o,i,a,s),m=rn.runKernelFunc(function(t){return t.maxPool3dBackprop(h,d,f,g)},{dy5D:h,input5D:d});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(t,s,u,e,n,a,r,o)}}});return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),jl=Ir({avgPool3d_:function(t,e,n,r,o,i,a){void 0===i&&(i="NDHWC");var s=gr(t,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),Kt(5===u.rank,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),Kt("NDHWC"===i,function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+i}),Kt(yi(n,a),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}),null!=o&&Kt($t(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."});var l=ci(u.shape,e,n,a,r,o,i),h=rn.runKernelFunc(function(t){return t.avgPool3d(u,l)},{x:u},function(t){return{x:function(){return function(t,e,n,r,o,i,a){var s=gr(t,"dy","avgPool3dBackprop"),u=gr(e,"input","avgPool3dBackprop"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),Kt(5===c.rank,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."}),Kt(5===l.rank,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."}),null==o&&(o=[1,1,1]),Kt(yi(r,o),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}),null!=a&&Kt($t(i),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."});var d=ci(l.shape,n,r,o,i,a),f=rn.runKernelFunc(function(t){return t.avgPool3dBackprop(c,l,d)},{dy5D:c,input5D:l});return h?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(t,u,e,n,a,r,o)}}});return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Gl=Ir({slice_:function(t,e,n){var r,o,i=gr(t,"x","slice");if(0===i.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(i.rank-1).fill(0)):e.length<i.rank?e.concat(new Array(i.rank-e.length).fill(0)):e.slice()).forEach(function(t){Kt(-1!==t,function(){return"slice() does not support negative begin indexing."})}),o=(o=null==n?new Array(i.rank).fill(-1):"number"==typeof n?[n].concat(new Array(i.rank-1).fill(-1)):n.length<i.rank?n.concat(new Array(i.rank-n.length).fill(-1)):n).map(function(t,e){return t>=0?t:(Kt(-1===t,function(){return"Negative size values should be exactly -1 but got "+t+" for the slice() size at index "+e+"."}),i.shape[e]-r[e])}),qo(i,r,o);var a=i.shape,s={begin:r,size:o};return rn.runKernelFunc(function(t){return t.slice(i,r,o)},{x:i},function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],a[n]-r[n]-o[n]]);return{x:function(){return t.pad(e)}}},"Slice",s)}}),Hl=Ir({slice1d_:function(t,e,n){var r=gr(t,"x","slice1d");return Kt(1===r.rank,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Gl(r,[e],[n])}}),ql=Ir({slice2d_:function(t,e,n){var r=gr(t,"x","slice2d");return Kt(2===r.rank,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Gl(r,e,n)}}),Kl=Ir({slice3d_:function(t,e,n){var r=gr(t,"x","slice3d");return Kt(3===r.rank,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Gl(r,e,n)}}),Ql=Ir({slice4d_:function(t,e,n){var r=gr(t,"x","slice4d");return Kt(4===r.rank,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Gl(r,e,n)}});function Xl(t,e,n,r,o){return e.rank<n.rank&&(e=e.reshape(wr(e.shape,r))),t.rank<n.rank&&(t=t.reshape(wr(t.shape,r))),{x:function(){var r=t.mul(n.equal(e).cast(t.dtype));return null==o?r:r.transpose(o)}}}var Jl=Ir({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=gr(t,"x","all","bool"),o=ie(e,r.shape),i=o,a=Er(i,r.rank);null!=a&&(r=r.transpose(a),i=Cr(i.length,r.rank));var s=rn.runKernelFunc(function(t){return t.all(r,i)},{$x:r});if(n){var u=wr(s.shape,o);return s.reshape(u)}return s}}),Yl=Ir({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=gr(t,"x","any","bool"),o=ie(e,r.shape),i=o,a=Er(i,r.rank);null!=a&&(r=r.transpose(a),i=Cr(i.length,r.rank));var s=rn.runKernelFunc(function(t){return t.any(r,i)},{$x:r});if(n){var u=wr(s.shape,o);return s.reshape(u)}return s}}),Zl=Ir({argMax_:function(t,e){void 0===e&&(e=0);var n=gr(t,"x","argMax");null==e&&(e=0);var r=ie(e,n.shape),o=Er(r,n.rank);null!=o&&(n=n.transpose(o),r=Cr(r.length,n.rank));var i={axis:r[0]},a=[n];return rn.runKernelFunc(function(t,e){var o=t.argMax(n,r[0]);return e([n]),o},{x:n},function(t,e){var n=e[0];return{x:function(){return jr(n)}}},"ArgMax",i,a)}}),$l=Ir({argMin_:function(t,e){void 0===e&&(e=0);var n=gr(t,"x","argMin");null==e&&(e=0);var r=ie(e,n.shape),o=Er(r,n.rank);return null!=o&&(n=n.transpose(o),r=Cr(r.length,n.rank)),rn.runKernelFunc(function(t,e){var o=t.argMin(n,r[0]);return e([n]),o},{$x:n},function(t,e){var n=e[0];return{$x:function(){return jr(n)}}})}}),th=Ir({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=gr(t,"x","logSumExp"),o=ie(e,r.shape),i=r.max(o,!0),a=r.sub(i).exp().sum(o).log(),s=i.reshape(a.shape).add(a);if(n){var u=wr(s.shape,o);return s.reshape(u)}return s}}),eh=Ir({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=gr(t,"x","max"),o=r,i=ie(e,r.shape),a=i,s=Er(a,r.rank);null!=s&&(r=r.transpose(s),a=Cr(a.length,r.rank));var u=[r],c=rn.runKernelFunc(function(t,e){var n=t.max(r,a);return e([o,n]),n},{x:r},function(t,e){return Xl(t,e[1],e[0],i,s)},"Max",{axes:a},u,[!0]);if(n){var l=wr(c.shape,i);c=c.reshape(l)}return c}}),nh=Ir({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=gr(t,"x","mean"),o=ie(e,r.shape),i=Yt(br(r.shape,o)[1]);return $o(function(t){var r=Dr(i);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(Lr(t.shape,"float32")).div(i)}}})(r)}}),rh=Ir({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=gr(t,"x","min"),o=r,i=ie(e,r.shape),a=i,s=Er(a,r.rank);null!=s&&(r=r.transpose(s),a=Cr(a.length,r.rank));var u=[r],c=rn.runKernelFunc(function(t,e){var n=t.min(r,a);return e([o,n]),n},{x:r},function(t,e){return Xl(t,e[1],e[0],i,s)},"Min",{axes:a},u,[!0]);if(n){var l=wr(c.shape,i);c=c.reshape(l)}return c}}),oh=Ir({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=ie(e,(t=gr(t,"x","moments")).shape),o=t.mean(r,n),i=o.shape;n||(i=wr(o.shape,r));var a=t.toFloat().sub(o.reshape(i)).square();return{mean:o,variance:a.mean(r,n)}}}),ih=Ir({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=gr(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=ie(e,r.shape);return $o(function(t){var e=Er(o,t.rank),r=o,i=t;null!=e&&(i=t.transpose(e),r=Cr(r.length,t.rank));var a=function(e){var n=t.shape.slice();return o.forEach(function(t){n[t]=1}),e.reshape(n).mul(Lr(t.shape,"float32"))},s={axes:r},u=rn.runKernelFunc(function(t){return t.sum(i,r)},{x:i},function(t){return{x:function(){return a(t)}}},"Sum",s);if(n){var c=wr(u.shape,o);u=u.reshape(c)}return{value:u,gradFunc:a}})(r)}}),ah=Ir({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=gr(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=ie(e,r.shape),i=Er(o,r.rank),a=o,s=r;null!=i&&(s=r.transpose(i),a=Cr(a.length,r.rank));var u=rn.runKernelFunc(function(t){return t.prod(s,a)},{permutedX:s});if(n){var c=wr(u.shape,o);u=u.reshape(c)}return u}}),sh=Ir({elu_:function(t){var e=gr(t,"x","elu");return rn.runKernelFunc(function(t,n){var r=t.elu(e);return n([r]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){return rn.runKernelFunc(function(e){return e.eluDer(t,n)},{dy:t,y:n})}}})}}),uh=Ir({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=gr(t,"x","leakyRelu");return Wc(Dr(e).mul(n),n)}}),ch=Ir({prelu_:function(t,e){var n=gr(t,"x","prelu"),r=gr(e,"alpha","prelu");return rn.runKernelFunc(function(t,e){var o=t.prelu(n,r);return e([n,r]),o},{x:n,alpha:r},function(t,e){var n=e[0],r=e[1],o=n.greater(0);return{x:function(){return Nc(o,t,t.mul(r))},alpha:function(){var e=Nc(o,jr(t),t.mul(n)),i=ai(r.shape,t.shape);return i.length>0&&(e=e.sum(i)),e.reshape(r.shape)}}},"Prelu")}}),lh=Ir({relu_:function(t){var e=gr(t,"x","relu");return"bool"===e.dtype?e.toInt():rn.runKernelFunc(function(t,n){var r=t.relu(e);return n([e]),r},{x:e},function(t,e){var n=e[0];return{x:function(){return t.mulStrict(n.step().toFloat())}}},"Relu")}}),hh=Ir({relu6_:function(t){var e=gr(t,"x","relu6");return"bool"===e.dtype?e.toInt():rn.runKernelFunc(function(t,n){var r=t.relu6(e);return n([e]),r},{x:e},function(t,e){var n=e[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return t.mulStrict(r.toFloat())}}},"Relu6")}}),dh=Ir({selu_:function(t){var e=gr(t,"x","selu");return rn.runKernelFunc(function(t,n){var r=t.selu(e);return n([e]),r},{$x:e},function(t,e){var n=e[0];return{$x:function(){var e=n.greater(Dr(0)),r=Dr(Zs),o=Dr($s),i=t.mul(o),a=t.mul(r).mul(n.toFloat().exp());return Nc(e,i,a)}}})}}),fh=Ir({transpose_:function(t,e){var n=gr(t,"x","transpose");if(null==e&&(e=n.shape.map(function(t,e){return e}).reverse()),Kt(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."}),e.forEach(function(t){Kt(t>=0&&t<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e})}),n.rank<=1)return n.clone();var r={perm:e};return rn.runKernelFunc(function(t){return t.transpose(n,e)},{x:n},function(t){var n=Ar(e);return{x:function(){return t.transpose(n)}}},"Transpose",r)}}),ph=Ir({localResponseNormalization_:function(t,e,n,r,o){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var i=gr(t,"x","localResponseNormalization");Kt(4===i.rank||3===i.rank,function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+i.rank+"."}),Kt($t(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=i,s=!1;3===i.rank&&(s=!0,a=i.as4D(1,i.shape[0],i.shape[1],i.shape[2]));var u=rn.runKernelFunc(function(t,i){var s=t.localResponseNormalization4D(a,e,n,r,o);return i([a,s]),s},{x4D:a},function(t,i){var a=i[0],s=i[1];return{x4D:function(){return rn.runKernelFunc(function(i){return i.LRNGrad(t,a,s,e,n,r,o)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),gh=Ir({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(Dr(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=gr(t,"x","norm"),e,n),i=o.shape;if(r){var a=ie(n,t.shape);i=wr(o.shape,a)}return o.reshape(i)}}),mh=Ir({basicLSTMCell_:function(t,e,n,r,o,i){var a=gr(t,"forgetBias","basicLSTMCell"),s=gr(e,"lstmKernel","basicLSTMCell"),u=gr(n,"lstmBias","basicLSTMCell"),c=gr(r,"data","basicLSTMCell"),l=gr(o,"c","basicLSTMCell"),h=gr(i,"h","basicLSTMCell"),d=c.concat(h,1).matMul(s).add(u),f=d.shape[0],p=d.shape[1]/4,g=[f,p],m=d.slice([0,0],g),v=d.slice([0,p],g),y=d.slice([0,2*p],g),b=d.slice([0,3*p],g),w=m.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(a.add(y).sigmoid())),x=w.tanh().mulStrict(b.sigmoid());return[w,x]}}),vh=Ir({multiRNNCell_:function(t,e,n,r){for(var o=gr(e,"data","multiRNNCell"),i=mr(n,"c","multiRNNCell"),a=mr(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,i[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],d=[];for(c=0;c<u.length;c+=2)h.push(u[c]),d.push(u[c+1]);return[h,d]}}),yh=Ir({movingAverage_:function(t,e,n,r,o){void 0===o&&(o=!0);var i=gr(t,"v","movingAverage"),a=gr(e,"x","movingAverage"),s=gr(n,"decay","movingAverage");Ze(i,a),Kt(Zt(i.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=Dr(1),c=u.sub(s),l=a.sub(i).mul(c);if(o){Kt(null!=r,function(){return"When using zeroDebias: true, step is required."});var h=gr(r,"step","movingAverage");l=l.div(u.sub(Qc(s,h)))}return i.add(l)}}),bh=Ir({stridedSlice_:function(t,e,n,r,o,i,a,s,u){if(void 0===o&&(o=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(e.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=gr(t,"x","stridedSlice"),l=Ko(s),h=c.shape.slice();l.forEach(function(t){e[t]=0,n[t]=1,h.splice(t,0,1)}),c=c.reshape(h);for(var d=0;d<c.rank;d++)e[d]=Xo(o,e,r,c.shape,d),n[d]=Jo(i,n,r,c.shape,d),r[d]=r[d]||1;var f=Ko(u);f.forEach(function(t){n[t]=e[t]+1,r[t]=1});var p=Qo(e,n,r),g=p.filter(function(t,e){return-1===f.indexOf(e)});return r.every(function(t){return 1===t})?Gl(c,e,p).reshape(g):rn.runKernelFunc(function(t){return t.stridedSlice(c,e,n,r)},{$x:c}).reshape(g)}}),wh=Ir({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=gr(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var i=rn.runKernelFunc(function(t){return t.topk(r,e,n)},{$x:r});return{values:i[0],indices:i[1]}}}),xh=Ir({scatterND_:function(t,e,n){var r=gr(t,"indices","scatterND","int32"),o=gr(e,"updates","scatterND");return Go(o,r,n),rn.runKernelFunc(function(t){return t.scatterND(r,o,n)},{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),Eh=Ir({fft_:function(t){Kt("complex64"===t.dtype,function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return rn.runKernelFunc(function(t){return t.fft(r)},{input:t}).reshape(t.shape)}}),Ah=Ir({ifft_:function(t){Kt("complex64"===t.dtype,function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."});var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return rn.runKernelFunc(function(t){return t.ifft(r)},{input:t}).reshape(t.shape)}}),Ch=Ir({rfft_:function(t,e){Kt("float32"===t.dtype,function(){return"The dtype for rfft() must be real value but got "+t.dtype});var n,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=e&&e<r){var i=t.shape.map(function(t){return 0}),a=t.shape.map(function(t){return t});a[t.shape.length-1]=e,n=t.slice(i,a),r=e}else if(null!=e&&e>r){var s=t.shape.map(function(t){return t});s[t.shape.length-1]=e-r,n=t.concat(Ur(s),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),c=Rr(n,u).as2D(o,r),l=Eh(c),h=Math.floor(r/2)+1,d=Tr(l),f=Nr(l),p=d.split([h,r-h],d.shape.length-1),g=f.split([h,r-h],f.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,Rr(p[0],g[0]).reshape(m)}}),kh=Ir({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),o=Ah(r);return Tr(o)}var i=[n,2*(e-1)],a=Tr(t).as2D(n,e),s=Nr(t).as2D(n,e),u=a.slice([0,1],[n,e-2]).reverse(1),c=s.slice([0,1],[n,e-2]).reverse(1).mul(Dr(-1)),l=a.concat(u,1),h=s.concat(c,1);return r=Rr(l,h).as2D(i[0],i[1]),o=Ah(r),Tr(o)}}),Sh=Object.freeze({fft:Eh,ifft:Ah,rfft:Ch,irfft:kh}),Ih=Ir({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var o=gr(t,"sparseIndices","sparseToDense","int32"),i=gr(e,"sparseValues","sparseToDense"),a=gr(r,"defaultValue","sparseToDense",i.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,i=t.rank>1?t.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+i+".");var a=e.size;if(0!==e.rank&&(1!==e.rank||a!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,i,n,a),rn.runKernelFunc(function(t){return t.sparseToDense(o,i,n,a)},{$sparseIndices:o,$sparseValues:i,$defaultValue:a})}}),Rh=Ir({gatherND_:function(t,e){var n=gr(e,"indices","gatherND","int32"),r=gr(t,"x","gatherND");return rn.runKernelFunc(function(t){return t.gatherND(r,n)},{x:r,indices:n},null,"GatherNd")}}),Th=Ir({diag_:function(t){var e=gr(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return rn.runKernelFunc(function(t){return t.diag(e)},{$x:e}).reshape(n)}}),Nh=Ir({dropout_:function(t,e,n,r){var o=gr(t,"x","dropout");if(Kt("float32"===o.dtype,function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."}),Kt(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),0===e)return t instanceof ze?o.clone():o;var i=function(t,e){if(null==e)return t.shape.slice();if(Zt(t.shape,e))return e;if(t.shape.length===e.length){for(var n=[],r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(o,n),a=1-e,s=Ro(i,0,1,"float32",r).add(a).floor().div(a);return o.mul(s)}});function _h(t,e,n){for(var r=1-t%2,o=new Float32Array(t),i=0;i<t;++i){var a=2*Math.PI*i/(t+r-1);o[i]=e-n*Math.cos(a)}return Or(o,"float32")}var Ph,Dh=Ir({hannWindow_:function(t){return _h(t,.5,.5)}}),Oh=Ir({hammingWindow_:function(t){return _h(t,.54,.46)}}),Fh=Ir({frame_:function(t,e,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var i=0,a=[];i+e<=t.size;)a.push(Gl(t,i,e)),i+=n;if(r)for(;i<t.size;){var s=i+e-t.size,u=Gr([Gl(t,i,e-s),Wr([s],o)]);a.push(u),i+=n}return 0===a.length?Fr([],[0,e]):Gr(a).as2D(a.length,e)}}),Mh=Ir({stft_:function(t,e,n,r,o){var i;void 0===o&&(o=Dh),null==r&&(i=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(i)/Math.log(2)))));for(var a=Fh(t,e,n),s=qc(a,o(e)),u=[],c=0;c<a.shape[0];c++)u.push(Ch(s.slice([c,0],[1,e]),r));return Gr(u)}}),Bh=Object.freeze({hannWindow:Dh,hammingWindow:Oh,frame:Fh,stft:Mh});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Ph||(Ph={}));var Lh=Ir({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=Ph.SUM_BY_NONZERO_WEIGHTS);var o=gr(t,"labels","absoluteDifference"),i=gr(e,"predictions","absoluteDifference"),a=null;null!=n&&(a=gr(n,"weights","absoluteDifference")),Qt(o.shape,i.shape,"Error in absoluteDifference: ");var s=o.sub(i).abs();return Uh(s,a,r)}}),Uh=Ir({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=Ph.SUM_BY_NONZERO_WEIGHTS);var r=gr(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=gr(e,"weights","computeWeightedLoss"));var i=null==o?r:r.mul(o);if(n===Ph.NONE)return i;if(n===Ph.SUM)return i.sum();if(n===Ph.MEAN){if(null==o)return i.mean();var a=r.size/o.size,s=i.sum().div(o.sum());return a>1?s.div(Dr(a)):s}if(n===Ph.SUM_BY_NONZERO_WEIGHTS){if(null==o)return i.sum().div(Dr(r.size));var u=o.mul(Lr(r.shape)).notEqual(Dr(0)).sum().toFloat();return i.sum().div(u)}throw Error("Unknown reduction: "+n)}}),Wh=Ir({cosineDistance_:function(t,e,n,r,o){void 0===o&&(o=Ph.SUM_BY_NONZERO_WEIGHTS);var i=gr(t,"labels","cosineDistance"),a=gr(e,"predictions","cosineDistance"),s=null;null!=r&&(s=gr(r,"weights","cosineDistance")),Qt(i.shape,a.shape,"Error in cosineDistance: ");var u=Dr(1).sub(i.mul(a).sum(n,!0));return Uh(u,s,o)}}),zh=Ir({hingeLoss_:function(t,e,n,r){void 0===r&&(r=Ph.SUM_BY_NONZERO_WEIGHTS);var o=gr(t,"labels","hingeLoss"),i=gr(e,"predictions","hingeLoss"),a=null;null!=n&&(a=gr(n,"weights","hingeLoss")),Qt(o.shape,i.shape,"Error in hingeLoss: ");var s=Dr(1);o=Dr(2).mul(o).sub(s);var u=s.sub(o.mul(i)).relu();return Uh(u,a,r)}}),Vh=Ir({huberLoss_:function(t,e,n,r,o){void 0===r&&(r=1),void 0===o&&(o=Ph.SUM_BY_NONZERO_WEIGHTS);var i=gr(t,"labels","huberLoss"),a=gr(e,"predictions","huberLoss"),s=null;null!=n&&(s=gr(n,"weights","huberLoss")),Qt(i.shape,a.shape,"Error in huberLoss: ");var u=Dr(r),c=a.sub(i).abs(),l=Vc(c,u),h=c.sub(l),d=Dr(.5).mul(l.square()).add(u.mul(h));return Uh(d,s,o)}}),jh=Ir({logLoss_:function(t,e,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=Ph.SUM_BY_NONZERO_WEIGHTS);var i=gr(t,"labels","logLoss"),a=gr(e,"predictions","logLoss"),s=null;null!=n&&(s=gr(n,"weights","logLoss")),Qt(i.shape,a.shape,"Error in logLoss: ");var u=Dr(1),c=Dr(r),l=i.mul(a.add(c).log()).neg().sub(u.sub(i).mul(u.sub(a).add(c).log()));return Uh(l,s,o)}}),Gh=Ir({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=Ph.SUM_BY_NONZERO_WEIGHTS);var o=gr(t,"labels","meanSquaredError"),i=gr(e,"predictions","meanSquaredError"),a=null;null!=n&&(a=gr(n,"weights","meanSquaredError")),Qt(o.shape,i.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(i);return Uh(s,a,r)}}),Hh=Ir({sigmoidCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Ph.SUM_BY_NONZERO_WEIGHTS);var i=gr(t,"multiClassLabels","sigmoidCrossEntropy"),a=gr(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=gr(n,"weights","sigmoidCrossEntropy")),Qt(i.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Dr(r),c=Dr(1),l=Dr(.5);i=i.mul(c.sub(u)).add(l.mul(u))}var h=function(t,e){var n=gr(t,"labels","sigmoidCrossEntropyWithLogits"),r=gr(e,"logits","sigmoidCrossEntropyWithLogits");Qt(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),i=r.mul(n),a=r.abs().neg().exp().log1p();return o.sub(i).add(a)}(i,a);return Uh(h,s,o)}}),qh=Ir({softmaxCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=Ph.SUM_BY_NONZERO_WEIGHTS);var i=gr(t,"onehotLabels","softmaxCrossEntropy"),a=gr(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=gr(n,"weights","softmaxCrossEntropy")),Qt(i.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Dr(r),c=Dr(1),l=Dr(i.shape[1]);i=i.mul(c.sub(u)).add(u.div(l))}var h=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return $o(function(t,e,r){var o=e.logSumExp([n],!0),i=e.toFloat().sub(o);return r([t,i]),{value:i.mul(t).neg().sum([n]),gradFunc:function(t,e){var r=e[0],o=e[1],i=wr(t.shape,[n]);return[t.reshape(i).mul(r.toFloat().sub(o.exp())),t.reshape(i).mul(o.exp().sub(r.toFloat()))]}}})(t,e)}(i,a);return Uh(h,s,o)}}),Kh=Object.freeze({get Reduction(){return Ph},absoluteDifference:Lh,computeWeightedLoss:Uh,cosineDistance:Wh,hingeLoss:zh,huberLoss:Vh,logLoss:jh,meanSquaredError:Gh,sigmoidCrossEntropy:Hh,softmaxCrossEntropy:qh});function Qh(t,e){return void 0===e&&(e=!1),rn.tidy(function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],o=vo(n),i=t.clone(),a=Fr([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,c=function(t){var e,u=i,c=s,l=o;e=rn.tidy(function(){var e=i.slice([t,t],[n-t,1]),u=e.norm(),c=i.slice([t,t],[1,1]),l=Fr([[-1]]).where(c.greater(0),Fr([[1]])),h=c.sub(l.mul(u)),d=e.div(h);s=1===d.shape[0]?a.clone():a.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var f=l.matMul(h).div(u).neg(),p=i.slice([t,0],[n-t,r]),g=f.mul(s);if(0===t)i=p.sub(g.matMul(s.transpose().matMul(p)));else{var m=p.sub(g.matMul(s.transpose().matMul(p)));i=i.slice([0,0],[t,r]).concat(m,0)}var v=o.slice([0,t],[n,o.shape[1]-t]);if(0===t)o=v.sub(v.matMul(s).matMul(g.transpose()));else{var y=v.sub(v.matMul(s).matMul(g.transpose()));o=o.slice([0,0],[n,t]).concat(y,1)}return[s,i,o]}),s=e[0],i=e[1],o=e[2],hr([u,c,l])},l=0;l<u;++l)c(l);return!e&&n>r&&(o=o.slice([0,0],[n,r]),i=i.slice([0,0],[r,r])),[o,i]})}var Xh=Ir({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=gr(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,i=r.shape.slice(-2),a=i[0],s=i[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),n<0&&(n=s);var u=zr(0,a,1,"int32").reshape([-1,1]),c=zr(0,s,1,"int32"),l=Yc(u,c),h=Sc(l.lessEqual(Dr(+e,"int32")),l.greaterEqual(Dr(-n,"int32"))),d=Ur([a,s],r.dtype);return Po(Fo(r.reshape([-1,a,s])).map(function(t){return Nc(h,t,d)})).reshape(o)}}),Jh=Ir({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,Kt(null!=t&&t.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var n=t[0].shape[0],r=function(e){Kt(t[e].shape[0]===n,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"})},o=1;o<t.length;++o)r(o)}else e=!0,t=Xr(t,t.shape[0],0).map(function(t){return _o(t,[0])});Kt(t.length<=t[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."});var i=[],a=t,s=function(t){i.push(rn.tidy(function(){var e=a[t];if(t>0)for(var n=0;n<t;++n){var r=ih(i[n].mulStrict(e)).mul(i[n]);e=e.sub(r)}return e.div(gh(e,"euclidean"))}))};for(o=0;o<t.length;++o)s(o);return e?Po(i,0):i}}),Yh=Ir({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return Qh(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce(function(t,e){return t*e}),r=Fo(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];return r.forEach(function(t){var n=Qh(t,e),r=n[0],a=n[1];o.push(r),i.push(a)}),[Po(o,0).reshape(t.shape),Po(i,0).reshape(t.shape)]}}),Zh=Object.freeze({bandPart:Xh,gramSchmidt:Jh,qr:Yh});function $h(t,e,n,r,o,i){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==i&&(i=0);var a=t.shape[0];return n=Math.min(n,a),Kt(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),Kt(2===t.rank,function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"}),Kt(4===t.shape[1],function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]}),Kt(1===e.rank,function(){return"scores must be a 1D tensor"}),Kt(e.shape[0]===a,function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]}),Kt(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:i}}var td=Ir({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=gr(t,"images","resizeBilinear");Kt(3===r.rank||4===r.rank,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),Kt(2===e.length,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=rn.runKernelFunc(function(t,e){return e([o]),t.resizeBilinear(o,a,s,n)},{x:o},function(t,e){return{x:function(){return rn.runKernelFunc(function(r){return r.resizeBilinearBackprop(t,e[0],n)},{})}}},"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),ed=Ir({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=gr(t,"images","resizeNearestNeighbor");Kt(3===r.rank||4===r.rank,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),Kt(2===e.length,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),Kt("float32"===r.dtype||"int32"===r.dtype,function(){return"`images` must have `int32` or `float32` as dtype"});var o=r,i=!1;3===r.rank&&(i=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=rn.runKernelFunc(function(t,e){return e([o]),t.resizeNearestNeighbor(o,a,s,n)},{batchImages:o},function(t,e){return{batchImages:function(){return rn.runKernelFunc(function(r){return r.resizeNearestNeighborBackprop(t,e[0],n)},{})}}});return i?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),nd=Ir({nonMaxSuppression_:function(t,e,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var i=gr(t,"boxes","nonMaxSuppression"),a=gr(e,"scores","nonMaxSuppression"),s=$h(i,a,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return rn.runKernelFunc(function(t){return t.nonMaxSuppression(i,a,n,r,o)},{boxes:i,scores:a},null,"NonMaxSuppressionV3",u)}}),rd=Ir({nonMaxSuppressionWithScore_:function(t,e,n,r,o,i){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0);var a=gr(t,"boxes","nonMaxSuppression"),s=gr(e,"scores","nonMaxSuppression"),u=$h(a,s,n,r,o,i),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},l=rn.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),od=Ir({cropAndResize_:function(t,e,n,r,o,i){var a=gr(t,"image","cropAndResize"),s=gr(e,"boxes","cropAndResize","float32"),u=gr(n,"boxInd","cropAndResize","int32");o=o||"bilinear",i=i||0;var c=s.shape[0];return Kt(4===a.rank,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),Kt(2===s.rank&&4===s.shape[1],function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."}),Kt(1===u.rank&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."}),Kt(2===r.length,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),Kt(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),Kt("bilinear"===o||"nearest"===o,function(){return"method must be bilinear or nearest, but was "+o}),rn.runKernelFunc(function(t,e){return t.cropAndResize(a,s,u,r,o,i)},{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:i,cropSize:r})}}),id=Object.freeze({resizeBilinear:td,resizeNearestNeighbor:ed,nonMaxSuppression:nd,nonMaxSuppressionAsync:function(t,e,n,r,o){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),_t(this,void 0,void 0,function(){var i,a,s,u,c,l,h;return Pt(this,function(d){switch(d.label){case 0:return i=gr(t,"boxes","nonMaxSuppressionAsync"),a=gr(e,"scores","nonMaxSuppressionAsync"),s=$h(i,a,n,r,o),n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold,[4,Promise.all([i.data(),a.data()])];case 1:return u=d.sent(),c=u[0],l=u[1],h=Ti(c,l,n,r,o),i!==t&&i.dispose(),a!==e&&a.dispose(),[2,h]}})})},nonMaxSuppressionWithScore:rd,nonMaxSuppressionWithScoreAsync:function(t,e,n,r,o,i){return void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===i&&(i=0),_t(this,void 0,void 0,function(){var a,s,u,c,l,h,d;return Pt(this,function(f){switch(f.label){case 0:return a=gr(t,"boxes","nonMaxSuppressionAsync"),s=gr(e,"scores","nonMaxSuppressionAsync"),u=$h(a,s,n,r,o,i),n=u.maxOutputSize,r=u.iouThreshold,o=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=f.sent(),l=c[0],h=c[1],d=Ni(l,h,n,r,o,i),a!==t&&a.dispose(),s!==e&&s.dispose(),[2,d]}})})},cropAndResize:od}),ad=function(t,e){return!(t>0)||"linear"===e},sd=function(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},ud=function(t,e){var n=e,r=ai(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},cd=function(t,e,n){if("linear"===e)return t;if("relu"===e)return lh(t);if("elu"===e)return sh(t);if("relu6"===e)return hh(t);if("prelu"===e)return ch(t,n);throw new Error("Unknown fused activation "+e+".")},ld=Ir({fusedMatMul_:function(t){var e,n=t.a,r=t.b,o=t.transposeA,i=void 0!==o&&o,a=t.transposeB,s=void 0!==a&&a,u=t.bias,c=t.activation,l=void 0===c?"linear":c,h=t.preluActivationWeights;if(!1===ad(rn.state.gradientDepth,l)){var d=Tl(n,r,i,s);return null!=u&&(d=Pc(d,u)),cd(d,l,h)}var f=gr(n,"a","fused matMul"),p=gr(r,"b","fused matMul");e=Ye(f,p),f=e[0],p=e[1];var g=i?f.shape[f.rank-2]:f.shape[f.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=i?f.shape[f.rank-1]:f.shape[f.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=f.shape.slice(0,-2),w=p.shape.slice(0,-2),x=Yt(b),E=Yt(w);Kt(f.rank>=2&&p.rank>=2&&f.rank===p.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."}),Kt(Zt(b,w),function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+w+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."}),Kt(g===m,function(){return"Error in fused matMul: inner shapes ("+g+") and ("+m+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+i+" and transposeB="+s+" must match."});var A,C,k=f.shape.slice(0,-2).concat([v,y]),S=i?f.as3D(x,g,v):f.as3D(x,v,g),I=s?p.as3D(E,y,m):p.as3D(E,m,y);null!=u&&si(k,(A=Ye(A=gr(u,"bias","fused matMul"),f)[0]).shape),null!=h&&(C=gr(h,"prelu weights","fused matMul"));var R={a:S,b:I};null!=u&&(R.bias=A),null!=h&&(R.preluActivationWeights=C);var T=[S,I];return rn.runKernelFunc(function(t,e){var n=t.fusedBatchMatMul({a:S,b:I,transposeA:i,transposeB:s,bias:A,activation:l,preluActivationWeights:C});return e([S,I,n]),n},R,function(t,e){var n=e[0],r=e[1],o=e[2],a=sd(t,o,l),c={};return null!=u&&(c={bias:function(){return ud(A,a)}}),i||s?!i&&s?Object.assign({a:function(){return a.matMul(r,!1,!1)},b:function(){return a.matMul(n,!0,!1)}},c):i&&!s?Object.assign({a:function(){return r.matMul(a,!1,!0)},b:function(){return n.matMul(a,!1,!1)}},c):Object.assign({a:function(){return r.matMul(a,!0,!0)},b:function(){return a.matMul(n,!0,!0)}},c):Object.assign({a:function(){return a.matMul(r,!1,!0)},b:function(){return n.matMul(a,!0,!1)}},c)},"_FusedMatMul",{transposeA:i,transposeB:s,activation:l},T,[!0]).reshape(k)}}),hd=Ir({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,h=t.activation,d=void 0===h?"linear":h,f=t.preluActivationWeights;if(d=d||"linear",!1===ad(rn.state.gradientDepth,d)){var p=bl(e,n,r,o,a,u,c);return null!=l&&(p=Pc(p,l)),cd(p,d,f)}var g=gr(e,"x","conv2d"),m=gr(n,"filter","conv2d"),v=g,y=!1;3===g.rank&&(y=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),Kt(4===v.rank,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."}),Kt(4===m.rank,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."}),null!=c&&Kt($t(o),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."}),Kt(v.shape[3]===m.shape[2],function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+m.shape[2]+"."}),Kt(yi(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),Kt("NHWC"===a,function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."});var b,w,x=li(v.shape,m.shape,r,u,o,c);null!=l&&(b=Ye(b=gr(l,"bias","fused conv2d"),g)[0],si(x.outShape,b.shape)),null!=f&&(w=gr(f,"prelu weights","fused conv2d"));var E={x:v,filter:m};null!=l&&(E.bias=b),null!=f&&(E.preluActivationWeights=w);var A=[m,v],C=rn.runKernelFunc(function(t,e){var n=t.fusedConv2d({input:v,filter:m,convInfo:x,bias:b,activation:d,preluActivationWeights:w});return e([m,v,n]),n},E,function(t,e){var n=e,i=n[0],a=n[1],s=n[2],c=sd(t,s,d);Kt(vi(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var h={};return null!=l&&(h={bias:function(){return ud(b,c)}}),Object.assign({x:function(){return El(a.shape,c,i,r,o)},filter:function(){return xl(a,c,i.shape,r,o)}},h)},"FusedConv2D",{convInfo:x,activation:d},A,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),dd=Ir({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,o=t.pad,i=t.dataFormat,a=void 0===i?"NHWC":i,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,h=t.activation,d=void 0===h?"linear":h,f=t.preluActivationWeights;if(!1===ad(rn.state.gradientDepth,d)){var p=Al(e,n,r,o,a,u,c);return null!=l&&(p=Pc(p,l)),cd(p,d,f)}var g=gr(e,"x","depthwiseConv2d"),m=gr(n,"filter","depthwiseConv2d"),v=g,y=!1;3===g.rank&&(y=!0,v=g.as4D(1,g.shape[0],g.shape[1],g.shape[2])),Kt(4===v.rank,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."}),Kt(4===m.rank,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."}),Kt(v.shape[3]===m.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."}),null==u&&(u=[1,1]),Kt(yi(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),null!=c&&Kt($t(o),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."});var b,w,x=li(v.shape,m.shape,r,u,o,c,!0);null!=l&&(b=Ye(b=gr(l,"bias","fused conv2d"),g)[0],si(x.outShape,b.shape)),null!=f&&(w=gr(f,"prelu weights","fused depthwiseConv2d"));var E={x:v,filter:m};null!=l&&(E.bias=b),null!=f&&(E.preluActivationWeights=w);var A=[m,v],C=rn.runKernelFunc(function(t,e){var n=t.fusedDepthwiseConv2D({input:v,filter:m,convInfo:x,bias:b,activation:d,preluActivationWeights:w});return e([m,v,n]),n},E,function(t,e){Kt(vi(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var n=e[0],r=e[1],o=e[2],i=sd(t,o,d),a={};return null!=l&&(a={bias:function(){return ud(b,i)}}),Object.assign({x:function(){return Cl(r.shape,i,n,x)},filter:function(){return kl(r,i,n.shape,x)}},a)},"FusedDepthwiseConv2D",{convInfo:x,activation:d},A,[!0]);return y?C.as3D(C.shape[1],C.shape[2],C.shape[3]):C}}),fd=Object.freeze({matMul:ld,conv2d:hd,depthwiseConv2d:dd}),pd=Object.freeze({image:id,linalg:Zh,losses:Kh,spectral:Sh,fused:fd,signal:Bh,square:Tu,squaredDifference:_u,conv1d:yl,conv2d:bl,conv3d:wl,depthwiseConv2d:Al,separableConv2d:Sl,conv2dTranspose:Il,conv3dTranspose:Rl,op:Ir,batchNormalization2d:yc,batchNormalization3d:bc,batchNormalization4d:wc,batchNormalization:xc,batchNorm:Ec,batchNorm2d:Ac,batchNorm3d:Cc,batchNorm4d:kc,booleanMaskAsync:function(t,e,n){return _t(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h,d,f,p,g;return Pt(this,function(m){switch(m.label){case 0:for(r=gr(t,"tensor","boolMask"),o=gr(e,"mask","boolMask","bool"),i=null==n?0:n,a=o.rank,s=r.shape,Kt(a>0,function(){return"mask cannot be scalar"}),Qt(s.slice(i,i+a),o.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+a;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+a)),h=r.reshape(l),d=o.reshape([-1]),[4,_c(d)];case 1:return f=m.sent(),p=f.squeeze([1]),g=fl(h,p,i),t!==r&&r.dispose(),e!==o&&o.dispose(),p.dispose(),h.dispose(),d.dispose(),f.dispose(),[2,g]}})})},complex:Rr,real:Tr,imag:Nr,concat:Gr,concat1d:Hr,concat2d:qr,concat3d:Kr,concat4d:Qr,split:Xr,matMul:Tl,dot:Nl,outerProduct:_l,reverse:Pl,reverse1d:Dl,reverse2d:Ol,reverse3d:Fl,reverse4d:Ml,maxPool:Ul,avgPool:Wl,pool:zl,maxPool3d:Vl,avgPool3d:jl,slice:Gl,slice1d:Hl,slice2d:ql,slice3d:Kl,slice4d:Ql,abs:Pu,acos:Du,acosh:Ou,asin:Fu,asinh:Mu,atan:Bu,atanh:Lu,ceil:Uu,clipByValue:Wu,cos:zu,cosh:Vu,erf:ju,exp:Gu,expm1:Hu,floor:qu,log:Ku,log1p:Qu,logSigmoid:Xu,neg:Ju,reciprocal:Yu,round:Zu,rsqrt:$u,sigmoid:tc,sign:ec,isNaN:nc,isInf:rc,isFinite:oc,sin:ic,sinh:ac,softplus:sc,sqrt:uc,step:cc,tan:lc,tanh:hc,all:Jl,any:Yl,argMax:Zl,argMin:$l,logSumExp:th,max:eh,mean:nh,min:rh,moments:oh,sum:ih,prod:ah,equal:$c,equalStrict:tl,greater:el,greaterEqual:nl,greaterEqualStrict:rl,greaterStrict:ol,less:il,lessEqual:al,lessEqualStrict:sl,lessStrict:ul,notEqual:cl,notEqualStrict:ll,add:Pc,addN:Dc,addStrict:Oc,atan2:Fc,div:Mc,divNoNan:Bc,divStrict:Lc,floorDiv:Uc,maximum:Wc,maximumStrict:zc,minimum:Vc,minimumStrict:jc,mod:Gc,modStrict:Hc,mul:qc,mulStrict:Kc,pow:Qc,powStrict:Xc,squaredDifferenceStrict:Jc,sub:Yc,subStrict:Zc,elu:sh,leakyRelu:uh,prelu:ch,relu:lh,relu6:hh,selu:dh,logicalAnd:Sc,logicalNot:Ic,logicalOr:Rc,logicalXor:Tc,where:Nc,whereAsync:_c,buffer:uo,print:function(t,e){void 0===e&&(e=!1),console.log(t.toString(e))},batchToSpaceND:co,broadcastTo:lo,cast:ho,clone:fo,cumsum:po,depthToSpace:go,expandDims:mo,eye:vo,multinomial:yo,oneHot:bo,pad:wo,pad1d:xo,pad2d:Eo,pad3d:Ao,pad4d:Co,rand:ko,randomNormal:So,randomGamma:Io,randomUniform:Ro,reshape:To,spaceToBatchND:No,squeeze:_o,stack:Po,tile:Do,truncatedNormal:Oo,unstack:Fo,setdiff1dAsync:function(t,e){return _t(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h;return Pt(this,function(d){switch(d.label){case 0:return n=gr(t,"x","setdiff1d"),r=gr(e,"y","setdiff1d"),Kt(n.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."}),Kt(1===n.rank,function(){return"x should be 1D tensor, but got x ("+n.shape+")."}),Kt(1===r.rank,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,n.data()];case 1:return o=d.sent(),[4,r.data()];case 2:for(i=d.sent(),a=new Set(i),s=0,l=0;l<o.length;l++)a.has(o[l])||s++;for(u=new Be([s],n.dtype),c=new Be([s],"int32"),l=0,h=0;l<o.length;l++)a.has(o[l])||(u.values[h]=o[l],c.values[h]=l,h++);return[2,[u.toTensor(),c.toTensor()]]}})})},fill:Wr,linspace:function(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return rn.runKernelFunc(function(r){return r.linspace(t,e,n)},{})},ones:Lr,range:zr,scalar:Dr,tensor:_r,tensor1d:Or,tensor2d:Fr,tensor3d:Mr,tensor4d:Br,tensor5d:function(t,e,n){if(Xt(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=fr(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Pr(t,e,r,n)},tensor6d:function(t,e,n){if(Xt(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=fr(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Pr(t,e=e||r,r,n)},variable:function(t,e,n,r){return void 0===e&&(e=!0),rn.makeVariable(t,e,n,r)},zeros:Ur,onesLike:Vr,zerosLike:jr,transpose:fh,softmax:ti,logSoftmax:ei,localResponseNormalization:ph,norm:gh,gather:fl,unsortedSegmentSum:pl,basicLSTMCell:mh,multiRNNCell:vh,movingAverage:yh,stridedSlice:bh,topk:wh,scatterND:xh,fft:Eh,ifft:Ah,rfft:Ch,irfft:kh,sparseToDense:Ih,gatherND:Rh,diag:Th,dropout:Nh,hannWindow:Dh,hammingWindow:Oh,frame:Fh,stft:Mh,inTopKAsync:function(t,e,n){return void 0===n&&(n=1),_t(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h,d,f,p,g,m;return Pt(this,function(v){switch(v.label){case 0:return r=gr(t,"predictions","inTopK"),o=gr(e,"targets","inTopK"),Kt(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),Kt(r.rank-1===o.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+o.rank}),Qt(r.shape.slice(0,r.shape.length-1),o.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],Kt(n>0&&n<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n}),[4,r.data()];case 1:return a=v.sent(),[4,o.data()];case 2:for(s=v.sent(),u=[a.length/i,i],l=u[1],h=se("bool",c=u[0]),d=0;d<c;d++){for(f=d*l,p=a.subarray(f,f+l),g=[],m=0;m<p.length;m++)g.push({value:p[m],index:m});for(g.sort(function(t,e){return e.value-t.value}),h[d]=0,m=0;m<n;m++)if(g[m].index===s[d]){h[d]=1;break}}return t!==r&&r.dispose(),e!==o&&o.dispose(),[2,_r(h,o.shape,"bool")]}})})}});function gd(t,e){Array.isArray(t)||(t=[t]),t.forEach(function(t){null!=t&&Kt("complex64"!==t.dtype,function(){return e+" does not support complex64 tensors."})})}function md(t,e,n,r){if("linear"===n)return t.linear(e);if("relu"===n)return t.relu(e);if("elu"===n)return t.elu(e);if("relu6"===n)return t.relu6(e);if("prelu"===n)return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var vd=function(t){function e(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new ni(e,rn),e}return Nt(e,t),e.prototype.write=function(t,e,n){this.firstUse&&(this.firstUse=!1,Ot().get("IS_NODE")&&dr("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:t,dtype:n}),r},e.prototype.move=function(t,e,n,r){this.data.set(t,{values:e,dtype:r})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return _t(this,void 0,void 0,function(){return Pt(this,function(e){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var e=this.data.get(t),n=e.dtype,r=e.complexTensors;return"complex64"===n?Ai(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),n=e;if("string"===t.dtype)try{n=e.map(function(t){return Te(t)})}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return uo(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,e,n){var r=this.write(t,e,n);return rn.makeTensorFromDataId(r,e,n,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return _t(this,void 0,void 0,function(){var e;return Pt(this,function(n){return e=Se(),t(),[2,{kernelMs:Se()-e}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,e){var n=this.makeOutput(null,t.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:rn.keep(t.clone()),imag:rn.keep(e.clone())},n},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(gd(t,"slice"),Yo(t.shape,e,n)){var r=Zo(e,t.strides),o=Yt(n);return _r(this.readSync(t.dataId).subarray(r,r+o),n,t.dtype)}for(var i=uo(n,t.dtype),a=this.bufferSync(t),s=0;s<i.size;++s){var u=i.indexToLoc(s).map(function(t,n){return t+e[n]});i.values[s]=a.get.apply(a,u)}return i.toTensor()},e.prototype.stridedSlice=function(t,e,n,r){gd(t,"stridedSlice");var o=Qo(e,n,r);if(o.some(function(t){return 0===t}))return _r([],o);for(var i=uo(o,t.dtype),a=this.bufferSync(t),s=0;s<i.size;s++){for(var u=i.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+e[l];i.set.apply(i,[a.get.apply(a,c)].concat(u))}return i.toTensor()},e.prototype.diag=function(t){for(var e=this.readSync(t.dataId),n=uo([t.size,t.size],t.dtype),r=n.values,o=0;o<e.length;o++)r[o*t.size+o]=e[o];return n.toTensor()},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,i=0;i<t.rank;i++)i!==e&&(r[o++]=t.shape[i]);var a=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(i=0;i<u.length;i++)a[e]=i,u[i]=this.slice(t,a,s).reshape(r);return u},e.prototype.reverse=function(t,e){gd(t,"reverse");for(var n=uo(t.shape,t.dtype),r=this.bufferSync(t),o=function(o){var i=n.indexToLoc(o),a=i.slice();e.forEach(function(e){return a[e]=t.shape[e]-1-a[e]}),n.set.apply(n,[r.get.apply(r,a)].concat(i))},i=0;i<n.size;i++)o(i);return n.toTensor()},e.prototype.concat=function(t,e){var n=this;if("complex64"===t[0].dtype){var r=t.map(function(t){return Tr(t)}),o=t.map(function(t){return Nr(t)});return Rr(this.concat(r,e),this.concat(o,e))}var i=t.map(function(t){var n=Yt(t.shape.slice(e));return t.as2D(-1,n)}),a=Sr(i.map(function(t){return t.shape}),1),s=uo(a,t[0].dtype).values;if(1===i[0].shape[0]){var u=0;i.forEach(function(t){s.set(n.readSync(t.dataId),u),u+=t.size})}else{var c=0;i.forEach(function(t){for(var e=n.readSync(t.dataId),r=0,o=0;o<t.shape[0];++o)for(var i=o*a[1]+c,u=0;u<t.shape[1];++u)s[i+u]=e[r++];c+=t.shape[1]})}var l=Sr(t.map(function(t){return t.shape}),e);return _r(s,l,t[0].dtype)},e.prototype.neg=function(t){return gd(t,"neg"),this.multiply(Dr(-1),t)},e.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t+n,imag:e+r}}):this.broadcastedBinaryOp(t,e,Xe(t.dtype,e.dtype),function(t,e){return t+e})},e.prototype.addN=function(t){var e=this;gd(t,"addN");for(var n=t.map(function(t){return e.readSync(t.dataId)}),r=uo(t[0].shape,t[0].dtype),o=r.values,i=0;i<t.length;i++)for(var a=n[i],s=0;s<o.length;s++)o[s]+=a[s];return r.toTensor()},e.prototype.softmax=function(t,e){var n=ie([e],t.shape),r=this.max(t,n),o=wr(r.shape,n),i=this.subtract(t,r.reshape(o)),a=this.exp(i),s=this.sum(a,n).reshape(o);return this.realDivide(a,s)},e.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t-n,imag:e-r}}):this.broadcastedBinaryOp(t,e,Xe(t.dtype,e.dtype),function(t,e){return t-e})},e.prototype.pow=function(t,e){return gd([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.pow(t,e)})},e.prototype.batchMatMul=function(t,e,n,r){gd([t,e],"matMul");for(var o=n?t.shape[1]:t.shape[2],i=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],s=t.shape[0],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=l[0],d=l[1],f=l[2],p=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],g=p[0],m=p[1],v=p[2],y=i*a,b=uo([s,i,a],t.dtype),w=b.values,x=this.blockSize,E=0;E<s;E++)for(var A=0;A<i;A+=x)for(var C=0;C<a;C+=x)for(var k=0;k<o;k+=x)for(var S=Math.min(A+x,i),I=Math.min(C+x,a),R=Math.min(k+x,o),T=A;T<S;T++)for(var N=C;N<I;N++){for(var _=0,P=k;P<R;P++)_+=u[E*h+T*d+P*f]*c[P*g+N*m+E*v];w[E*y+(T*a+N)]+=_}return b.toTensor()},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,o=t.transposeB,i=t.bias,a=t.activation,s=t.preluActivationWeights,u=this.batchMatMul(e,n,r,o);return i&&(u=this.add(u,i)),a&&(u=md(this,u,a,s)),u},e.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}}):this.broadcastedBinaryOp(t,e,Xe(t.dtype,e.dtype),function(t,e){return t*e})},e.prototype.realDivide=function(t,e){return gd([t,e],"realDivide"),this.broadcastedBinaryOp(t,e,"float32",function(t,e){return t/e})},e.prototype.floorDiv=function(t,e){return gd([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",function(t,e){return Math.floor(t/e)})},e.prototype.sum=function(t,e){gd(t,"sum"),xr("sum",e,t.rank);for(var n=br(t.shape,e),r=n[0],o=n[1],i=Ur(r,Xe(t.dtype,"int32")),a=Yt(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=0,d=0;d<a;++d)h+=u[l+d];s[c]=h}return i},e.prototype.prod=function(t,e){gd(t,"sum");for(var n=br(t.shape,e),r=n[0],o=n[1],i=Ur(r,Xe(t.dtype,"int32")),a=Yt(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=1,d=0;d<a;++d)h*=u[l+d];s[c]=h}return i},e.prototype.unsortedSegmentSum=function(t,e,n){gd(t,"unsortedSegmentSum");for(var r=[],o=t.rank-e.rank,i=0;i<o;++i)e=e.expandDims(i+1);for(i=0;i<n;++i){var a=Dr(i,"int32"),s=$c(a,e).asType("float32").mul(t).sum(0);r.push(s)}return Po(r)},e.prototype.argMin=function(t,e){gd(t,"argMin");var n=[e];xr("argMin",n,t.rank);for(var r=br(t.shape,n),o=r[0],i=r[1],a=Ur(o,"int32"),s=Yt(i),u=this.readSync(a.dataId),c=this.readSync(t.dataId),l=0;l<u.length;++l){for(var h=l*s,d=c[h],f=0,p=0;p<s;++p){var g=c[h+p];g<d&&(d=g,f=p)}u[l]=f}return a},e.prototype.argMax=function(t,e){gd(t,"argMax");var n=[e];xr("argMax",n,t.rank);for(var r=br(t.shape,n),o=r[0],i=r[1],a=Ur(o,"int32"),s=Yt(i),u=this.readSync(a.dataId),c=this.readSync(t.dataId),l=0;l<u.length;++l){for(var h=l*s,d=c[h],f=0,p=0;p<s;++p){var g=c[h+p];g>d&&(d=g,f=p)}u[l]=f}return a},e.prototype.cumsum=function(t,e,n,r){if(gd(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=Xe(t.dtype,"int32"),i=Ur(t.shape,o),a=this.readSync(i.dataId),s=this.readSync(t.dataId),u=t.shape[t.rank-1],c=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var d=c(l,h);if(0===h)a[d]=n?0:s[d];else{var f=c(l,h-1);a[d]=n?s[f]+a[f]:s[d]+a[f]}}return i},e.prototype.equal=function(t,e){return gd([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t===e?1:0})},e.prototype.notEqual=function(t,e){return gd([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t!==e?1:0})},e.prototype.less=function(t,e){return gd([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<e?1:0})},e.prototype.lessEqual=function(t,e){return gd([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t<=e?1:0})},e.prototype.greater=function(t,e){return gd([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>e?1:0})},e.prototype.greaterEqual=function(t,e){return gd([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t>=e?1:0})},e.prototype.logicalNot=function(t){gd(t,"logicalNot");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return this.makeOutput(n,t.shape,"bool")},e.prototype.logicalAnd=function(t,e){return gd([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t&&e})},e.prototype.logicalOr=function(t,e){return gd([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",function(t,e){return t||e})},e.prototype.select=function(t,e,n){gd([t,e,n],"select");for(var r=this.readSync(t.dataId),o=this.readSync(e.dataId),i=this.readSync(n.dataId),a=Ur(e.shape,Xe(e.dtype,n.dtype)),s=this.readSync(a.dataId),u=0,c=0===t.rank||t.rank>1||1===e.rank?1:Yt(e.shape.slice(1)),l=0;l<r.length;l++)for(var h=0;h<c;h++)1===r[l]?s[u++]=o[l]:s[u++]=i[l];return a},e.prototype.where=function(t){gd([t],"where");var e=this.readSync(t.dataId);return Li(t.shape,e)},e.prototype.topk=function(t,e,n){return gd(t,"topk"),Bi(this.readSync(t.dataId),t.shape,t.dtype,e)},e.prototype.min=function(t,e){gd(t,"min"),xr("min",e,t.rank);for(var n=br(t.shape,e),r=n[0],o=n[1],i=Ur(r,t.dtype),a=Yt(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var f=u[l+d];f<h&&(h=f)}s[c]=h}return i},e.prototype.minimum=function(t,e){return gd([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.min(t,e)})},e.prototype.mod=function(t,e){return gd([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})},e.prototype.max=function(t,e){gd(t,"max"),xr("max",e,t.rank);for(var n=br(t.shape,e),r=n[0],o=n[1],i=Ur(r,t.dtype),a=Yt(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var f=u[l+d];f>h&&(h=f)}s[c]=h}return i},e.prototype.maximum=function(t,e){return gd([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.max(t,e)})},e.prototype.all=function(t,e){gd(t,"all"),xr("all",e,t.rank);for(var n=br(t.shape,e),r=n[0],o=n[1],i=Ur(r,t.dtype),a=Yt(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var f=u[l+d];h=h&&f}s[c]=h}return i},e.prototype.any=function(t,e){gd(t,"any"),xr("any",e,t.rank);for(var n=br(t.shape,e),r=n[0],o=n[1],i=Ur(r,t.dtype),a=Yt(o),s=this.readSync(i.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],d=0;d<a;++d){var f=u[l+d];h=h||f}s[c]=h}return i},e.prototype.squaredDifference=function(t,e){return gd([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){var n=t-e;return n*n})},e.prototype.ceil=function(t){gd(t,"ceil");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.floor=function(t){gd(t,"floor");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.sign=function(t){gd(t,"x");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)e[r]<0?n[r]=-1:e[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,t.shape,"float32")},e.prototype.isNaN=function(t){gd(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isInf=function(t){gd(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isFinite=function(t){gd(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.round=function(t){gd(t,"round");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=Math.floor(e[r]);e[r]-o<.5?n[r]=Math.floor(e[r]):e[r]-o>.5?n[r]=Math.ceil(e[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,t.shape,"float32")},e.prototype.exp=function(t){gd(t,"exp");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.expm1=function(t){gd(t,"expm1");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.log=function(t){gd(t,"log");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.log(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.log1p=function(t){gd(t,"log1p");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.log1p(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.sqrt=function(t){gd(t,"sqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.rsqrt=function(t){gd(t,"rsqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.reciprocal=function(t){gd(t,"reciprocal");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return this.makeOutput(n,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){gd(t,"relu");for(var e=Ur(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return e},e.prototype.relu6=function(t){gd(t,"relu");for(var e=Ur(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return e},e.prototype.prelu=function(t,e){return gd([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return t<0?e*t:t})},e.prototype.elu=function(t){gd(t,"elu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(e,t.shape,"float32")},e.prototype.eluDer=function(t,e){gd([t,e],"eluDer");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=this.readSync(t.dataId),i=0;i<r.length;++i){var a=r[i];n[i]=a>=1?o[i]:o[i]*(a+1)}return this.makeOutput(n,e.shape,"float32")},e.prototype.selu=function(t){gd(t,"selu");for(var e=Zs,n=$s,r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>=0?n*a:e*(Math.exp(a)-1)}return this.makeOutput(r,t.shape,"float32")},e.prototype.clip=function(t,e,n){gd(t,"clip");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),i=0;i<o.length;++i){var a=o[i];r[i]=a>n?n:a<e?e:a}return this.makeOutput(r,t.shape,"float32")},e.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<t.size;++r){var o=n[2*r],i=n[2*r+1];e[r]=Math.hypot(o,i)}return this.makeOutput(e,t.shape,"float32")},e.prototype.int=function(t){gd(t,"int");for(var e=new Int32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=n[r];return this.makeOutput(e,t.shape,"int32")},e.prototype.sigmoid=function(t){gd(t,"sigmoid");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(e,t.shape,"float32")},e.prototype.softplus=function(t){gd(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var i,a=r[o]>-e,s=r[o]<e,u=Math.exp(r[o]);i=s?u:a?r[o]:Math.log(1+u),n[o]=i}return this.makeOutput(n,t.shape,"float32")},e.prototype.sin=function(t){gd(t,"sin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cos=function(t){gd(t,"cos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tan=function(t){gd(t,"tan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asin=function(t){gd(t,"asin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acos=function(t){gd(t,"acos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan=function(t){gd(t,"atan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan2=function(t,e){return gd([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,function(t,e){return Math.atan2(t,e)})},e.prototype.sinh=function(t){gd(t,"sinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cosh=function(t){gd(t,"cosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tanh=function(t){gd(t,"tanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=te(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asinh=function(t){gd(t,"asinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acosh=function(t){gd(t,"acosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atanh=function(t){gd(t,"atanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.erf=function(t){gd(t,"erf");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),i=Math.abs(n[r]),a=1/(1+.3275911*i);e[r]=o*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-i*i))}return this.makeOutput(e,t.shape,"float32")},e.prototype.step=function(t,e){void 0===e&&(e=0),gd(t,"step");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var i=r[o];isNaN(i)?n[o]=NaN:n[o]=i>0?1:e}return this.makeOutput(n,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,i=t.activation,a=t.preluActivationWeights,s=this.conv2d(e,n,r);return o&&(s=this.add(s,o)),i&&(s=md(this,s,i,a)),s},e.prototype.conv2d=function(t,e,n){gd([t,e],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=uo(n.outShape,t.dtype),h=t.strides[0],d=c?t.strides[1]:t.strides[2],f=c?t.strides[2]:1,p=c?1:t.strides[1],g=l.strides[0],m=c?l.strides[1]:l.strides[2],v=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(t.dataId),w=this.readSync(e.dataId),x=l.values,E=0;E<n.batchSize;++E)for(var A=E*h,C=E*g,k=0;k<n.outHeight;++k)for(var S=C+k*m,I=k*n.strideHeight-u,R=0;R<r;R++){var T=I+R*i;if(!(T<0||T>=n.inHeight))for(var N=R*e.strides[0],_=A+T*d,P=0;P<n.outWidth;++P)for(var D=S+P*v,O=P*n.strideWidth-s,F=0;F<o;F++){var M=O+F*a;if(!(M<0||M>=n.inWidth))for(var B=_+M*f,L=N+F*e.strides[1],U=0;U<n.inChannels;++U){for(var W=b[B+U*p],z=0;z<n.outChannels;++z)x[D+z*y]+=W*w[L+z];L+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,o=n.filterHeight,i=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,h=n.padInfo.top,d=uo(n.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(e.dataId),g=d.values,m=0;m<n.batchSize;++m)for(var v=m*t.strides[0],y=m*d.strides[0],b=0;b<n.outDepth;++b)for(var w=y+b*d.strides[1],x=b*n.strideDepth-c,E=0;E<r;E++){var A=x+E*a;if(!(A<0||A>=n.inDepth))for(var C=E*e.strides[0],k=v+A*t.strides[1],S=0;S<n.outHeight;++S)for(var I=w+S*d.strides[2],R=S*n.strideHeight-h,T=0;T<o;T++){var N=R+T*s;if(!(N<0||N>=n.inHeight))for(var _=C+T*e.strides[1],P=k+N*t.strides[2],D=0;D<n.outWidth;++D)for(var O=I+D*n.outChannels,F=D*n.strideWidth-l,M=0;M<i;M++){var B=F+M*u;if(!(B<0||B>=n.inWidth))for(var L=_+M*e.strides[2],U=P+B*n.inChannels,W=L,z=0;z<n.inChannels;++z){for(var V=f[U+z],j=0;j<n.outChannels;++j)g[O+j]+=V*p[W+j];W+=n.outChannels}}}}return d.toTensor()},e.prototype.conv2dDerInput=function(t,e,n){gd([t,e],"conv2dDerInput");for(var r=uo(n.inShape,"float32"),o=r.values,i=this.readSync(t.dataId),a=this.readSync(e.dataId),s=e.strides,u=s[0],c=s[1],l=s[2],h=n.batchSize,d=n.filterHeight,f=n.filterWidth,p=n.inChannels,g=n.inHeight,m=n.inWidth,v=n.outChannels,y=n.outHeight,b=n.outWidth,w=n.strideHeight,x=n.strideWidth,E=n.dataFormat,A=d-1-n.padInfo.top,C=f-1-n.padInfo.left,k="channelsLast"===E,S=r.strides[0],I=k?r.strides[1]:r.strides[2],R=k?r.strides[2]:1,T=k?1:r.strides[1],N=t.strides[0],_=k?t.strides[1]:t.strides[2],P=k?t.strides[2]:1,D=k?1:t.strides[1],O=0;O<h;++O)for(var F=0;F<p;++F)for(var M=0;M<g;++M)for(var B=M-A,L=Math.max(0,Math.ceil(B/w)),U=Math.min(y,(d+B)/w),W=0;W<m;++W){for(var z=W-C,V=Math.max(0,Math.ceil(z/x)),j=Math.min(b,(f+z)/x),G=0,H=L;H<U;++H)for(var q=H*w-B,K=V;K<j;++K)for(var Q=N*O+_*H+P*K,X=u*(d-1-q)+c*(f-1-(K*x-z))+l*F,J=0;J<v;++J)G+=i[Q+D*J]*a[X+J];o[S*O+I*M+R*W+T*F]=G}return r.toTensor()},e.prototype.conv3dDerInput=function(t,e,n){for(var r=uo(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=i[3],l=this.readSync(t.dataId),h=t.strides,d=h[0],f=h[1],p=h[2],g=h[3],m=this.readSync(e.dataId),v=e.strides,y=v[0],b=v[1],w=v[2],x=v[3],E=n.batchSize,A=n.filterDepth,C=n.filterHeight,k=n.filterWidth,S=n.inChannels,I=n.inDepth,R=n.inHeight,T=n.inWidth,N=n.outChannels,_=n.outDepth,P=n.outHeight,D=n.outWidth,O=n.strideDepth,F=n.strideHeight,M=n.strideWidth,B=A-1-n.padInfo.front,L=C-1-n.padInfo.top,U=k-1-n.padInfo.left,W=0;W<E;++W)for(var z=0;z<S;++z)for(var V=0;V<I;++V)for(var j=V-B,G=Math.max(0,Math.ceil(j/O)),H=Math.min(_,(A+j)/O),q=0;q<R;++q)for(var K=q-L,Q=Math.max(0,Math.ceil(K/F)),X=Math.min(P,(C+K)/F),J=0;J<T;++J){for(var Y=J-U,Z=Math.max(0,Math.ceil(Y/M)),$=Math.min(D,(k+Y)/M),tt=0,et=G;et<H;++et)for(var nt=et*O-j,rt=Q;rt<X;++rt)for(var ot=rt*F-K,it=Z;it<$;++it)for(var at=d*W+f*et+p*rt+g*it,st=y*(A-1-nt)+b*(C-1-ot)+w*(k-1-(it*M-Y))+x*z,ut=0;ut<N;++ut)tt+=l[at+ut]*m[st+ut];o[a*W+s*V+u*q+c*J+z]=tt}return r.toTensor()},e.prototype.conv2dDerFilter=function(t,e,n){gd([t,e],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s="channelsLast"===n.dataFormat,u=uo(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,h=this.bufferSync(t),d=this.bufferSync(e),f=0;f<i;++f)for(var p=Math.max(0,Math.ceil((l-f)/r)),g=Math.min(n.outHeight,(n.inHeight+l-f)/r),m=0;m<a;++m)for(var v=Math.max(0,Math.ceil((c-m)/o)),y=Math.min(n.outWidth,(n.inWidth+c-m)/o),b=0;b<n.inChannels;++b)for(var w=0;w<n.outChannels;++w){for(var x=0,E=0;E<n.batchSize;++E)for(var A=p;A<g;++A)for(var C=f+A*r-l,k=v;k<y;++k){var S=m+k*o-c;x+=s?h.get(E,C,S,b)*d.get(E,A,k,w):h.get(E,b,C,S)*d.get(E,w,A,k)}u.set(x,f,m,b,w)}return u.toTensor()},e.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=uo(n.filterShape,"float32"),l=c.values,h=c.strides,d=h[0],f=h[1],p=h[2],g=h[3],m=this.readSync(e.dataId),v=e.strides,y=v[0],b=v[1],w=v[2],x=v[3],E=this.readSync(t.dataId),A=t.strides,C=A[0],k=A[1],S=A[2],I=A[3],R=n.padInfo.front,T=n.padInfo.left,N=n.padInfo.top,_=0;_<a;++_)for(var P=Math.max(0,Math.ceil((R-_)/r)),D=Math.min(n.outDepth,(n.inDepth+R-_)/r),O=_*d,F=0;F<s;++F)for(var M=Math.max(0,Math.ceil((N-F)/o)),B=Math.min(n.outHeight,(n.inHeight+N-F)/o),L=F*f+O,U=0;U<u;++U)for(var W=Math.max(0,Math.ceil((T-U)/i)),z=Math.min(n.outWidth,(n.inWidth+T-U)/i),V=U*p+L,j=0;j<n.inChannels;++j)for(var G=j*g+V,H=0;H<n.outChannels;++H){for(var q=0,K=0;K<n.batchSize;++K)for(var Q=K*C,X=K*y,J=P;J<D;++J)for(var Y=(_+J*r-R)*k+Q,Z=J*b+X,$=M;$<B;++$)for(var tt=(F+$*o-N)*S+Y,et=$*w+Z,nt=W;nt<z;++nt){var rt=nt*x+et;q+=E[(U+nt*i-T)*I+tt+j]*m[rt+H]}l[G+H]=q}return c.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,i=t.activation,a=t.preluActivationWeights,s=this.depthwiseConv2D(e,n,r);return o&&(s=this.add(s,o)),i&&(s=md(this,s,i,a)),s},e.prototype.depthwiseConv2D=function(t,e,n){gd([t,e],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,i=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=uo(n.outShape,t.dtype),h=this.readSync(t.dataId),d=this.readSync(e.dataId),f=l.values,p=0;p<n.batchSize;++p)for(var g=p*t.strides[0],m=p*l.strides[0],v=0;v<n.outHeight;++v)for(var y=m+v*l.strides[1],b=v*n.strideHeight-s,w=0;w<r;++w){var x=b+w*i;if(!(x<0||x>=n.inHeight))for(var E=w*e.strides[0],A=g+x*t.strides[1],C=0;C<n.outWidth;++C)for(var k=y+C*l.strides[2],S=C*n.strideWidth-u,I=0;I<o;++I){var R=S+I*a;if(!(R<0||R>=n.inWidth))for(var T=E+I*e.strides[1],N=A+R*n.inChannels,_=k,P=T,D=0;D<n.inChannels;++D){for(var O=h[N+D],F=0;F<c;++F)f[_+F]+=O*d[P+F];_+=c,P+=c}}}return l.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,e,n){gd([t,e],"depthwiseConv2DDerInput");for(var r=uo(n.inShape,"float32"),o=r.values,i=r.strides,a=i[0],s=i[1],u=i[2],c=this.readSync(t.dataId),l=t.strides,h=l[0],d=l[1],f=l[2],p=this.readSync(e.dataId),g=e.strides,m=g[0],v=g[1],y=g[2],b=n.batchSize,w=n.filterHeight,x=n.filterWidth,E=n.inChannels,A=n.inHeight,C=n.inWidth,k=n.outChannels,S=n.outHeight,I=n.outWidth,R=n.strideHeight,T=n.strideWidth,N=w-1-n.padInfo.top,_=x-1-n.padInfo.left,P=k/E,D=0;D<b;++D)for(var O=0;O<E;++O)for(var F=0;F<A;++F)for(var M=F-N,B=Math.max(0,Math.ceil(M/R)),L=Math.min(S,(w+M)/R),U=0;U<C;++U){for(var W=U-_,z=Math.max(0,Math.ceil(W/T)),V=Math.min(I,(x+W)/T),j=0,G=B;G<L;++G)for(var H=G*R-M,q=z;q<V;++q)for(var K=h*D+d*G+f*q,Q=m*(w-1-H)+v*(x-1-(q*T-W))+y*O,X=0;X<P;++X)j+=c[K+(O*P+X)]*p[Q+X];o[a*D+s*F+u*U+O]=j}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){gd([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=uo(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,h=this.bufferSync(t),d=this.bufferSync(e),f=0;f<i;++f)for(var p=Math.max(0,Math.ceil((c-f)/r)),g=Math.min(n.outHeight,(n.inHeight+c-f)/r),m=0;m<a;++m)for(var v=Math.max(0,Math.ceil((u-m)/o)),y=Math.min(n.outWidth,(n.inWidth+u-m)/o),b=0;b<n.outChannels;++b){for(var w=Math.trunc(b/l),x=b%l,E=0,A=0;A<n.batchSize;++A)for(var C=p;C<g;++C)for(var k=f+C*r-c,S=v;S<y;++S){var I=m+S*o-u;E+=h.get(A,k,I,w)*d.get(A,C,S,b)}s.set(E,f,m,w,x)}return s.toTensor()},e.prototype.tile=function(t,e){return gd(t,"tile"),Mi(this.bufferSync(t),e)},e.prototype.pad=function(t,e,n){gd(t,"pad");var r=e.map(function(e,n){return e[0]+t.shape[n]+e[1]}),o=e.map(function(t){return t[0]}),i=this.bufferSync(t),a=uo(r,t.dtype);0!==n&&a.values.fill(n);for(var s=0;s<t.size;s++){var u=i.indexToLoc(s),c=u.map(function(t,e){return t+o[e]});a.set.apply(a,[i.get.apply(i,u)].concat(c))}return a.toTensor()},e.prototype.transpose=function(t,e){gd(t,"transpose");for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[e[r]];var o=this.readSync(t.dataId),i=uo(n,t.dtype),a=this.bufferSync(t);for(r=0;r<t.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[e[c]];var l=i.locToIndex(u);i.values[l]=o[r]}return i.toTensor()},e.prototype.gather=function(t,e,n){gd([t,e],"gather");var r=t.shape.slice(),o=this.readSync(e.dataId);r[n]=o.length;for(var i=uo(r,t.dtype),a=this.bufferSync(t),s=0;s<i.size;++s){var u=i.indexToLoc(s),c=u.slice();c[n]=o[u[n]];var l=a.locToIndex(c);i.values[s]=a.values[l]}return i.toTensor()},e.prototype.batchToSpaceND=function(t,e,n){gd([t],"batchToSpaceND");var r=e.reduce(function(t,e){return t*e}),o=Mo(t.shape,e,r),i=Bo(o.length,e.length),a=Lo(t.shape,e,r),s=Uo(n,e.length),u=Wo(a,n,e.length);return t.reshape(o).transpose(i).reshape(a).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){gd([t],"spaceToBatchND");var r=e.reduce(function(t,e){return t*e}),o=[[0,0]];o.push.apply(o,n);for(var i=1+e.length;i<t.shape.length;++i)o.push([0,0]);var a=t.pad(o),s=Mo(a.shape,e,r,!1),u=Bo(s.length,e.length,!1),c=Lo(a.shape,e,r,!1);return a.reshape(s).transpose(u).reshape(c)},e.prototype.pool=function(t,e,n){gd(t,"pool");for(var r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,d=this.readSync(t.dataId),f=uo(e.outShape,t.dtype),p=f.values,g=e.outShape[1]*e.outShape[2]*e.outShape[3],m=e.outShape[2]*e.outShape[3],v=e.outShape[3],y=0;y<e.batchSize;++y)for(var b=y*g,w=y*t.strides[0],x=0;x<e.inChannels;++x)for(var E=0;E<e.outHeight;++E)for(var A=E*r-c,C=Math.max(0,A),k=Math.min(e.inHeight,s+A),S=b+E*m,I=0;I<e.outWidth;++I){for(var R=I*o-l,T=Math.max(0,R),N=Math.min(e.inWidth,u+R),_=h,P=0,D=0,O=C;O<k;O+=i){for(var F=w+O*t.strides[1],M=T;M<N;M+=a){var B=d[F+M*t.strides[2]+x];"max"===n&&B>_?_=B:"avg"===n&&(P+=B,D++)}if(isNaN(_))break}p[S+I*v+x]="avg"===n?P/D:_}return f.toTensor()},e.prototype.maxPool=function(t,e){return this.pool(t,e,"max")},e.prototype.maxPoolPositions=function(t,e){for(var n=uo(e.outShape,"int32"),r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,s=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=e.padInfo.top,l=e.padInfo.left,h=this.bufferSync(t),d=0;d<e.batchSize;++d)for(var f=0;f<e.inChannels;++f)for(var p=0;p<e.outHeight;++p){for(var g=p*r-c,m=g;m<0;)m+=i;for(var v=Math.min(e.inHeight,s+g),y=0;y<e.outWidth;++y){for(var b=y*o-l,w=b;w<0;)w+=a;for(var x=Math.min(e.inWidth,u+b),E=Number.NEGATIVE_INFINITY,A=-1,C=m;C<v;C+=i)for(var k=C-g,S=w;S<x;S+=a){var I=S-b,R=h.get(d,C,S,f);R>E&&(E=R,A=k*u+I)}n.set(A,d,p,y,f)}}return n.toTensor()},e.prototype.maxPoolBackprop=function(t,e,n,r){gd([e,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(e,r),i=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=l-1-r.padInfo.left,d=c-1-r.padInfo.top,f=uo(e.shape,"float32"),p=this.bufferSync(o),g=this.bufferSync(t),m=0;m<r.batchSize;++m)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var w=y-d,x=b-h,E=0,A=0;A<c;A+=s){var C=(w+A)/i;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var k=0;k<l;k+=u){var S=(x+k)/a;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var I=c*l-1-p.get(m,C,S,v)===A*l+k?1:0;0!==I&&(E+=g.get(m,C,S,v)*I)}}}f.set(E,m,y,b,v)}return f.toTensor()},e.prototype.avgPoolBackprop=function(t,e,n){gd([t,e],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,i=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=l-1-n.padInfo.left,d=c-1-n.padInfo.top,f=uo(e.shape,"float32"),p=1/(i*a),g=this.bufferSync(t),m=0;m<n.batchSize;++m)for(var v=0;v<n.inChannels;++v)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var w=y-d,x=b-h,E=0,A=0;A<c;A+=s){var C=(w+A)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var k=0;k<l;k+=u){var S=(x+k)/o;S<0||S>=n.outWidth||Math.floor(S)!==S||(E+=g.get(m,C,S,v))}}f.set(E*p,m,y,b,v)}return f.toTensor()},e.prototype.pool3d=function(t,e,n){gd(t,"pool3d");for(var r=e.strideDepth,o=e.strideHeight,i=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left,g="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(t.dataId),v=uo(e.outShape,t.dtype),y=v.values,b=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],w=e.outShape[2]*e.outShape[3]*e.outShape[4],x=e.outShape[3]*e.outShape[4],E=e.outShape[4],A=0;A<e.batchSize;++A)for(var C=A*b,k=A*t.strides[0],S=0;S<e.inChannels;++S)for(var I=0;I<e.outDepth;++I){for(var R=I*r-d,T=R;T<0;)T+=a;for(var N=Math.min(e.inDepth,c+R),_=C+I*w,P=0;P<e.outHeight;++P){for(var D=P*o-f,O=D;O<0;)O+=s;for(var F=Math.min(e.inHeight,l+D),M=_+P*x,B=0;B<e.outWidth;++B){for(var L=B*i-p,U=L;U<0;)U+=u;for(var W=Math.min(e.inWidth,h+L),z=M+B*E,V=g,j=0,G=0,H=T;H<N;H+=a){for(var q=k+H*t.strides[1],K=O;K<F;K+=s){for(var Q=q+K*t.strides[2],X=U;X<W;X+=u){var J=m[Q+X*t.strides[3]+S];if("max"===n&&J>V?V=J:"avg"===n&&(j+=J,G++),isNaN(V))break}if(isNaN(V))break}if(isNaN(V))break}y[z+S]="avg"===n?j/G:V}}}return v.toTensor()},e.prototype.avgPool3d=function(t,e){return gd(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,e,n){gd([t,e],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,g=d-1-n.padInfo.front,m=p-1-n.padInfo.left,v=f-1-n.padInfo.top,y=uo(e.shape,"float32"),b=1/(a*s*u),w=this.bufferSync(t),x=0;x<n.batchSize;++x)for(var E=0;E<n.inChannels;++E)for(var A=0;A<n.inDepth;++A)for(var C=0;C<n.inHeight;++C)for(var k=0;k<n.inWidth;++k){for(var S=A-g,I=C-v,R=k-m,T=0,N=0;N<d;N+=c){var _=(S+N)/r;if(!(_<0||_>=n.outDepth||Math.floor(_)!==_))for(var P=0;P<f;P+=l){var D=(I+P)/o;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var O=0;O<p;O+=h){var F=(R+O)/i;F<0||F>=n.outWidth||Math.floor(F)!==F||(T+=w.get(x,_,D,F,E))}}}y.set(T*b,x,A,C,k,E)}return y.toTensor()},e.prototype.maxPool3d=function(t,e){return gd(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,e){for(var n=uo(e.outShape,"int32"),r=e.strideDepth,o=e.strideHeight,i=e.strideWidth,a=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left,g=this.bufferSync(t),m=0;m<e.batchSize;++m)for(var v=0;v<e.inChannels;++v)for(var y=0;y<e.outDepth;++y){for(var b=y*r-d,w=b;w<0;)w+=a;for(var x=Math.min(e.inDepth,c+b),E=0;E<e.outHeight;++E){for(var A=E*o-f,C=A;C<0;)C+=s;for(var k=Math.min(e.inHeight,l+A),S=0;S<e.outWidth;++S){for(var I=S*i-p,R=I;R<0;)R+=u;for(var T=Math.min(e.inWidth,h+I),N=Number.NEGATIVE_INFINITY,_=-1,P=w;P<x;P+=a)for(var D=P-b,O=C;O<k;O+=s)for(var F=O-A,M=R;M<T;M+=u){var B=M-I,L=g.get(m,P,O,M,v);L>=N&&(N=L,_=D*l*h+F*l+B)}n.set(_,m,y,E,S,v)}}}return n.toTensor()},e.prototype.maxPool3dBackprop=function(t,e,n,r){gd([e,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(e,r),i=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=h-1-r.padInfo.front,g=f-1-r.padInfo.left,m=d-1-r.padInfo.top,v=uo(e.shape,"float32"),y=this.bufferSync(o),b=this.bufferSync(t),w=0;w<r.batchSize;++w)for(var x=0;x<r.inChannels;++x)for(var E=0;E<r.inDepth;++E)for(var A=0;A<r.inHeight;++A)for(var C=0;C<r.inWidth;++C){for(var k=E-p,S=A-m,I=C-g,R=0,T=0;T<h;T+=u){var N=(k+T)/i;if(!(N<0||N>=r.outDepth||Math.floor(N)!==N))for(var _=0;_<d;_+=c){var P=(S+_)/a;if(!(P<0||P>=r.outHeight||Math.floor(P)!==P))for(var D=0;D<f;D+=l){var O=(I+D)/s;if(!(O<0||O>=r.outWidth||Math.floor(O)!==O)){var F=h*d*f-1-y.get(w,N,P,O,x)===T*d*f+_*f+D?1:0;0!==F&&(R+=b.get(w,N,P,O,x)*F)}}}}v.set(R,w,E,A,C,x)}return v.toTensor()},e.prototype.cast=function(t,e){return wi(t,e,this)},e.prototype.reshape=function(t,e){return xi(t,e)},e.prototype.avgPool=function(t,e){return gd(t,"avgPool"),this.pool(t,e,"avg").toFloat()},e.prototype.resizeBilinear=function(t,e,n,r){gd(t,"resizeBilinear");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=this.readSync(t.dataId),l=new Float32Array(Yt([i,e,n,u])),h=[r&&e>1?a-1:a,r&&n>1?s-1:s],d=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=0,p=h[0]/d[0],g=h[1]/d[1],m=0;m<i;m++)for(var v=0;v<e;v++)for(var y=p*v,b=Math.floor(y),w=y-b,x=Math.min(a-1,Math.ceil(y)),E=m*t.strides[0]+b*t.strides[1],A=m*t.strides[0]+x*t.strides[1],C=0;C<n;C++)for(var k=g*C,S=Math.floor(k),I=k-S,R=Math.min(s-1,Math.ceil(k)),T=E+S*t.strides[2],N=A+S*t.strides[2],_=E+R*t.strides[2],P=A+R*t.strides[2],D=0;D<u;D++){var O=c[T+D],F=c[N+D],M=O+(c[_+D]-O)*I,B=M+(F+(c[P+D]-F)*I-M)*w;l[f++]=B}return _r(l,[i,e,n,u])},e.prototype.resizeBilinearBackprop=function(t,e,n){gd([t,e],"resizeBilinearBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(o*i*a*s),d=[n&&c>1?i-1:i,n&&l>1?a-1:a],f=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=d[0]/f[0],g=d[1]/f[1],m=this.readSync(t.dataId),v=0,y=0;y<o;y++)for(var b=y*e.strides[0],w=0;w<c;w++)for(var x=w*p,E=Math.floor(x),A=Math.min(Math.ceil(x),i-1),C=b+E*e.strides[1],k=b+A*e.strides[1],S=x-E,I=1-S,R=0;R<l;R++)for(var T=R*g,N=Math.floor(T),_=Math.min(Math.ceil(T),a-1),P=T-N,D=1-P,O=C+N*e.strides[2],F=C+_*e.strides[2],M=k+N*e.strides[2],B=k+_*e.strides[2],L=I*D,U=I*P,W=S*D,z=S*P,V=0;V<s;V++){var j=m[v++];h[O+V]+=j*L,h[F+V]+=j*U,h[M+V]+=j*W,h[B+V]+=j*z}return Br(h,[o,a,i,s],e.dtype)},e.prototype.resizeNearestNeighbor=function(t,e,n,r){gd(t,"resizeNearestNeighbor");for(var o=t.shape,i=o[0],a=o[1],s=o[2],u=o[3],c=this.readSync(t.dataId),l=new Float32Array(i*e*n*u),h=[r&&e>1?a-1:a,r&&n>1?s-1:s],d=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=h[0]/d[0],p=h[1]/d[1],g=0,m=0;m<i;m++)for(var v=m*t.strides[0],y=0;y<e;y++)for(var b=f*y,w=v+Math.min(a-1,r?Math.round(b):Math.floor(b))*t.strides[1],x=0;x<n;x++)for(var E=p*x,A=w+Math.min(s-1,r?Math.round(E):Math.floor(E))*t.strides[2],C=0;C<u;C++){var k=c[A+C];l[g++]=k}return _r(l,[i,e,n,u],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){gd([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,o=r[0],i=r[1],a=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(o*i*a*s),d=this.readSync(t.dataId),f=[n&&c>1?i-1:i,n&&l>1?a-1:a],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],g=f[0]/p[0],m=f[1]/p[1],v=1/g,y=1/m,b=2*Math.ceil(v)+2,w=2*Math.ceil(y)+2,x=0;x<o;x++)for(var E=x*e.strides[0],A=0;A<i;A++)for(var C=E+A*e.strides[1],k=Math.floor(A*v),S=Math.floor(k-b/2),I=0;I<a;I++)for(var R=C+I*e.strides[2],T=Math.floor(I*y),N=Math.floor(T-w/2),_=0;_<s;_++){for(var P=0,D=0;D<b;D++){var O=D+S;if(!(O<0||O>=c)){var F=E+O*t.strides[1],M=O*g;if(A===Math.min(i-1,n?Math.round(M):Math.floor(M)))for(var B=0;B<w;B++){var L=B+N;if(!(L<0||L>=l)){var U=F+L*t.strides[2],W=L*m;I===Math.min(a-1,n?Math.round(W):Math.floor(W))&&(P+=d[U+_])}}}}h[R+_]=P}return Br(h,e.shape,e.dtype)},e.prototype.batchNormalization=function(t,e,n,r,o,i){gd([t,e,n,o,i],"batchNorm");for(var a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=this.readSync(n.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),l=i?this.readSync(i.dataId):new Float32Array([0]),h=new Float32Array(a.length),d=l.length,f=c.length,p=u.length,g=s.length,m=0,v=0,y=0,b=0,w=0;w<a.length;++w)h[w]=l[m++]+(a[w]-s[v++])*c[y++]/Math.sqrt(u[b++]+r),m>=d&&(m=0),v>=g&&(v=0),y>=f&&(y=0),b>=p&&(b=0);return Br(h,t.shape)},e.prototype.localResponseNormalization4D=function(t,e,n,r,o){gd(t,"localResponseNormalization4D");var i=t.shape[3],a=i-1,s=this.readSync(t.dataId),u=t.size,c=new Float32Array(u);function l(t){for(var n=t%i,r=t-n+Math.max(0,n-e),o=t-n+Math.min(n+e,a),u=0;r<=o;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var d=l(h),f=s[h]*Math.pow(n+r*d,-o);c[h]=f}return Br(c,t.shape)},e.prototype.LRNGrad=function(t,e,n,r,o,i,a){gd(t,"LRNGrad");for(var s=t.shape[3],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=this.readSync(n.dataId),h=new Float32Array(t.size),d=t.size,f=0;f<d;f++){for(var p=f%s,g=f-p+Math.max(0,p-r),m=f-p+Math.min(s,p+r+1),v=0,y=g;y<m;y++)v+=Math.pow(c[y],2);for(v=i*v+o,y=g;y<m;y++){var b=-2*i*a*c[y]*l[f]/v;f===y&&(b+=Math.pow(v,-a)),b*=u[f],h[y]+=b}}return Br(h,t.shape)},e.prototype.multinomial=function(t,e,n,r){gd(t,"multinomial");for(var o=e?t:ti(t),i=o.shape[0],a=o.shape[1],s=Ur([i,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(o.dataId),l=0;l<i;++l){var h=l*a,d=new Float32Array(a-1);d[0]=c[h];for(var f=1;f<d.length;++f)d[f]=d[f-1]+c[h+f];for(var p=oo(r.toString()),g=l*n,m=0;m<n;++m){var v=p();u[g+m]=d.length;for(var y=0;y<d.length;y++)if(v<d[y]){u[g+m]=y;break}}}return s},e.prototype.oneHot=function(t,e,n,r){gd(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(r);for(var i=this.readSync(t.dataId),a=0;a<t.size;++a)i[a]>=0&&i[a]<e&&(o[a*e+i[a]]=n);return Fr(o,[t.size,e],"int32")},e.prototype.nonMaxSuppression=function(t,e,n,r,o){return gd(t,"nonMaxSuppression"),Ti(this.readSync(t.dataId),this.readSync(e.dataId),n,r,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],o=uo(t.shape,"float32"),i=uo(t.shape,"float32"),a=Tr(t).as2D(n,r),s=Nr(t).as2D(n,r),u=0;u<n;u++)for(var c=a.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),h=Rr(c,l),d=this.readSync(this.fftImpl(h,e).dataId),f=0;f<r;f++){var p=Ci(d,f);o.values[u*r+f]=p.real,i.values[u*r+f]=p.imag}return Rr(o.toTensor(),i.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(o=Rr(Tr(o).div(Dr(r)),Nr(o).div(Dr(r)))),o}var i=this.readSync(t.dataId),a=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(i,r,e));return Rr(a.real,a.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=this.readSync(t.dataId),o=e/2,i=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),a=Rr(i.real,i.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),u=Rr(s.real,s.imag).as1D();a=this.fftRadix2(a,o,n),u=this.fftRadix2(u,o,n);var c=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var i=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:n,imag:r}}(e,n),l=Rr(c.real,c.imag).mul(u),h=a.add(l),d=a.sub(l),f=Tr(h).concat(Tr(d)),p=Nr(h).concat(Nr(d));return Rr(f,p).as1D()},e.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),o=0;o<e;o++){for(var i=0,a=0,s=0;s<e;s++){var u=Si(o*s,e,n),c=Ci(t,s);i+=c.real*u.real-c.imag*u.imag,a+=c.real*u.imag+c.imag*u.real}n&&(i/=e,a/=e),ki(r,i,a,o)}return r},e.prototype.depthToSpace=function(t,e,n){Kt("NHWC"===n,function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),Kt(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e});for(var r=t.shape[0],o=t.shape[1],i=t.shape[2],a=t.shape[3],s=o*e,u=i*e,c=a/(e*e),l=this.readSync(t.dataId),h=new Float32Array(r*s*u*c),d=0,f=0;f<r;++f)for(var p=0;p<s;++p)for(var g=Math.floor(p/e),m=p%e,v=0;v<u;++v)for(var y=Math.floor(v/e),b=(m*e+v%e)*c,w=0;w<c;++w){var x=w+b+a*(y+i*(g+o*f));h[d++]=l[x]}return Br(h,[r,s,u,c])},e.prototype.broadcastedBinaryOp=function(t,e,n,r){var o=si(t.shape,e.shape),i=uo(o,n),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=ii(t.shape,o),c=ii(e.shape,o),l=i.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(a[h%a.length],s[h%s.length]);else{var d=this.bufferSync(t),f=this.bufferSync(e),p=function(n){var o=i.indexToLoc(n),h=o.slice(-t.rank);u.forEach(function(t){return h[t]=0});var p=d.locToIndex(h),g=o.slice(-e.rank);c.forEach(function(t){return g[t]=0});var m=f.locToIndex(g);l[n]=r(a[p],s[m])};for(h=0;h<l.length;++h)p(h)}return i.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=si(t.shape,e.shape),o=uo(r,"float32"),i=uo(r,"float32"),a=this.readSync(t.dataId),s=this.readSync(e.dataId),u=ii(t.shape,r),c=ii(e.shape,r),l=o.values,h=i.values;if(u.length+c.length===0)for(var d=0;d<l.length;d++){var f=d%a.length,p=d%s.length,g=n(a[2*f],a[2*f+1],s[2*p],s[2*p+1]);l[d]=g.real,h[d]=g.imag}else{var m=this.bufferSync(this.data.get(t.dataId).complexTensors.real),v=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=function(r){var i=o.indexToLoc(r),d=i.slice(-t.rank);u.forEach(function(t){return d[t]=0});var f=m.locToIndex(d),p=i.slice(-e.rank);c.forEach(function(t){return p[t]=0});var g=v.locToIndex(p),y=n(a[2*f],a[2*f+1],s[2*g],s[2*g+1]);l[r]=y.real,h[r]=y.imag};for(d=0;d<l.length;d++)y(d)}return this.complex(o.toTensor(),i.toTensor())},e.prototype.split=function(t,e,n){return Fi(t,e,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,e,n,r,o,i){for(var a=t.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=e.shape[0],d=r[0],f=r[1],p=uo([h,d,f,l],"float32"),g=this.readSync(e.dataId),m=this.readSync(n.dataId),v=this.readSync(t.dataId),y=t.strides,b=p.strides,w=0;w<h;w++){var x=4*w,E=g[x],A=g[x+1],C=g[x+2],k=g[x+3],S=m[w];if(!(S>=s))for(var I=d>1?(C-E)*(u-1)/(d-1):0,R=f>1?(k-A)*(c-1)/(f-1):0,T=0;T<d;T++){var N=d>1?E*(u-1)+T*I:.5*(E+C)*(u-1);if(N<0||N>u-1)for(var _=0;_<f;_++)for(var P=0;P<l;P++){var D=P+_*b[2]+T*b[1]+w*b[0];p.values[D]=i}else if("bilinear"===o){var O=Math.floor(N),F=Math.ceil(N),M=N-O;for(_=0;_<f;_++)if((H=f>1?A*(c-1)+_*R:.5*(A+k)*(c-1))<0||H>c-1)for(P=0;P<l;P++)D=P+_*b[2]+T*b[1]+w*b[0],p.values[D]=i;else{var B=Math.floor(H),L=Math.ceil(H),U=H-B;for(P=0;P<l;P++){var W=v[D=P+B*y[2]+O*y[1]+S*y[0]],z=v[D=P+L*y[2]+O*y[1]+S*y[0]],V=v[D=P+B*y[2]+F*y[1]+S*y[0]],j=W+(z-W)*U,G=V+(v[D=P+L*y[2]+F*y[1]+S*y[0]]-V)*U;D=P+_*b[2]+T*b[1]+w*b[0],p.values[D]=j+(G-j)*M}}}else for(_=0;_<f;++_){var H;if((H=f>1?A*(c-1)+_*R:.5*(A+k)*(c-1))<0||H>c-1)for(P=0;P<l;P++)D=P+_*b[2]+T*b[1]+w*b[0],p.values[D]=i;else{var q=Math.round(H),K=Math.round(N);for(P=0;P<l;P++){var Q=P+q*y[2]+K*y[1]+S*y[0],X=P+_*b[2]+T*b[1]+w*b[0];p.values[X]=v[Q]}}}}}return p.toTensor()},e.prototype.sparseToDense=function(t,e,n,r){var o=Ho(0,t,n),i=o.sliceRank,a=o.numUpdates,s=o.sliceSize,u=o.strides,c=o.outputSize;return this.scatter(t,e,n,c,s,a,i,u,r,!1)},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=zo(t,e),i=o[0],a=o[1],s=o[2],u=o[3];if(0===a)return _r([],i,t.dtype);for(var c=new Be([a,s],t.dtype),l=this.readSync(e.dataId),h=this.readSync(t.dataId),d=0;d<a;d++){for(var f=[],p=0,g=0;g<r;g++){var m=l[d*r+g];p+=m*u[g],f.push(m)}if(p<0||p>=t.size/s)throw new Error("Invalid indices: "+f+" does not index into "+t.shape);for(var v=0;v<s;v++)c.values[d*s+v]=h[p*s+v]}return c.toTensor().reshape(i)},e.prototype.scatterND=function(t,e,n){var r=Ho(0,t,n),o=r.sliceRank,i=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=Dr(0);return this.scatter(t,e,n,u,a,i,o,s,c,!0)},e.prototype.fill=function(t,e,n){var r=ue(n=n||ye(e),Yt(t));return r.fill(e),rn.makeTensor(r,t,n,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var e=ue(t.dtype,Yt(t.shape));return this.makeOutput(e,t.shape,t.dtype)},e.prototype.linspace=function(t,e,n){return Ei(t,e,n)},e.prototype.scatter=function(t,e,n,r,o,i,a,s,u,c){var l=[r/o,o],h=this.readSync(t.dataId),d=this.readSync(e.dataId);if(0===r)return _r([],n,e.dtype);var f=new Be(l,e.dtype);f.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<i;p++){for(var g=[],m=0,v=0;v<a;v++){var y=h[p*a+v];g.push(y),m+=y*s[v]}if(m<0||m>=r/o)throw new Error("Invalid indices: "+g+" does not index into "+n);for(var b=0;b<o;b++)c?f.values[m*o+b]+=d[p*o+b]:f.values[m*o+b]=0===e.rank?d[0]:d[p*o+b]}return f.toTensor().reshape(n)},e}(ri);rn.registerBackend("cpu",function(){return new vd},1);for(var yd=0,bd=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,o=e,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=n;gd(i,"NonMaxSuppressionWithScore");var f=Ni(d.data.get(i.dataId).values,d.data.get(a.dataId).values,u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,o=n;gd(r,"square");for(var i=o.data.get(r.dataId).values,a=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];a[s]=u*u}return{dataId:o.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:Nu,backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,o=r.a,i=r.b,a=n;gd([o,i],Nu);var s=a.data.get(o.dataId).values,u=a.data.get(i.dataId).values,c=function(t,e,n,r,o,i){var a=si(t,e),s=a.length,u=xe(a),c=se(o,Yt(a)),l=t.length,h=e.length,d=xe(t),f=xe(e),p=ii(t,a),g=ii(e,a);if(p.length+g.length===0)for(var m=0;m<c.length;++m)c[m]=i(n[m%n.length],r[m%r.length]);else{var v=function(t){var e=_e(t,s,u),o=e.slice(-l);p.forEach(function(t){return o[t]=0});var a=Ne(o,l,d),m=e.slice(-h);g.forEach(function(t){return m[t]=0});var v=Ne(m,h,f);c[t]=i(n[a],r[v])};for(m=0;m<c.length;++m)v(m)}return[c,a]}(o.shape,i.shape,s,u,o.dtype,function(t,e){var n=t-e;return n*n}),l=c[0],h=c[1];return{dataId:a.write(l,h,o.dtype),shape:h,dtype:o.dtype}}}];yd<bd.length;yd++)Wt(bd[yd]);for(var wd,xd=function(t){this.variableNames=["A"];var e=Gi(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},Ed=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Gi(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},Ad=0,Cd=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,o=e.pixels,i=r.numChannels,a="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,s="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,u=a?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=u[0],l=u[1],h=[l,c],d=[l,c,i];(s||a)&&(null==wd&&(wd=document.createElement("canvas").getContext("2d")),wd.canvas.width=c,wd.canvas.height=l,wd.drawImage(o,0,0,c,l),o=wd.canvas);var f=n.makeTensorInfo(h,"int32");n.texData.get(f.dataId).usage=un.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(f.dataId),o);var p=Ot().getBool("WEBGL_PACK")?new Ed(d):new xd(d),g=n.runWebGLProgram(p,[f],"int32");return n.disposeData(f.dataId),g}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;dr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=e,i=o.boxes,a=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=n,f=Ni(d.readSync(i.dataId),d.readSync(a.dataId),u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,o=n,i=new tu(r.shape,"return x * x;");return o.runWebGLProgram(i,[r],r.dtype)}},{kernelName:Nu,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,o=r.a,i=r.b,a=n,s=Ot().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ya("return (a - b) * (a - b);",o.shape,i.shape):new ma("return (a - b) * (a - b);",o.shape,i.shape);return a.compileAndRun(s,[o,i])}}];Ad<Cd.length;Ad++)Wt(Cd[Ad]);for(var kd=0,Sd=[{kernelName:"Square",gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}},{kernelName:Nu,gradFunc:function(t,e){var n=e[0],r=e[1],o=Dr(2);return{a:function(){return qc(t,qc(o,Yc(n,r)))},b:function(){return qc(t,qc(o,Yc(r,n)))}}}}];kd<Sd.length;kd++)zt(Sd[kd]);var Id=function(){function t(){}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();Ot().get("IS_BROWSER")&&Ot().setPlatform("browser",new Id);var Rd,Td=function(){function t(){this.util=n(745),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=Ot().global.fetch?Ot().global.fetch(t,e):(null==Rd&&(Rd=n(318)),Rd(t,e))},t.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();Ot().get("IS_NODE")&&Ot().setPlatform("node",new Td);var Nd={float32:4,int32:4,uint16:2,uint8:1,bool:1};function _d(t,e){for(var n={},r=0,o=function(e){var o=e.name,i=e.dtype,a=e.shape,s=Yt(a),u=void 0;if("quantization"in e){var c=e.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=Nd[c.dtype],h=t.slice(r,r+s*l),d="uint8"===c.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===i)u=Float32Array.from(d,function(t){return t*c.scale+c.min});else{if("int32"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=Int32Array.from(d,function(t){return Math.round(t*c.scale+c.min)})}r+=s*l}else if("string"===i){var f=Yt(e.shape);u=[];for(var p=0;p<f;p++){var g=new Uint32Array(t.slice(r,r+4))[0];r+=4;var m=new Uint8Array(t.slice(r,r+g));u.push(m),r+=g}}else{var v=Nd[i];if(h=t.slice(r,r+s*v),"float32"===i)u=new Float32Array(h);else if("int32"===i)u=new Int32Array(h);else{if("bool"!==i)throw new Error("Unsupported dtype in weight '"+o+"': "+i);u=new Uint8Array(h)}r+=s*v}n[o]=_r(u,a,i)},i=0,a=e;i<a.length;i++)o(a[i]);return n}function Pd(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach(function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)});var r=new Uint8Array(e),o=0;return n.forEach(function(t){r.set(new Uint8Array(t.buffer),o),o+=t.byteLength}),r.buffer}var Dd="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Od(t){return Dd?Buffer.byteLength(t):new Blob([t]).size}function Fd(t){var e=0;t.forEach(function(t){e+=t.byteLength});var n=new Uint8Array(e),r=0;return t.forEach(function(t){n.set(new Uint8Array(t),r),r+=t.byteLength}),n.buffer}function Md(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function Bd(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:Od(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:Od(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var Ld=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var o=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(function(t){var n=t(e,r);null!==n&&o.push(n)}),o},t}(),Ud="://",Wd=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){Kt(null!=e,function(){return"scheme must not be undefined or null."}),e.endsWith(Ud)&&(e=e.slice(0,e.indexOf(Ud))),Kt(e.length>0,function(){return"scheme must not be an empty string."});var r=t.getInstance();Kt(null==r.managers[e],function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function zd(t){if(-1===t.indexOf(Ud))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Wd.getSchemes().join(","));return{scheme:t.split(Ud)[0],path:t.split(Ud)[1]}}function Vd(t,e,n){return void 0===n&&(n=!1),_t(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h;return Pt(this,function(d){switch(d.label){case 0:return Kt(t!==e,function(){return"Old path and new path are the same: '"+t+"'"}),Kt((r=Ld.getLoadHandlers(t)).length>0,function(){return"Copying failed because no load handler is found for source URL "+t+"."}),Kt(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."}),o=r[0],Kt((i=Ld.getSaveHandlers(e)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+e+"."}),Kt(i.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."}),a=i[0],s=zd(t).scheme,u=zd(t).path,c=s===zd(t).scheme,[4,o.load()];case 1:return l=d.sent(),n&&c?[4,Wd.getManager(s).removeModel(u)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,a.save(l)];case 4:return h=d.sent(),!n||c?[3,6]:[4,Wd.getManager(s).removeModel(u)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}})})}var jd="models_store",Gd="model_info_store";function Hd(){if(!Ot().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function qd(t){var e=t.result;e.createObjectStore(jd,{keyPath:"modelPath"}),e.createObjectStore(Gd,{keyPath:"modelPath"})}var Kd=function(){function t(t){if(this.indexedDB=Hd(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return _t(this,void 0,void 0,function(){return Pt(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},t.prototype.load=function(){return _t(this,void 0,void 0,function(){return Pt(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},t.prototype.databaseAction=function(t,e){var n=this;return new Promise(function(t,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return qd(o)},o.onsuccess=function(){var i=o.result;if(null==e){var a=i.transaction(jd,"readonly"),s=a.objectStore(jd).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return i.close(),r(s.error)},a.oncomplete=function(){return i.close()}}else{var u,c=Bd(e),l=i.transaction(Gd,"readwrite"),h=l.objectStore(Gd),d=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var o=(u=i.transaction(jd,"readwrite")).objectStore(jd).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:c});o.onsuccess=function(){return t({modelArtifactsInfo:c})},o.onerror=function(t){var e=(h=l.objectStore(Gd)).delete(n.modelPath);e.onsuccess=function(){return i.close(),r(o.error)},e.onerror=function(t){return i.close(),r(o.error)}}},d.onerror=function(t){return i.close(),r(d.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},o.onerror=function(t){return r(o.error)}})},t.URL_SCHEME="indexeddb://",t}(),Qd=function(t){return Ot().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Kd.URL_SCHEME)?(e=t.slice(Kd.URL_SCHEME.length),new Kd(e)):null;var e};Ld.registerSaveRouter(Qd),Ld.registerLoadRouter(Qd);var Xd=function(){function t(){this.indexedDB=Hd()}return t.prototype.listModels=function(){return _t(this,void 0,void 0,function(){var t=this;return Pt(this,function(e){return[2,new Promise(function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return qd(r)},r.onsuccess=function(){var t=r.result,o=t.transaction(Gd,"readonly"),i=o.objectStore(Gd).getAll();i.onsuccess=function(){for(var t={},n=0,r=i.result;n<r.length;n++){var o=r[n];t[o.modelPath]=o.modelArtifactsInfo}e(t)},i.onerror=function(e){return t.close(),n(i.error)},o.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}})]})})},t.prototype.removeModel=function(t){return _t(this,void 0,void 0,function(){var e=this;return Pt(this,function(n){var r;return t=(r=t).startsWith(Kd.URL_SCHEME)?r.slice(Kd.URL_SCHEME.length):r,[2,new Promise(function(n,r){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return qd(o)},o.onsuccess=function(){var e,i=o.result,a=i.transaction(Gd,"readwrite"),s=a.objectStore(Gd),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),a=function(){var o=(e=i.transaction(jd,"readwrite")).objectStore(jd).delete(t);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(t){return r(u.error)}};o.onsuccess=a,o.onerror=function(t){return a(),i.close(),r(u.error)}},u.onerror=function(t){return i.close(),r(u.error)},a.oncomplete=function(){null==e?i.close():e.oncomplete=function(){return i.close()}}},o.onerror=function(t){return r(o.error)}})]})})},t}();if(Ot().getBool("IS_BROWSER"))try{Wd.registerManager(Kd.URL_SCHEME,new Xd)}catch(Tt){}var Jd="/",Yd="tensorflowjs_models",Zd="info",$d="model_topology",tf="weight_specs",ef="weight_data",nf="model_metadata";function rf(t){return{info:[Yd,t,Zd].join(Jd),topology:[Yd,t,$d].join(Jd),weightSpecs:[Yd,t,tf].join(Jd),weightData:[Yd,t,ef].join(Jd),modelMetadata:[Yd,t,nf].join(Jd)}}function of(t){var e=t.split(Jd);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(Jd)}var af=function(){function t(t){if(!Ot().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=rf(this.modelPath)}return t.prototype.save=function(t){return _t(this,void 0,void 0,function(){var e,n,r;return Pt(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=Bd(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(Dd)return Buffer.from(t).toString("base64");for(var e=new Uint8Array(t),n="",r=0,o=e.length;r<o;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}})})},t.prototype.load=function(){return _t(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return Pt(this,function(s){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(o),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy,e.userDefinedMetadata=i.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(Dd){var e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),o=0;o<n.length;++o)r.set([n.charCodeAt(o)],o);return r.buffer}(a),[2,e]})})},t.URL_SCHEME="localstorage://",t}(),sf=function(t){return Ot().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(af.URL_SCHEME)?(e=t.slice(af.URL_SCHEME.length),new af(e)):null;var e};Ld.registerSaveRouter(sf),Ld.registerLoadRouter(sf);var uf=function(){function t(){Kt(Ot().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),Kt("undefined"==typeof window||void 0!==window.localStorage,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return t.prototype.listModels=function(){return _t(this,void 0,void 0,function(){var t,e,n,r,o,i;return Pt(this,function(a){for(t={},e=Yd+Jd,n=Jd+Zd,r=0;r<this.LS.length;++r)(o=this.LS.key(r)).startsWith(e)&&o.endsWith(n)&&(i=of(o),t[i]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},t.prototype.removeModel=function(t){return _t(this,void 0,void 0,function(){var e,n;return Pt(this,function(r){var o;if(t=(o=t).startsWith(af.URL_SCHEME)?o.slice(af.URL_SCHEME.length):o,e=rf(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]})})},t}();if(Ot().getBool("IS_BROWSER"))try{Wd.registerManager(af.URL_SCHEME,new uf)}catch(Tt){}function cf(t){return new Promise(function(t){return setTimeout(t)}).then(t)}var lf=function(){function t(e){if(!Ot().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return t.prototype.save=function(t){return _t(this,void 0,void 0,function(){var e,n,r,o,i,a;return Pt(this,function(s){switch(s.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=o,[4,cf(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return s.sent(),null==t.weightData?[3,4]:((a=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,a.href=e,[4,cf(function(){return a.dispatchEvent(new MouseEvent("click"))})]);case 3:s.sent(),s.label=4;case 4:return[2,{modelArtifactsInfo:Bd(t)}]}})})},t.URL_SCHEME="downloads://",t}(),hf=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return _t(this,void 0,void 0,function(){var t,e,n=this;return Pt(this,function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(r,o){var i=new FileReader;i.onload=function(i){var a=JSON.parse(i.target.result),s=a.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var l=[],h=[],d=[];u.forEach(function(t){t.paths.forEach(function(t){h.push(t),d.push(null)}),l.push.apply(l,t.weights)}),u.forEach(function(t){t.paths.forEach(function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,o=h.indexOf(t);d[o]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:Fd(d),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(c[t])})})}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},i.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},i.readAsText(t)})]})})},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map(function(t){return Md(t.name)}),o={},i=0,a=t;i<a.length;i++)a[i].paths.forEach(function(t){var i=Md(t);if(-1!==n.indexOf(i))throw new Error("Duplicate file basename found in weights manifest: '"+i+"'");if(n.push(i),-1===r.indexOf(i))throw new Error("Weight file with basename '"+i+"' is not provided.");o[t]=e[r.indexOf(i)]});if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},t}();function df(t,e,n,r){!function(t){Kt(null!=t&&Array.isArray(t)&&t.length>0,function(){return"promises must be a none empty array"})}(t),function(t,e){Kt(t>=0&&t<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t}),Kt(e>=0&&e<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e}),Kt(e>=t,function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e})}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(t.map(function(i){return i.then(function(i){var a=n+ ++o/t.length*(r-n);return e(a),i}),i}))}function ff(t,e){return _t(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l;return Pt(this,function(h){switch(h.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?Ot().platform.fetch:e.fetchFunc,r=t.map(function(t){return n(t,e.requestInit,{isBinary:!0})}),o=0,i=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,df(r,e.onProgress,o,i)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(t){return t.arrayBuffer()}),u=.5,c=1,null!=e.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=h.sent(),[3,8];case 6:return[4,df(s,e.onProgress,u,c)];case 7:l=h.sent(),h.label=8;case 8:return[2,l]}})})}function pf(t){var e=this;return function(n,r,o){return void 0===r&&(r=""),_t(e,void 0,void 0,function(){var e,i,a,s,u,c,l,h,d,f;return Pt(this,function(p){switch(p.label){case 0:if(e=n.map(function(){return!1}),i={},a=null!=o?o.map(function(){return!1}):[],s=[],n.forEach(function(t,n){var r=0;t.weights.forEach(function(t){var u="quantization"in t?t.quantization.dtype:t.dtype,c=Nd[u]*Yt(t.shape),l=function(){e[n]=!0,null==i[n]&&(i[n]=[]),i[n].push({manifestEntry:t,groupOffset:r,sizeBytes:c})};null!=o?o.forEach(function(e,n){e===t.name&&(l(),a[n]=!0)}):l(),s.push(t.name),r+=c})}),!a.every(function(t){return t}))throw u=o.filter(function(t,e){return!a[e]}),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return c=e.reduce(function(t,e,n){return e&&t.push(n),t},[]),l=[],c.forEach(function(t){n[t].paths.forEach(function(t){var e=r+(r.endsWith("/")?"":"/")+t;l.push(e)})}),[4,t(l)];case 1:return h=p.sent(),d={},f=0,c.forEach(function(t){for(var e=n[t].paths.length,r=0,o=0;o<e;o++)r+=h[f+o].byteLength;for(var a=new ArrayBuffer(r),s=new Uint8Array(a),u=0,c=0;c<e;c++){var l=new Uint8Array(h[f+c]);s.set(l,u),u+=l.byteLength}i[t].forEach(function(t){var e=_d(a.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)d[n]=e[n]}),f+=e}),[2,d]}})})}}Ld.registerSaveRouter(function(t){return Ot().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(lf.URL_SCHEME)?function(t){return void 0===t&&(t="model"),new lf(t)}(t.slice(lf.URL_SCHEME.length)):null});var gf=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(Kt("function"==typeof e.fetchFunc,function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=Ot().platform.fetch,Kt(null!=t&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&Kt(2===t.length,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return _t(this,void 0,void 0,function(){var e,n,r,o;return Pt(this,function(i){switch(i.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((o=i.sent()).ok)return[2,{modelArtifactsInfo:Bd(t),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},t.prototype.load=function(){return _t(this,void 0,void 0,function(){var t,e,n,r,o,i,a,s,u,c,l,h;return Pt(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,t.json()];case 3:return e=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=e.modelTopology,o=e.weightsManifest,i=e.generatedBy,a=e.convertedBy,s=e.format,u=e.userDefinedMetadata,null==r&&null==o)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==o?[3,7]:[4,this.loadWeights(o)];case 6:h=d.sent(),c=h[0],l=h[1],d.label=7;case 7:return[2,{modelTopology:r,weightSpecs:c,weightData:l,userDefinedMetadata:u,generatedBy:i,convertedBy:a,format:s}]}})})},t.prototype.loadWeights=function(t){return _t(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,c,l,h;return Pt(this,function(d){switch(d.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],o=n[1],i=this.weightPathPrefix||r,a=[],s=0,u=t;s<u.length;s++)c=u[s],a.push.apply(a,c.weights);return l=[],t.forEach(function(t){t.paths.forEach(function(t){l.push(i+t+o)})}),[4,ff(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=d.sent(),[2,[a,Fd(h)]]}})})},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function mf(t){return null!=t.match(gf.URL_SCHEME_REGEX)}var vf=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every(function(t){return mf(t)}):mf(t))?yf(t,{onProgress:e}):null};function yf(t,e){return new gf(t,e)}Ld.registerSaveRouter(vf),Ld.registerLoadRouter(vf);var bf,wf=function(){function t(t){this.modelArtifacts=t}return t.prototype.load=function(){return _t(this,void 0,void 0,function(){return Pt(this,function(t){return[2,this.modelArtifacts]})})},t}(),xf=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return _t(this,void 0,void 0,function(){return Pt(this,function(e){return[2,this.saveHandler(t)]})})},t}(),Ef=Object.freeze({browserFiles:function(t){return new hf(t)},browserHTTPRequest:function(t,e){return yf(t,e)},concatenateArrayBuffers:Fd,decodeWeights:_d,encodeWeights:function(t,e){return _t(this,void 0,void 0,function(){var n,r,o,i,a,s=this;return Pt(this,function(u){switch(u.label){case 0:for(n=[],r=[],o=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t),i=function(i){var a=o[i],u=Array.isArray(t)?t[i].tensor:t[a];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+a+"': "+u.dtype);var c={name:a,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var l=new Promise(function(t){return _t(s,void 0,void 0,function(){var e,n,r,o,i,a,s;return Pt(this,function(c){switch(c.label){case 0:return[4,u.bytes()];case 1:for(e=c.sent(),n=e.reduce(function(t,e){return t+e.length},0)+4*e.length,r=new Uint8Array(n),o=0,i=0;i<e.length;i++)a=e[i],s=new Uint8Array(new Uint32Array([a.length]).buffer),r.set(s,o),o+=4,r.set(a,o),o+=a.length;return t(r),[2]}})})});r.push(l)}else r.push(u.data());null!=e&&(c.group=e),n.push(c)},a=0;a<o.length;++a)i(a);return[4,Promise.all(r)];case 1:return[2,{data:Pd(u.sent()),specs:n}]}})})},fromMemory:function(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new wf(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new wf({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new wf({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return Ld.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:Bd,getSaveHandlers:function(t){return Ld.getSaveHandlers(t)},http:yf,isHTTPScheme:mf,loadWeights:function(t,e,n,r){return void 0===e&&(e=""),_t(this,void 0,void 0,function(){return Pt(this,function(o){return[2,pf(function(t){return ff(t,{requestInit:r})})(t,e,n)]})})},registerLoadRouter:function(t){return Ld.registerLoadRouter(t)},registerSaveRouter:function(t){return Ld.registerSaveRouter(t)},weightsLoaderFactory:pf,withSaveHandler:function(t){return new xf(t)},copyModel:function(t,e){return _t(this,void 0,void 0,function(){return Pt(this,function(n){return[2,Vd(t,e,!1)]})})},listModels:function(){return _t(this,void 0,void 0,function(){var t,e,n,r,o,i,a;return Pt(this,function(s){switch(s.label){case 0:t=Wd.getSchemes(),e={},n=0,r=t,s.label=1;case 1:return n<r.length?(o=r[n],[4,Wd.getManager(o).listModels()]):[3,4];case 2:for(a in i=s.sent())e[o+Ud+a]=i[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,e]}})})},moveModel:function(t,e){return _t(this,void 0,void 0,function(){return Pt(this,function(n){return[2,Vd(t,e,!0)]})})},removeModel:function(t){return _t(this,void 0,void 0,function(){var e;return Pt(this,function(n){return e=zd(t),[2,Wd.getManager(e.scheme).removeModel(e.path)]})})}}),Af=Ir({confusionMatrix_:function(t,e,n){var r=gr(t,"labels","confusionMatrix"),o=gr(e,"predictions","confusionMatrix");Kt(null==n||n>0&&Number.isInteger(n),function(){return"If provided, numClasses must be a positive integer, but got "+n}),Kt(1===r.rank,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),Kt(1===o.rank,function(){return"Expected the rank of predictions to be 1, but got "+o.rank}),Kt(r.shape[0]===o.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."}),Kt(n>0&&Number.isInteger(n),function(){return"numClasses is required to be a positive integer, but got "+n});var i=bo(r.asType("int32"),n),a=bo(o.asType("int32"),n);return i.transpose().matMul(a).asType("int32")}}),Cf=(Object.freeze({confusionMatrix:Af}),Ir({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)i=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);a=!0}if(o&&o&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=Lt("FromPixels",rn.backendName))return rn.runKernel("FromPixels",{pixels:t},{numChannels:e});var s,u,c=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],h=c[1];if(a?s=t.getContext("2d").getImageData(0,0,l,h).data:r||n?s=t.data:(i||o)&&(null==bf&&(bf=document.createElement("canvas").getContext("2d")),bf.canvas.width=l,bf.canvas.height=h,bf.drawImage(t,0,0,l,h),s=bf.getImageData(0,0,l,h).data),4===e)u=new Int32Array(s);else{var d=l*h;u=new Int32Array(d*e);for(var f=0;f<d;f++)for(var p=0;p<e;++p)u[f*e+p]=s[4*f+p]}return Mr(u,[h,l,e],"int32")}})),kf=Object.freeze({toPixels:function(t,e){return _t(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,d,f,p,g,m,v,y,b,w,x,E,A,C;return Pt(this,function(k){switch(k.label){case 0:if(n=gr(t,"img","toPixels"),t instanceof ze||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),o=r[0],i=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=k.sent(),u=n.min(),c=n.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=k.sent(),h=l[0],d=l[1],f=h[0],p=d[0],u.dispose(),c.dispose(),"float32"===n.dtype){if(f<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+f+" - "+p+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(f<0||p>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+f+" - "+p+"].")}for(g="float32"===n.dtype?255:1,m=new Uint8ClampedArray(i*o*4),v=0;v<o*i;++v)y=void 0,b=void 0,w=void 0,x=void 0,1===a?(y=s[v]*g,b=s[v]*g,w=s[v]*g,x=255):3===a?(y=s[3*v]*g,b=s[3*v+1]*g,w=s[3*v+2]*g,x=255):4===a&&(y=s[4*v]*g,b=s[4*v+1]*g,w=s[4*v+2]*g,x=s[4*v+3]*g),m[0+(E=4*v)]=Math.round(y),m[E+1]=Math.round(b),m[E+2]=Math.round(w),m[E+3]=Math.round(x);return null!=e&&(e.width=i,e.height=o,A=e.getContext("2d"),C=new ImageData(m,i,o),A.putImageData(C,0,0)),n!==t&&n.dispose(),[2,m]}})})},fromPixels:Cf}),Sf=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),If=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function Rf(t){Kt(null!=t.className,function(){return"Class being registered does not have the static className property defined."}),Kt("string"==typeof t.className,function(){return"className is required to be a string, but got type "+typeof t.className}),Kt(t.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),If.register(t)}Object.freeze({Serializable:Sf,SerializationMap:If,registerClass:Rf});function Tf(){return 32===rn.backend.floatPrecision()?.001:.1}function Nf(t,e,n){var r=!0;if((de(t)||de(e))&&(r=!1),de(t)&&de(e)&&(r=!0),r){var o=t.constructor.name,i=e.constructor.name;if(o!==i)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+i)}if(Array.isArray(t)&&Array.isArray(e)){var a=fr(t),s=fr(e);if(!Zt(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=de(t)?t:Jt(t),c=de(e)?e:Jt(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var h=u[l],d=c[l];if(!n(h,d))throw new Error("Arrays differ: actual["+l+"] = "+h+", expected["+l+"] = "+d+".\nActual:   "+u+".\nExpected: "+c+".")}}function _f(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=Tf()),Nf(t,e,function(t,e){return _f(t,e,n)})},testEpsilon:Tf,expectPromiseToFail:function(t,e){t().then(function(){return e.fail()},function(){return e()})},expectArraysEqual:function(t,e){var n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return ge(t)||ge(t[0])||ge(e)||ge(e[0])?Nf(t,n,function(t,e){return t==e}):Nf(t,e,function(t,e){return _f(t,e,0)})},expectNumbersClose:function(t,e,n){if(null==n&&(n=Tf()),!_f(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){for(var r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error("Value out of range:"+t[r]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}}),Object.freeze({gpgpu_util:fs,webgl_util:sr,forceHalfFloat:function(){Ot().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Ru,setWebGLContext:dn,GPGPUContext:ps});var Pf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Nt(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),o=r.value,i=r.grads;if(null!=n){var a=n.map(function(t){return{name:t.name,tensor:i[t.name]}});this.applyGradients(a)}else this.applyGradients(i);return hr(i),e?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return function(t,e){Kt(be(t),function(){return"The f passed in variableGrads(f) must be a function"}),Kt(null==e||Array.isArray(e)&&e.every(function(t){return t instanceof Ke}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var n=null!=e;if(!n)for(var r in e=[],rn.registeredVariables)e.push(rn.registeredVariables[r]);var o=n?e.filter(function(t){return!t.trainable}):null,i=e.length;Kt((e=e.filter(function(t){return t.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+i+" variables is trainable."});var a=rn.gradients(t,e,null,!0),s=a.value,u=a.grads;Kt(u.some(function(t){return null!=t}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Kt(0===s.rank,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var c={};return e.forEach(function(t,e){null!=u[e]&&(c[t.name]=u[e])}),null!=o&&o.forEach(function(t){return c[t.name]=null}),{value:s,grads:c}}(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&hr(this.iterations_)},e.prototype.saveIterations=function(){return _t(this,void 0,void 0,function(){return Pt(this,function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:Dr(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return _t(this,void 0,void 0,function(){return Pt(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return _t(this,void 0,void 0,function(){return Pt(this,function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return _t(this,void 0,void 0,function(){var e;return Pt(this,function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}})})},e}(Sf);Object.defineProperty(Pf,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var Df=function(t){function e(e,n,r){void 0===r&&(r=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=rn.backend.epsilon()),o}return Nt(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=rn.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:lr(function(){return jr(o).variable(!1)})}),null==e.accumulatedUpdates[r]&&(e.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:lr(function(){return jr(o).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedGrads[r].variable,s=e.accumulatedUpdates[r].variable;lr(function(){var t=a.mul(e.rho).add(i.square().mul(1-e.rho)),n=s.add(e.epsilon).sqrt().div(a.add(e.epsilon).sqrt()).mul(i),r=s.mul(e.rho).add(n.square().mul(1-e.rho));a.assign(t),s.assign(r);var u=n.mul(-e.learningRate).add(o);o.assign(u)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(hr(this.accumulatedGrads.map(function(t){return t.variable})),hr(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return _t(this,void 0,void 0,function(){var t;return Pt(this,function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return _t(this,void 0,void 0,function(){var e;return Pt(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=t.length/2,this.accumulatedGrads=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="Adadelta",e}(Pf);Rf(Df);var Of=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return Nt(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=rn.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accumulator",variable:lr(function(){return Wr(o.shape,e.initialAccumulatorValue).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedGrads[r].variable;lr(function(){var t=a.add(i.square());a.assign(t);var n=i.div(t.add(rn.backend.epsilon()).sqrt()).mul(-e.learningRate).add(o);o.assign(n)})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&hr(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return _t(this,void 0,void 0,function(){return Pt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return _t(this,void 0,void 0,function(){return Pt(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(Pf);Rf(Of);var Ff=function(t){function e(e,n,r,o){void 0===o&&(o=null);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],lr(function(){i.accBeta1=Dr(n).variable(),i.accBeta2=Dr(r).variable()}),null==o&&(i.epsilon=rn.backend.epsilon()),i}return Nt(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);lr(function(){var r=Yc(1,e.accBeta1),o=Yc(1,e.accBeta2);n.forEach(function(n,i){var a=rn.registeredVariables[n];null==e.accumulatedFirstMoment[i]&&(e.accumulatedFirstMoment[i]={originalName:n+"/m",variable:lr(function(){return jr(a).variable(!1)})}),null==e.accumulatedSecondMoment[i]&&(e.accumulatedSecondMoment[i]={originalName:n+"/v",variable:lr(function(){return jr(a).variable(!1)})});var s=Array.isArray(t)?t[i].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[i].variable,c=e.accumulatedSecondMoment[i].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),h=c.mul(e.beta2).add(s.square().mul(1-e.beta2)),d=l.div(r),f=h.div(o);u.assign(l),c.assign(h);var p=d.div(f.sqrt().add(e.epsilon)).mul(-e.learningRate).add(a);a.assign(p)}}),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&hr(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedSecondMoment&&hr(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return _t(this,void 0,void 0,function(){var t;return Pt(this,function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return _t(this,void 0,void 0,function(){var e,n=this;return Pt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),lr(function(){n.accBeta1.assign(Qc(n.beta1,n.iterations_+1)),n.accBeta2.assign(Qc(n.beta2,n.iterations_+1))}),e=t.length/2,this.accumulatedFirstMoment=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(Pf);Rf(Ff);var Mf=function(t){function e(e,n,r,o,i){void 0===o&&(o=null),void 0===i&&(i=0);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=o,a.decay=i,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],lr(function(){a.iteration=Dr(0).variable(),a.accBeta1=Dr(n).variable()}),null==o&&(a.epsilon=rn.backend.epsilon()),a}return Nt(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t);lr(function(){var r=Yc(1,e.accBeta1),o=Mc(-e.learningRate,e.iteration.mul(e.decay).add(1));n.forEach(function(n,i){var a=rn.registeredVariables[n];null==e.accumulatedFirstMoment[i]&&(e.accumulatedFirstMoment[i]={originalName:n+"/m",variable:jr(a).variable(!1)}),null==e.accumulatedWeightedInfNorm[i]&&(e.accumulatedWeightedInfNorm[i]={originalName:n+"/v",variable:jr(a).variable(!1)});var s=Array.isArray(t)?t[i].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[i].variable,c=e.accumulatedWeightedInfNorm[i].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),h=c.mul(e.beta2),d=s.abs(),f=h.maximum(d);u.assign(l),c.assign(f);var p=o.div(r).mul(l.div(f.add(e.epsilon))).add(a);a.assign(p)}}),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&hr(this.accumulatedFirstMoment.map(function(t){return t.variable})),null!=this.accumulatedWeightedInfNorm&&hr(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return _t(this,void 0,void 0,function(){return Pt(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return _t(this,void 0,void 0,function(){return Pt(this,function(t){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(Pf);Rf(Mf);var Bf=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return Nt(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var i=rn.registeredVariables[n];lr(function(){var t=e.c.mul(o).add(i);i.assign(t)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=function(t){return rn.keep(t)}(Dr(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return _t(this,void 0,void 0,function(){return Pt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return _t(this,void 0,void 0,function(){return Pt(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(Pf);Rf(Bf);var Lf=function(t){function e(e,n,r){void 0===r&&(r=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=Dr(o.momentum),o}return Nt(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=rn.registeredVariables[n];null==e.accumulations[r]&&(e.accumulations[r]={originalName:n+"/momentum",variable:lr(function(){return jr(o).variable(!1)})});var i=e.accumulations[r].variable,a=Array.isArray(t)?t[r].tensor:t[n];null!=a&&lr(function(){var t,n=e.m.mul(i).add(a);t=e.useNesterov?e.c.mul(a.add(n.mul(e.m))).add(o):e.c.mul(n).add(o),i.assign(n),o.assign(t)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&hr(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return _t(this,void 0,void 0,function(){return Pt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return _t(this,void 0,void 0,function(){return Pt(this,function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(Bf);Rf(Lf);var Uf=function(t){function e(e,n,r,o,i){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===i&&(i=!1);var a=t.call(this)||this;if(a.learningRate=e,a.decay=n,a.momentum=r,a.epsilon=o,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=i,null==o&&(a.epsilon=rn.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return Nt(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map(function(t){return t.name}):Object.keys(t)).forEach(function(n,r){var o=rn.registeredVariables[n];null==e.accumulatedMeanSquares[r]&&(e.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:lr(function(){return jr(o).variable(!1)})}),null==e.accumulatedMoments[r]&&(e.accumulatedMoments[r]={originalName:n+"/momentum",variable:lr(function(){return jr(o).variable(!1)})}),null==e.accumulatedMeanGrads[r]&&e.centered&&(e.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:lr(function(){return jr(o).variable(!1)})});var i=Array.isArray(t)?t[r].tensor:t[n];if(null!=i){var a=e.accumulatedMeanSquares[r].variable,s=e.accumulatedMoments[r].variable;lr(function(){var t=a.mul(e.decay).add(i.square().mul(1-e.decay));if(e.centered){var n=e.accumulatedMeanGrads[r].variable,u=n.mul(e.decay).add(i.mul(1-e.decay)),c=s.mul(e.momentum).add(i.mul(e.learningRate).div(t.sub(u.square().add(e.epsilon)).sqrt()));a.assign(t),n.assign(u),s.assign(c);var l=o.sub(c);o.assign(l)}else{var h=a.mul(e.decay).add(i.square().mul(1-e.decay));c=s.mul(e.momentum).add(i.mul(e.learningRate).div(h.add(e.epsilon).sqrt())),a.assign(h),s.assign(c),l=o.sub(c),o.assign(l)}})}}),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&hr(this.accumulatedMeanSquares.map(function(t){return t.variable})),null!=this.accumulatedMeanGrads&&this.centered&&hr(this.accumulatedMeanGrads.map(function(t){return t.variable})),null!=this.accumulatedMoments&&hr(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return _t(this,void 0,void 0,function(){var t;return Pt(this,function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map(function(t){return{name:t.originalName,tensor:t.variable}}))]}})})},e.prototype.setWeights=function(t){return _t(this,void 0,void 0,function(){var e;return Pt(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(e,2*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map(function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(Pf);Rf(Uf);var Wf=function(){function t(){}return t.sgd=function(t){return new Bf(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new Lf(t,e,n)},t.rmsprop=function(t,e,n,r,o){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new Uf(t,e,n,r,o)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new Ff(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new Df(t,e,n)},t.adamax=function(t,e,n,r,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new Mf(t,e,n,r,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new Of(t,e)},t}();Wf.sgd,Wf.momentum,Wf.adadelta,Wf.adagrad,Wf.rmsprop,Wf.adamax,Wf.adam,"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate;ze.prototype.squaredDifference=function(t){return _u(this,t)},Ue=pd;var zf=function(t,e){return zf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},zf(t,e)};function Vf(t,e){function n(){this.constructor=t}zf(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var jf=function(){return jf=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t},jf.apply(this,arguments)};function Gf(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{u(r.next(t))}catch(Nt){i(Nt)}}function s(t){try{u(r.throw(t))}catch(Nt){i(Nt)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}u((r=r.apply(t,e||[])).next())})}function Hf(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(Nt){i=[6,Nt],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}function qf(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r}var Kf=function(){function t(t,e){if(!ep(t)||!ep(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function Qf(t,e){return t instanceof ze&&t.shape.length===e}function Xf(t){return Qf(t,3)}function Jf(t){return Qf(t,4)}function Yf(t){return t%2===0}function Zf(t){return t&&t.width&&t.height}function $f(t){return t.reduce(function(t,e){return t.add(e)},new rp(0,0)).div(new rp(t.length,t.length))}function tp(t,e,n){return Array(t).fill(0).map(function(t,r){return e+r*n})}function ep(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function np(t){return ep(t)&&0<=t&&t<=1}var rp=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),op=function(){function t(e,n){void 0===n&&(n=!0);var r=e||{},o=[r.left,r.top,r.right,r.bottom].every(ep),i=[r.x,r.y,r.width,r.height].every(ep);if(!i&&!o)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];t.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(ep)},t.assertIsValidBox=function(e,n,r){if(void 0===r&&(r=!1),!t.isRect(e))throw new Error(n+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(n+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new rp(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new rp(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new rp(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new rp(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.round(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.floor(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this,n=e.x,r=e.y,o=e.width,i=e.height,a=Math.abs(o-i);return o<i&&(n-=a/2,o+=a),i<o&&(r-=a/2,i+=a),new t({x:n,y:r,width:o,height:i})},t.prototype.rescale=function(e){var n=Zf(e)?e.width:e,r=Zf(e)?e.height:e;return new t({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},t.prototype.pad=function(e,n){var r=[this.x-e/2,this.y-n/2,this.width+e,this.height+n];return new t({x:r[0],y:r[1],width:r[2],height:r[3]})},t.prototype.clipAtImageBorders=function(e,n){var r=this,o=r.x,i=r.y,a=r.right,s=r.bottom,u=Math.max(o,0),c=Math.max(i,0),l=a-u,h=s-c;return new t({x:u,y:c,width:Math.min(l,e-u),height:Math.min(h,n-c)}).floor()},t.prototype.shift=function(e,n){var r=this.width,o=this.height;return new t({x:this.x+e,y:this.y+n,width:r,height:o})},t.prototype.padAtBorders=function(t,e){var n=this.width+1,r=this.height+1,o=n,i=r,a=this.left,s=this.top,u=this.right,c=this.bottom;return u>e&&(o=-u+e+n,u=e),c>t&&(i=-c+t+r,c=t),a<1&&(i=2-a,a=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:o,y:s,ey:c,x:a,ex:u,w:n,h:r}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),ip=function(t){function e(e,n,r,o,i){return void 0===i&&(i=!1),t.call(this,{left:e,top:n,right:r,bottom:o},i)||this}return Vf(e,t),e}(op),ap=function(){function t(t,e,n,r,o){this._imageDims=new Kf(o.width,o.height),this._score=t,this._classScore=e,this._className=n,this._box=new op(r).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new op(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,n){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:n})},t}(),sp=function(t){function e(e,n,r){return t.call(this,e,e,"",n,r)||this}return Vf(e,t),e.prototype.forSize=function(n,r){var o=t.prototype.forSize.call(this,n,r);return new e(o.score,o.relativeBox,o.imageDims)},e}(ap);function up(t,e,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return n?r/(t.area+e.area-r):r/Math.min(t.area,e.area)}function cp(t,e,n,r){void 0===r&&(r=!0);for(var o=e.map(function(t,e){return{score:t,boxIndex:e}}).sort(function(t,e){return t.score-e.score}).map(function(t){return t.boxIndex}),i=[],a=function(){var e=o.pop();i.push(e);for(var a=o,s=[],u=0;u<a.length;u++){var c=a[u],l=t[e],h=t[c];s.push(up(l,h,r))}o=o.filter(function(t,e){return s[e]<=n})};o.length>0;)a();return i}function lp(t,e){return lr(function(){var n=e[0],r=e[1],o=e[2],i=Wr(qf(t.shape.slice(0,3),[1]),n),a=Wr(qf(t.shape.slice(0,3),[1]),r),s=Wr(qf(t.shape.slice(0,3),[1]),o),u=Gr([i,a,s],3);return Yc(t,u)})}function hp(t){return 1/(1+Math.exp(-t))}var dp,fp=function(t){function e(e,n,r,o,i){return void 0===i&&(i=!1),t.call(this,{x:e,y:n,width:r,height:o},i)||this}return Vf(e,t),e}(op),pp=function(){function t(t,e,n){void 0===n&&(n=new rp(0,0));var r=e.width,o=e.height;this._imgDims=new Kf(r,o),this._shift=n,this._positions=t.map(function(t){return t.mul(new rp(r,o)).add(n)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new rp(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new rp(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new rp(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var n=t instanceof sp?t.box.floor():new op(t);return this.shiftBy(n.x,n.y).align(null,e)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=r.useDlibAlignment,i=r.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(i)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],n=t[1],r=t[2],o=function(t){return r.sub(t).magnitude()},i=(o(e)+o(n))/2,a=Math.floor(i/.45),s=$f(t),u=Math.floor(Math.max(0,s.x-.5*a)),c=Math.floor(Math.max(0,s.y-.43*a));return new fp(u,c,Math.min(a,this.imageWidth+u),Math.min(a,this.imageHeight+c))},t.prototype.alignMinBbox=function(t){var e=function(t){var e=t.map(function(t){return t.x}),n=t.map(function(t){return t.y}),r=e.reduce(function(t,e){return e<t?e:t},1/0),o=n.reduce(function(t,e){return e<t?e:t},1/0),i=e.reduce(function(t,e){return t<e?e:t},0),a=n.reduce(function(t,e){return t<e?e:t},0);return new ip(r,o,i,a)}(this.positions);return e.pad(e.width*t,e.height*t)},t.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},t}(),gp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],$f([t[3],t[4]])]},e}(pp),mp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map($f)},e}(pp),vp=function(){function t(t,e){this._label=t,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){return void 0===t&&(t=!0),this.label+(t?" ("+function(t,e){void 0===e&&(e=2);var n=Math.pow(10,e);return Math.floor(t*n)/n}(this.distance)+")":"")},t}(),yp=function(t){function e(e,n){var r=t.call(this,e)||this;return r._label=n,r}return Vf(e,t),e.assertIsValidLabeledBox=function(t,e){if(op.assertIsValidBox(t,e),!ep(t.label))throw new Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(op),bp=function(){function t(t,e){if("string"!==typeof t)throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(t){return!(t instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},t.fromJSON=function(e){var n=e.descriptors.map(function(t){return new Float32Array(t)});return new t(e.label,n)},t}();!function(t){function e(e,n,r,o){var i=t.call(this,e,n)||this;return i._score=r,i._classScore=o,i}Vf(e,t),e.assertIsValidPredictedBox=function(t,e){if(yp.assertIsValidLabeledBox(t,e),!np(t.score)||!np(t.classScore))throw new Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(yp);function wp(t,e){var n={detection:e};return Object.assign({},t,n)}function xp(){var t=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:t,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function Ep(t){var e="";if(!t)try{t=n(Object(function(){var t=new Error("Cannot find module 'fs'");throw t.code="MODULE_NOT_FOUND",t}()))}catch(r){e=r.toString()}return{readFile:t?function(e){return new Promise(function(n,r){t.readFile(e,function(t,e){return t?r(t):n(e)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}function Ap(){var t=n.g.Canvas||n.g.HTMLCanvasElement,e=n.g.Image||n.g.HTMLImageElement,r=n.g.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=Ep();return jf({Canvas:t||function(){},CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){},Image:e||function(){},ImageData:n.g.ImageData||function(){},Video:n.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(t)return new t;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:r},o)}function Cp(){return"object"===typeof window&&"undefined"!==typeof document&&"undefined"!==typeof HTMLImageElement&&"undefined"!==typeof HTMLCanvasElement&&"undefined"!==typeof HTMLVideoElement&&"undefined"!==typeof ImageData&&"undefined"!==typeof CanvasRenderingContext2D}function kp(){return"object"===typeof n.g&&"undefined"!==typeof process&&!!process.version}function Sp(t){dp=t}function Ip(){Cp()&&Sp(xp()),kp()&&Sp(Ap())}var Rp,Tp={getEnv:function(){if(!dp)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return dp},setEnv:Sp,initialize:Ip,createBrowserEnv:xp,createFileSystem:Ep,createNodejsEnv:Ap,monkeyPatch:function(t){if(dp||Ip(),!dp)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=t.Canvas,n=void 0===e?dp.Canvas:e,r=t.Image,o=void 0===r?dp.Image:r;dp.Canvas=n,dp.Image=o,dp.createCanvasElement=t.createCanvasElement||function(){return new n},dp.createImageElement=t.createImageElement||function(){return new o},dp.ImageData=t.ImageData||dp.ImageData,dp.Video=t.Video||dp.Video,dp.fetch=t.fetch||dp.fetch,dp.readFile=t.readFile||dp.readFile},isBrowser:Cp,isNodejs:kp};function Np(t){return Tp.isNodejs()||"string"!==typeof t?t:document.getElementById(t)}function _p(t){var e=Tp.getEnv(),n=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var r=Np(t);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=r.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}Ip(),function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Rp||(Rp={}));var Pp=function(t){void 0===t&&(t={});var e=t.anchorPosition,n=t.backgroundColor,r=t.fontColor,o=t.fontSize,i=t.fontStyle,a=t.padding;this.anchorPosition=e||Rp.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=r||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=i||"Georgia",this.padding=a||4},Dp=function(){function t(e,n,r){void 0===r&&(r={}),this.text="string"===typeof e?[e]:e instanceof t?e.text:e,this.anchor=n,this.options=new Pp(r)}return t.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(e){return t.measureText(e).width}).reduce(function(t,e){return t<e?e:t},0)+2*e},t.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,n=t.padding;return this.text.length*e+2*n},t.prototype.getUpperLeft=function(t,e){var n=this.options.anchorPosition,r=n===Rp.BOTTOM_RIGHT||n===Rp.TOP_RIGHT,o=n===Rp.BOTTOM_LEFT||n===Rp.BOTTOM_RIGHT,i=this.measureWidth(t),a=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,u=o?this.anchor.y-a:this.anchor.y;if(e){var c=e.width,l=e.height;return{x:Math.max(Math.min(s,c-i),0),y:Math.max(Math.min(u,l-a),0)}}return{x:s,y:u}},t.prototype.draw=function(t){var e=Np(t),n=_p(e),r=this.options,o=r.backgroundColor,i=r.fontColor,a=r.fontSize,s=r.fontStyle,u=r.padding;n.font=a+"px "+s;var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=o;var h=this.getUpperLeft(n,e);n.fillRect(h.x,h.y,c,l),n.fillStyle=i,this.text.forEach(function(t,e){var r=u+h.x,o=u+h.y+(e+1)*a;n.fillText(t,r,o)})},t}(),Op=function(t){void 0===t&&(t={});var e=t.boxColor,n=t.lineWidth,r=t.label,o=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=r;var i={anchorPosition:Rp.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Pp(Object.assign({},i,o))};!function(){function t(t,e){void 0===e&&(e={}),this.box=new op(t),this.options=new Op(e)}t.prototype.draw=function(t){var e=_p(t),n=this.options,r=n.boxColor,o=n.lineWidth,i=this.box,a=i.x,s=i.y,u=i.width,c=i.height;e.strokeStyle=r,e.lineWidth=o,e.strokeRect(a,s,u,c);var l=this.options.label;l&&new Dp([l],{x:a-o/2,y:s},this.options.drawLabelOptions).draw(t)}}();function Fp(t){var e=Tp.getEnv(),n=e.Image,r=e.Video;return t instanceof n&&t.complete||t instanceof r&&t.readyState>=3}function Mp(t){var e=Tp.getEnv(),n=e.Image,r=e.Video;return t instanceof n?new Kf(t.naturalWidth,t.naturalHeight):t instanceof r?new Kf(t.videoWidth,t.videoHeight):new Kf(t.width,t.height)}function Bp(t){var e=t.width,n=t.height,r=(0,Tp.getEnv().createCanvasElement)();return r.width=e,r.height=n,r}function Lp(t,e){var n=Tp.getEnv().ImageData;if(!(t instanceof n)&&!Fp(t))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=e||Mp(t),o=r.width,i=r.height,a=Bp({width:o,height:i});return t instanceof n?_p(a).putImageData(t,0,0):_p(a).drawImage(t,0,0,o,i),a}function Up(t,e){return Gf(this,void 0,void 0,function(){var n,r,o,i,a,s;return Hf(this,function(u){switch(u.label){case 0:return n=e||Tp.getEnv().createCanvasElement(),r=t.shape.slice(Jf(t)?1:0),o=r[0],i=r[1],a=r[2],s=lr(function(){return t.as3D(o,i,a).toInt()}),[4,kf.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}})})}function Wp(t){var e=Tp.getEnv(),n=e.Image,r=e.Canvas,o=e.Video;return t instanceof n||t instanceof r||t instanceof o}var zp=function(){function t(t,e){var n=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(t,e){if(Xf(t))return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape);if(Jf(t)){var r=t.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[e]=t,void(n._inputDimensions[e]=t.shape.slice(1))}var o=t instanceof Tp.getEnv().Canvas?t:Lp(t);n._canvases[e]=o,n._inputDimensions[e]=[o.height,o.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return tp(this.batchSize,0,1).map(function(e,n){return t.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){if("number"!==typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return function(t,e){var n=t.width,r=t.height,o=e/Math.max(r,n);return new Kf(Math.round(n*o),Math.round(r*o))}({width:this.getInputWidth(t),height:this.getInputHeight(t)},this.inputSize)},t.prototype.toBatchTensor=function(t,e){var n=this;return void 0===e&&(e=!0),this._inputSize=t,lr(function(){var r=tp(n.batchSize,0,1).map(function(r){var o=n.getInput(r);if(o instanceof ze){var i=Jf(o)?o:o.expandDims();return i=function(t,e){return void 0===e&&(e=!1),lr(function(){var n=t.shape.slice(1),r=n[0],o=n[1];if(r===o)return t;var i=Math.abs(r-o),a=Math.round(i*(e?.5:1)),s=r>o?2:1,u=function(e){var n=t.shape.slice();return n[s]=e,Wr(n,0)},c=u(a),l=i-c.shape[s],h=[e&&l?u(l):null,t,c].filter(function(t){return!!t}).map(function(t){return t.toFloat()});return Gr(h,s)})}(i,e),i.shape[1]===t&&i.shape[2]===t||(i=id.resizeBilinear(i,[t,t])),i.as3D(t,t,3)}if(o instanceof Tp.getEnv().Canvas)return kf.fromPixels(function(t,e,n){void 0===n&&(n=!1);var r=Tp.getEnv(),o=r.Image,i=r.Canvas;if(!(t instanceof o||t instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=Mp(t),s=e/Math.max(a.height,a.width),u=s*a.width,c=s*a.height,l=Bp({width:e,height:e}),h=t instanceof i?t:Lp(t),d=Math.abs(u-c)/2,f=n&&u<c?d:0,p=n&&c<u?d:0;return _p(l).drawImage(h,f,p,u,c),l}(o,t,e));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)}),o=Po(r.map(function(t){return t.toFloat()})).as4D(n.batchSize,t,t,3);return o})},t}();function Vp(t){return Gf(this,void 0,void 0,function(){var e,n,r;return Hf(this,function(o){switch(o.label){case 0:if(t instanceof zp)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw new Error("toNetInput - empty array passed as input");return n=function(e){return Array.isArray(t)?" at input index "+e+":":""},(r=e.map(Np)).forEach(function(t,r){if(!Wp(t)&&!Xf(t)&&!Jf(t)){if("string"===typeof e[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+e[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(Jf(t)){var o=t.shape[0];if(1!==o)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(t){return Wp(t)&&(e=t,new Promise(function(t,n){if(e instanceof Tp.getEnv().Canvas||Fp(e))return t();function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",o),t(e))}function o(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",o),n(t))}e.addEventListener("load",r),e.addEventListener("error",o)}));var e}))];case 1:return o.sent(),[2,new zp(r,Array.isArray(t))]}})})}function jp(t,e){return Gf(this,void 0,void 0,function(){var n,r,o,i,a,s;return Hf(this,function(u){switch(u.label){case 0:return n=Tp.getEnv().Canvas,r=t,t instanceof n?[3,5]:[4,Vp(t)];case 1:if((o=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(i=o.getInput(0))instanceof n?(a=i,[3,4]):[3,2];case 2:return[4,Up(i)];case 3:a=u.sent(),u.label=4;case 4:r=a,u.label=5;case 5:return s=_p(r),[2,e.map(function(t){return t instanceof sp?t.forSize(r.width,r.height).box.floor():t}).map(function(t){return t.clipAtImageBorders(r.width,r.height)}).map(function(t){var e=t.x,n=t.y,r=t.width,o=t.height,i=Bp({width:r,height:o});return _p(i).putImageData(s.getImageData(e,n,r,o),0,0),i})]}})})}function Gp(t,e){return Gf(this,void 0,void 0,function(){return Hf(this,function(n){if(!Xf(t)&&!Jf(t))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Jf(t)&&t.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,lr(function(){var n=t.shape.slice(Jf(t)?1:0),r=n[0],o=n[1],i=n[2],a=e.map(function(t){return t instanceof sp?t.forSize(o,r).box:t}).map(function(t){return t.clipAtImageBorders(o,r)}).map(function(e){var n=e.x,a=e.y,s=e.width,u=e.height;return Kl(t.as3D(r,o,i),[a,n,0],[u,s,i])});return a})]})})}function Hp(t,e){return Gf(this,void 0,void 0,function(){var n;return Hf(this,function(r){switch(r.label){case 0:return[4,(0,Tp.getEnv().fetch)(t,e)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function qp(t){return Gf(this,void 0,void 0,function(){return Hf(this,function(e){switch(e.label){case 0:return[4,Hp(t)];case 1:return[2,e.sent().json()]}})})}function Kp(t,e){var n=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:n};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+n};var r=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(r,"")).split("/").filter(function(t){return t}),i=t.endsWith(".json")?o[o.length-1]:n,a=r+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function Qp(t,e){return Gf(this,void 0,void 0,function(){var n,r,o,i;return Hf(this,function(a){switch(a.label){case 0:return n=Kp(t,e),r=n.manifestUri,o=n.modelBaseUri,[4,qp(r)];case 1:return i=a.sent(),[2,Ef.loadWeights(i,o)]}})})}var Xp=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var n=this.traversePropertyPath(t),r=n.obj,o=n.objProp;r[o].dispose(),r[o]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var n=e.paramPath;return{path:n,tensor:t.getParamFromPath(n)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof Ke})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof Ke)})},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var n=e.path,r=e.tensor;t.reassignParamFromPath(n,r.variable())})},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var n=e.path,r=e.tensor,o=_r(r.dataSync());r.dispose(),t.reassignParamFromPath(n,o)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},t.prototype.load=function(t){return Gf(this,void 0,void 0,function(){return Hf(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:if(t&&"string"!==typeof t)throw new Error(this._name+".loadFromUri - expected model uri");return[4,Qp(t,this.getDefaultModelName())];case 1:return e=n.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(t){return Gf(this,void 0,void 0,function(){var e,n,r,o,i,a,s,u,c,l;return Hf(this,function(h){switch(h.label){case 0:if(t&&"string"!==typeof t)throw new Error(this._name+".loadFromDisk - expected model file path");return e=Tp.getEnv().readFile,n=Kp(t,this.getDefaultModelName()),r=n.manifestUri,o=n.modelBaseUri,i=function(t){return Promise.all(t.map(function(t){return e(t).then(function(t){return t.buffer})}))},a=Ef.weightsLoaderFactory(i),c=(u=JSON).parse,[4,e(r)];case 1:return s=c.apply(u,[h.sent().toString()]),[4,a(s,o)];case 2:return l=h.sent(),this.loadFromWeightMap(l),[2]}})})},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.extractWeights=function(t){var e=this.extractParams(t),n=e.paramMappings,r=e.params;this._paramMappings=n,this._params=r},t.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(e,n){if(!e.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+t);return{obj:e.nextObj,objProp:n,nextObj:e.nextObj[n]}},{nextObj:this.params}),n=e.obj,r=e.objProp;if(!n||!r||!(n[r]instanceof ze))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:n,objProp:r}},t}();function Jp(t,e,n){return lr(function(){var r=Sl(t,e.depthwise_filter,e.pointwise_filter,n,"same");return r=Pc(r,e.bias)})}function Yp(t,e,n){return void 0===n&&(n=!1),lr(function(){var r=lh(n?Pc(bl(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):Jp(t,e.conv0,[2,2])),o=Jp(r,e.conv1,[1,1]),i=Jp(lh(Pc(r,o)),e.conv2,[1,1]);return lh(Pc(r,Pc(o,i)))})}function Zp(t,e,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),lr(function(){var o=lh(n?Pc(bl(t,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Jp(t,e.conv0,r?[2,2]:[1,1])),i=Jp(o,e.conv1,[1,1]),a=Jp(lh(Pc(o,i)),e.conv2,[1,1]),s=Jp(lh(Pc(o,Pc(i,a))),e.conv3,[1,1]);return lh(Pc(o,Pc(i,Pc(a,s))))})}function $p(t,e,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),lr(function(){var o=Pc(bl(t,e.filters,[1,1],n),e.bias);return r?lh(o):o})}function tg(t,e){Object.keys(t).forEach(function(n){e.some(function(t){return t.originalPath===n})||t[n].dispose()})}function eg(t,e){return function(n,r,o,i){var a=Br(t(n*r*o*o),[o,o,n,r]),s=Or(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function ng(t,e){return function(n,r,o){var i=Fr(t(n*r),[n,r]),a=Or(t(r));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var rg=function(t,e,n){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=n};function og(t,e){return function(n,r,o){var i=Br(t(9*n),[3,3,n,1]),a=Br(t(n*r),[1,1,n,r]),s=Or(t(r));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new rg(i,a,s)}}function ig(t){return function(e){var n=t(e+"/depthwise_filter",4),r=t(e+"/pointwise_filter",4),o=t(e+"/bias",1);return new rg(n,r,o)}}function ag(t,e){return function(n,r,o){var i=t[n];if(!Qf(i,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+i);return e.push({originalPath:n,paramPath:o||n}),i}}function sg(t){var e=t;return{extractWeights:function(t){var n=e.slice(0,t);return e=e.slice(t),n},getRemainingWeights:function(){return e}}}function ug(t,e){var n=eg(t,e),r=og(t,e);function o(t,e,o,i){return void 0===i&&(i=!1),{conv0:i?n(t,e,3,o+"/conv0"):r(t,e,o+"/conv0"),conv1:r(e,e,o+"/conv1"),conv2:r(e,e,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(t,e,n,i){void 0===i&&(i=!1);var a=o(t,e,n,i);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:r(e,e,n+"/conv3")}}}}function cg(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function lg(t,e){var n=ag(t,e),r=cg(n),o=ig(n);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?r(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2"),conv3:o(t+"/conv3")}}}}var hg=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return Vf(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceFeatureExtractor - load model before inference");return lr(function(){var n=Zp(lp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Dr(255)),e.dense0,!0);return n=Zp(n,e.dense1),n=Zp(n,e.dense2),n=Zp(n,e.dense3),n=Wl(n,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Vp(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=lg(t,e).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return tg(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=sg(t),r=n.extractWeights,o=n.getRemainingWeights,i=ug(r,e).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:c}}}(t)},e}(Xp);function dg(t,e){return lr(function(){return Pc(Tl(t,e.weights),e.bias)})}function fg(t){var e={},n={};return Object.keys(t).forEach(function(r){(r.startsWith("fc")?n:e)[r]=t[r]}),{featureExtractorMap:e,classifierMap:n}}var pg=function(t){function e(e,n){var r=t.call(this,e)||this;return r._faceFeatureExtractor=n,r}return Vf(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return lr(function(){var r=t instanceof zp?e.faceFeatureExtractor.forwardInput(t):t;return dg(r.as2D(r.shape[0],-1),n.fc)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t,e,n){var r=[],o=sg(t),i=o.extractWeights,a=o.getRemainingWeights,s=ng(i,r)(e,n,"fc");if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:s}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e=fg(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e,n=[],r=ag(t,n),o={fc:(e="fc",{weights:r(e+"/weights",2),bias:r(e+"/bias",1)})};return tg(t,n),{params:o,paramMappings:n}}(r)},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*e+n,o=t.slice(0,t.length-r),i=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(Xp),gg=["neutral","happy","sad","angry","fearful","disgusted","surprised"],mg=function(){function t(t){var e=this;if(7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);gg.forEach(function(n,r){e[n]=t[r]})}return t.prototype.asSortedArray=function(){var t=this;return gg.map(function(e){return{expression:e,probability:t[e]}}).sort(function(t,e){return e.probability-t.probability})},t}(),vg=function(t){function e(e){return void 0===e&&(e=new hg),t.call(this,"FaceExpressionNet",e)||this}return Vf(e,t),e.prototype.forwardInput=function(t){var e=this;return lr(function(){return ti(e.runNet(t))})},e.prototype.forward=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Vp(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictExpressions=function(t){return Gf(this,void 0,void 0,function(){var e,n,r,o,i=this;return Hf(this,function(a){switch(a.label){case 0:return[4,Vp(t)];case 1:return e=a.sent(),[4,this.forwardInput(e)];case 2:return n=a.sent(),[4,Promise.all(Fo(n).map(function(t){return Gf(i,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return[4,t.data()];case 1:return e=n.sent(),t.dispose(),[2,e]}})})}))];case 3:return r=a.sent(),n.dispose(),o=r.map(function(t){return new mg(t)}),[2,e.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(pg);function yg(t,e){var n={expressions:e};return Object.assign({},t,n)}function bg(t){return function(t){return t.detection instanceof sp}(t)&&t.landmarks instanceof pp&&t.unshiftedLandmarks instanceof pp&&t.alignedRect instanceof sp}function wg(t,e){var n=t.detection.box,r=e.shiftBy(n.x,n.y),o=r.align(),i=t.detection.imageDims,a={landmarks:r,unshiftedLandmarks:e,alignedRect:new sp(t.detection.score,o.rescale(i.reverse()),i)};return Object.assign({},t,a)}function xg(t,e,n){if(void 0===n&&(n=!1),t.beginPath(),e.slice(1).forEach(function(n,r){var o=n.x,i=n.y,a=e[r];t.moveTo(a.x,a.y),t.lineTo(o,i)}),n){var r=e[e.length-1],o=e[0];if(!r||!o)return;t.moveTo(r.x,r.y),t.lineTo(o.x,o.y)}t.stroke()}var Eg=function(t){void 0===t&&(t={});var e=t.drawLines,n=void 0===e||e,r=t.drawPoints,o=void 0===r||r,i=t.lineWidth,a=t.lineColor,s=t.pointSize,u=t.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=i||1,this.pointSize=s||2,this.lineColor=a||"rgba(0, 255, 255, 1)",this.pointColor=u||"rgba(255, 0, 255, 1)"};!function(){function t(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new Eg(e)}t.prototype.draw=function(t){var e=_p(t),n=this.options,r=n.drawLines,o=n.drawPoints,i=n.lineWidth,a=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof mp&&(e.strokeStyle=a,e.lineWidth=i,xg(e,this.faceLandmarks.getJawOutline()),xg(e,this.faceLandmarks.getLeftEyeBrow()),xg(e,this.faceLandmarks.getRightEyeBrow()),xg(e,this.faceLandmarks.getNose()),xg(e,this.faceLandmarks.getLeftEye(),!0),xg(e,this.faceLandmarks.getRightEye(),!0),xg(e,this.faceLandmarks.getMouth(),!0)),o){e.strokeStyle=u,e.fillStyle=u;this.faceLandmarks.positions.forEach(function(t){e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI),e.fill()})}}}();function Ag(t,e){var n=[],r=sg(t),o=r.extractWeights,i=r.getRemainingWeights,a=function(t,e){var n=eg(t,e),r=og(t,e);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(t,e,o){return{separable_conv0:r(t,e,o+"/separable_conv0"),separable_conv1:r(e,e,o+"/separable_conv1"),expansion_conv:n(t,e,1,o+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:r(t,t,e+"/separable_conv0"),separable_conv1:r(t,t,e+"/separable_conv1"),separable_conv2:r(t,t,e+"/separable_conv2")}}}}(o,n),s=a.extractConvParams,u=a.extractSeparableConvParams,c=a.extractReductionBlockParams,l=a.extractMainBlockParams,h={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},d={};tp(e,0,1).forEach(function(t){d["main_block_"+t]=l(128,"middle_flow/main_block_"+t)});var f={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:h,middle_flow:d,exit_flow:f}}}function Cg(t,e){var n=[],r=function(t,e){var n=ag(t,e),r=cg(n),o=ig(n);return{extractConvParams:r,extractSeparableConvParams:o,extractReductionBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),expansion_conv:r(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:o(t+"/separable_conv0"),separable_conv1:o(t+"/separable_conv1"),separable_conv2:o(t+"/separable_conv2")}}}}(t,n),o=r.extractConvParams,i=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:o("entry_flow/conv_in"),reduction_block_0:a("entry_flow/reduction_block_0"),reduction_block_1:a("entry_flow/reduction_block_1")},c={};tp(e,0,1).forEach(function(t){c["main_block_"+t]=s("middle_flow/main_block_"+t)});var l={reduction_block:a("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return tg(t,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function kg(t,e,n){return Pc(bl(t,e.filters,n,"same"),e.bias)}function Sg(t,e,n){void 0===n&&(n=!0);var r=n?lh(t):t;return r=Jp(r,e.separable_conv0,[1,1]),r=Jp(lh(r),e.separable_conv1,[1,1]),r=Ul(r,[3,3],[2,2],"same"),r=Pc(r,kg(t,e.expansion_conv,[2,2]))}var Ig,Rg=function(t){function e(e){var n=t.call(this,"TinyXception")||this;return n._numMainBlocks=e,n}return Vf(e,t),e.prototype.forwardInput=function(t){var e=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return lr(function(){var r=lp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Dr(256)),o=lh(kg(r,n.entry_flow.conv_in,[2,2]));return o=Sg(o,n.entry_flow.reduction_block_0,!1),o=Sg(o,n.entry_flow.reduction_block_1),tp(e._numMainBlocks,0,1).forEach(function(t){o=function(t,e){var n=Jp(lh(t),e.separable_conv0,[1,1]);return n=Jp(lh(n),e.separable_conv1,[1,1]),n=Jp(lh(n),e.separable_conv2,[1,1]),Pc(n,t)}(o,n.middle_flow["main_block_"+t])}),o=Sg(o,n.exit_flow.reduction_block),o=lh(Jp(o,n.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Vp(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Cg(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return Ag(t,this._numMainBlocks)},e}(Xp);!function(t){t.FEMALE="female",t.MALE="male"}(Ig||(Ig={}));var Tg=function(t){function e(e){void 0===e&&(e=new Rg(2));var n=t.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=e,n}return Vf(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return lr(function(){var r=t instanceof zp?e.faceFeatureExtractor.forwardInput(t):t,o=Wl(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:dg(o,n.fc.age).as1D(),gender:dg(o,n.fc.gender)}})},e.prototype.forwardInput=function(t){var e=this;return lr(function(){var n=e.runNet(t),r=n.age,o=n.gender;return{age:r,gender:ti(o)}})},e.prototype.forward=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Vp(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return Gf(this,void 0,void 0,function(){var e,n,r,o,i,a,s=this;return Hf(this,function(u){switch(u.label){case 0:return[4,Vp(t)];case 1:return e=u.sent(),[4,this.forwardInput(e)];case 2:return n=u.sent(),r=Fo(n.age),o=Fo(n.gender),i=r.map(function(t,e){return{ageTensor:t,genderTensor:o[e]}}),[4,Promise.all(i.map(function(t){var e=t.ageTensor,n=t.genderTensor;return Gf(s,void 0,void 0,function(){var t,r,o,i,a;return Hf(this,function(s){switch(s.label){case 0:return[4,e.data()];case 1:return t=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],i=(o=r>.5)?Ig.MALE:Ig.FEMALE,a=o?r:1-r,e.dispose(),n.dispose(),[2,{age:t,gender:i,genderProbability:a}]}})})}))];case 3:return a=u.sent(),n.age.dispose(),n.gender.dispose(),[2,e.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),n=e.params,r=e.paramMappings;this._params=n,this._paramMappings=r},e.prototype.extractClassifierParams=function(t){return function(t){var e=[],n=sg(t),r=n.extractWeights,o=n.getRemainingWeights,i=ng(r,e),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var e=fg(t),n=e.featureExtractorMap,r=e.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(t){var e=[],n=ag(t,e);function r(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}var o={fc:{age:r("fc/age"),gender:r("fc/gender")}};return tg(t,e),{params:o,paramMappings:e}}(r)},e.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),n=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(n)},e}(Xp),Ng=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.postProcess=function(t,e,n){var r=n.map(function(t){var n=t.width,r=t.height,o=e/Math.max(r,n);return{width:n*o,height:r*o}}),o=r.length;return lr(function(){var n=function(t,e){return Po([Wr([68],t),Wr([68],e)],1).as2D(1,136).as1D()},i=function(t,e){var n=r[t],o=n.width,i=n.height;return e(o,i)?Math.abs(o-i)/2:0},a=t.mul(Wr([o,136],e)).sub(Po(Array.from(Array(o),function(t,e){return n(function(t){return i(t,function(t,e){return t<e})}(e),function(t){return i(t,function(t,e){return e<t})}(e))}))).div(Po(Array.from(Array(o),function(t,e){return n(r[e].width,r[e].height)})));return a})},e.prototype.forwardInput=function(t){var e=this;return lr(function(){var n=e.runNet(t);return e.postProcess(n,t.inputSize,t.inputDimensions.map(function(t){return{height:t[0],width:t[1]}}))})},e.prototype.forward=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Vp(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.detectLandmarks=function(t){return Gf(this,void 0,void 0,function(){var e,n,r,o=this;return Hf(this,function(i){switch(i.label){case 0:return[4,Vp(t)];case 1:return e=i.sent(),n=lr(function(){return Fo(o.forwardInput(e))}),[4,Promise.all(n.map(function(t,n){return Gf(o,void 0,void 0,function(){var r,o,i,a,s;return Hf(this,function(u){switch(u.label){case 0:return i=(o=Array).from,[4,t.data()];case 1:return r=i.apply(o,[u.sent()]),a=r.filter(function(t,e){return Yf(e)}),s=r.filter(function(t,e){return!Yf(e)}),[2,new mp(Array(68).fill(0).map(function(t,e){return new rp(a[e],s[e])}),{height:e.getInputHeight(n),width:e.getInputWidth(n)})]}})})}))];case 2:return r=i.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?r:r[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(pg),_g=function(t){function e(e){return void 0===e&&(e=new hg),t.call(this,"FaceLandmark68Net",e)||this}return Vf(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(Ng);var Pg=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return Vf(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("TinyFaceFeatureExtractor - load model before inference");return lr(function(){var n=Yp(lp(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(Dr(255)),e.dense0,!0);return n=Yp(n,e.dense1),n=Yp(n,e.dense2),n=Wl(n,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Vp(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],n=lg(t,e).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return tg(t,e),{params:r,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=sg(t),r=n.extractWeights,o=n.getRemainingWeights,i=ug(r,e).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}(t)},e}(Xp),Dg=function(t){function e(e){return void 0===e&&(e=new Pg),t.call(this,"FaceLandmark68TinyNet",e)||this}return Vf(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(Ng);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Vf(e,t)}(_g);function Og(t,e,n,r,o){void 0===o&&(o="same");var i=e.conv,a=i.filters,s=i.bias,u=bl(t,a,n,o);return u=function(t,e){return Pc(qc(t,e.weights),e.biases)}(u=Pc(u,s),e.scale),r?lh(u):u}function Fg(t,e){return Og(t,e,[1,1],!1)}function Mg(t,e){return Og(t,e,[2,2],!0,"valid")}function Bg(t,e){function n(n,r,o,i){var a=function(e,n,r){var o=t(e),i=o.length/(n*r*r);if(i%1!==0)throw new Error("depth has to be an integer: "+i+", weights.length: "+o.length+", numFilters: "+n+", filterSize: "+r);return lr(function(){return fh(Br(o,[n,i,r,r]),[2,3,1,0])})}(n,r,o),s=Or(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}function r(r,o,i,a){var s=n(r,o,i,a+"/conv"),u=function(n,r){var o=Or(t(n)),i=Or(t(n));return e.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:o,biases:i}}(o,a+"/scale");return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t,e,n,o,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*t,e,n,o+"/conv1"),conv2:r(t,e,n,o+"/conv2")}}}}function Lg(t,e){var n=ag(t,e);function r(t){var e=n(t+"/conv/filters",4),r=n(t+"/conv/bias",1),o=function(t){return{weights:n(t+"/scale/weights",1),biases:n(t+"/scale/biases",1)}}(t);return{conv:{filters:e,bias:r},scale:o}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t){return{conv1:r(t+"/conv1"),conv2:r(t+"/conv2")}}}}function Ug(t){var e=[],n=Lg(t,e),r=n.extractConvLayerParams,o=n.extractResidualLayerParams,i=r("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),u=o("conv32_3"),c=o("conv64_down"),l=o("conv64_1"),h=o("conv64_2"),d=o("conv64_3"),f=o("conv128_down"),p=o("conv128_1"),g=o("conv128_2"),m=o("conv256_down"),v=o("conv256_1"),y=o("conv256_2"),b=o("conv256_down_out"),w=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!Qf(w,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var x={conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:h,conv64_3:d,conv128_down:f,conv128_1:p,conv128_2:g,conv256_down:m,conv256_1:v,conv256_2:y,conv256_down_out:b,fc:w};return tg(t,e),{params:x,paramMappings:e}}function Wg(t,e){var n=function(t,e){return Og(t,e,[1,1],!0)}(t,e.conv1);return n=Fg(n,e.conv2),n=Pc(n,t),n=lh(n)}function zg(t,e){var n=Mg(t,e.conv1);n=Fg(n,e.conv2);var r=Wl(t,2,2,"valid"),o=Ur(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var a=qf(n.shape);a[1]=1;var s=Ur(a),u=qf((n=Gr([n,s],1)).shape);u[2]=1;var c=Ur(u);n=Gr([n,c],2)}return r=i?Gr([r,o],3):r,n=Pc(r,n),n=lh(n)}var Vg=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return Vf(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("FaceRecognitionNet - load model before inference");return lr(function(){var n=Mg(lp(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(Dr(256)),e.conv32_down);n=Wg(n=Ul(n,3,2,"valid"),e.conv32_1),n=Wg(n,e.conv32_2),n=Wg(n,e.conv32_3),n=Wg(n=zg(n,e.conv64_down),e.conv64_1),n=Wg(n,e.conv64_2),n=Wg(n,e.conv64_3),n=Wg(n=zg(n,e.conv128_down),e.conv128_1),n=Wg(n,e.conv128_2),n=Wg(n=zg(n,e.conv256_down),e.conv256_1);var r=(n=zg(n=Wg(n,e.conv256_2),e.conv256_down_out)).mean([1,2]);return Tl(r,e.fc)})},e.prototype.forward=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Vp(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return Gf(this,void 0,void 0,function(){var e,n,r,o=this;return Hf(this,function(i){switch(i.label){case 0:return[4,Vp(t)];case 1:return e=i.sent(),n=lr(function(){return Fo(o.forwardInput(e))}),[4,Promise.all(n.map(function(t){return t.data()}))];case 2:return r=i.sent(),n.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?r:r[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Ug(t)},e.prototype.extractParams=function(t){return function(t){var e=sg(t),n=e.extractWeights,r=e.getRemainingWeights,o=[],i=Bg(n,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),p=s(36864,64,3,"conv64_2"),g=s(36864,64,3,"conv64_3"),m=s(147456,128,3,"conv128_down",!0),v=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),A=lr(function(){return fh(Fr(n(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:h,conv64_down:d,conv64_1:f,conv64_2:p,conv64_3:g,conv128_down:m,conv128_1:v,conv128_2:y,conv256_down:b,conv256_1:w,conv256_2:x,conv256_down_out:E,fc:A},paramMappings:o}}(t)},e}(Xp);function jg(t,e,n){var r={gender:e,genderProbability:n};return Object.assign({},t,r)}var Gg=function(){function t(t){var e=void 0===t?{}:t,n=e.minFaceSize,r=e.scaleFactor,o=e.maxNumScales,i=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,"number"!==typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!==typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!==typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(t){return"number"!==typeof t}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(t){return"number"!==typeof t})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function Hg(t,e){function n(n,r,o,i,a){var s=Br(t(n*r*o*o),[o,o,n,r]),u=Or(t(r));return e.push({paramPath:i+"/filters"},{paramPath:i+"/"+(a?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(t,e,r,o){var i=n(t,e,r,o,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function o(n,o,i){var a=function(n,r){var o=Br(t(9*n),[3,3,n,1]),i=Or(t(n)),a=Or(t(n)),s=Or(t(n)),u=Or(t(n));return e.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:o,batch_norm_scale:i,batch_norm_offset:a,batch_norm_mean:s,batch_norm_variance:u}}(n,i+"/depthwise_conv");return{depthwise_conv:a,pointwise_conv:r(n,o,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function qg(t){var e=[],n=function(t,e){var n=ag(t,e);function r(t,e,r){return{filters:n(t+"/Conv2d_"+e+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function o(t){var e="mobilenetv1/conv_"+t,o="MobilenetV1/Conv2d_"+t+"_depthwise",i=e+"/depthwise_conv",a=e+"/pointwise_conv";return{depthwise_conv:{filters:n(o+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:n(o+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:n(o+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:n(o+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:n(o+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",t,a)}}function i(t,e){return{filters:n(t+"/weights",4,e+"/filters"),bias:n(t+"/biases",1,e+"/bias")}}function a(t){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,e),r=n.extractMobilenetV1Params,o=n.extractPredictionLayerParams,i=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Xf(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:r(),prediction_layer:o(),output_layer:{extra_dim:i}};return tg(t,e),{params:a,paramMappings:e}}function Kg(t,e,n){return lr(function(){var r=bl(t,e.filters,n,"same");return r=Pc(r,e.batch_norm_offset),Wu(r,0,6)})}function Qg(t,e){return lr(function(){var n=null,r=Kg(t,e.conv_0,[2,2]);if([e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13].forEach(function(t,e){var o=e+1,i=function(t){return[2,4,6,12].some(function(e){return e===t})?[2,2]:[1,1]}(o);r=function(t,e,n){return lr(function(){var r=Al(t,e.filters,n,"same");return r=Ec(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,.0010000000474974513),Wu(r,0,6)})}(r,t.depthwise_conv,i),r=Kg(r,t.pointwise_conv,[1,1]),11===o&&(n=r)}),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}})}function Xg(t,e,n){var r=t.arraySync(),o=Math.min(r[e][0],r[e][2]),i=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),d=(a-o)*(s-i),f=(l-u)*(h-c);if(d<=0||f<=0)return 0;var p=Math.max(o,u),g=Math.max(i,c),m=Math.min(a,l),v=Math.min(s,h),y=Math.max(m-p,0)*Math.max(v-g,0);return y/(d+f-y)}function Jg(t,e){var n=function(t){var e=Fo(fh(t,[1,0])),n=[Yc(e[2],e[0]),Yc(e[3],e[1])];return{sizes:n,centers:[Pc(e[0],Mc(n[0],Dr(2))),Pc(e[1],Mc(n[1],Dr(2)))]}}(t),r=n.sizes,o=n.centers,i=Fo(fh(e,[1,0])),a=Mc(qc(Gu(Mc(i[2],Dr(5))),r[0]),Dr(2)),s=Pc(qc(Mc(i[0],Dr(10)),r[0]),o[0]),u=Mc(qc(Gu(Mc(i[3],Dr(5))),r[1]),Dr(2)),c=Pc(qc(Mc(i[1],Dr(10)),r[1]),o[1]);return fh(Po([Yc(s,a),Yc(c,u),Pc(s,a),Pc(c,u)]),[1,0])}function Yg(t,e){return lr(function(){var n=t.shape[0];return{boxPredictionEncoding:To($p(t,e.box_encoding_predictor),[n,-1,1,4]),classPrediction:To($p(t,e.class_predictor),[n,-1,3])}})}var Zg=function(){function t(t){var e=void 0===t?{}:t,n=e.minConfidence,r=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!==typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!==typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),$g=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return Vf(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw new Error("SsdMobilenetv1 - load model before inference");return lr(function(){var n=t.toBatchTensor(512,!1).toFloat(),r=Qg(Yc(qc(n,Dr(.007843137718737125)),Dr(1)),e.mobilenetv1),o=function(t,e,n){return lr(function(){var r=Kg(t,n.conv_0,[1,1]),o=Kg(r,n.conv_1,[2,2]),i=Kg(o,n.conv_2,[1,1]),a=Kg(i,n.conv_3,[2,2]),s=Kg(a,n.conv_4,[1,1]),u=Kg(s,n.conv_5,[2,2]),c=Kg(u,n.conv_6,[1,1]),l=Kg(c,n.conv_7,[2,2]),h=Yg(e,n.box_predictor_0),d=Yg(t,n.box_predictor_1),f=Yg(o,n.box_predictor_2),p=Yg(a,n.box_predictor_3),g=Yg(u,n.box_predictor_4),m=Yg(l,n.box_predictor_5);return{boxPredictions:Gr([h.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,p.boxPredictionEncoding,g.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:Gr([h.classPrediction,d.classPrediction,f.classPrediction,p.classPrediction,g.classPrediction,m.classPrediction],1)}})}(r.out,r.conv11,e.prediction_layer);return function(t,e,n){return lr(function(){var r=t.shape[0],o=Jg(To(Do(n.extra_dim,[r,1,1]),[-1,4]),To(t,[-1,4]));o=To(o,[r,o.shape[0]/r,4]);var i=tc(Gl(e,[0,0,1],[-1,-1,-1])),a=Gl(i,[0,0,0],[-1,-1,1]);return a=To(a,[r,a.shape[1]]),{boxes:Fo(o),scores:Fo(a)}})}(o.boxPredictions,o.classPredictions,e.output_layer)})},e.prototype.forward=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=this.forwardInput,[4,Vp(t)];case 1:return[2,e.apply(this,[n.sent()])]}})})},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),Gf(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,d,f,p,g,m,v,y,b,w,x;return Hf(this,function(E){switch(E.label){case 0:return n=new Zg(e),r=n.maxResults,o=n.minConfidence,[4,Vp(t)];case 1:for(i=E.sent(),a=this.forwardInput(i),s=a.boxes,u=a.scores,c=s[0],l=u[0],h=1;h<s.length;h++)s[h].dispose(),u[h].dispose();return p=(f=Array).from,[4,l.data()];case 2:return d=p.apply(f,[E.sent()]),g=function(t,e,n,r,o){var i=t.shape[0],a=Math.min(n,i),s=e.map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>o}).sort(function(t,e){return e.score-t.score}),u=function(t){return t<=r?1:0},c=[];return s.forEach(function(e){if(!(c.length>=a)){for(var n=e.score,r=c.length-1;r>=0;--r){var i=Xg(t,e.boxIndex,c[r]);if(0!==i&&(e.score*=u(i),e.score<=o))break}n===e.score&&c.push(e.boxIndex)}}),c}(c,d,r,.5,o),m=i.getReshapedInputDimensions(0),v=i.inputSize,y=v/m.width,b=v/m.height,w=c.arraySync(),x=g.map(function(t){var e=[Math.max(0,w[t][0]),Math.min(1,w[t][2])].map(function(t){return t*b}),n=e[0],r=e[1],o=[Math.max(0,w[t][1]),Math.min(1,w[t][3])].map(function(t){return t*y}),a=o[0],s=o[1];return new sp(d[t],new fp(a,n,s-a,r-n),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),c.dispose(),l.dispose(),[2,x]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return qg(t)},e.prototype.extractParams=function(t){return function(t){var e=[],n=sg(t),r=n.extractWeights,o=n.getRemainingWeights,i=Hg(r,e),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),c=s(),l={extra_dim:Mr(r(20472),[1,5118,4])};if(e.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:e}}(t)},e}(Xp);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}Vf(e,t)}($g);var tm,em=[new rp(.738768,.874946),new rp(2.42204,2.65704),new rp(4.30971,7.04493),new rp(10.246,4.59428),new rp(12.6868,11.8741)],nm=[new rp(1.603231,2.094468),new rp(6.041143,7.080126),new rp(2.882459,3.518061),new rp(4.266906,5.178857),new rp(9.041765,10.66308)],rm=[117.001,114.697,97.404],om=function(t){return"number"===typeof t};function im(t){return lr(function(){var e=qc(t,Dr(.10000000149011612));return Pc(lh(Yc(t,e)),e)})}function am(t,e){return lr(function(){var n=wo(t,[[0,0],[1,1],[1,1],[0,0]]);return n=bl(n,e.conv.filters,[1,1],"valid"),n=Yc(n,e.bn.sub),n=qc(n,e.bn.truediv),im(n=Pc(n,e.conv.bias))})}function sm(t,e){return lr(function(){var n=wo(t,[[0,0],[1,1],[1,1],[0,0]]);return n=Sl(n,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),im(n=Pc(n,e.bias))})}function um(t,e){var n=eg(t,e);var r=og(t,e);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,o,i){var a=n(r,o,3,i+"/conv"),s=function(n,r){var o=Or(t(n)),i=Or(t(n));return e.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:o,truediv:i}}(o,i+"/bn");return{conv:a,bn:s}},extractSeparableConvParams:r}}function cm(t,e){var n=ag(t,e);function r(t){return{filters:n(t+"/filters",4),bias:n(t+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(t){var e=r(t+"/conv"),o=function(t){return{sub:n(t+"/sub",1),truediv:n(t+"/truediv",1)}}(t+"/bn");return{conv:e,bn:o}},extractSeparableConvParams:ig(n)}}!function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"}(tm||(tm={}));var lm=function(){function t(t){var e=void 0===t?{}:t,n=e.inputSize,r=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!==typeof this._inputSize||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!==typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),hm=function(t){function e(e){var n=t.call(this,"TinyYolov2")||this;return function(t){if(!t)throw new Error("invalid config: "+t);if("boolean"!==typeof t.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+t.withSeparableConvs);if(!om(t.iouThreshold)||t.iouThreshold<0||t.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+t.iouThreshold);if(!Array.isArray(t.classes)||!t.classes.length||!t.classes.every(function(t){return"string"===typeof t}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(t.classes));if(!Array.isArray(t.anchors)||!t.anchors.length||!t.anchors.map(function(t){return t||{}}).every(function(t){return om(t.x)&&om(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(t.anchors));if(t.meanRgb&&(!Array.isArray(t.meanRgb)||3!==t.meanRgb.length||!t.meanRgb.every(om)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(t.meanRgb))}(e),n._config=e,n}return Vf(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var n=am(t,e.conv0);return n=am(n=Ul(n,[2,2],[2,2],"same"),e.conv1),n=am(n=Ul(n,[2,2],[2,2],"same"),e.conv2),n=am(n=Ul(n,[2,2],[2,2],"same"),e.conv3),n=am(n=Ul(n,[2,2],[2,2],"same"),e.conv4),n=am(n=Ul(n,[2,2],[2,2],"same"),e.conv5),n=am(n=Ul(n,[2,2],[1,1],"same"),e.conv6),$p(n=am(n,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var n=this.config.isFirstLayerConv2d?im($p(t,e.conv0,"valid",!1)):sm(t,e.conv0);return n=sm(n=Ul(n,[2,2],[2,2],"same"),e.conv1),n=sm(n=Ul(n,[2,2],[2,2],"same"),e.conv2),n=sm(n=Ul(n,[2,2],[2,2],"same"),e.conv3),n=sm(n=Ul(n,[2,2],[2,2],"same"),e.conv4),n=sm(n=Ul(n,[2,2],[2,2],"same"),e.conv5),n=Ul(n,[2,2],[1,1],"same"),n=e.conv6?sm(n,e.conv6):n,$p(n=e.conv7?sm(n,e.conv7):n,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return lr(function(){var o=t.toBatchTensor(e,!1).toFloat();return o=(o=n.config.meanRgb?lp(o,n.config.meanRgb):o).div(Dr(256)),n.config.withSeparableConvs?n.runMobilenet(o,r):n.runTinyYolov2(o,r)})},e.prototype.forward=function(t,e){return Gf(this,void 0,void 0,function(){var n;return Hf(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Vp(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent()]}})})},e.prototype.detect=function(t,e){return void 0===e&&(e={}),Gf(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,d,f,p,g=this;return Hf(this,function(m){switch(m.label){case 0:return n=new lm(e),r=n.inputSize,o=n.scoreThreshold,[4,Vp(t)];case 1:return i=m.sent(),[4,this.forwardInput(i,r)];case 2:return a=m.sent(),s=lr(function(){return Fo(a)[0].expandDims()}),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(s,i.getReshapedInputDimensions(0),o)];case 3:return c=m.sent(),a.dispose(),s.dispose(),l=c.map(function(t){return t.box}),h=c.map(function(t){return t.score}),d=c.map(function(t){return t.classScore}),f=c.map(function(t){return g.config.classes[t.label]}),p=cp(l.map(function(t){return t.rescale(r)}),h,this.config.iouThreshold,!0),[2,p.map(function(t){return new ap(h[t],d[t],f[t],l[t],u)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var n,r=[],o=cm(t,r),i=o.extractConvParams,a=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;n={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return tg(t,r),{params:n,paramMappings:r}}(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(t,e,n,r){var o,i=sg(t),a=i.extractWeights,s=i.getRemainingWeights,u=[],c=um(a,u),l=c.extractConvParams,h=c.extractConvWithBatchNormParams,d=c.extractSeparableConvParams;if(e.withSeparableConvs){var f=r[0],p=r[1],g=r[2],m=r[3],v=r[4],y=r[5],b=r[6],w=r[7],x=r[8];o={conv0:e.isFirstLayerConv2d?l(f,p,3,"conv0"):d(f,p,"conv0"),conv1:d(p,g,"conv1"),conv2:d(g,m,"conv2"),conv3:d(m,v,"conv3"),conv4:d(v,y,"conv4"),conv5:d(y,b,"conv5"),conv6:w?d(b,w,"conv6"):void 0,conv7:x?d(w,x,"conv7"):void 0,conv8:l(x||w||b,5*n,1,"conv8")}}else f=r[0],p=r[1],g=r[2],m=r[3],v=r[4],y=r[5],b=r[6],w=r[7],x=r[8],o={conv0:h(f,p,"conv0"),conv1:h(p,g,"conv1"),conv2:h(g,m,"conv2"),conv3:h(m,v,"conv3"),conv4:h(v,y,"conv4"),conv5:h(y,b,"conv5"),conv6:h(b,w,"conv6"),conv7:h(w,x,"conv7"),conv8:l(x,5*n,1,"conv8")};if(0!==s().length)throw new Error("weights remaing after extract: "+s().length);return{params:o,paramMappings:u}}(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,e,n){return Gf(this,void 0,void 0,function(){var r,o,i,a,s,u,c,l,h,d,f,p,g,m,v,y,b,w,x,E,A,C,k,S,I,R,T,N,_,P=this;return Hf(this,function(D){switch(D.label){case 0:return r=e.width,o=e.height,i=Math.max(r,o),a=i/r,s=i/o,u=t.shape[1],c=this.config.anchors.length,l=lr(function(){var e=t.reshape([u,u,c,P.boxEncodingSize]);return[e.slice([0,0,0,0],[u,u,c,4]),e.slice([0,0,0,4],[u,u,c,1]),P.withClassScores?ti(e.slice([0,0,0,5],[u,u,c,P.config.classes.length]),3):Dr(0)]}),h=l[0],d=l[1],f=l[2],p=[],[4,d.array()];case 1:return g=D.sent(),[4,h.array()];case 2:m=D.sent(),v=0,D.label=3;case 3:if(!(v<u))return[3,12];y=0,D.label=4;case 4:if(!(y<u))return[3,11];b=0,D.label=5;case 5:return b<c?(w=hp(g[v][y][b][0]),!n||w>n?(x=(y+hp(m[v][y][b][0]))/u*a,E=(v+hp(m[v][y][b][1]))/u*s,A=Math.exp(m[v][y][b][2])*this.config.anchors[b].x/u*a,C=Math.exp(m[v][y][b][3])*this.config.anchors[b].y/u*s,k=x-A/2,S=E-C/2,I={row:v,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(f,I)]:[3,7]):[3,9]):[3,10];case 6:return _=D.sent(),[3,8];case 7:_={classScore:1,label:0},D.label=8;case 8:T=(R=_).classScore,N=R.label,p.push(jf({box:new ip(k,S,k+A,S+C),score:w,classScore:w*T,label:N},I)),D.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return v++,[3,3];case 12:return h.dispose(),d.dispose(),f.dispose(),[2,p]}})})},e.prototype.extractPredictedClass=function(t,e){return Gf(this,void 0,void 0,function(){var n,r,o,i;return Hf(this,function(a){switch(a.label){case 0:return n=e.row,r=e.col,o=e.anchor,[4,t.array()];case 1:return i=a.sent(),[2,Array(this.config.classes.length).fill(0).map(function(t,e){return i[n][r][o][e]}).map(function(t,e){return{classScore:t,label:e}}).reduce(function(t,e){return t.classScore>e.classScore?t:e})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(Xp),dm=function(t){function e(e){void 0===e&&(e=!0);var n=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:nm,meanRgb:rm}:{anchors:em,withClassScores:!0});return t.call(this,n)||this}return Vf(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return Gf(this,void 0,void 0,function(){return Hf(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new sp(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(hm);var fm=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return Vf(e,t),e}(lm),pm=function(){function t(){}return t.prototype.then=function(t){return Gf(this,void 0,void 0,function(){var e;return Hf(this,function(n){switch(n.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[n.sent()])]}})})},t.prototype.run=function(){return Gf(this,void 0,void 0,function(){return Hf(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},t}();function gm(t,e){var n={descriptor:e};return Object.assign({},t,n)}function mm(t,e,n,r,o){return void 0===o&&(o=function(t){return t.alignedRect}),Gf(this,void 0,void 0,function(){var i,a,s,u,c;return Hf(this,function(l){switch(l.label){case 0:return i=t.map(function(t){return bg(t)?o(t):t.detection}),(s=r)?[3,5]:e instanceof ze?[4,Gp(e,i)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,jp(e,i)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(a=s)];case 6:return c=l.sent(),a.forEach(function(t){return t instanceof ze&&t.dispose()}),[2,c]}})})}function vm(t,e,n,r,o){return Gf(this,void 0,void 0,function(){var i=this;return Hf(this,function(a){return[2,mm([t],e,function(t){return Gf(i,void 0,void 0,function(){return Hf(this,function(e){return[2,n(t[0])]})})},r,o)]})})}function ym(t){var e=sg(t),n=e.extractWeights,r=e.getRemainingWeights,o=[],i=function(t,e){var n=eg(t,e),r=ng(t,e);function o(n,r){var o=Or(t(n));return e.push({paramPath:r}),o}function i(t,e,r){return void 0===r&&(r=!1),{conv1:n(t[0],t[1],3,e+"/conv1"),prelu1_alpha:o(t[1],e+"/prelu1_alpha"),conv2:n(t[1],t[2],3,e+"/conv2"),prelu2_alpha:o(t[2],e+"/prelu2_alpha"),conv3:n(t[2],t[3],r?2:3,e+"/conv3"),prelu3_alpha:o(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=i([3,10,16,32],"pnet"),e=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return jf(jf({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=i([3,28,48,64],"rnet",!0),e=r(576,128,"rnet/fc1"),n=o(128,"rnet/prelu4_alpha"),a=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return jf(jf({},t),{fc1:e,prelu4_alpha:n,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=i([3,32,64,64],"onet"),e=n(64,128,2,"onet/conv4"),a=o(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=o(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),h=r(256,10,"onet/fc2_3");return jf(jf({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:h})}}}(n,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,c=a(),l=s(),h=u();if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:c,rnet:l,onet:h},paramMappings:o}}function bm(t){var e=[],n=function(t,e){var n=ag(t,e);function r(t){return{filters:n(t+"/weights",4,t+"/filters"),bias:n(t+"/bias",1)}}function o(t){return{weights:n(t+"/weights",2),bias:n(t+"/bias",1)}}function i(t){return n(t,1)}function a(t){return{conv1:r(t+"/conv1"),prelu1_alpha:i(t+"/prelu1_alpha"),conv2:r(t+"/conv2"),prelu2_alpha:i(t+"/prelu2_alpha"),conv3:r(t+"/conv3"),prelu3_alpha:i(t+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=a("pnet"),e=r("pnet/conv4_1"),n=r("pnet/conv4_2");return jf(jf({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=a("rnet"),e=o("rnet/fc1"),n=i("rnet/prelu4_alpha"),r=o("rnet/fc2_1"),s=o("rnet/fc2_2");return jf(jf({},t),{fc1:e,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var t=a("onet"),e=r("onet/conv4"),n=i("onet/prelu4_alpha"),s=o("onet/fc1"),u=i("onet/prelu5_alpha"),c=o("onet/fc2_1"),l=o("onet/fc2_2"),h=o("onet/fc2_3");return jf(jf({},t),{conv4:e,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:h})}}}(t,e),r=n.extractPNetParams,o=n.extractRNetParams,i=n.extractONetParams,a=r(),s=o(),u=i();return tg(t,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function wm(t,e){var n=e[0],r=e[1];return{height:Math.floor(n*t),width:Math.floor(r*t)}}var xm=function(t){function e(e,n,r,o){return t.call(this,{left:e,top:n,right:r,bottom:o},!0)||this}return Vf(e,t),e}(op);function Em(t){return lr(function(){return qc(Yc(t,Dr(127.5)),Dr(.0078125))})}function Am(t,e){return lr(function(){return Pc(lh(t),qc(e,Ju(lh(Ju(t)))))})}function Cm(t,e,n){return void 0===n&&(n=!1),lr(function(){var r=$p(t,e.conv1,"valid");return r=Am(r,e.prelu1_alpha),r=Am(r=$p(r=Ul(r,n?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),r=Am(r=$p(r=n?r:Ul(r,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function km(t,e,n,r,o){o.stage1=[];var i=e.map(function(e){return lr(function(){var n={scale:e},o=function(t,e){return lr(function(){var n=wm(e,t.shape.slice(1)),r=n.height,o=n.width,i=Em(id.resizeBilinear(t,[r,o]));return fh(i,[0,2,1,3])})}(t,e),i=Date.now(),a=function(t,e){return lr(function(){var n=Cm(t,e,!0),r=$p(n,e.conv4_1,"valid"),o=mo(eh(r,3),3);return{prob:ti(Yc(r,o),3),regions:$p(n,e.conv4_2,"valid")}})}(o,r),s=a.prob,u=a.regions;return n.pnet=Date.now()-i,{scoresTensor:Fo(Fo(s,3)[1])[0],regionsTensor:Fo(u)[0],scale:e,statsForScale:n}})}),a=i.map(function(t){var e=t.scoresTensor,r=t.regionsTensor,i=t.scale,a=t.statsForScale,s=function(t,e,n,r){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=r&&o.push(new rp(s,a));return o.map(function(t){var r=new ip(Math.round((2*t.y+1)/n),Math.round((2*t.x+1)/n),Math.round((2*t.y+12)/n),Math.round((2*t.x+12)/n)),o=i[t.y][t.x],a=e.arraySync();return{cell:r,score:o,region:new xm(a[t.y][t.x][0],a[t.y][t.x][1],a[t.y][t.x][2],a[t.y][t.x][3])}})}(e,r,i,n);if(e.dispose(),r.dispose(),!s.length)return o.stage1.push(a),[];var u=Date.now(),c=cp(s.map(function(t){return t.cell}),s.map(function(t){return t.score}),.5);return a.nms=Date.now()-u,a.numBoxes=c.length,o.stage1.push(a),c.map(function(t){return s[t]})}),s=a.reduce(function(t,e){return t.concat(e)},[]),u=[],c=[];if(s.length>0){var l=Date.now(),h=cp(s.map(function(t){return t.cell}),s.map(function(t){return t.score}),.7);o.stage1_nms=Date.now()-l,c=h.map(function(t){return s[t].score}),u=h.map(function(t){return s[t]}).map(function(t){var e=t.cell,n=t.region;return new ip(e.left+n.left*e.width,e.top+n.top*e.height,e.right+n.right*e.width,e.bottom+n.bottom*e.height).toSquare().round()})}return{boxes:u,scores:c}}function Sm(t,e,n){var r=n.width,o=n.height;return Gf(this,void 0,void 0,function(){var n,i,a,s=this;return Hf(this,function(u){switch(u.label){case 0:return n=_p(t),[4,Promise.all(e.map(function(e){return Gf(s,void 0,void 0,function(){var r,o,i,a,s,u,c,l;return Hf(this,function(h){return r=e.padAtBorders(t.height,t.width),o=r.y,i=r.ey,a=r.x,s=r.ex,u=a-1,c=o-1,l=n.getImageData(u,c,s-u,i-c),[2,Tp.isNodejs()?Lp(l):createImageBitmap(l)]})})}))];case 1:return i=u.sent(),a=[],i.forEach(function(t){var e=_p(Bp({width:r,height:o}));e.drawImage(t,0,0,r,o);for(var n=e.getImageData(0,0,r,o).data,i=[],s=0;s<n.length;s+=4)i.push(n[s+2]),i.push(n[s+1]),i.push(n[s]);a.push(i)}),[2,a.map(function(t){return lr(function(){return Em(fh(Br(t,[1,r,o,3]),[0,2,1,3]).toFloat())})})]}})})}function Im(t,e,n,r,o){return Gf(this,void 0,void 0,function(){var i,a,s,u,c,l,h,d,f,p,g,m,v,y;return Hf(this,function(b){switch(b.label){case 0:return i=Date.now(),[4,Sm(t,e,{width:24,height:24})];case 1:return a=b.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(t){var e=function(t,e){return lr(function(){var n=Cm(t,e),r=Am(dg(To(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu4_alpha),o=dg(r,e.fc2_1),i=mo(eh(o,1),1),a=ti(Yc(o,i),1),s=dg(r,e.fc2_2);return{scores:Fo(a,1)[1],regions:s}})}(t,r);return t.dispose(),e}),o.stage2_rnet=Date.now()-i,u=s.length>1?Gr(s.map(function(t){return t.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[b.sent()]),u.dispose(),d=c.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx}),f=d.map(function(t){return e[t]}),p=d.map(function(t){return c[t]}),g=[],m=[],f.length>0&&(i=Date.now(),v=cp(f,p,.7),o.stage2_nms=Date.now()-i,y=v.map(function(t){var e=s[d[t]].regions.arraySync();return new xm(e[0][0],e[0][1],e[0][2],e[0][3])}),m=v.map(function(t){return p[t]}),g=v.map(function(t,e){return f[t].calibrate(y[e])})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose()}),[2,{boxes:g,scores:m}]}})})}function Rm(t,e,n,r,o){return Gf(this,void 0,void 0,function(){var i,a,s,u,c,l,h,d,f,p,g,m,v,y,b;return Hf(this,function(w){switch(w.label){case 0:return i=Date.now(),[4,Sm(t,e,{width:48,height:48})];case 1:return a=w.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(t){var e=function(t,e){return lr(function(){var n=Cm(t,e);n=Am(n=$p(n=Ul(n,[2,2],[2,2],"same"),e.conv4,"valid"),e.prelu4_alpha);var r=Am(dg(To(n,[n.shape[0],e.fc1.weights.shape[0]]),e.fc1),e.prelu5_alpha),o=dg(r,e.fc2_1),i=mo(eh(o,1),1),a=ti(Yc(o,i),1),s=dg(r,e.fc2_2),u=dg(r,e.fc2_3);return{scores:Fo(a,1)[1],regions:s,points:u}})}(t,r);return t.dispose(),e}),o.stage3_onet=Date.now()-i,u=s.length>1?Gr(s.map(function(t){return t.scores})):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[w.sent()]),u.dispose(),d=c.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>n}).map(function(t){return t.idx}),f=d.map(function(t){var e=s[t].regions.arraySync();return new xm(e[0][0],e[0][1],e[0][2],e[0][3])}),p=d.map(function(t,n){return e[t].calibrate(f[n])}),g=d.map(function(t){return c[t]}),m=[],v=[],y=[],p.length>0&&(i=Date.now(),b=cp(p,g,.7,!1),o.stage3_nms=Date.now()-i,m=b.map(function(t){return p[t]}),v=b.map(function(t){return g[t]}),y=b.map(function(t,e){return Array(5).fill(0).map(function(n,r){var o=s[t].points.arraySync();return new rp(o[0][r]*(m[e].width+1)+m[e].left,o[0][r+5]*(m[e].height+1)+m[e].top)})})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()}),[2,{boxes:m,scores:v,points:y}]}})})}var Tm=function(t){function e(){return t.call(this,"Mtcnn")||this}return Vf(e,t),e.prototype.load=function(e){return Gf(this,void 0,void 0,function(){return Hf(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},e.prototype.loadFromDisk=function(e){return Gf(this,void 0,void 0,function(){return Hf(this,function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),Gf(this,void 0,void 0,function(){var n,r,o,i,a,s,u,c,l,h,d,f,p,g,m,v,y,b,w,x,E;return Hf(this,function(A){switch(A.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=t.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},i=Date.now(),a=lr(function(){return t=mo(kf.fromPixels(r)).toFloat(),lr(function(){return Po(Fo(t,3).reverse(),3)});var t}),s=function(t){return a.dispose(),o.total=Date.now()-i,t},u=a.shape.slice(1),c=u[0],l=u[1],h=new Gg(e),d=h.minFaceSize,f=h.scaleFactor,p=h.maxNumScales,g=h.scoreThresholds,m=h.scaleSteps,v=(m||function(t,e,n){for(var r=n[0],o=n[1],i=12/t,a=[],s=Math.min(r,o)*i,u=0;s>=12;)a.push(i*Math.pow(e,u)),s*=e,u+=1;return a}(d,f,[c,l])).filter(function(t){var e=wm(t,[c,l]);return Math.min(e.width,e.height)>12}).slice(0,p),o.scales=v,o.pyramid=v.map(function(t){return wm(t,[c,l])}),y=Date.now(),[4,km(a,v,g[0],n.pnet,o)];case 1:return b=A.sent(),o.total_stage1=Date.now()-y,b.boxes.length?(o.stage2_numInputBoxes=b.boxes.length,y=Date.now(),[4,Im(r,b.boxes,g[1],n.rnet,o)]):[2,s({results:[],stats:o})];case 2:return w=A.sent(),o.total_stage2=Date.now()-y,w.boxes.length?(o.stage3_numInputBoxes=w.boxes.length,y=Date.now(),[4,Rm(r,w.boxes,g[2],n.onet,o)]):[2,s({results:[],stats:o})];case 3:return x=A.sent(),o.total_stage3=Date.now()-y,E=x.boxes.map(function(t,e){return wg(wp({},new sp(x.scores[e],new fp(t.left/l,t.top/c,t.width/l,t.height/c),{height:c,width:l})),new gp(x.points[e].map(function(e){return e.sub(new rp(t.left,t.top)).div(new rp(t.width,t.height))}),{width:t.width,height:t.height}))}),[2,s({results:E,stats:o})]}})})},e.prototype.forward=function(t,e){return void 0===e&&(e={}),Gf(this,void 0,void 0,function(){var n;return Hf(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Vp(t)];case 1:return[4,n.apply(this,[r.sent(),e])];case 2:return[2,r.sent().results]}})})},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),Gf(this,void 0,void 0,function(){var n;return Hf(this,function(r){switch(r.label){case 0:return n=this.forwardInput,[4,Vp(t)];case 1:return[2,n.apply(this,[r.sent(),e])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return bm(t)},e.prototype.extractParams=function(t){return ym(t)},e}(Xp),Nm=[new rp(1.603231,2.094468),new rp(6.041143,7.080126),new rp(2.882459,3.518061),new rp(4.266906,5.178857),new rp(9.041765,10.66308)],_m=[117.001,114.697,97.404],Pm=function(t){function e(){var e={withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:Nm,meanRgb:_m,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)||this}return Vf(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return Gf(this,void 0,void 0,function(){return Hf(this,function(n){switch(n.label){case 0:return[4,this.detect(t,e)];case 1:return[2,n.sent().map(function(t){return new sp(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(hm),Dm={ssdMobilenetv1:new $g,tinyFaceDetector:new Pm,tinyYolov2:new dm,mtcnn:new Tm,faceLandmark68Net:new _g,faceLandmark68TinyNet:new Dg,faceRecognitionNet:new Vg,faceExpressionNet:new vg,ageGenderNet:new Tg};function Om(t,e){var n={age:e};return Object.assign({},t,n)}var Fm=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=r,o}return Vf(e,t),e}(pm),Mm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e,n=this;return Hf(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,mm(t=r.sent(),this.input,function(t){return Gf(n,void 0,void 0,function(){return Hf(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return Dm.faceExpressionNet.predictExpressions(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=r.sent(),[2,t.map(function(t,n){return yg(t,e[n])})]}})})},e.prototype.withAgeAndGender=function(){return new zm(this,this.input)},e}(Fm),Bm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e;return Hf(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,vm(t,this.input,function(t){return Dm.faceExpressionNet.predictExpressions(t)},this.extractedFaces)]:[2];case 2:return e=n.sent(),[2,yg(t,e)]}})})},e.prototype.withAgeAndGender=function(){return new Vm(this,this.input)},e}(Fm),Lm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.withAgeAndGender=function(){return new jm(this,this.input)},e.prototype.withFaceDescriptors=function(){return new qm(this,this.input)},e}(Mm),Um=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.withAgeAndGender=function(){return new Gm(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Km(this,this.input)},e}(Bm),Wm=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.extractedFaces=r,o}return Vf(e,t),e}(pm),zm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e,n=this;return Hf(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,mm(t=r.sent(),this.input,function(t){return Gf(n,void 0,void 0,function(){return Hf(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return Dm.ageGenderNet.predictAgeAndGender(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=r.sent(),[2,t.map(function(t,n){var r=e[n],o=r.age;return Om(jg(t,r.gender,r.genderProbability),o)})]}})})},e.prototype.withFaceExpressions=function(){return new Mm(this,this.input)},e}(Wm),Vm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e,n,r,o;return Hf(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?[4,vm(t,this.input,function(t){return Dm.ageGenderNet.predictAgeAndGender(t)},this.extractedFaces)]:[2];case 2:return e=i.sent(),n=e.age,r=e.gender,o=e.genderProbability,[2,Om(jg(t,r,o),n)]}})})},e.prototype.withFaceExpressions=function(){return new Bm(this,this.input)},e}(Wm),jm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.withFaceExpressions=function(){return new Lm(this,this.input)},e.prototype.withFaceDescriptors=function(){return new qm(this,this.input)},e}(zm),Gm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.withFaceExpressions=function(){return new Um(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Km(this,this.input)},e}(Vm),Hm=function(t){function e(e,n){var r=t.call(this)||this;return r.parentTask=e,r.input=n,r}return Vf(e,t),e}(pm),qm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t;return Hf(this,function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,mm(t=e.sent(),this.input,function(t){return Promise.all(t.map(function(t){return Dm.faceRecognitionNet.computeFaceDescriptor(t)}))},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,e.sent().map(function(e,n){return gm(t[n],e)})]}})})},e.prototype.withFaceExpressions=function(){return new Lm(this,this.input)},e.prototype.withAgeAndGender=function(){return new jm(this,this.input)},e}(Hm),Km=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e;return Hf(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return(t=n.sent())?[4,vm(t,this.input,function(t){return Dm.faceRecognitionNet.computeFaceDescriptor(t)},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return e=n.sent(),[2,gm(t,e)]}})})},e.prototype.withFaceExpressions=function(){return new Um(this,this.input)},e.prototype.withAgeAndGender=function(){return new Gm(this,this.input)},e}(Hm),Qm=function(t){function e(e,n,r){var o=t.call(this)||this;return o.parentTask=e,o.input=n,o.useTinyLandmarkNet=r,o}return Vf(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Dm.faceLandmark68TinyNet:Dm.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(pm),Xm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e,n,r,o,i=this;return Hf(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return t=a.sent(),e=t.map(function(t){return t.detection}),this.input instanceof ze?[4,Gp(this.input,e)]:[3,3];case 2:return r=a.sent(),[3,5];case 3:return[4,jp(this.input,e)];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,Promise.all(n.map(function(t){return i.landmarkNet.detectLandmarks(t)}))];case 6:return o=a.sent(),n.forEach(function(t){return t instanceof ze&&t.dispose()}),[2,t.map(function(t,e){return wg(t,o[e])})]}})})},e.prototype.withFaceExpressions=function(){return new Lm(this,this.input)},e.prototype.withAgeAndGender=function(){return new jm(this,this.input)},e.prototype.withFaceDescriptors=function(){return new qm(this,this.input)},e}(Qm),Jm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e,n,r,o;return Hf(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return(t=i.sent())?(e=t.detection,this.input instanceof ze?[4,Gp(this.input,[e])]:[3,3]):[2];case 2:return r=i.sent(),[3,5];case 3:return[4,jp(this.input,[e])];case 4:r=i.sent(),i.label=5;case 5:return n=r,[4,this.landmarkNet.detectLandmarks(n[0])];case 6:return o=i.sent(),n.forEach(function(t){return t instanceof ze&&t.dispose()}),[2,wg(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new Um(this,this.input)},e.prototype.withAgeAndGender=function(){return new Gm(this,this.input)},e.prototype.withFaceDescriptor=function(){return new Km(this,this.input)},e}(Qm),Ym=function(t){function e(e,n){void 0===n&&(n=new Zg);var r=t.call(this)||this;return r.input=e,r.options=n,r}return Vf(e,t),e}(pm),Zm=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e,n,r;return Hf(this,function(o){switch(o.label){case 0:return e=(t=this).input,(n=t.options)instanceof Gg?[4,Dm.mtcnn.forward(e,n)]:[3,2];case 1:return[2,o.sent().map(function(t){return t.detection})];case 2:if(r=n instanceof fm?function(t){return Dm.tinyFaceDetector.locateFaces(t,n)}:n instanceof Zg?function(t){return Dm.ssdMobilenetv1.locateFaces(t,n)}:n instanceof lm?function(t){return Dm.tinyYolov2.locateFaces(t,n)}:null,!r)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(e)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return Gf(t,void 0,void 0,function(){var t;return Hf(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t.map(function(t){return wp({},t)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new Xm(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new Mm(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new zm(this.runAndExtendWithFaceDetections(),this.input)},e}(Ym),$m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vf(e,t),e.prototype.run=function(){return Gf(this,void 0,void 0,function(){var t,e;return Hf(this,function(n){switch(n.label){case 0:return[4,new Zm(this.input,this.options)];case 1:return t=n.sent(),e=t[0],t.forEach(function(t){t.score>e.score&&(e=t)}),[2,e]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return Gf(t,void 0,void 0,function(){var t;return Hf(this,function(n){switch(n.label){case 0:return[4,this.run()];case 1:return t=n.sent(),[2,e(t?wp({},t):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new Jm(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new Bm(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new Vm(this.runAndExtendWithFaceDetection(),this.input)},e}(Ym);function tv(t,e){return void 0===e&&(e=new Zg),new $m(t,e)}function ev(t,e){if(t.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var n=Array.from(t),r=Array.from(e);return Math.sqrt(n.map(function(t,e){return t-r[e]}).reduce(function(t,e){return t+Math.pow(e,2)},0))}!function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var n=Array.isArray(t)?t:[t];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var r=1,o=function(){return"person "+r++};this._labeledDescriptors=n.map(function(t){if(t instanceof bp)return t;if(t instanceof Float32Array)return new bp(o(),[t]);if(t.descriptor&&t.descriptor instanceof Float32Array)return new bp(o(),[t.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map(function(e){return ev(e,t)}).reduce(function(t,e){return t+e},0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(n){var r=n.descriptors,o=n.label;return new vp(o,e.computeMeanDistance(t,r))}).reduce(function(t,e){return t.distance<e.distance?t:e})},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new vp("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},t.fromJSON=function(e){var n=e.labeledDescriptors.map(function(t){return bp.fromJSON(t)});return new t(n,e.distanceThreshold)}}();const nv=.6,rv=3,ov="/",iv="/admin",av="/vote",sv="Please connect your MetaMask wallet",uv="Only admin can access this page",cv="Face not recognized. Please try again.",lv="Camera access denied. Please allow camera access to continue.",hv="blockdface_voter_id";const dv=new class{constructor(){this.isInitialized=!1,this.modelsLoaded=!1,this.stream=null,this.videoElement=null,this.initializeModels()}async initializeModels(){try{const t="/models";await Promise.all([Dm.tinyFaceDetector.loadFromUri(t),Dm.faceLandmark68Net.loadFromUri(t),Dm.faceRecognitionNet.loadFromUri(t),Dm.faceExpressionNet.loadFromUri(t)]),this.modelsLoaded=!0,console.log("Face recognition models loaded successfully")}catch(t){console.error("Failed to load face recognition models:",t)}}async startCamera(t){try{return this.videoElement=t,this.stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},facingMode:"user"}}),t.srcObject=this.stream,new Promise((e,n)=>{t.onloadedmetadata=()=>{t.play(),this.isInitialized=!0,e(!0)},t.onerror=()=>{n(new Error("Failed to load video stream"))}})}catch(e){return console.error("Failed to start camera:",e),!1}}stopCamera(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.videoElement&&(this.videoElement.srcObject=null,this.videoElement=null),this.isInitialized=!1}async detectFace(){if(!this.isInitialized||!this.videoElement||!this.modelsLoaded)return null;try{const t=await tv(this.videoElement,new fm).withFaceLandmarks();return null!==t&&void 0!==t?t:null}catch(t){return console.error("Face detection failed:",t),null}}async getFaceDescriptor(){if(!this.isInitialized||!this.videoElement||!this.modelsLoaded)return null;try{const t=await tv(this.videoElement,new fm).withFaceLandmarks().withFaceDescriptor();return t?t.descriptor:null}catch(t){return console.error("Failed to get face descriptor:",t),null}}async captureFacePhotos(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;const e=[];for(let n=0;n<t;n++){await new Promise(t=>setTimeout(t,1e3));const t=await this.getFaceDescriptor();if(!t)throw new Error("Failed to capture face photo ".concat(n+1));e.push(t)}return e}async registerVoter(t){try{const e=this.generateVoterId(),n=this.averageDescriptors(t);return await this.storeVoterData({voterId:e,faceDescriptor:n,registrationDate:Date.now()}),e}catch(e){throw console.error("Failed to register voter:",e),e}}async authenticateVoter(){try{const t=await this.getFaceDescriptor();if(!t)return null;const e=await this.getAllVoters();let n=null,r=nv;for(const o of e){const e=ev(t,o.faceDescriptor);e<r&&(r=e,n=o)}return n?n.voterId:null}catch(t){return console.error("Failed to authenticate voter:",t),null}}generateVoterId(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}averageDescriptors(t){if(0===t.length)throw new Error("No descriptors to average");const e=t[0].length,n=new Float32Array(e);for(let r=0;r<e;r++){let e=0;for(const n of t)e+=n[r];n[r]=e/t.length}return n}async openDB(){return new Promise((t,e)=>{const n=indexedDB.open("VotingFaceDB",1);n.onerror=()=>e(n.error),n.onsuccess=()=>t(n.result),n.onupgradeneeded=t=>{const e=t.target.result;if(!e.objectStoreNames.contains("voters")){e.createObjectStore("voters",{keyPath:"voterId"}).createIndex("registrationDate","registrationDate",{unique:!1})}}})}async storeVoterData(t){const e=await this.openDB();return new Promise((n,r)=>{const o=e.transaction(["voters"],"readwrite").objectStore("voters").put(t);o.onerror=()=>r(o.error),o.onsuccess=()=>n()})}async getAllVoters(){const t=await this.openDB();return new Promise((e,n)=>{const r=t.transaction(["voters"],"readonly").objectStore("voters").getAll();r.onerror=()=>n(r.error),r.onsuccess=()=>e(r.result)})}async getVoterById(t){const e=await this.openDB();return new Promise((n,r)=>{const o=e.transaction(["voters"],"readonly").objectStore("voters").get(t);o.onerror=()=>r(o.error),o.onsuccess=()=>n(o.result||null)})}async clearAllVoters(){const t=await this.openDB();return new Promise((e,n)=>{const r=t.transaction(["voters"],"readwrite").objectStore("voters").clear();r.onerror=()=>n(r.error),r.onsuccess=()=>e()})}async getRegisteredVoterId(){try{const t=await this.getAllVoters();if(t.length>0){const e=t.sort((t,e)=>e.registrationDate-t.registrationDate);return e[0].voterId}return null}catch(t){return console.error("Failed to get registered voter ID:",t),null}}isReady(){return this.modelsLoaded}};function fv(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function pv(t,e,n){fv(t,e),e.set(t,n)}function gv(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function mv(t,e){return t.get(gv(t,e))}function vv(t,e,n){return t.set(gv(t,e),n),n}function yv(t,e,n){const r=e.split("|").map(t=>t.trim());for(let i=0;i<r.length;i++)switch(e){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof t===e)return}const o=new Error("invalid value for type ".concat(e));throw o.code="INVALID_ARGUMENT",o.argument="value.".concat(n),o.value=t,o}async function bv(t){const e=Object.keys(t),n=await Promise.all(e.map(e=>Promise.resolve(t[e])));return n.reduce((t,n,r)=>(t[e[r]]=n,t),{})}function wv(t,e,n){for(let r in e){let o=e[r];const i=n?n[r]:null;i&&yv(o,i,r),Object.defineProperty(t,r,{enumerable:!0,value:o,writable:!1})}}function xv(t,e){if(null==t)return"null";if(null==e&&(e=new Set),"object"===typeof t){if(e.has(t))return"[Circular]";e.add(t)}if(Array.isArray(t))return"[ "+t.map(t=>xv(t,e)).join(", ")+" ]";if(t instanceof Uint8Array){const e="0123456789abcdef";let n="0x";for(let r=0;r<t.length;r++)n+=e[t[r]>>4],n+=e[15&t[r]];return n}if("object"===typeof t&&"function"===typeof t.toJSON)return xv(t.toJSON(),e);switch(typeof t){case"boolean":case"number":case"symbol":return t.toString();case"bigint":return BigInt(t).toString();case"string":return JSON.stringify(t);case"object":{const n=Object.keys(t);return n.sort(),"{ "+n.map(n=>"".concat(xv(n,e),": ").concat(xv(t[n],e))).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function Ev(t,e){return t&&t.code===e}function Av(t){return Ev(t,"CALL_EXCEPTION")}function Cv(t,e,n){let r,o=t;{const r=[];if(n){if("message"in n||"code"in n||"name"in n)throw new Error("value will overwrite populated values: ".concat(xv(n)));for(const t in n){if("shortMessage"===t)continue;const e=n[t];r.push(t+"="+xv(e))}}r.push("code=".concat(e)),r.push("version=".concat("6.15.0")),r.length&&(t+=" ("+r.join(", ")+")")}switch(e){case"INVALID_ARGUMENT":r=new TypeError(t);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":r=new RangeError(t);break;default:r=new Error(t)}return wv(r,{code:e}),n&&Object.assign(r,n),null==r.shortMessage&&wv(r,{shortMessage:o}),r}function kv(t,e,n,r){if(!t)throw Cv(e,n,r)}function Sv(t,e,n,r){kv(t,e,"INVALID_ARGUMENT",{argument:n,value:r})}function Iv(t,e,n){null==n&&(n=""),n&&(n=": "+n),kv(t>=e,"missing argument"+n,"MISSING_ARGUMENT",{count:t,expectedCount:e}),kv(t<=e,"too many arguments"+n,"UNEXPECTED_ARGUMENT",{count:t,expectedCount:e})}const Rv=["NFD","NFC","NFKD","NFKC"].reduce((t,e)=>{try{if("test"!=="test".normalize(e))throw new Error("bad");if("NFD"===e){const t=String.fromCharCode(233).normalize("NFD");if(t!==String.fromCharCode(101,769))throw new Error("broken")}t.push(e)}catch(n){}return t},[]);function Tv(t,e,n){if(null==n&&(n=""),t!==e){let t=n,e="new";n&&(t+=".",e+=" "+n),kv(!1,"private constructor; use ".concat(t,"from* methods"),"UNSUPPORTED_OPERATION",{operation:e})}}function Nv(t,e){fv(t,e),e.add(t)}function _v(t,e,n){if(t instanceof Uint8Array)return n?new Uint8Array(t):t;if("string"===typeof t&&t.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const e=new Uint8Array((t.length-2)/2);let n=2;for(let r=0;r<e.length;r++)e[r]=parseInt(t.substring(n,n+2),16),n+=2;return e}Sv(!1,"invalid BytesLike value",e||"value",t)}function Pv(t,e){return _v(t,e,!1)}function Dv(t,e){return _v(t,e,!0)}function Ov(t,e){return!("string"!==typeof t||!t.match(/^0x[0-9A-Fa-f]*$/))&&(("number"!==typeof e||t.length===2+2*e)&&(!0!==e||t.length%2===0))}function Fv(t){return Ov(t,!0)||t instanceof Uint8Array}const Mv="0123456789abcdef";function Bv(t){const e=Pv(t);let n="0x";for(let r=0;r<e.length;r++){const t=e[r];n+=Mv[(240&t)>>4]+Mv[15&t]}return n}function Lv(t){return"0x"+t.map(t=>Bv(t).substring(2)).join("")}function Uv(t){return Ov(t,!0)?(t.length-2)/2:Pv(t).length}function Wv(t,e,n){const r=Pv(t);return null!=n&&n>r.length&&kv(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n}),Bv(r.slice(null==e?0:e,null==n?r.length:n))}function zv(t,e,n){const r=Pv(t);kv(e>=r.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(r),length:e,offset:e+1});const o=new Uint8Array(e);return o.fill(0),n?o.set(r,e-r.length):o.set(r,0),Bv(o)}function Vv(t,e){return zv(t,e,!0)}const jv=BigInt(0),Gv=BigInt(1),Hv=9007199254740991;function qv(t,e){const n=Jv(t,"value"),r=BigInt($v(e,"width"));if(kv(n>>r===jv,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:t}),n>>r-Gv){return-((~n&(Gv<<r)-Gv)+Gv)}return n}function Kv(t,e){let n=Xv(t,"value");const r=BigInt($v(e,"width")),o=Gv<<r-Gv;if(n<jv){n=-n,kv(n<=o,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:t});return(~n&(Gv<<r)-Gv)+Gv}return kv(n<o,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:t}),n}function Qv(t,e){const n=Jv(t,"value"),r=BigInt($v(e,"bits"));return n&(Gv<<r)-Gv}function Xv(t,e){switch(typeof t){case"bigint":return t;case"number":return Sv(Number.isInteger(t),"underflow",e||"value",t),Sv(t>=-Hv&&t<=Hv,"overflow",e||"value",t),BigInt(t);case"string":try{if(""===t)throw new Error("empty string");return"-"===t[0]&&"-"!==t[1]?-BigInt(t.substring(1)):BigInt(t)}catch(Nt){Sv(!1,"invalid BigNumberish string: ".concat(Nt.message),e||"value",t)}}Sv(!1,"invalid BigNumberish value",e||"value",t)}function Jv(t,e){const n=Xv(t,e);return kv(n>=jv,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:t}),n}const Yv="0123456789abcdef";function Zv(t){if(t instanceof Uint8Array){let e="0x0";for(const n of t)e+=Yv[n>>4],e+=Yv[15&n];return BigInt(e)}return Xv(t)}function $v(t,e){switch(typeof t){case"bigint":return Sv(t>=-Hv&&t<=Hv,"overflow",e||"value",t),Number(t);case"number":return Sv(Number.isInteger(t),"underflow",e||"value",t),Sv(t>=-Hv&&t<=Hv,"overflow",e||"value",t),t;case"string":try{if(""===t)throw new Error("empty string");return $v(BigInt(t),e)}catch(Nt){Sv(!1,"invalid numeric string: ".concat(Nt.message),e||"value",t)}}Sv(!1,"invalid numeric value",e||"value",t)}function ty(t,e){let n=Jv(t,"value").toString(16);if(null==e)n.length%2&&(n="0"+n);else{const r=$v(e,"width");for(kv(2*r>=n.length,"value exceeds width (".concat(r," bytes)"),"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:t});n.length<2*r;)n="0"+n}return"0x"+n}function ey(t){const e=Jv(t,"value");if(e===jv)return new Uint8Array([]);let n=e.toString(16);n.length%2&&(n="0"+n);const r=new Uint8Array(n.length/2);for(let o=0;o<r.length;o++){const t=2*o;r[o]=parseInt(n.substring(t,t+2),16)}return r}function ny(t){let e=Bv(Fv(t)?t:ey(t)).substring(2);for(;e.startsWith("0");)e=e.substring(1);return""===e&&(e="0"),"0x"+e}const ry=32,oy=new Uint8Array(ry),iy=["then"],ay={},sy=new WeakMap;function uy(t){return sy.get(t)}function cy(t,e){sy.set(t,e)}function ly(t,e){const n=new Error("deferred error during ABI decoding triggered accessing ".concat(t));throw n.error=e,n}function hy(t,e,n){return t.indexOf(null)>=0?e.map((t,e)=>t instanceof fy?hy(uy(t),t,n):t):t.reduce((t,r,o)=>{let i=e.getValue(r);return r in t||(n&&i instanceof fy&&(i=hy(uy(i),i,n)),t[r]=i),t},{})}var dy=new WeakMap;class fy extends Array{constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e[0];let o=e[1],i=(e[2]||[]).slice(),a=!0;r!==ay&&(o=e,i=[],a=!1),super(o.length),pv(this,dy,void 0),o.forEach((t,e)=>{this[e]=t});const s=i.reduce((t,e)=>("string"===typeof e&&t.set(e,(t.get(e)||0)+1),t),new Map);if(cy(this,Object.freeze(o.map((t,e)=>{const n=i[e];return null!=n&&1===s.get(n)?n:null}))),vv(dy,this,[]),null==mv(dy,this)&&mv(dy,this),!a)return;Object.freeze(this);const u=new Proxy(this,{get:(t,e,n)=>{if("string"===typeof e){if(e.match(/^[0-9]+$/)){const n=$v(e,"%index");if(n<0||n>=this.length)throw new RangeError("out of result range");const r=t[n];return r instanceof Error&&ly("index ".concat(n),r),r}if(iy.indexOf(e)>=0)return Reflect.get(t,e,n);const r=t[e];if(r instanceof Function)return function(){for(var e=arguments.length,o=new Array(e),i=0;i<e;i++)o[i]=arguments[i];return r.apply(this===n?t:this,o)};if(!(e in t))return t.getValue.apply(this===n?t:this,[e])}return Reflect.get(t,e,n)}});return cy(u,uy(this)),u}toArray(t){const e=[];return this.forEach((n,r)=>{n instanceof Error&&ly("index ".concat(r),n),t&&n instanceof fy&&(n=n.toArray(t)),e.push(n)}),e}toObject(t){const e=uy(this);return e.reduce((n,r,o)=>(kv(null!=r,"value at index ".concat(o," unnamed"),"UNSUPPORTED_OPERATION",{operation:"toObject()"}),hy(e,this,t)),{})}slice(t,e){null==t&&(t=0),t<0&&(t+=this.length)<0&&(t=0),null==e&&(e=this.length),e<0&&(e+=this.length)<0&&(e=0),e>this.length&&(e=this.length);const n=uy(this),r=[],o=[];for(let i=t;i<e;i++)r.push(this[i]),o.push(n[i]);return new fy(ay,r,o)}filter(t,e){const n=uy(this),r=[],o=[];for(let i=0;i<this.length;i++){const a=this[i];a instanceof Error&&ly("index ".concat(i),a),t.call(e,a,i,this)&&(r.push(a),o.push(n[i]))}return new fy(ay,r,o)}map(t,e){const n=[];for(let r=0;r<this.length;r++){const o=this[r];o instanceof Error&&ly("index ".concat(r),o),n.push(t.call(e,o,r,this))}return n}getValue(t){const e=uy(this).indexOf(t);if(-1===e)return;const n=this[e];return n instanceof Error&&ly("property ".concat(JSON.stringify(t)),n.error),n}static fromItems(t,e){return new fy(ay,t,e)}}function py(t){let e=ey(t);return kv(e.length<=ry,"value out-of-bounds","BUFFER_OVERRUN",{buffer:e,length:ry,offset:e.length}),e.length!==ry&&(e=Dv(Lv([oy.slice(e.length%ry),e]))),e}class gy{constructor(t,e,n,r){St(this,"name",void 0),St(this,"type",void 0),St(this,"localName",void 0),St(this,"dynamic",void 0),wv(this,{name:t,type:e,localName:n,dynamic:r},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(t,e){Sv(!1,t,this.localName,e)}}var my=new WeakMap,vy=new WeakMap,yy=new WeakSet;class by{constructor(){Nv(this,yy),pv(this,my,void 0),pv(this,vy,void 0),vv(my,this,[]),vv(vy,this,0)}get data(){return Lv(mv(my,this))}get length(){return mv(vy,this)}appendWriter(t){return gv(yy,this,wy).call(this,Dv(t.data))}writeBytes(t){let e=Dv(t);const n=e.length%ry;return n&&(e=Dv(Lv([e,oy.slice(n)]))),gv(yy,this,wy).call(this,e)}writeValue(t){return gv(yy,this,wy).call(this,py(t))}writeUpdatableValue(){const t=mv(my,this).length;return mv(my,this).push(oy),vv(vy,this,mv(vy,this)+ry),e=>{mv(my,this)[t]=py(e)}}}function wy(t){return mv(my,this).push(t),vv(vy,this,mv(vy,this)+t.length),t.length}var xy=new WeakMap,Ey=new WeakMap,Ay=new WeakMap,Cy=new WeakMap,ky=new WeakMap,Sy=new WeakSet;class Iy{constructor(t,e,n){Nv(this,Sy),St(this,"allowLoose",void 0),pv(this,xy,void 0),pv(this,Ey,void 0),pv(this,Ay,void 0),pv(this,Cy,void 0),pv(this,ky,void 0),wv(this,{allowLoose:!!e}),vv(xy,this,Dv(t)),vv(Ay,this,0),vv(Cy,this,null),vv(ky,this,null!=n?n:1024),vv(Ey,this,0)}get data(){return Bv(mv(xy,this))}get dataLength(){return mv(xy,this).length}get consumed(){return mv(Ey,this)}get bytes(){return new Uint8Array(mv(xy,this))}subReader(t){const e=new Iy(mv(xy,this).slice(mv(Ey,this)+t),this.allowLoose,mv(ky,this));return vv(Cy,e,this),e}readBytes(t,e){let n=gv(Sy,this,Ty).call(this,0,t,!!e);return gv(Sy,this,Ry).call(this,t),vv(Ey,this,mv(Ey,this)+n.length),n.slice(0,t)}readValue(){return Zv(this.readBytes(ry))}readIndex(){return $v(Zv(this.readBytes(ry)))}}function Ry(t){var e;if(mv(Cy,this))return gv(Sy,e=mv(Cy,this),Ry).call(e,t);vv(Ay,this,mv(Ay,this)+t),kv(mv(ky,this)<1||mv(Ay,this)<=mv(ky,this)*this.dataLength,"compressed ABI data exceeds inflation ratio of ".concat(mv(ky,this)," ( see: https://github.com/ethers-io/ethers.js/issues/4537 )"),"BUFFER_OVERRUN",{buffer:Dv(mv(xy,this)),offset:mv(Ey,this),length:t,info:{bytesRead:mv(Ay,this),dataLength:this.dataLength}})}function Ty(t,e,n){let r=Math.ceil(e/ry)*ry;return mv(Ey,this)+r>mv(xy,this).length&&(this.allowLoose&&n&&mv(Ey,this)+e<=mv(xy,this).length?r=e:kv(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:Dv(mv(xy,this)),length:mv(xy,this).length,offset:mv(Ey,this)+r})),mv(xy,this).slice(mv(Ey,this),mv(Ey,this)+r)}function Ny(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("Wrong positive integer: ".concat(t))}function _y(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(n.length>0&&!n.includes(t.length))throw new Error("Expected Uint8Array of length ".concat(n,", not of length=").concat(t.length))}function Py(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Dy(t,e){_y(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least ".concat(n))}const Oy=BigInt(2**32-1),Fy=BigInt(32);function My(t){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{h:Number(t&Oy),l:Number(t>>Fy&Oy)}:{h:0|Number(t>>Fy&Oy),l:0|Number(t&Oy)}}function By(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let o=0;o<t.length;o++){const{h:i,l:a}=My(t[o],e);[n[o],r[o]]=[i,a]}return[n,r]}const Ly=(t,e,n)=>t<<n|e>>>32-n,Uy=(t,e,n)=>e<<n|t>>>32-n,Wy=(t,e,n)=>e<<n-32|t>>>64-n,zy=(t,e,n)=>t<<n-32|e>>>64-n;const Vy={fromBig:My,split:By,toBig:(t,e)=>BigInt(t>>>0)<<Fy|BigInt(e>>>0),shrSH:(t,e,n)=>t>>>n,shrSL:(t,e,n)=>t<<32-n|e>>>n,rotrSH:(t,e,n)=>t>>>n|e<<32-n,rotrSL:(t,e,n)=>t<<32-n|e>>>n,rotrBH:(t,e,n)=>t<<64-n|e>>>n-32,rotrBL:(t,e,n)=>t>>>n-32|e<<64-n,rotr32H:(t,e)=>e,rotr32L:(t,e)=>t,rotlSH:Ly,rotlSL:Uy,rotlBH:Wy,rotlBL:zy,add:function(t,e,n,r){const o=(e>>>0)+(r>>>0);return{h:t+n+(o/2**32|0)|0,l:0|o}},add3L:(t,e,n)=>(t>>>0)+(e>>>0)+(n>>>0),add3H:(t,e,n,r)=>e+n+r+(t/2**32|0)|0,add4L:(t,e,n,r)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0),add4H:(t,e,n,r,o)=>e+n+r+o+(t/2**32|0)|0,add5H:(t,e,n,r,o,i)=>e+n+r+o+i+(t/2**32|0)|0,add5L:(t,e,n,r,o)=>(t>>>0)+(e>>>0)+(n>>>0)+(r>>>0)+(o>>>0)},jy=Vy,Gy=t=>t instanceof Uint8Array,Hy=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),qy=(t,e)=>t<<32-e|t>>>e;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Ky(t){if("string"===typeof t&&(t=function(t){if("string"!==typeof t)throw new Error("utf8ToBytes expected string, got ".concat(typeof t));return new Uint8Array((new TextEncoder).encode(t))}(t)),!Gy(t))throw new Error("expected Uint8Array, got ".concat(typeof t));return t}class Qy{clone(){return this._cloneInto()}}function Xy(t){const e=e=>t().update(Ky(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}const[Jy,Yy,Zy]=[[],[],[]],$y=BigInt(0),tb=BigInt(1),eb=BigInt(2),nb=BigInt(7),rb=BigInt(256),ob=BigInt(113);for(let n=0,n_=tb,r_=1,o_=0;n<24;n++){[r_,o_]=[o_,(2*r_+3*o_)%5],Jy.push(2*(5*o_+r_)),Yy.push((n+1)*(n+2)/2%64);let t=$y;for(let e=0;e<7;e++)n_=(n_<<tb^(n_>>nb)*ob)%rb,n_&eb&&(t^=tb<<(tb<<BigInt(e))-tb);Zy.push(t)}const[ib,ab]=By(Zy,!0),sb=(t,e,n)=>n>32?Wy(t,e,n):Ly(t,e,n),ub=(t,e,n)=>n>32?zy(t,e,n):Uy(t,e,n);class cb extends Qy{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:24;if(super(),this.blockLen=t,this.suffix=e,this.outputLen=n,this.enableXOF=r,this.rounds=o,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Ny(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");var i;this.state=new Uint8Array(200),this.state32=(i=this.state,new Uint32Array(i.buffer,i.byteOffset,Math.floor(i.byteLength/4)))}keccak(){!function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:24;const n=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let r=0;r<10;r++)n[r]=t[r]^t[r+10]^t[r+20]^t[r+30]^t[r+40];for(let r=0;r<10;r+=2){const e=(r+8)%10,o=(r+2)%10,i=n[o],a=n[o+1],s=sb(i,a,1)^n[e],u=ub(i,a,1)^n[e+1];for(let n=0;n<50;n+=10)t[r+n]^=s,t[r+n+1]^=u}let e=t[2],o=t[3];for(let n=0;n<24;n++){const r=Yy[n],i=sb(e,o,r),a=ub(e,o,r),s=Jy[n];e=t[s],o=t[s+1],t[s]=i,t[s+1]=a}for(let r=0;r<50;r+=10){for(let e=0;e<10;e++)n[e]=t[r+e];for(let e=0;e<10;e++)t[r+e]^=~n[(e+2)%10]&n[(e+4)%10]}t[0]^=ib[r],t[1]^=ab[r]}n.fill(0)}(this.state32,this.rounds),this.posOut=0,this.pos=0}update(t){Py(this);const{blockLen:e,state:n}=this,r=(t=Ky(t)).length;for(let o=0;o<r;){const i=Math.min(e-this.pos,r-o);for(let e=0;e<i;e++)n[this.pos++]^=t[o++];this.pos===e&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:e,pos:n,blockLen:r}=this;t[n]^=e,0!==(128&e)&&n===r-1&&this.keccak(),t[r-1]^=128,this.keccak()}writeInto(t){Py(this,!1),_y(t),this.finish();const e=this.state,{blockLen:n}=this;for(let r=0,o=t.length;r<o;){this.posOut>=n&&this.keccak();const i=Math.min(n-this.posOut,o-r);t.set(e.subarray(this.posOut,this.posOut+i),r),this.posOut+=i,r+=i}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return Ny(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(Dy(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(t){const{blockLen:e,suffix:n,outputLen:r,rounds:o,enableXOF:i}=this;return t||(t=new cb(e,n,r,i,o)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=o,t.suffix=n,t.outputLen=r,t.enableXOF=i,t.destroyed=this.destroyed,t}}const lb=(t,e,n)=>Xy(()=>new cb(e,t,n)),hb=lb(1,136,32);let db=!1;const fb=function(t){return hb(t)};let pb=fb;function gb(t){const e=Pv(t,"data");return Bv(pb(e))}gb._=fb,gb.lock=function(){db=!0},gb.register=function(t){if(db)throw new TypeError("keccak256 is locked");pb=t},Object.freeze(gb);const mb=BigInt(0),vb=BigInt(36);function yb(t){const e=(t=t.toLowerCase()).substring(2).split(""),n=new Uint8Array(40);for(let o=0;o<40;o++)n[o]=e[o].charCodeAt(0);const r=Pv(gb(n));for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&(e[o]=e[o].toUpperCase()),(15&r[o>>1])>=8&&(e[o+1]=e[o+1].toUpperCase());return"0x"+e.join("")}const bb={};for(let n=0;n<10;n++)bb[String(n)]=String(n);for(let n=0;n<26;n++)bb[String.fromCharCode(65+n)]=String(10+n);function wb(t){let e=(t=(t=t.toUpperCase()).substring(4)+t.substring(0,2)+"00").split("").map(t=>bb[t]).join("");for(;e.length>=15;){let t=e.substring(0,15);e=parseInt(t,10)%97+e.substring(t.length)}let n=String(98-parseInt(e,10)%97);for(;n.length<2;)n="0"+n;return n}const xb=function(){const t={};for(let e=0;e<36;e++){t["0123456789abcdefghijklmnopqrstuvwxyz"[e]]=BigInt(e)}return t}();function Eb(t){if(Sv("string"===typeof t,"invalid address","address",t),t.match(/^(0x)?[0-9a-fA-F]{40}$/)){t.startsWith("0x")||(t="0x"+t);const e=yb(t);return Sv(!t.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||e===t,"bad address checksum","address",t),e}if(t.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){Sv(t.substring(2,4)===wb(t),"bad icap checksum","address",t);let e=function(t){t=t.toLowerCase();let e=mb;for(let n=0;n<t.length;n++)e=e*vb+xb[t[n]];return e}(t.substring(4)).toString(16);for(;e.length<40;)e="0"+e;return yb("0x"+e)}Sv(!1,"invalid address","address",t)}const Ab={};function Cb(t,e){let n=!1;return e<0&&(n=!0,e*=-1),new Rb(Ab,"".concat(n?"":"u","int").concat(e),t,{signed:n,width:e})}function kb(t,e){return new Rb(Ab,"bytes".concat(e||""),t,{size:e})}const Sb=Symbol.for("_ethers_typed");var Ib=new WeakMap;class Rb{constructor(t,e,n,r){St(this,"type",void 0),St(this,"value",void 0),pv(this,Ib,void 0),St(this,"_typedSymbol",void 0),null==r&&(r=null),Tv(Ab,t,"Typed"),wv(this,{_typedSymbol:Sb,type:e,value:n}),vv(Ib,this,r),this.format()}format(){if("array"===this.type)throw new Error("");if("dynamicArray"===this.type)throw new Error("");return"tuple"===this.type?"tuple(".concat(this.value.map(t=>t.format()).join(","),")"):this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return"string"===this.type}get tupleName(){if("tuple"!==this.type)throw TypeError("not a tuple");return mv(Ib,this)}get arrayLength(){if("array"!==this.type)throw TypeError("not an array");return!0===mv(Ib,this)?-1:!1===mv(Ib,this)?this.value.length:null}static from(t,e){return new Rb(Ab,t,e)}static uint8(t){return Cb(t,8)}static uint16(t){return Cb(t,16)}static uint24(t){return Cb(t,24)}static uint32(t){return Cb(t,32)}static uint40(t){return Cb(t,40)}static uint48(t){return Cb(t,48)}static uint56(t){return Cb(t,56)}static uint64(t){return Cb(t,64)}static uint72(t){return Cb(t,72)}static uint80(t){return Cb(t,80)}static uint88(t){return Cb(t,88)}static uint96(t){return Cb(t,96)}static uint104(t){return Cb(t,104)}static uint112(t){return Cb(t,112)}static uint120(t){return Cb(t,120)}static uint128(t){return Cb(t,128)}static uint136(t){return Cb(t,136)}static uint144(t){return Cb(t,144)}static uint152(t){return Cb(t,152)}static uint160(t){return Cb(t,160)}static uint168(t){return Cb(t,168)}static uint176(t){return Cb(t,176)}static uint184(t){return Cb(t,184)}static uint192(t){return Cb(t,192)}static uint200(t){return Cb(t,200)}static uint208(t){return Cb(t,208)}static uint216(t){return Cb(t,216)}static uint224(t){return Cb(t,224)}static uint232(t){return Cb(t,232)}static uint240(t){return Cb(t,240)}static uint248(t){return Cb(t,248)}static uint256(t){return Cb(t,256)}static uint(t){return Cb(t,256)}static int8(t){return Cb(t,-8)}static int16(t){return Cb(t,-16)}static int24(t){return Cb(t,-24)}static int32(t){return Cb(t,-32)}static int40(t){return Cb(t,-40)}static int48(t){return Cb(t,-48)}static int56(t){return Cb(t,-56)}static int64(t){return Cb(t,-64)}static int72(t){return Cb(t,-72)}static int80(t){return Cb(t,-80)}static int88(t){return Cb(t,-88)}static int96(t){return Cb(t,-96)}static int104(t){return Cb(t,-104)}static int112(t){return Cb(t,-112)}static int120(t){return Cb(t,-120)}static int128(t){return Cb(t,-128)}static int136(t){return Cb(t,-136)}static int144(t){return Cb(t,-144)}static int152(t){return Cb(t,-152)}static int160(t){return Cb(t,-160)}static int168(t){return Cb(t,-168)}static int176(t){return Cb(t,-176)}static int184(t){return Cb(t,-184)}static int192(t){return Cb(t,-192)}static int200(t){return Cb(t,-200)}static int208(t){return Cb(t,-208)}static int216(t){return Cb(t,-216)}static int224(t){return Cb(t,-224)}static int232(t){return Cb(t,-232)}static int240(t){return Cb(t,-240)}static int248(t){return Cb(t,-248)}static int256(t){return Cb(t,-256)}static int(t){return Cb(t,-256)}static bytes1(t){return kb(t,1)}static bytes2(t){return kb(t,2)}static bytes3(t){return kb(t,3)}static bytes4(t){return kb(t,4)}static bytes5(t){return kb(t,5)}static bytes6(t){return kb(t,6)}static bytes7(t){return kb(t,7)}static bytes8(t){return kb(t,8)}static bytes9(t){return kb(t,9)}static bytes10(t){return kb(t,10)}static bytes11(t){return kb(t,11)}static bytes12(t){return kb(t,12)}static bytes13(t){return kb(t,13)}static bytes14(t){return kb(t,14)}static bytes15(t){return kb(t,15)}static bytes16(t){return kb(t,16)}static bytes17(t){return kb(t,17)}static bytes18(t){return kb(t,18)}static bytes19(t){return kb(t,19)}static bytes20(t){return kb(t,20)}static bytes21(t){return kb(t,21)}static bytes22(t){return kb(t,22)}static bytes23(t){return kb(t,23)}static bytes24(t){return kb(t,24)}static bytes25(t){return kb(t,25)}static bytes26(t){return kb(t,26)}static bytes27(t){return kb(t,27)}static bytes28(t){return kb(t,28)}static bytes29(t){return kb(t,29)}static bytes30(t){return kb(t,30)}static bytes31(t){return kb(t,31)}static bytes32(t){return kb(t,32)}static address(t){return new Rb(Ab,"address",t)}static bool(t){return new Rb(Ab,"bool",!!t)}static bytes(t){return new Rb(Ab,"bytes",t)}static string(t){return new Rb(Ab,"string",t)}static array(t,e){throw new Error("not implemented yet")}static tuple(t,e){throw new Error("not implemented yet")}static overrides(t){return new Rb(Ab,"overrides",Object.assign({},t))}static isTyped(t){return t&&"object"===typeof t&&"_typedSymbol"in t&&t._typedSymbol===Sb}static dereference(t,e){if(Rb.isTyped(t)){if(t.type!==e)throw new Error("invalid type: expecetd ".concat(e,", got ").concat(t.type));return t.value}return t}}class Tb extends gy{constructor(t){super("address","address",t,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(t,e){let n=Rb.dereference(e,"string");try{n=Eb(n)}catch(r){return this._throwError(r.message,e)}return t.writeValue(n)}decode(t){return Eb(ty(t.readValue(),20))}}class Nb extends gy{constructor(t){super(t.name,t.type,"_",t.dynamic),St(this,"coder",void 0),this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,e){return this.coder.encode(t,e)}decode(t){return this.coder.decode(t)}}function _b(t,e,n){let r=[];if(Array.isArray(n))r=n;else if(n&&"object"===typeof n){let t={};r=e.map(e=>{const r=e.localName;return kv(r,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:e},value:n}),kv(!t[r],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:e},value:n}),t[r]=!0,n[r]})}else Sv(!1,"invalid tuple value","tuple",n);Sv(e.length===r.length,"types/value length mismatch","tuple",n);let o=new by,i=new by,a=[];e.forEach((t,e)=>{let n=r[e];if(t.dynamic){let e=i.length;t.encode(i,n);let r=o.writeUpdatableValue();a.push(t=>{r(t+e)})}else t.encode(o,n)}),a.forEach(t=>{t(o.length)});let s=t.appendWriter(o);return s+=t.appendWriter(i),s}function Pb(t,e){let n=[],r=[],o=t.subReader(0);return e.forEach(e=>{let i=null;if(e.dynamic){let n=t.readIndex(),r=o.subReader(n);try{i=e.decode(r)}catch(a){if(Ev(a,"BUFFER_OVERRUN"))throw a;i=a,i.baseType=e.name,i.name=e.localName,i.type=e.type}}else try{i=e.decode(t)}catch(a){if(Ev(a,"BUFFER_OVERRUN"))throw a;i=a,i.baseType=e.name,i.name=e.localName,i.type=e.type}if(void 0==i)throw new Error("investigate");n.push(i),r.push(e.localName||null)}),fy.fromItems(n,r)}class Db extends gy{constructor(t,e,n){super("array",t.type+"["+(e>=0?e:"")+"]",n,-1===e||t.dynamic),St(this,"coder",void 0),St(this,"length",void 0),wv(this,{coder:t,length:e})}defaultValue(){const t=this.coder.defaultValue(),e=[];for(let n=0;n<this.length;n++)e.push(t);return e}encode(t,e){const n=Rb.dereference(e,"array");Array.isArray(n)||this._throwError("expected array value",n);let r=this.length;-1===r&&(r=n.length,t.writeValue(n.length)),Iv(n.length,r,"coder array"+(this.localName?" "+this.localName:""));let o=[];for(let i=0;i<n.length;i++)o.push(this.coder);return _b(t,o,n)}decode(t){let e=this.length;-1===e&&(e=t.readIndex(),kv(e*ry<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:e*ry,length:t.dataLength}));let n=[];for(let r=0;r<e;r++)n.push(new Nb(this.coder));return Pb(t,n)}}class Ob extends gy{constructor(t){super("bool","bool",t,!1)}defaultValue(){return!1}encode(t,e){const n=Rb.dereference(e,"bool");return t.writeValue(n?1:0)}decode(t){return!!t.readValue()}}class Fb extends gy{constructor(t,e){super(t,t,e,!0)}defaultValue(){return"0x"}encode(t,e){e=Dv(e);let n=t.writeValue(e.length);return n+=t.writeBytes(e),n}decode(t){return t.readBytes(t.readIndex(),!0)}}class Mb extends Fb{constructor(t){super("bytes",t)}decode(t){return Bv(super.decode(t))}}class Bb extends gy{constructor(t,e){let n="bytes"+String(t);super(n,n,e,!1),St(this,"size",void 0),wv(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+2*this.size)}encode(t,e){let n=Dv(Rb.dereference(e,this.type));return n.length!==this.size&&this._throwError("incorrect data length",e),t.writeBytes(n)}decode(t){return Bv(t.readBytes(this.size))}}const Lb=new Uint8Array([]);class Ub extends gy{constructor(t){super("null","",t,!1)}defaultValue(){return null}encode(t,e){return null!=e&&this._throwError("not null",e),t.writeBytes(Lb)}decode(t){return t.readBytes(0),null}}const Wb=BigInt(0),zb=BigInt(1),Vb=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class jb extends gy{constructor(t,e,n){const r=(e?"int":"uint")+8*t;super(r,r,n,!1),St(this,"size",void 0),St(this,"signed",void 0),wv(this,{size:t,signed:e},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,e){let n=Xv(Rb.dereference(e,this.type)),r=Qv(Vb,256);if(this.signed){let t=Qv(r,8*this.size-1);(n>t||n<-(t+zb))&&this._throwError("value out-of-bounds",e),n=Kv(n,256)}else(n<Wb||n>Qv(r,8*this.size))&&this._throwError("value out-of-bounds",e);return t.writeValue(n)}decode(t){let e=Qv(t.readValue(),8*this.size);return this.signed&&(e=qv(e,8*this.size)),e}}function Gb(t,e,n,r,o){if("BAD_PREFIX"===t||"UNEXPECTED_CONTINUE"===t){let t=0;for(let r=e+1;r<n.length&&n[r]>>6===2;r++)t++;return t}return"OVERRUN"===t?n.length-e-1:0}const Hb=Object.freeze({error:function(t,e,n,r,o){Sv(!1,"invalid codepoint at offset ".concat(e,"; ").concat(t),"bytes",n)},ignore:Gb,replace:function(t,e,n,r,o){return"OVERLONG"===t?(Sv("number"===typeof o,"invalid bad code point for replacement","badCodepoint",o),r.push(o),0):(r.push(65533),Gb(t,e,n))}});function qb(t,e){null==e&&(e=Hb.error);const n=Pv(t,"bytes"),r=[];let o=0;for(;o<n.length;){const t=n[o++];if(t>>7===0){r.push(t);continue}let i=null,a=null;if(192===(224&t))i=1,a=127;else if(224===(240&t))i=2,a=2047;else{if(240!==(248&t)){o+=e(128===(192&t)?"UNEXPECTED_CONTINUE":"BAD_PREFIX",o-1,n,r);continue}i=3,a=65535}if(o-1+i>=n.length){o+=e("OVERRUN",o-1,n,r);continue}let s=t&(1<<8-i-1)-1;for(let u=0;u<i;u++){let t=n[o];if(128!=(192&t)){o+=e("MISSING_CONTINUE",o,n,r),s=null;break}s=s<<6|63&t,o++}null!==s&&(s>1114111?o+=e("OUT_OF_RANGE",o-1-i,n,r,s):s>=55296&&s<=57343?o+=e("UTF16_SURROGATE",o-1-i,n,r,s):s<=a?o+=e("OVERLONG",o-1-i,n,r,s):r.push(s))}return r}function Kb(t,e){Sv("string"===typeof t,"invalid string value","str",t),null!=e&&(!function(t){kv(Rv.indexOf(t)>=0,"platform missing String.prototype.normalize","UNSUPPORTED_OPERATION",{operation:"String.prototype.normalize",info:{form:t}})}(e),t=t.normalize(e));let n=[];for(let r=0;r<t.length;r++){const e=t.charCodeAt(r);if(e<128)n.push(e);else if(e<2048)n.push(e>>6|192),n.push(63&e|128);else if(55296==(64512&e)){r++;const o=t.charCodeAt(r);Sv(r<t.length&&56320===(64512&o),"invalid surrogate pair","str",t);const i=65536+((1023&e)<<10)+(1023&o);n.push(i>>18|240),n.push(i>>12&63|128),n.push(i>>6&63|128),n.push(63&i|128)}else n.push(e>>12|224),n.push(e>>6&63|128),n.push(63&e|128)}return new Uint8Array(n)}function Qb(t,e){return qb(t,e).map(t=>t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10&1023),56320+(1023&t)))).join("")}class Xb extends Fb{constructor(t){super("string",t)}defaultValue(){return""}encode(t,e){return super.encode(t,Kb(Rb.dereference(e,"string")))}decode(t){return Qb(super.decode(t))}}class Jb extends gy{constructor(t,e){let n=!1;const r=[];t.forEach(t=>{t.dynamic&&(n=!0),r.push(t.type)});super("tuple","tuple("+r.join(",")+")",e,n),St(this,"coders",void 0),wv(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach(e=>{t.push(e.defaultValue())});const e=this.coders.reduce((t,e)=>{const n=e.localName;return n&&(t[n]||(t[n]=0),t[n]++),t},{});return this.coders.forEach((n,r)=>{let o=n.localName;o&&1===e[o]&&("length"===o&&(o="_length"),null==t[o]&&(t[o]=t[r]))}),Object.freeze(t)}encode(t,e){const n=Rb.dereference(e,"tuple");return _b(t,this.coders,n)}decode(t){return Pb(t,this.coders)}}function Yb(t){return gb(Kb(t))}var Zb;function $b(t){const e=new Set;return t.forEach(t=>e.add(t)),Object.freeze(e)}const tw=$b("external public payable override".split(" ")),ew="constant external internal payable private public pure view override",nw=$b(ew.split(" ")),rw="constructor error event fallback function receive struct",ow=$b(rw.split(" ")),iw="calldata memory storage payable indexed",aw=$b(iw.split(" ")),sw=$b([rw,iw,"tuple returns",ew].join(" ").split(" ")),uw={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},cw=new RegExp("^(\\s*)"),lw=new RegExp("^([0-9]+)"),hw=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),dw=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),fw=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");var pw=new WeakMap,gw=new WeakMap,mw=new WeakSet;class vw{get offset(){return mv(pw,this)}get length(){return mv(gw,this).length-mv(pw,this)}constructor(t){Nv(this,mw),pv(this,pw,void 0),pv(this,gw,void 0),vv(pw,this,0),vv(gw,this,t.slice())}clone(){return new vw(mv(gw,this))}reset(){vv(pw,this,0)}popKeyword(t){const e=this.peek();if("KEYWORD"!==e.type||!t.has(e.text))throw new Error("expected keyword ".concat(e.text));return this.pop().text}popType(t){if(this.peek().type!==t){const e=this.peek();throw new Error("expected ".concat(t,"; got ").concat(e.type," ").concat(JSON.stringify(e.text)))}return this.pop().text}popParen(){const t=this.peek();if("OPEN_PAREN"!==t.type)throw new Error("bad start");const e=gv(mw,this,yw).call(this,mv(pw,this)+1,t.match+1);return vv(pw,this,t.match+1),e}popParams(){const t=this.peek();if("OPEN_PAREN"!==t.type)throw new Error("bad start");const e=[];for(;mv(pw,this)<t.match-1;){const t=this.peek().linkNext;e.push(gv(mw,this,yw).call(this,mv(pw,this)+1,t)),vv(pw,this,t)}return vv(pw,this,t.match+1),e}peek(){if(mv(pw,this)>=mv(gw,this).length)throw new Error("out-of-bounds");return mv(gw,this)[mv(pw,this)]}peekKeyword(t){const e=this.peekType("KEYWORD");return null!=e&&t.has(e)?e:null}peekType(t){if(0===this.length)return null;const e=this.peek();return e.type===t?e.text:null}pop(){var t;const e=this.peek();return vv(pw,this,(t=mv(pw,this),t++,t)),e}toString(){const t=[];for(let e=mv(pw,this);e<mv(gw,this).length;e++){const n=mv(gw,this)[e];t.push("".concat(n.type,":").concat(n.text))}return"<TokenString ".concat(t.join(" "),">")}}function yw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new Zb(mv(gw,this).slice(t,e).map(e=>Object.freeze(Object.assign({},e,{match:e.match-t,linkBack:e.linkBack-t,linkNext:e.linkNext-t}))))}function bw(t){const e=[],n=e=>{const n=i<t.length?JSON.stringify(t[i]):"$EOI";throw new Error("invalid token ".concat(n," at ").concat(i,": ").concat(e))};let r=[],o=[],i=0;for(;i<t.length;){let a=t.substring(i),s=a.match(cw);s&&(i+=s[1].length,a=t.substring(i));const u={depth:r.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:i,value:-1};e.push(u);let c=uw[a[0]]||"";if(c){if(u.type=c,u.text=a[0],i++,"OPEN_PAREN"===c)r.push(e.length-1),o.push(e.length-1);else if("CLOSE_PAREN"==c)0===r.length&&n("no matching open bracket"),u.match=r.pop(),e[u.match].match=e.length-1,u.depth--,u.linkBack=o.pop(),e[u.linkBack].linkNext=e.length-1;else if("COMMA"===c)u.linkBack=o.pop(),e[u.linkBack].linkNext=e.length-1,o.push(e.length-1);else if("OPEN_BRACKET"===c)u.type="BRACKET";else if("CLOSE_BRACKET"===c){let t=e.pop().text;if(e.length>0&&"NUMBER"===e[e.length-1].type){const n=e.pop().text;t=n+t,e[e.length-1].value=$v(n)}if(0===e.length||"BRACKET"!==e[e.length-1].type)throw new Error("missing opening bracket");e[e.length-1].text+=t}}else if(s=a.match(hw),s){if(u.text=s[1],i+=u.text.length,sw.has(u.text)){u.type="KEYWORD";continue}if(u.text.match(fw)){u.type="TYPE";continue}u.type="ID"}else{if(s=a.match(lw),!s)throw new Error("unexpected token ".concat(JSON.stringify(a[0])," at position ").concat(i));u.text=s[1],u.type="NUMBER",i+=u.text.length}}return new vw(e.map(t=>Object.freeze(t)))}function ww(t,e){let n=[];for(const r in e.keys())t.has(r)&&n.push(r);if(n.length>1)throw new Error("conflicting types: ".concat(n.join(", ")))}function xw(t,e){if(e.peekKeyword(ow)){const n=e.pop().text;if(n!==t)throw new Error("expected ".concat(t,", got ").concat(n))}return e.popType("ID")}function Ew(t,e){const n=new Set;for(;;){const r=t.peekType("KEYWORD");if(null==r||e&&!e.has(r))break;if(t.pop(),n.has(r))throw new Error("duplicate keywords: ".concat(JSON.stringify(r)));n.add(r)}return Object.freeze(n)}function Aw(t){let e=Ew(t,nw);return ww(e,$b("constant payable nonpayable".split(" "))),ww(e,$b("pure view payable nonpayable".split(" "))),e.has("view")?"view":e.has("pure")?"pure":e.has("payable")?"payable":e.has("nonpayable")?"nonpayable":e.has("constant")?"view":"nonpayable"}function Cw(t,e){return t.popParams().map(t=>Uw.from(t,e))}function kw(t){if(t.peekType("AT")){if(t.pop(),t.peekType("NUMBER"))return Xv(t.pop().text);throw new Error("invalid gas")}return null}function Sw(t){if(t.length)throw new Error("unexpected tokens at offset ".concat(t.offset,": ").concat(t.toString()))}Zb=vw;const Iw=new RegExp(/^(.*)\[([0-9]*)\]$/);function Rw(t){const e=t.match(fw);if(Sv(e,"invalid type","type",t),"uint"===t)return"uint256";if("int"===t)return"int256";if(e[2]){const n=parseInt(e[2]);Sv(0!==n&&n<=32,"invalid bytes length","type",t)}else if(e[3]){const n=parseInt(e[3]);Sv(0!==n&&n<=256&&n%8===0,"invalid numeric width","type",t)}return t}const Tw={},Nw=Symbol.for("_ethers_internal"),_w="_ParamTypeInternal",Pw="_ErrorInternal",Dw="_EventInternal",Ow="_ConstructorInternal",Fw="_FallbackInternal",Mw="_FunctionInternal",Bw="_StructInternal";var Lw=new WeakSet;class Uw{constructor(t,e,n,r,o,i,a,s){if(Nv(this,Lw),St(this,"name",void 0),St(this,"type",void 0),St(this,"baseType",void 0),St(this,"indexed",void 0),St(this,"components",void 0),St(this,"arrayLength",void 0),St(this,"arrayChildren",void 0),Tv(t,Tw,"ParamType"),Object.defineProperty(this,Nw,{value:_w}),i&&(i=Object.freeze(i.slice())),"array"===r){if(null==a||null==s)throw new Error("")}else if(null!=a||null!=s)throw new Error("");if("tuple"===r){if(null==i)throw new Error("")}else if(null!=i)throw new Error("");wv(this,{name:e,type:n,baseType:r,indexed:o,components:i,arrayLength:a,arrayChildren:s})}format(t){if(null==t&&(t="sighash"),"json"===t){const e=this.name||"";if(this.isArray()){const t=JSON.parse(this.arrayChildren.format("json"));return t.name=e,t.type+="[".concat(this.arrayLength<0?"":String(this.arrayLength),"]"),JSON.stringify(t)}const n={type:"tuple"===this.baseType?"tuple":this.type,name:e};return"boolean"===typeof this.indexed&&(n.indexed=this.indexed),this.isTuple()&&(n.components=this.components.map(e=>JSON.parse(e.format(t)))),JSON.stringify(n)}let e="";return this.isArray()?(e+=this.arrayChildren.format(t),e+="[".concat(this.arrayLength<0?"":String(this.arrayLength),"]")):this.isTuple()?e+="("+this.components.map(e=>e.format(t)).join("full"===t?", ":",")+")":e+=this.type,"sighash"!==t&&(!0===this.indexed&&(e+=" indexed"),"full"===t&&this.name&&(e+=" "+this.name)),e}isArray(){return"array"===this.baseType}isTuple(){return"tuple"===this.baseType}isIndexable(){return null!=this.indexed}walk(t,e){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(-1!==this.arrayLength&&t.length!==this.arrayLength)throw new Error("array is wrong length");const n=this;return t.map(t=>n.arrayChildren.walk(t,e))}if(this.isTuple()){if(!Array.isArray(t))throw new Error("invalid tuple value");if(t.length!==this.components.length)throw new Error("array is wrong length");const n=this;return t.map((t,r)=>n.components[r].walk(t,e))}return e(this.type,t)}async walkAsync(t,e){const n=[],r=[t];return gv(Lw,this,Ww).call(this,n,t,e,t=>{r[0]=t}),n.length&&await Promise.all(n),r[0]}static from(t,e){if(Uw.isParamType(t))return t;if("string"===typeof t)try{return Uw.from(bw(t),e)}catch(a){Sv(!1,"invalid param type","obj",t)}else if(t instanceof vw){let n="",r="",o=null;Ew(t,$b(["tuple"])).has("tuple")||t.peekType("OPEN_PAREN")?(r="tuple",o=t.popParams().map(t=>Uw.from(t)),n="tuple(".concat(o.map(t=>t.format()).join(","),")")):(n=Rw(t.popType("TYPE")),r=n);let i=null,a=null;for(;t.length&&t.peekType("BRACKET");){const e=t.pop();i=new Uw(Tw,"",n,r,null,o,a,i),a=e.value,n+=e.text,r="array",o=null}let s=null;if(Ew(t,aw).has("indexed")){if(!e)throw new Error("");s=!0}const u=t.peekType("ID")?t.pop().text:"";if(t.length)throw new Error("leftover tokens");return new Uw(Tw,u,n,r,s,o,a,i)}const n=t.name;Sv(!n||"string"===typeof n&&n.match(dw),"invalid name","obj.name",n);let r=t.indexed;null!=r&&(Sv(e,"parameter cannot be indexed","obj.indexed",t.indexed),r=!!r);let o=t.type,i=o.match(Iw);if(i){const e=parseInt(i[2]||"-1"),a=Uw.from({type:i[1],components:t.components});return new Uw(Tw,n||"",o,"array",r,null,e,a)}if("tuple"===o||o.startsWith("tuple(")||o.startsWith("(")){const e=null!=t.components?t.components.map(t=>Uw.from(t)):null;return new Uw(Tw,n||"",o,"tuple",r,e,null,null)}return o=Rw(t.type),new Uw(Tw,n||"",o,o,r,null,null,null)}static isParamType(t){return t&&t[Nw]===_w}}function Ww(t,e,n,r){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(-1!==this.arrayLength&&e.length!==this.arrayLength)throw new Error("array is wrong length");const o=this.arrayChildren,i=e.slice();return i.forEach((e,r)=>{gv(Lw,o,Ww).call(o,t,e,n,t=>{i[r]=t})}),void r(i)}if(this.isTuple()){const o=this.components;let i;if(Array.isArray(e))i=e.slice();else{if(null==e||"object"!==typeof e)throw new Error("invalid tuple value");i=o.map(t=>{if(!t.name)throw new Error("cannot use object value with unnamed components");if(!(t.name in e))throw new Error("missing value for component ".concat(t.name));return e[t.name]})}if(i.length!==this.components.length)throw new Error("array is wrong length");return i.forEach((e,r)=>{var a;gv(Lw,a=o[r],Ww).call(a,t,e,n,t=>{i[r]=t})}),void r(i)}const o=n(this.type,e);o.then?t.push(async function(){r(await o)}()):r(o)}class zw{constructor(t,e,n){St(this,"type",void 0),St(this,"inputs",void 0),Tv(t,Tw,"Fragment"),wv(this,{type:e,inputs:n=Object.freeze(n.slice())})}static from(t){if("string"===typeof t){try{zw.from(JSON.parse(t))}catch(Nt){}return zw.from(bw(t))}if(t instanceof vw){switch(t.peekKeyword(ow)){case"constructor":return qw.from(t);case"error":return Gw.from(t);case"event":return Hw.from(t);case"fallback":case"receive":return Kw.from(t);case"function":return Qw.from(t);case"struct":return Xw.from(t)}}else if("object"===typeof t){switch(t.type){case"constructor":return qw.from(t);case"error":return Gw.from(t);case"event":return Hw.from(t);case"fallback":case"receive":return Kw.from(t);case"function":return Qw.from(t);case"struct":return Xw.from(t)}kv(!1,"unsupported type: ".concat(t.type),"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}Sv(!1,"unsupported frgament object","obj",t)}static isConstructor(t){return qw.isFragment(t)}static isError(t){return Gw.isFragment(t)}static isEvent(t){return Hw.isFragment(t)}static isFunction(t){return Qw.isFragment(t)}static isStruct(t){return Xw.isFragment(t)}}class Vw extends zw{constructor(t,e,n,r){super(t,e,r),St(this,"name",void 0),Sv("string"===typeof n&&n.match(dw),"invalid identifier","name",n),r=Object.freeze(r.slice()),wv(this,{name:n})}}function jw(t,e){return"("+e.map(e=>e.format(t)).join("full"===t?", ":",")+")"}class Gw extends Vw{constructor(t,e,n){super(t,"error",e,n),Object.defineProperty(this,Nw,{value:Pw})}get selector(){return Yb(this.format("sighash")).substring(0,10)}format(t){if(null==t&&(t="sighash"),"json"===t)return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(e=>JSON.parse(e.format(t)))});const e=[];return"sighash"!==t&&e.push("error"),e.push(this.name+jw(t,this.inputs)),e.join(" ")}static from(t){if(Gw.isFragment(t))return t;if("string"===typeof t)return Gw.from(bw(t));if(t instanceof vw){const e=xw("error",t),n=Cw(t);return Sw(t),new Gw(Tw,e,n)}return new Gw(Tw,t.name,t.inputs?t.inputs.map(Uw.from):[])}static isFragment(t){return t&&t[Nw]===Pw}}class Hw extends Vw{constructor(t,e,n,r){super(t,"event",e,n),St(this,"anonymous",void 0),Object.defineProperty(this,Nw,{value:Dw}),wv(this,{anonymous:r})}get topicHash(){return Yb(this.format("sighash"))}format(t){if(null==t&&(t="sighash"),"json"===t)return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(e=>JSON.parse(e.format(t)))});const e=[];return"sighash"!==t&&e.push("event"),e.push(this.name+jw(t,this.inputs)),"sighash"!==t&&this.anonymous&&e.push("anonymous"),e.join(" ")}static getTopicHash(t,e){e=(e||[]).map(t=>Uw.from(t));return new Hw(Tw,t,e,!1).topicHash}static from(t){if(Hw.isFragment(t))return t;if("string"===typeof t)try{return Hw.from(bw(t))}catch(e){Sv(!1,"invalid event fragment","obj",t)}else if(t instanceof vw){const e=xw("event",t),n=Cw(t,!0),r=!!Ew(t,$b(["anonymous"])).has("anonymous");return Sw(t),new Hw(Tw,e,n,r)}return new Hw(Tw,t.name,t.inputs?t.inputs.map(t=>Uw.from(t,!0)):[],!!t.anonymous)}static isFragment(t){return t&&t[Nw]===Dw}}class qw extends zw{constructor(t,e,n,r,o){super(t,e,n),St(this,"payable",void 0),St(this,"gas",void 0),Object.defineProperty(this,Nw,{value:Ow}),wv(this,{payable:r,gas:o})}format(t){if(kv(null!=t&&"sighash"!==t,"cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),"json"===t)return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:null!=this.gas?this.gas:void 0,inputs:this.inputs.map(e=>JSON.parse(e.format(t)))});const e=["constructor".concat(jw(t,this.inputs))];return this.payable&&e.push("payable"),null!=this.gas&&e.push("@".concat(this.gas.toString())),e.join(" ")}static from(t){if(qw.isFragment(t))return t;if("string"===typeof t)try{return qw.from(bw(t))}catch(e){Sv(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof vw){Ew(t,$b(["constructor"]));const e=Cw(t),n=!!Ew(t,tw).has("payable"),r=kw(t);return Sw(t),new qw(Tw,"constructor",e,n,r)}return new qw(Tw,"constructor",t.inputs?t.inputs.map(Uw.from):[],!!t.payable,null!=t.gas?t.gas:null)}static isFragment(t){return t&&t[Nw]===Ow}}class Kw extends zw{constructor(t,e,n){super(t,"fallback",e),St(this,"payable",void 0),Object.defineProperty(this,Nw,{value:Fw}),wv(this,{payable:n})}format(t){const e=0===this.inputs.length?"receive":"fallback";if("json"===t){const t=this.payable?"payable":"nonpayable";return JSON.stringify({type:e,stateMutability:t})}return"".concat(e,"()").concat(this.payable?" payable":"")}static from(t){if(Kw.isFragment(t))return t;if("string"===typeof t)try{return Kw.from(bw(t))}catch(e){Sv(!1,"invalid fallback fragment","obj",t)}else if(t instanceof vw){const e=t.toString();Sv(t.peekKeyword($b(["fallback","receive"])),"type must be fallback or receive","obj",e);if("receive"===t.popKeyword($b(["fallback","receive"]))){const e=Cw(t);return Sv(0===e.length,"receive cannot have arguments","obj.inputs",e),Ew(t,$b(["payable"])),Sw(t),new Kw(Tw,[],!0)}let n=Cw(t);n.length?Sv(1===n.length&&"bytes"===n[0].type,"invalid fallback inputs","obj.inputs",n.map(t=>t.format("minimal")).join(", ")):n=[Uw.from("bytes")];const r=Aw(t);if(Sv("nonpayable"===r||"payable"===r,"fallback cannot be constants","obj.stateMutability",r),Ew(t,$b(["returns"])).has("returns")){const e=Cw(t);Sv(1===e.length&&"bytes"===e[0].type,"invalid fallback outputs","obj.outputs",e.map(t=>t.format("minimal")).join(", "))}return Sw(t),new Kw(Tw,n,"payable"===r)}if("receive"===t.type)return new Kw(Tw,[],!0);if("fallback"===t.type){const e=[Uw.from("bytes")],n="payable"===t.stateMutability;return new Kw(Tw,e,n)}Sv(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[Nw]===Fw}}class Qw extends Vw{constructor(t,e,n,r,o,i){super(t,"function",e,r),St(this,"constant",void 0),St(this,"outputs",void 0),St(this,"stateMutability",void 0),St(this,"payable",void 0),St(this,"gas",void 0),Object.defineProperty(this,Nw,{value:Mw});wv(this,{constant:"view"===n||"pure"===n,gas:i,outputs:o=Object.freeze(o.slice()),payable:"payable"===n,stateMutability:n})}get selector(){return Yb(this.format("sighash")).substring(0,10)}format(t){if(null==t&&(t="sighash"),"json"===t)return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:"nonpayable"!==this.stateMutability?this.stateMutability:void 0,payable:this.payable,gas:null!=this.gas?this.gas:void 0,inputs:this.inputs.map(e=>JSON.parse(e.format(t))),outputs:this.outputs.map(e=>JSON.parse(e.format(t)))});const e=[];return"sighash"!==t&&e.push("function"),e.push(this.name+jw(t,this.inputs)),"sighash"!==t&&("nonpayable"!==this.stateMutability&&e.push(this.stateMutability),this.outputs&&this.outputs.length&&(e.push("returns"),e.push(jw(t,this.outputs))),null!=this.gas&&e.push("@".concat(this.gas.toString()))),e.join(" ")}static getSelector(t,e){e=(e||[]).map(t=>Uw.from(t));return new Qw(Tw,t,"view",e,[],null).selector}static from(t){if(Qw.isFragment(t))return t;if("string"===typeof t)try{return Qw.from(bw(t))}catch(n){Sv(!1,"invalid function fragment","obj",t)}else if(t instanceof vw){const e=xw("function",t),n=Cw(t),r=Aw(t);let o=[];Ew(t,$b(["returns"])).has("returns")&&(o=Cw(t));const i=kw(t);return Sw(t),new Qw(Tw,e,r,n,o,i)}let e=t.stateMutability;return null==e&&(e="payable","boolean"===typeof t.constant?(e="view",t.constant||(e="payable","boolean"!==typeof t.payable||t.payable||(e="nonpayable"))):"boolean"!==typeof t.payable||t.payable||(e="nonpayable")),new Qw(Tw,t.name,e,t.inputs?t.inputs.map(Uw.from):[],t.outputs?t.outputs.map(Uw.from):[],null!=t.gas?t.gas:null)}static isFragment(t){return t&&t[Nw]===Mw}}class Xw extends Vw{constructor(t,e,n){super(t,"struct",e,n),Object.defineProperty(this,Nw,{value:Bw})}format(){throw new Error("@TODO")}static from(t){if("string"===typeof t)try{return Xw.from(bw(t))}catch(e){Sv(!1,"invalid struct fragment","obj",t)}else if(t instanceof vw){const e=xw("struct",t),n=Cw(t);return Sw(t),new Xw(Tw,e,n)}return new Xw(Tw,t.name,t.inputs?t.inputs.map(Uw.from):[])}static isFragment(t){return t&&t[Nw]===Bw}}const Jw=new Map;Jw.set(0,"GENERIC_PANIC"),Jw.set(1,"ASSERT_FALSE"),Jw.set(17,"OVERFLOW"),Jw.set(18,"DIVIDE_BY_ZERO"),Jw.set(33,"ENUM_RANGE_ERROR"),Jw.set(34,"BAD_STORAGE_DATA"),Jw.set(49,"STACK_UNDERFLOW"),Jw.set(50,"ARRAY_RANGE_ERROR"),Jw.set(65,"OUT_OF_MEMORY"),Jw.set(81,"UNINITIALIZED_FUNCTION_CALL");const Yw=new RegExp(/^bytes([0-9]*)$/),Zw=new RegExp(/^(u?int)([0-9]*)$/);let $w=null,tx=1024;var ex=new WeakSet;class nx{constructor(){Nv(this,ex)}getDefaultValue(t){const e=t.map(t=>gv(ex,this,rx).call(this,Uw.from(t)));return new Jb(e,"_").defaultValue()}encode(t,e){Iv(e.length,t.length,"types/values length mismatch");const n=t.map(t=>gv(ex,this,rx).call(this,Uw.from(t))),r=new Jb(n,"_"),o=new by;return r.encode(o,e),o.data}decode(t,e,n){const r=t.map(t=>gv(ex,this,rx).call(this,Uw.from(t)));return new Jb(r,"_").decode(new Iy(e,n,tx))}static _setDefaultMaxInflation(t){Sv("number"===typeof t&&Number.isInteger(t),"invalid defaultMaxInflation factor","value",t),tx=t}static defaultAbiCoder(){return null==$w&&($w=new nx),$w}static getBuiltinCallException(t,e,n){return function(t,e,n,r){let o="missing revert data",i=null,a=null;if(n){o="execution reverted";const t=Pv(n);if(n=Bv(n),0===t.length)o+=" (no data present; likely require(false) occurred",i="require(false)";else if(t.length%32!==4)o+=" (could not decode reason; invalid data length)";else if("0x08c379a0"===Bv(t.slice(0,4)))try{i=r.decode(["string"],t.slice(4))[0],a={signature:"Error(string)",name:"Error",args:[i]},o+=": ".concat(JSON.stringify(i))}catch(u){o+=" (could not decode reason; invalid string data)"}else if("0x4e487b71"===Bv(t.slice(0,4)))try{const e=Number(r.decode(["uint256"],t.slice(4))[0]);a={signature:"Panic(uint256)",name:"Panic",args:[e]},i="Panic due to ".concat(Jw.get(e)||"UNKNOWN","(").concat(e,")"),o+=": ".concat(i)}catch(u){o+=" (could not decode panic code)"}else o+=" (unknown custom error)"}const s={to:e.to?Eb(e.to):null,data:e.data||"0x"};return e.from&&(s.from=Eb(e.from)),Cv(o,"CALL_EXCEPTION",{action:t,data:n,reason:i,transaction:s,invocation:null,revert:a})}(t,e,n,nx.defaultAbiCoder())}}function rx(t){if(t.isArray())return new Db(gv(ex,this,rx).call(this,t.arrayChildren),t.arrayLength,t.name);if(t.isTuple())return new Jb(t.components.map(t=>gv(ex,this,rx).call(this,t)),t.name);switch(t.baseType){case"address":return new Tb(t.name);case"bool":return new Ob(t.name);case"string":return new Xb(t.name);case"bytes":return new Mb(t.name);case"":return new Ub(t.name)}let e=t.type.match(Zw);if(e){let n=parseInt(e[2]||"256");return Sv(0!==n&&n<=256&&n%8===0,"invalid "+e[1]+" bit length","param",t),new jb(n/8,"int"===e[1],t.name)}if(e=t.type.match(Yw),e){let n=parseInt(e[1]);return Sv(0!==n&&n<=32,"invalid bytes length","param",t),new Bb(n,t.name)}Sv(!1,"invalid type","type",t.type)}function ox(t){return t&&"function"===typeof t.getAddress}async function ix(t,e){const n=await e;return null!=n&&"0x0000000000000000000000000000000000000000"!==n||(kv("string"!==typeof t,"unconfigured name","UNCONFIGURED_NAME",{value:t}),Sv(!1,"invalid AddressLike value; did not resolve to a value address","target",t)),Eb(n)}function ax(t,e){return"string"===typeof t?t.match(/^0x[0-9a-f]{40}$/i)?Eb(t):(kv(null!=e,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),ix(t,e.resolveName(t))):ox(t)?ix(t,t.getAddress()):t&&"function"===typeof t.then?ix(t,t):void Sv(!1,"unsupported addressable value","target",t)}const sx=new Uint8Array(32);sx.fill(0);const ux=BigInt(-1),cx=BigInt(0),lx=BigInt(1),hx=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");const dx=ty(lx,32),fx=ty(cx,32),px={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},gx=["name","version","chainId","verifyingContract","salt"];function mx(t){return function(e){return Sv("string"===typeof e,"invalid domain value for ".concat(JSON.stringify(t)),"domain.".concat(t),e),e}}const vx={name:mx("name"),version:mx("version"),chainId:function(t){const e=Xv(t,"domain.chainId");return Sv(e>=0,"invalid chain ID","domain.chainId",t),Number.isSafeInteger(e)?Number(e):ny(e)},verifyingContract:function(t){try{return Eb(t).toLowerCase()}catch(e){}Sv(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",t)},salt:function(t){const e=Pv(t,"domain.salt");return Sv(32===e.length,'invalid domain value "salt"',"domain.salt",t),Bv(e)}};function yx(t){{const e=t.match(/^(u?)int(\d+)$/);if(e){const n=""===e[1],r=parseInt(e[2]);Sv(r%8===0&&0!==r&&r<=256&&e[2]===String(r),"invalid numeric width","type",t);const o=Qv(hx,n?r-1:r),i=n?(o+lx)*ux:cx;return function(e){const r=Xv(e,"value");return Sv(r>=i&&r<=o,"value out-of-bounds for ".concat(t),"value",r),ty(n?Kv(r,256):r,32)}}}{const e=t.match(/^bytes(\d+)$/);if(e){const n=parseInt(e[1]);return Sv(0!==n&&n<=32&&e[1]===String(n),"invalid bytes width","type",t),function(e){return Sv(Pv(e).length===n,"invalid length for ".concat(t),"value",e),function(t){const e=Pv(t),n=e.length%32;return n?Lv([e,sx.slice(n)]):Bv(e)}(e)}}}switch(t){case"address":return function(t){return Vv(Eb(t),32)};case"bool":return function(t){return t?dx:fx};case"bytes":return function(t){return gb(t)};case"string":return function(t){return Yb(t)}}return null}function bx(t,e){return"".concat(t,"(").concat(e.map(t=>{let{name:e,type:n}=t;return n+" "+e}).join(","),")")}function wx(t){const e=t.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:t}}var xx=new WeakMap,Ex=new WeakMap,Ax=new WeakMap,Cx=new WeakSet;class kx{get types(){return JSON.parse(mv(xx,this))}constructor(t){Nv(this,Cx),St(this,"primaryType",void 0),pv(this,xx,void 0),pv(this,Ex,void 0),pv(this,Ax,void 0),vv(Ex,this,new Map),vv(Ax,this,new Map);const e=new Map,n=new Map,r=new Map,o={};Object.keys(t).forEach(i=>{o[i]=t[i].map(e=>{let{name:n,type:r}=e,{base:o,index:i}=wx(r);return"int"!==o||t.int||(o="int256"),"uint"!==o||t.uint||(o="uint256"),{name:n,type:o+(i||"")}}),e.set(i,new Set),n.set(i,[]),r.set(i,new Set)}),vv(xx,this,JSON.stringify(o));for(const a in o){const r=new Set;for(const i of o[a]){Sv(!r.has(i.name),"duplicate variable name ".concat(JSON.stringify(i.name)," in ").concat(JSON.stringify(a)),"types",t),r.add(i.name);const o=wx(i.type).base;Sv(o!==a,"circular type reference to ".concat(JSON.stringify(o)),"types",t);yx(o)||(Sv(n.has(o),"unknown type ".concat(JSON.stringify(o)),"types",t),n.get(o).push(a),e.get(a).add(o))}}const i=Array.from(n.keys()).filter(t=>0===n.get(t).length);Sv(0!==i.length,"missing primary type","types",t),Sv(1===i.length,"ambiguous primary types or unused types: ".concat(i.map(t=>JSON.stringify(t)).join(", ")),"types",t),wv(this,{primaryType:i[0]}),function o(i,a){Sv(!a.has(i),"circular type reference to ".concat(JSON.stringify(i)),"types",t),a.add(i);for(const t of e.get(i))if(n.has(t)){o(t,a);for(const e of a)r.get(e).add(t)}a.delete(i)}(this.primaryType,new Set);for(const[a,s]of r){const t=Array.from(s);t.sort(),mv(Ex,this).set(a,bx(a,o[a])+t.map(t=>bx(t,o[t])).join(""))}}getEncoder(t){let e=mv(Ax,this).get(t);return e||(e=gv(Cx,this,Sx).call(this,t),mv(Ax,this).set(t,e)),e}encodeType(t){const e=mv(Ex,this).get(t);return Sv(e,"unknown type: ".concat(JSON.stringify(t)),"name",t),e}encodeData(t,e){return this.getEncoder(t)(e)}hashStruct(t,e){return gb(this.encodeData(t,e))}encode(t){return this.encodeData(this.primaryType,t)}hash(t){return this.hashStruct(this.primaryType,t)}_visit(t,e,n){if(yx(t))return n(t,e);const r=wx(t).array;if(r)return Sv(-1===r.count||r.count===e.length,"array length mismatch; expected length ".concat(r.count),"value",e),e.map(t=>this._visit(r.prefix,t,n));const o=this.types[t];if(o)return o.reduce((t,r)=>{let{name:o,type:i}=r;return t[o]=this._visit(i,e[o],n),t},{});Sv(!1,"unknown type: ".concat(t),"type",t)}visit(t,e){return this._visit(this.primaryType,t,e)}static from(t){return new kx(t)}static getPrimaryType(t){return kx.from(t).primaryType}static hashStruct(t,e,n){return kx.from(e).hashStruct(t,n)}static hashDomain(t){const e=[];for(const n in t){if(null==t[n])continue;const r=px[n];Sv(r,"invalid typed-data domain key: ".concat(JSON.stringify(n)),"domain",t),e.push({name:n,type:r})}return e.sort((t,e)=>gx.indexOf(t.name)-gx.indexOf(e.name)),kx.hashStruct("EIP712Domain",{EIP712Domain:e},t)}static encode(t,e,n){return Lv(["0x1901",kx.hashDomain(t),kx.from(e).hash(n)])}static hash(t,e,n){return gb(kx.encode(t,e,n))}static async resolveNames(t,e,n,r){t=Object.assign({},t);for(const a in t)null==t[a]&&delete t[a];const o={};t.verifyingContract&&!Ov(t.verifyingContract,20)&&(o[t.verifyingContract]="0x");const i=kx.from(e);i.visit(n,(t,e)=>("address"!==t||Ov(e,20)||(o[e]="0x"),e));for(const a in o)o[a]=await r(a);return t.verifyingContract&&o[t.verifyingContract]&&(t.verifyingContract=o[t.verifyingContract]),{domain:t,value:n=i.visit(n,(t,e)=>"address"===t&&o[e]?o[e]:e)}}static getPayload(t,e,n){kx.hashDomain(t);const r={},o=[];gx.forEach(e=>{const n=t[e];null!=n&&(r[e]=vx[e](n),o.push({name:e,type:px[e]}))});const i=kx.from(e);e=i.types;const a=Object.assign({},e);return Sv(null==a.EIP712Domain,"types must not contain EIP712Domain type","types.EIP712Domain",e),a.EIP712Domain=o,i.encode(n),{types:a,domain:r,primaryType:i.primaryType,message:i.visit(n,(t,e)=>{if(t.match(/^bytes(\d*)/))return Bv(Pv(e));if(t.match(/^u?int/))return Xv(e).toString();switch(t){case"address":return e.toLowerCase();case"bool":return!!e;case"string":return Sv("string"===typeof e,"invalid string","value",e),e}Sv(!1,"unsupported type","type",t)})}}}function Sx(t){{const e=yx(t);if(e)return e}const e=wx(t).array;if(e){const t=e.prefix,n=this.getEncoder(t);return r=>{Sv(-1===e.count||e.count===r.length,"array length mismatch; expected length ".concat(e.count),"value",r);let o=r.map(n);return mv(Ex,this).has(t)&&(o=o.map(gb)),gb(Lv(o))}}const n=this.types[t];if(n){const e=Yb(mv(Ex,this).get(t));return t=>{const r=n.map(e=>{let{name:n,type:r}=e;const o=this.getEncoder(r)(t[n]);return mv(Ex,this).has(r)?gb(o):o});return r.unshift(e),Lv(r)}}Sv(!1,"unknown type: ".concat(t),"type",t)}function Ix(t,e){return{address:Eb(t),storageKeys:e.map((t,e)=>(Sv(Ov(t,32),"invalid slot","storageKeys[".concat(e,"]"),t),t.toLowerCase()))}}function Rx(t){if(Array.isArray(t))return t.map((e,n)=>Array.isArray(e)?(Sv(2===e.length,"invalid slot set","value[".concat(n,"]"),e),Ix(e[0],e[1])):(Sv(null!=e&&"object"===typeof e,"invalid address-slot set","value",t),Ix(e.address,e.storageKeys)));Sv(null!=t&&"object"===typeof t,"invalid access list","value",t);const e=Object.keys(t).map(e=>{const n=t[e].reduce((t,e)=>(t[e]=!0,t),{});return Ix(e,Object.keys(n).sort())});return e.sort((t,e)=>t.address.localeCompare(e.address)),e}const Tx="0x0000000000000000000000000000000000000000000000000000000000000000",Nx=BigInt(0),_x=BigInt(1),Px=BigInt(2),Dx=BigInt(27),Ox=BigInt(28),Fx=BigInt(35),Mx={};function Bx(t){return Vv(ey(t),32)}var Lx=new WeakMap,Ux=new WeakMap,Wx=new WeakMap,zx=new WeakMap;class Vx{get r(){return mv(Lx,this)}set r(t){Sv(32===Uv(t),"invalid r","value",t),vv(Lx,this,Bv(t))}get s(){return Sv(parseInt(mv(Ux,this).substring(0,3))<8,"non-canonical s; use ._s","s",mv(Ux,this)),mv(Ux,this)}set s(t){Sv(32===Uv(t),"invalid s","value",t),vv(Ux,this,Bv(t))}get _s(){return mv(Ux,this)}isValid(){return parseInt(mv(Ux,this).substring(0,3))<8}get v(){return mv(Wx,this)}set v(t){const e=$v(t,"value");Sv(27===e||28===e,"invalid v","v",t),vv(Wx,this,e)}get networkV(){return mv(zx,this)}get legacyChainId(){const t=this.networkV;return null==t?null:Vx.getChainId(t)}get yParity(){return 27===this.v?0:1}get yParityAndS(){const t=Pv(this.s);return this.yParity&&(t[0]|=128),Bv(t)}get compactSerialized(){return Lv([this.r,this.yParityAndS])}get serialized(){return Lv([this.r,this.s,this.yParity?"0x1c":"0x1b"])}constructor(t,e,n,r){pv(this,Lx,void 0),pv(this,Ux,void 0),pv(this,Wx,void 0),pv(this,zx,void 0),Tv(t,Mx,"Signature"),vv(Lx,this,e),vv(Ux,this,n),vv(Wx,this,r),vv(zx,this,null)}[Symbol.for("nodejs.util.inspect.custom")](){return'Signature { r: "'.concat(this.r,'", s: "').concat(this._s,'"').concat(this.isValid()?"":', valid: "false"',", yParity: ").concat(this.yParity,", networkV: ").concat(this.networkV," }")}clone(){const t=new Vx(Mx,this.r,this._s,this.v);return this.networkV&&vv(zx,t,this.networkV),t}toJSON(){const t=this.networkV;return{_type:"signature",networkV:null!=t?t.toString():null,r:this.r,s:this._s,v:this.v}}static getChainId(t){const e=Xv(t,"v");return e==Dx||e==Ox?Nx:(Sv(e>=Fx,"invalid EIP-155 v","v",t),(e-Fx)/Px)}static getChainIdV(t,e){return Xv(t)*Px+BigInt(35+e-27)}static getNormalizedV(t){const e=Xv(t);return e===Nx||e===Dx?27:e===_x||e===Ox?28:(Sv(e>=Fx,"invalid v","v",t),e&_x?27:28)}static from(t){function e(e,n){Sv(e,n,"signature",t)}if(null==t)return new Vx(Mx,Tx,Tx,27);if("string"===typeof t){const n=Pv(t,"signature");if(64===n.length){const t=Bv(n.slice(0,32)),e=n.slice(32,64),r=128&e[0]?28:27;return e[0]&=127,new Vx(Mx,t,Bv(e),r)}if(65===n.length){const t=Bv(n.slice(0,32)),e=Bv(n.slice(32,64)),r=Vx.getNormalizedV(n[64]);return new Vx(Mx,t,e,r)}e(!1,"invalid raw signature length")}if(t instanceof Vx)return t.clone();const n=t.r;e(null!=n,"missing r");const r=Bx(n),o=function(t,n){if(null!=t)return Bx(t);if(null!=n){e(Ov(n,32),"invalid yParityAndS");const t=Pv(n);return t[0]&=127,Bv(t)}e(!1,"missing s")}(t.s,t.yParityAndS),{networkV:i,v:a}=function(t,n,r){if(null!=t){const e=Xv(t);return{networkV:e>=Fx?e:void 0,v:Vx.getNormalizedV(e)}}if(null!=n)return e(Ov(n,32),"invalid yParityAndS"),{v:128&Pv(n)[0]?28:27};if(null!=r){switch($v(r,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}e(!1,"invalid yParity")}e(!1,"missing v")}(t.v,t.yParityAndS,t.yParity),s=new Vx(Mx,r,o,a);return i&&vv(zx,s,i),e(null==t.yParity||$v(t.yParity,"sig.yParity")===s.yParity,"yParity mismatch"),e(null==t.yParityAndS||t.yParityAndS===s.yParityAndS,"yParityAndS mismatch"),s}}function jx(t){return{address:Eb(t.address),nonce:Xv(null!=t.nonce?t.nonce:0),chainId:Xv(null!=t.chainId?t.chainId:0),signature:Vx.from(t.signature)}}function Gx(t){return async function(e,n){kv(null==n||!n.cancelled,"request cancelled before sending","CANCELLED");const r=e.url.split(":")[0].toLowerCase();kv("http"===r||"https"===r,"unsupported protocol ".concat(r),"UNSUPPORTED_OPERATION",{info:{protocol:r},operation:"request"}),kv("https"===r||!e.credentials||e.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let o=null;const i=new AbortController,a=setTimeout(()=>{o=Cv("request timeout","TIMEOUT"),i.abort()},e.timeout);n&&n.addListener(()=>{o=Cv("request cancelled","CANCELLED"),i.abort()});const s=Object.assign({},t,{method:e.method,headers:new Headers(Array.from(e)),body:e.body||void 0,signal:i.signal});let u;try{u=await fetch(e.url,s)}catch(SE){if(clearTimeout(a),o)throw o;throw SE}clearTimeout(a);const c={};u.headers.forEach((t,e)=>{c[e.toLowerCase()]=t});const l=await u.arrayBuffer(),h=null==l?null:new Uint8Array(l);return{statusCode:u.status,statusMessage:u.statusText,headers:c,body:h}}}Gx({});let Hx=Gx();const qx=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),Kx=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let Qx=!1;async function Xx(t,e){try{const e=t.match(qx);if(!e)throw new Error("invalid data");return new IE(200,"OK",{"content-type":e[1]||"text/plain"},e[2]?function(t){t=atob(t);const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return Pv(e)}(e[3]):Kb(e[3].replace(/%([0-9a-f][0-9a-f])/gi,(t,e)=>String.fromCharCode(parseInt(e,16)))))}catch(n){return new IE(599,"BAD REQUEST (invalid data: URI)",{},null,new bE(t))}}function Jx(t){return async function(e,n){try{const n=e.match(Kx);if(!n)throw new Error("invalid link");return new bE("".concat(t).concat(n[2]))}catch(r){return new IE(599,"BAD REQUEST (invalid IPFS URI)",{},null,new bE(e))}}}const Yx={data:Xx,ipfs:Jx("https://gateway.ipfs.io/ipfs/")},Zx=new WeakMap;var $x=new WeakMap,tE=new WeakMap;class eE{constructor(t){pv(this,$x,void 0),pv(this,tE,void 0),vv($x,this,[]),vv(tE,this,!1),Zx.set(t,()=>{if(!mv(tE,this)){vv(tE,this,!0);for(const t of mv($x,this))setTimeout(()=>{t()},0);vv($x,this,[])}})}addListener(t){kv(!mv(tE,this),"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),mv($x,this).push(t)}get cancelled(){return mv(tE,this)}checkSignal(){kv(!this.cancelled,"cancelled","CANCELLED",{})}}function nE(t){if(null==t)throw new Error("missing signal; should not happen");return t.checkSignal(),t}var rE=new WeakMap,oE=new WeakMap,iE=new WeakMap,aE=new WeakMap,sE=new WeakMap,uE=new WeakMap,cE=new WeakMap,lE=new WeakMap,hE=new WeakMap,dE=new WeakMap,fE=new WeakMap,pE=new WeakMap,gE=new WeakMap,mE=new WeakMap,vE=new WeakMap,yE=new WeakSet;class bE{get url(){return mv(uE,this)}set url(t){vv(uE,this,String(t))}get body(){return null==mv(cE,this)?null:new Uint8Array(mv(cE,this))}set body(t){if(null==t)vv(cE,this,void 0),vv(lE,this,void 0);else if("string"===typeof t)vv(cE,this,Kb(t)),vv(lE,this,"text/plain");else if(t instanceof Uint8Array)vv(cE,this,t),vv(lE,this,"application/octet-stream");else{if("object"!==typeof t)throw new Error("invalid body");vv(cE,this,Kb(JSON.stringify(t))),vv(lE,this,"application/json")}}hasBody(){return null!=mv(cE,this)}get method(){return mv(aE,this)?mv(aE,this):this.hasBody()?"POST":"GET"}set method(t){null==t&&(t=""),vv(aE,this,String(t).toUpperCase())}get headers(){const t=Object.assign({},mv(iE,this));return mv(hE,this)&&(t.authorization="Basic ".concat(function(t){const e=Pv(t);let n="";for(let r=0;r<e.length;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(Kb(mv(hE,this))))),this.allowGzip&&(t["accept-encoding"]="gzip"),null==t["content-type"]&&mv(lE,this)&&(t["content-type"]=mv(lE,this)),this.body&&(t["content-length"]=String(this.body.length)),t}getHeader(t){return this.headers[t.toLowerCase()]}setHeader(t,e){mv(iE,this)[String(t).toLowerCase()]=String(e)}clearHeaders(){vv(iE,this,{})}[Symbol.iterator](){const t=this.headers,e=Object.keys(t);let n=0;return{next:()=>{if(n<e.length){const r=e[n++];return{value:[r,t[r]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return mv(hE,this)||null}setCredentials(t,e){Sv(!t.match(/:/),"invalid basic authentication username","username","[REDACTED]"),vv(hE,this,"".concat(t,":").concat(e))}get allowGzip(){return mv(oE,this)}set allowGzip(t){vv(oE,this,!!t)}get allowInsecureAuthentication(){return!!mv(rE,this)}set allowInsecureAuthentication(t){vv(rE,this,!!t)}get timeout(){return mv(sE,this)}set timeout(t){Sv(t>=0,"timeout must be non-zero","timeout",t),vv(sE,this,t)}get preflightFunc(){return mv(dE,this)||null}set preflightFunc(t){vv(dE,this,t)}get processFunc(){return mv(fE,this)||null}set processFunc(t){vv(fE,this,t)}get retryFunc(){return mv(pE,this)||null}set retryFunc(t){vv(pE,this,t)}get getUrlFunc(){return mv(vE,this)||Hx}set getUrlFunc(t){vv(vE,this,t)}constructor(t){Nv(this,yE),pv(this,rE,void 0),pv(this,oE,void 0),pv(this,iE,void 0),pv(this,aE,void 0),pv(this,sE,void 0),pv(this,uE,void 0),pv(this,cE,void 0),pv(this,lE,void 0),pv(this,hE,void 0),pv(this,dE,void 0),pv(this,fE,void 0),pv(this,pE,void 0),pv(this,gE,void 0),pv(this,mE,void 0),pv(this,vE,void 0),vv(uE,this,String(t)),vv(rE,this,!1),vv(oE,this,!0),vv(iE,this,{}),vv(aE,this,""),vv(sE,this,3e5),vv(mE,this,{slotInterval:250,maxAttempts:12}),vv(vE,this,null)}toString(){return"<FetchRequest method=".concat(JSON.stringify(this.method)," url=").concat(JSON.stringify(this.url)," headers=").concat(JSON.stringify(this.headers)," body=").concat(mv(cE,this)?Bv(mv(cE,this)):"null",">")}setThrottleParams(t){null!=t.slotInterval&&(mv(mE,this).slotInterval=t.slotInterval),null!=t.maxAttempts&&(mv(mE,this).maxAttempts=t.maxAttempts)}send(){return kv(null==mv(gE,this),"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),vv(gE,this,new eE(this)),gv(yE,this,wE).call(this,0,RE()+this.timeout,0,this,new IE(0,"",{},null,this))}cancel(){kv(null!=mv(gE,this),"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const t=Zx.get(this);if(!t)throw new Error("missing signal; should not happen");t()}redirect(t){const e=this.url.split(":")[0].toLowerCase(),n=t.split(":")[0].toLowerCase();kv("GET"===this.method&&("https"!==e||"http"!==n)&&t.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:"redirect(".concat(this.method," ").concat(JSON.stringify(this.url)," => ").concat(JSON.stringify(t),")")});const r=new bE(t);return r.method="GET",r.allowGzip=this.allowGzip,r.timeout=this.timeout,vv(iE,r,Object.assign({},mv(iE,this))),mv(cE,this)&&vv(cE,r,new Uint8Array(mv(cE,this))),vv(lE,r,mv(lE,this)),r}clone(){const t=new bE(this.url);return vv(aE,t,mv(aE,this)),mv(cE,this)&&vv(cE,t,mv(cE,this)),vv(lE,t,mv(lE,this)),vv(iE,t,Object.assign({},mv(iE,this))),vv(hE,t,mv(hE,this)),this.allowGzip&&(t.allowGzip=!0),t.timeout=this.timeout,this.allowInsecureAuthentication&&(t.allowInsecureAuthentication=!0),vv(dE,t,mv(dE,this)),vv(fE,t,mv(fE,this)),vv(pE,t,mv(pE,this)),vv(mE,t,Object.assign({},mv(mE,this))),vv(vE,t,mv(vE,this)),t}static lockConfig(){Qx=!0}static getGateway(t){return Yx[t.toLowerCase()]||null}static registerGateway(t,e){if("http"===(t=t.toLowerCase())||"https"===t)throw new Error("cannot intercept ".concat(t,"; use registerGetUrl"));if(Qx)throw new Error("gateways locked");Yx[t]=e}static registerGetUrl(t){if(Qx)throw new Error("gateways locked");Hx=t}static createGetUrlFunc(t){return Gx(t)}static createDataGateway(){return Xx}static createIpfsGatewayFunc(t){return Jx(t)}}async function wE(t,e,n,r,o){if(t>=mv(mE,this).maxAttempts)return o.makeServerError("exceeded maximum retry limit");kv(RE()<=e,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:r}),n>0&&await function(t){return new Promise(e=>setTimeout(e,t))}(n);let i=this.clone();const a=(i.url.split(":")[0]||"").toLowerCase();if(a in Yx){const t=await Yx[a](i.url,nE(mv(gE,r)));if(t instanceof IE){let e=t;if(this.processFunc){nE(mv(gE,r));try{e=await this.processFunc(i,e)}catch(d){null!=d.throttle&&"number"===typeof d.stall||e.makeServerError("error in post-processing function",d).assertOk()}}return e}i=t}this.preflightFunc&&(i=await this.preflightFunc(i));const s=await this.getUrlFunc(i,nE(mv(gE,r)));let u=new IE(s.statusCode,s.statusMessage,s.headers,s.body,r);if(301===u.statusCode||302===u.statusCode){try{var c;const n=u.headers.location||"";return gv(yE,c=i.redirect(n),wE).call(c,t+1,e,0,r,u)}catch(d){}return u}if(429===u.statusCode&&(null==this.retryFunc||await this.retryFunc(i,u,t))){var l;const n=u.headers["retry-after"];let o=mv(mE,this).slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return"string"===typeof n&&n.match(/^[1-9][0-9]*$/)&&(o=parseInt(n)),gv(yE,l=i.clone(),wE).call(l,t+1,e,o,r,u)}if(this.processFunc){nE(mv(gE,r));try{u=await this.processFunc(i,u)}catch(d){var h;null!=d.throttle&&"number"===typeof d.stall||u.makeServerError("error in post-processing function",d).assertOk();let n=mv(mE,this).slotInterval*Math.trunc(Math.random()*Math.pow(2,t));return d.stall>=0&&(n=d.stall),gv(yE,h=i.clone(),wE).call(h,t+1,e,n,r,u)}}return u}var xE=new WeakMap,EE=new WeakMap,AE=new WeakMap,CE=new WeakMap,kE=new WeakMap,SE=new WeakMap;class IE{toString(){return"<FetchResponse status=".concat(this.statusCode," body=").concat(mv(CE,this)?Bv(mv(CE,this)):"null",">")}get statusCode(){return mv(xE,this)}get statusMessage(){return mv(EE,this)}get headers(){return Object.assign({},mv(AE,this))}get body(){return null==mv(CE,this)?null:new Uint8Array(mv(CE,this))}get bodyText(){try{return null==mv(CE,this)?"":Qb(mv(CE,this))}catch(t){kv(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch(t){kv(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const t=this.headers,e=Object.keys(t);let n=0;return{next:()=>{if(n<e.length){const r=e[n++];return{value:[r,t[r]],done:!1}}return{value:void 0,done:!0}}}}constructor(t,e,n,r,o){pv(this,xE,void 0),pv(this,EE,void 0),pv(this,AE,void 0),pv(this,CE,void 0),pv(this,kE,void 0),pv(this,SE,void 0),vv(xE,this,t),vv(EE,this,e),vv(AE,this,Object.keys(n).reduce((t,e)=>(t[e.toLowerCase()]=String(n[e]),t),{})),vv(CE,this,null==r?null:new Uint8Array(r)),vv(kE,this,o||null),vv(SE,this,{message:""})}makeServerError(t,e){let n;t?n="CLIENT ESCALATED SERVER ERROR (".concat(this.statusCode," ").concat(this.statusMessage,"; ").concat(t,")"):(t="".concat(this.statusCode," ").concat(this.statusMessage),n="CLIENT ESCALATED SERVER ERROR (".concat(t,")"));const r=new IE(599,n,this.headers,this.body,mv(kE,this)||void 0);return vv(SE,r,{message:t,error:e}),r}throwThrottleError(t,e){null==e?e=-1:Sv(Number.isInteger(e)&&e>=0,"invalid stall timeout","stall",e);const n=new Error(t||"throttling requests");throw wv(n,{stall:e,throttle:!0}),n}getHeader(t){return this.headers[t.toLowerCase()]}hasBody(){return null!=mv(CE,this)}get request(){return mv(kE,this)}ok(){return""===mv(SE,this).message&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:t,error:e}=mv(SE,this);""===t&&(t="server response ".concat(this.statusCode," ").concat(this.statusMessage));let n=null;this.request&&(n=this.request.url);let r=null;try{mv(CE,this)&&(r=Qb(mv(CE,this)))}catch(Nt){}kv(!1,t,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:e,info:{requestUrl:n,responseBody:r,responseStatus:"".concat(this.statusCode," ").concat(this.statusMessage)}})}}function RE(){return(new Date).getTime()}const TE="0x0000000000000000000000000000000000000000";class NE{constructor(t,e,n){St(this,"fragment",void 0),St(this,"name",void 0),St(this,"signature",void 0),St(this,"topic",void 0),St(this,"args",void 0);const r=t.name,o=t.format();wv(this,{fragment:t,name:r,signature:o,topic:e,args:n})}}class _E{constructor(t,e,n,r){St(this,"fragment",void 0),St(this,"name",void 0),St(this,"args",void 0),St(this,"signature",void 0),St(this,"selector",void 0),St(this,"value",void 0);const o=t.name,i=t.format();wv(this,{fragment:t,name:o,args:n,signature:i,selector:e,value:r})}}class PE{constructor(t,e,n){St(this,"fragment",void 0),St(this,"name",void 0),St(this,"args",void 0),St(this,"signature",void 0),St(this,"selector",void 0);const r=t.name,o=t.format();wv(this,{fragment:t,name:r,args:n,signature:o,selector:e})}}class DE{static isIndexed(t){return!(!t||!t._isIndexed)}constructor(t){St(this,"hash",void 0),St(this,"_isIndexed",void 0),wv(this,{hash:t,_isIndexed:!0})}}const OE={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},FE={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:t=>"reverted with reason string ".concat(JSON.stringify(t))},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:t=>{let e="unknown panic code";return t>=0&&t<=255&&OE[t.toString()]&&(e=OE[t.toString()]),"reverted with panic code 0x".concat(t.toString(16)," (").concat(e,")")}}};var ME=new WeakMap,BE=new WeakMap,LE=new WeakMap,UE=new WeakMap,WE=new WeakSet;class zE{constructor(t){Nv(this,WE),St(this,"fragments",void 0),St(this,"deploy",void 0),St(this,"fallback",void 0),St(this,"receive",void 0),pv(this,ME,void 0),pv(this,BE,void 0),pv(this,LE,void 0),pv(this,UE,void 0);let e=[];e="string"===typeof t?JSON.parse(t):t,vv(LE,this,new Map),vv(ME,this,new Map),vv(BE,this,new Map);const n=[];for(const a of e)try{n.push(zw.from(a))}catch(i){console.log("[Warning] Invalid Fragment ".concat(JSON.stringify(a),":"),i.message)}wv(this,{fragments:Object.freeze(n)});let r=null,o=!1;vv(UE,this,this.getAbiCoder()),this.fragments.forEach((t,e)=>{let n;switch(t.type){case"constructor":return this.deploy?void console.log("duplicate definition - constructor"):void wv(this,{deploy:t});case"fallback":return void(0===t.inputs.length?o=!0:(Sv(!r||t.payable!==r.payable,"conflicting fallback fragments","fragments[".concat(e,"]"),t),r=t,o=r.payable));case"function":n=mv(LE,this);break;case"event":n=mv(BE,this);break;case"error":n=mv(ME,this);break;default:return}const i=t.format();n.has(i)||n.set(i,t)}),this.deploy||wv(this,{deploy:qw.from("constructor()")}),wv(this,{fallback:r,receive:o})}format(t){const e=t?"minimal":"full",n=this.fragments.map(t=>t.format(e));return n}formatJson(){const t=this.fragments.map(t=>t.format("json"));return JSON.stringify(t.map(t=>JSON.parse(t)))}getAbiCoder(){return nx.defaultAbiCoder()}getFunctionName(t){const e=gv(WE,this,VE).call(this,t,null,!1);return Sv(e,"no matching function","key",t),e.name}hasFunction(t){return!!gv(WE,this,VE).call(this,t,null,!1)}getFunction(t,e){return gv(WE,this,VE).call(this,t,e||null,!0)}forEachFunction(t){const e=Array.from(mv(LE,this).keys());e.sort((t,e)=>t.localeCompare(e));for(let n=0;n<e.length;n++){const r=e[n];t(mv(LE,this).get(r),n)}}getEventName(t){const e=gv(WE,this,jE).call(this,t,null,!1);return Sv(e,"no matching event","key",t),e.name}hasEvent(t){return!!gv(WE,this,jE).call(this,t,null,!1)}getEvent(t,e){return gv(WE,this,jE).call(this,t,e||null,!0)}forEachEvent(t){const e=Array.from(mv(BE,this).keys());e.sort((t,e)=>t.localeCompare(e));for(let n=0;n<e.length;n++){const r=e[n];t(mv(BE,this).get(r),n)}}getError(t,e){if(Ov(t)){const e=t.toLowerCase();if(FE[e])return Gw.from(FE[e].signature);for(const t of mv(ME,this).values())if(e===t.selector)return t;return null}if(-1===t.indexOf("(")){const e=[];for(const[n,r]of mv(ME,this))n.split("(")[0]===t&&e.push(r);if(0===e.length)return"Error"===t?Gw.from("error Error(string)"):"Panic"===t?Gw.from("error Panic(uint256)"):null;if(e.length>1){const n=e.map(t=>JSON.stringify(t.format())).join(", ");Sv(!1,"ambiguous error description (i.e. ".concat(n,")"),"name",t)}return e[0]}if("Error(string)"===(t=Gw.from(t).format()))return Gw.from("error Error(string)");if("Panic(uint256)"===t)return Gw.from("error Panic(uint256)");const n=mv(ME,this).get(t);return n||null}forEachError(t){const e=Array.from(mv(ME,this).keys());e.sort((t,e)=>t.localeCompare(e));for(let n=0;n<e.length;n++){const r=e[n];t(mv(ME,this).get(r),n)}}_decodeParams(t,e){return mv(UE,this).decode(t,e)}_encodeParams(t,e){return mv(UE,this).encode(t,e)}encodeDeploy(t){return this._encodeParams(this.deploy.inputs,t||[])}decodeErrorResult(t,e){if("string"===typeof t){const e=this.getError(t);Sv(e,"unknown error","fragment",t),t=e}return Sv(Wv(e,0,4)===t.selector,"data signature does not match error ".concat(t.name,"."),"data",e),this._decodeParams(t.inputs,Wv(e,4))}encodeErrorResult(t,e){if("string"===typeof t){const e=this.getError(t);Sv(e,"unknown error","fragment",t),t=e}return Lv([t.selector,this._encodeParams(t.inputs,e||[])])}decodeFunctionData(t,e){if("string"===typeof t){const e=this.getFunction(t);Sv(e,"unknown function","fragment",t),t=e}return Sv(Wv(e,0,4)===t.selector,"data signature does not match function ".concat(t.name,"."),"data",e),this._decodeParams(t.inputs,Wv(e,4))}encodeFunctionData(t,e){if("string"===typeof t){const e=this.getFunction(t);Sv(e,"unknown function","fragment",t),t=e}return Lv([t.selector,this._encodeParams(t.inputs,e||[])])}decodeFunctionResult(t,e){if("string"===typeof t){const e=this.getFunction(t);Sv(e,"unknown function","fragment",t),t=e}let n="invalid length for result data";const r=Dv(e);if(r.length%32===0)try{return mv(UE,this).decode(t.outputs,r)}catch(o){n="could not decode result data"}kv(!1,n,"BAD_DATA",{value:Bv(r),info:{method:t.name,signature:t.format()}})}makeError(t,e){const n=Pv(t,"data"),r=nx.getBuiltinCallException("call",e,n);if(r.message.startsWith("execution reverted (unknown custom error)")){const t=Bv(n.slice(0,4)),e=this.getError(t);if(e)try{const t=mv(UE,this).decode(e.inputs,n.slice(4));r.revert={name:e.name,signature:e.format(),args:t},r.reason=r.revert.signature,r.message="execution reverted: ".concat(r.reason)}catch(Nt){r.message="execution reverted (coult not decode custom error)"}}const o=this.parseTransaction(e);return o&&(r.invocation={method:o.name,signature:o.signature,args:o.args}),r}encodeFunctionResult(t,e){if("string"===typeof t){const e=this.getFunction(t);Sv(e,"unknown function","fragment",t),t=e}return Bv(mv(UE,this).encode(t.outputs,e||[]))}encodeFilterTopics(t,e){if("string"===typeof t){const e=this.getEvent(t);Sv(e,"unknown event","eventFragment",t),t=e}kv(e.length<=t.inputs.length,"too many arguments for ".concat(t.format()),"UNEXPECTED_ARGUMENT",{count:e.length,expectedCount:t.inputs.length});const n=[];t.anonymous||n.push(t.topicHash);const r=(t,e)=>"string"===t.type?Yb(e):"bytes"===t.type?gb(Bv(e)):("bool"===t.type&&"boolean"===typeof e?e=e?"0x01":"0x00":t.type.match(/^u?int/)?e=ty(e):t.type.match(/^bytes/)?e=function(t,e){return zv(t,e,!1)}(e,32):"address"===t.type&&mv(UE,this).encode(["address"],[e]),Vv(Bv(e),32));for(e.forEach((e,o)=>{const i=t.inputs[o];i.indexed?null==e?n.push(null):"array"===i.baseType||"tuple"===i.baseType?Sv(!1,"filtering with tuples or arrays not supported","contract."+i.name,e):Array.isArray(e)?n.push(e.map(t=>r(i,t))):n.push(r(i,e)):Sv(null==e,"cannot filter non-indexed parameters; must be null","contract."+i.name,e)});n.length&&null===n[n.length-1];)n.pop();return n}encodeEventLog(t,e){if("string"===typeof t){const e=this.getEvent(t);Sv(e,"unknown event","eventFragment",t),t=e}const n=[],r=[],o=[];return t.anonymous||n.push(t.topicHash),Sv(e.length===t.inputs.length,"event arguments/values mismatch","values",e),t.inputs.forEach((t,i)=>{const a=e[i];if(t.indexed)if("string"===t.type)n.push(Yb(a));else if("bytes"===t.type)n.push(gb(a));else{if("tuple"===t.baseType||"array"===t.baseType)throw new Error("not implemented");n.push(mv(UE,this).encode([t.type],[a]))}else r.push(t),o.push(a)}),{data:mv(UE,this).encode(r,o),topics:n}}decodeEventLog(t,e,n){if("string"===typeof t){const e=this.getEvent(t);Sv(e,"unknown event","eventFragment",t),t=e}if(null!=n&&!t.anonymous){const e=t.topicHash;Sv(Ov(n[0],32)&&n[0].toLowerCase()===e,"fragment/topic mismatch","topics[0]",n[0]),n=n.slice(1)}const r=[],o=[],i=[];t.inputs.forEach((t,e)=>{t.indexed?"string"===t.type||"bytes"===t.type||"tuple"===t.baseType||"array"===t.baseType?(r.push(Uw.from({type:"bytes32",name:t.name})),i.push(!0)):(r.push(t),i.push(!1)):(o.push(t),i.push(!1))});const a=null!=n?mv(UE,this).decode(r,Lv(n)):null,s=mv(UE,this).decode(o,e,!0),u=[],c=[];let l=0,h=0;return t.inputs.forEach((t,e)=>{let n=null;if(t.indexed)if(null==a)n=new DE(null);else if(i[e])n=new DE(a[h++]);else try{n=a[h++]}catch(r){n=r}else try{n=s[l++]}catch(r){n=r}u.push(n),c.push(t.name||null)}),fy.fromItems(u,c)}parseTransaction(t){const e=Pv(t.data,"tx.data"),n=Xv(null!=t.value?t.value:0,"tx.value"),r=this.getFunction(Bv(e.slice(0,4)));if(!r)return null;const o=mv(UE,this).decode(r.inputs,e.slice(4));return new _E(r,r.selector,o,n)}parseCallResult(t){throw new Error("@TODO")}parseLog(t){const e=this.getEvent(t.topics[0]);return!e||e.anonymous?null:new NE(e,e.topicHash,this.decodeEventLog(e,t.data,t.topics))}parseError(t){const e=Bv(t),n=this.getError(Wv(e,0,4));if(!n)return null;const r=mv(UE,this).decode(n.inputs,Wv(e,4));return new PE(n,n.selector,r)}static from(t){return t instanceof zE?t:"string"===typeof t?new zE(JSON.parse(t)):"function"===typeof t.formatJson?new zE(t.formatJson()):"function"===typeof t.format?new zE(t.format("json")):new zE(t)}}function VE(t,e,n){if(Ov(t)){const e=t.toLowerCase();for(const t of mv(LE,this).values())if(e===t.selector)return t;return null}if(-1===t.indexOf("(")){const r=[];for(const[e,n]of mv(LE,this))e.split("(")[0]===t&&r.push(n);if(e){const t=e.length>0?e[e.length-1]:null;let n=e.length,o=!0;Rb.isTyped(t)&&"overrides"===t.type&&(o=!1,n--);for(let e=r.length-1;e>=0;e--){const t=r[e].inputs.length;t===n||o&&t===n-1||r.splice(e,1)}for(let i=r.length-1;i>=0;i--){const t=r[i].inputs;for(let n=0;n<e.length;n++)if(Rb.isTyped(e[n])){if(n>=t.length){if("overrides"===e[n].type)continue;r.splice(i,1);break}if(e[n].type!==t[n].baseType){r.splice(i,1);break}}}}if(1===r.length&&e&&e.length!==r[0].inputs.length){const t=e[e.length-1];(null==t||Array.isArray(t)||"object"!==typeof t)&&r.splice(0,1)}if(0===r.length)return null;if(r.length>1&&n){const e=r.map(t=>JSON.stringify(t.format())).join(", ");Sv(!1,"ambiguous function description (i.e. matches ".concat(e,")"),"key",t)}return r[0]}const r=mv(LE,this).get(Qw.from(t).format());return r||null}function jE(t,e,n){if(Ov(t)){const e=t.toLowerCase();for(const t of mv(BE,this).values())if(e===t.topicHash)return t;return null}if(-1===t.indexOf("(")){const r=[];for(const[e,n]of mv(BE,this))e.split("(")[0]===t&&r.push(n);if(e){for(let t=r.length-1;t>=0;t--)r[t].inputs.length<e.length&&r.splice(t,1);for(let t=r.length-1;t>=0;t--){const n=r[t].inputs;for(let o=0;o<e.length;o++)if(Rb.isTyped(e[o])&&e[o].type!==n[o].baseType){r.splice(t,1);break}}}if(0===r.length)return null;if(r.length>1&&n){const e=r.map(t=>JSON.stringify(t.format())).join(", ");Sv(!1,"ambiguous event description (i.e. matches ".concat(e,")"),"key",t)}return r[0]}const r=mv(BE,this).get(Hw.from(t).format());return r||null}const GE=BigInt(0);function HE(t){return null==t?null:t}function qE(t){return null==t?null:t.toString()}class KE{constructor(t,e,n){St(this,"gasPrice",void 0),St(this,"maxFeePerGas",void 0),St(this,"maxPriorityFeePerGas",void 0),wv(this,{gasPrice:HE(t),maxFeePerGas:HE(e),maxPriorityFeePerGas:HE(n)})}toJSON(){const{gasPrice:t,maxFeePerGas:e,maxPriorityFeePerGas:n}=this;return{_type:"FeeData",gasPrice:qE(t),maxFeePerGas:qE(e),maxPriorityFeePerGas:qE(n)}}}function QE(t){const e={};t.to&&(e.to=t.to),t.from&&(e.from=t.from),t.data&&(e.data=Bv(t.data));const n="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const o of n)o in t&&null!=t[o]&&(e[o]=Xv(t[o],"request.".concat(o)));const r="type,nonce".split(/,/);for(const o of r)o in t&&null!=t[o]&&(e[o]=$v(t[o],"request.".concat(o)));return t.accessList&&(e.accessList=Rx(t.accessList)),t.authorizationList&&(e.authorizationList=t.authorizationList.slice()),"blockTag"in t&&(e.blockTag=t.blockTag),"enableCcipRead"in t&&(e.enableCcipRead=!!t.enableCcipRead),"customData"in t&&(e.customData=t.customData),"blobVersionedHashes"in t&&t.blobVersionedHashes&&(e.blobVersionedHashes=t.blobVersionedHashes.slice()),"kzg"in t&&(e.kzg=t.kzg),"blobs"in t&&t.blobs&&(e.blobs=t.blobs.map(t=>Fv(t)?Bv(t):Object.assign({},t))),e}var XE=new WeakMap;class JE{constructor(t,e){St(this,"provider",void 0),St(this,"number",void 0),St(this,"hash",void 0),St(this,"timestamp",void 0),St(this,"parentHash",void 0),St(this,"parentBeaconBlockRoot",void 0),St(this,"nonce",void 0),St(this,"difficulty",void 0),St(this,"gasLimit",void 0),St(this,"gasUsed",void 0),St(this,"stateRoot",void 0),St(this,"receiptsRoot",void 0),St(this,"blobGasUsed",void 0),St(this,"excessBlobGas",void 0),St(this,"miner",void 0),St(this,"prevRandao",void 0),St(this,"extraData",void 0),St(this,"baseFeePerGas",void 0),pv(this,XE,void 0),vv(XE,this,t.transactions.map(t=>"string"!==typeof t?new eA(t,e):t)),wv(this,{provider:e,hash:HE(t.hash),number:t.number,timestamp:t.timestamp,parentHash:t.parentHash,parentBeaconBlockRoot:t.parentBeaconBlockRoot,nonce:t.nonce,difficulty:t.difficulty,gasLimit:t.gasLimit,gasUsed:t.gasUsed,blobGasUsed:t.blobGasUsed,excessBlobGas:t.excessBlobGas,miner:t.miner,prevRandao:HE(t.prevRandao),extraData:t.extraData,baseFeePerGas:HE(t.baseFeePerGas),stateRoot:t.stateRoot,receiptsRoot:t.receiptsRoot})}get transactions(){return mv(XE,this).map(t=>"string"===typeof t?t:t.hash)}get prefetchedTransactions(){const t=mv(XE,this).slice();return 0===t.length?[]:(kv("object"===typeof t[0],"transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),t)}toJSON(){const{baseFeePerGas:t,difficulty:e,extraData:n,gasLimit:r,gasUsed:o,hash:i,miner:a,prevRandao:s,nonce:u,number:c,parentHash:l,parentBeaconBlockRoot:h,stateRoot:d,receiptsRoot:f,timestamp:p,transactions:g}=this;return{_type:"Block",baseFeePerGas:qE(t),difficulty:qE(e),extraData:n,gasLimit:qE(r),gasUsed:qE(o),blobGasUsed:qE(this.blobGasUsed),excessBlobGas:qE(this.excessBlobGas),hash:i,miner:a,prevRandao:s,nonce:u,number:c,parentHash:l,timestamp:p,parentBeaconBlockRoot:h,stateRoot:d,receiptsRoot:f,transactions:g}}[Symbol.iterator](){let t=0;const e=this.transactions;return{next:()=>t<this.length?{value:e[t++],done:!1}:{value:void 0,done:!0}}}get length(){return mv(XE,this).length}get date(){return null==this.timestamp?null:new Date(1e3*this.timestamp)}async getTransaction(t){let e;if("number"===typeof t)e=mv(XE,this)[t];else{const n=t.toLowerCase();for(const t of mv(XE,this)){if("string"===typeof t){if(t!==n)continue;e=t;break}if(t.hash===n){e=t;break}}}if(null==e)throw new Error("no such tx");return"string"===typeof e?await this.provider.getTransaction(e):e}getPrefetchedTransaction(t){const e=this.prefetchedTransactions;if("number"===typeof t)return e[t];t=t.toLowerCase();for(const n of e)if(n.hash===t)return n;Sv(!1,"no matching transaction","indexOrHash",t)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return{orphan:"drop-block",hash:(t=this).hash,number:t.number};var t}}class YE{constructor(t,e){St(this,"provider",void 0),St(this,"transactionHash",void 0),St(this,"blockHash",void 0),St(this,"blockNumber",void 0),St(this,"removed",void 0),St(this,"address",void 0),St(this,"data",void 0),St(this,"topics",void 0),St(this,"index",void 0),St(this,"transactionIndex",void 0),this.provider=e;const n=Object.freeze(t.topics.slice());wv(this,{transactionHash:t.transactionHash,blockHash:t.blockHash,blockNumber:t.blockNumber,removed:t.removed,address:t.address,data:t.data,topics:n,index:t.index,transactionIndex:t.transactionIndex})}toJSON(){const{address:t,blockHash:e,blockNumber:n,data:r,index:o,removed:i,topics:a,transactionHash:s,transactionIndex:u}=this;return{_type:"log",address:t,blockHash:e,blockNumber:n,data:r,index:o,removed:i,topics:a,transactionHash:s,transactionIndex:u}}async getBlock(){const t=await this.provider.getBlock(this.blockHash);return kv(!!t,"failed to find transaction","UNKNOWN_ERROR",{}),t}async getTransaction(){const t=await this.provider.getTransaction(this.transactionHash);return kv(!!t,"failed to find transaction","UNKNOWN_ERROR",{}),t}async getTransactionReceipt(){const t=await this.provider.getTransactionReceipt(this.transactionHash);return kv(!!t,"failed to find transaction receipt","UNKNOWN_ERROR",{}),t}removedEvent(){return{orphan:"drop-log",log:{transactionHash:(t=this).transactionHash,blockHash:t.blockHash,blockNumber:t.blockNumber,address:t.address,data:t.data,topics:Object.freeze(t.topics.slice()),index:t.index}};var t}}var ZE=new WeakMap;class $E{constructor(t,e){St(this,"provider",void 0),St(this,"to",void 0),St(this,"from",void 0),St(this,"contractAddress",void 0),St(this,"hash",void 0),St(this,"index",void 0),St(this,"blockHash",void 0),St(this,"blockNumber",void 0),St(this,"logsBloom",void 0),St(this,"gasUsed",void 0),St(this,"blobGasUsed",void 0),St(this,"cumulativeGasUsed",void 0),St(this,"gasPrice",void 0),St(this,"blobGasPrice",void 0),St(this,"type",void 0),St(this,"status",void 0),St(this,"root",void 0),pv(this,ZE,void 0),vv(ZE,this,Object.freeze(t.logs.map(t=>new YE(t,e))));let n=GE;null!=t.effectiveGasPrice?n=t.effectiveGasPrice:null!=t.gasPrice&&(n=t.gasPrice),wv(this,{provider:e,to:t.to,from:t.from,contractAddress:t.contractAddress,hash:t.hash,index:t.index,blockHash:t.blockHash,blockNumber:t.blockNumber,logsBloom:t.logsBloom,gasUsed:t.gasUsed,cumulativeGasUsed:t.cumulativeGasUsed,blobGasUsed:t.blobGasUsed,gasPrice:n,blobGasPrice:t.blobGasPrice,type:t.type,status:t.status,root:t.root})}get logs(){return mv(ZE,this)}toJSON(){const{to:t,from:e,contractAddress:n,hash:r,index:o,blockHash:i,blockNumber:a,logsBloom:s,logs:u,status:c,root:l}=this;return{_type:"TransactionReceipt",blockHash:i,blockNumber:a,contractAddress:n,cumulativeGasUsed:qE(this.cumulativeGasUsed),from:e,gasPrice:qE(this.gasPrice),blobGasUsed:qE(this.blobGasUsed),blobGasPrice:qE(this.blobGasPrice),gasUsed:qE(this.gasUsed),hash:r,index:o,logs:u,logsBloom:s,root:l,status:c,to:t}}get length(){return this.logs.length}[Symbol.iterator](){let t=0;return{next:()=>t<this.length?{value:this.logs[t++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const t=await this.provider.getBlock(this.blockHash);if(null==t)throw new Error("TODO");return t}async getTransaction(){const t=await this.provider.getTransaction(this.hash);if(null==t)throw new Error("TODO");return t}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return rA(this)}reorderedEvent(t){return kv(!t||t.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),nA(this,t)}}var tA=new WeakMap;class eA{constructor(t,e){St(this,"provider",void 0),St(this,"blockNumber",void 0),St(this,"blockHash",void 0),St(this,"index",void 0),St(this,"hash",void 0),St(this,"type",void 0),St(this,"to",void 0),St(this,"from",void 0),St(this,"nonce",void 0),St(this,"gasLimit",void 0),St(this,"gasPrice",void 0),St(this,"maxPriorityFeePerGas",void 0),St(this,"maxFeePerGas",void 0),St(this,"maxFeePerBlobGas",void 0),St(this,"data",void 0),St(this,"value",void 0),St(this,"chainId",void 0),St(this,"signature",void 0),St(this,"accessList",void 0),St(this,"blobVersionedHashes",void 0),St(this,"authorizationList",void 0),pv(this,tA,void 0),this.provider=e,this.blockNumber=null!=t.blockNumber?t.blockNumber:null,this.blockHash=null!=t.blockHash?t.blockHash:null,this.hash=t.hash,this.index=t.index,this.type=t.type,this.from=t.from,this.to=t.to||null,this.gasLimit=t.gasLimit,this.nonce=t.nonce,this.data=t.data,this.value=t.value,this.gasPrice=t.gasPrice,this.maxPriorityFeePerGas=null!=t.maxPriorityFeePerGas?t.maxPriorityFeePerGas:null,this.maxFeePerGas=null!=t.maxFeePerGas?t.maxFeePerGas:null,this.maxFeePerBlobGas=null!=t.maxFeePerBlobGas?t.maxFeePerBlobGas:null,this.chainId=t.chainId,this.signature=t.signature,this.accessList=null!=t.accessList?t.accessList:null,this.blobVersionedHashes=null!=t.blobVersionedHashes?t.blobVersionedHashes:null,this.authorizationList=null!=t.authorizationList?t.authorizationList:null,vv(tA,this,-1)}toJSON(){const{blockNumber:t,blockHash:e,index:n,hash:r,type:o,to:i,from:a,nonce:s,data:u,signature:c,accessList:l,blobVersionedHashes:h}=this;return{_type:"TransactionResponse",accessList:l,blockNumber:t,blockHash:e,blobVersionedHashes:h,chainId:qE(this.chainId),data:u,from:a,gasLimit:qE(this.gasLimit),gasPrice:qE(this.gasPrice),hash:r,maxFeePerGas:qE(this.maxFeePerGas),maxPriorityFeePerGas:qE(this.maxPriorityFeePerGas),maxFeePerBlobGas:qE(this.maxFeePerBlobGas),nonce:s,signature:c,to:i,index:n,type:o,value:qE(this.value)}}async getBlock(){let t=this.blockNumber;if(null==t){const e=await this.getTransaction();e&&(t=e.blockNumber)}if(null==t)return null;const e=this.provider.getBlock(t);if(null==e)throw new Error("TODO");return e}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(null==this.blockNumber){const{tx:t,blockNumber:e}=await bv({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return null==t||null==t.blockNumber?0:e-t.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(t,e){const n=null==t?1:t,r=null==e?0:e;let o=mv(tA,this),i=-1,a=-1===o;const s=async()=>{if(a)return null;const{blockNumber:t,nonce:e}=await bv({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(e<this.nonce)return void(o=t);if(a)return null;const r=await this.getTransaction();if(!r||null==r.blockNumber)for(-1===i&&(i=o-3,i<mv(tA,this)&&(i=mv(tA,this)));i<=t;){if(a)return null;const e=await this.provider.getBlock(i,!0);if(null==e)return;for(const t of e)if(t===this.hash)return;for(let r=0;r<e.length;r++){const i=await e.getTransaction(r);if(i.from===this.from&&i.nonce===this.nonce){if(a)return null;const e=await this.provider.getTransactionReceipt(i.hash);if(null==e)return;if(t-e.blockNumber+1<n)return;let r="replaced";i.data===this.data&&i.to===this.to&&i.value===this.value?r="repriced":"0x"===i.data&&i.from===i.to&&i.value===GE&&(r="cancelled"),kv(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:"replaced"===r||"cancelled"===r,reason:r,replacement:i.replaceableTransaction(o),hash:i.hash,receipt:e})}}i++}},u=t=>{if(null==t||0!==t.status)return t;kv(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:t.to,from:t.from,data:""},receipt:t})},c=await this.provider.getTransactionReceipt(this.hash);if(0===n)return u(c);if(c){if(1===n||await c.confirmations()>=n)return u(c)}else if(await s(),0===n)return null;const l=new Promise((t,e)=>{const i=[],c=()=>{i.forEach(t=>t())};if(i.push(()=>{a=!0}),r>0){const t=setTimeout(()=>{c(),e(Cv("wait for transaction timeout","TIMEOUT"))},r);i.push(()=>{clearTimeout(t)})}const l=async r=>{if(await r.confirmations()>=n){c();try{t(u(r))}catch(o){e(o)}}};if(i.push(()=>{this.provider.off(this.hash,l)}),this.provider.on(this.hash,l),o>=0){const t=async()=>{try{await s()}catch(n){if(Ev(n,"TRANSACTION_REPLACED"))return c(),void e(n)}a||this.provider.once("block",t)};i.push(()=>{this.provider.off("block",t)}),this.provider.once("block",t)}});return await l}isMined(){return null!=this.blockHash}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}removedEvent(){return kv(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),rA(this)}reorderedEvent(t){return kv(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),kv(!t||t.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),nA(this,t)}replaceableTransaction(t){Sv(Number.isInteger(t)&&t>=0,"invalid startBlock","startBlock",t);const e=new eA(this,this.provider);return vv(tA,e,t),e}}function nA(t,e){return{orphan:"reorder-transaction",tx:t,other:e}}function rA(t){return{orphan:"drop-transaction",tx:t}}var oA=new WeakMap;class iA{constructor(t,e,n){St(this,"filter",void 0),St(this,"emitter",void 0),pv(this,oA,void 0),vv(oA,this,e),wv(this,{emitter:t,filter:n})}async removeListener(){null!=mv(oA,this)&&await this.emitter.off(this.filter,mv(oA,this))}}class aA extends YE{constructor(t,e,n){super(t,t.provider),St(this,"interface",void 0),St(this,"fragment",void 0),St(this,"args",void 0);wv(this,{args:e.decodeEventLog(n,t.data,t.topics),fragment:n,interface:e})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class sA extends YE{constructor(t,e){super(t,t.provider),St(this,"error",void 0),wv(this,{error:e})}}var uA=new WeakMap;class cA extends $E{constructor(t,e,n){super(n,e),pv(this,uA,void 0),vv(uA,this,t)}get logs(){return super.logs.map(t=>{const e=t.topics.length?mv(uA,this).getEvent(t.topics[0]):null;if(e)try{return new aA(t,mv(uA,this),e)}catch(n){return new sA(t,n)}return t})}}var lA=new WeakMap;class hA extends eA{constructor(t,e,n){super(n,e),pv(this,lA,void 0),vv(lA,this,t)}async wait(t,e){const n=await super.wait(t,e);return null==n?null:new cA(mv(lA,this),this.provider,n)}}class dA extends iA{constructor(t,e,n,r){super(t,e,n),St(this,"log",void 0),wv(this,{log:r})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class fA extends dA{constructor(t,e,n,r,o){super(t,e,n,new aA(o,t.interface,r));wv(this,{args:t.interface.decodeEventLog(r,this.log.data,this.log.topics),fragment:r})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const pA=BigInt(0);function gA(t){return t&&"function"===typeof t.call}function mA(t){return t&&"function"===typeof t.estimateGas}function vA(t){return t&&"function"===typeof t.resolveName}function yA(t){return t&&"function"===typeof t.sendTransaction}function bA(t){if(null!=t){if(vA(t))return t;if(t.provider)return t.provider}}var wA=new WeakMap;class xA{constructor(t,e,n){if(pv(this,wA,void 0),St(this,"fragment",void 0),wv(this,{fragment:e}),e.inputs.length<n.length)throw new Error("too many arguments");const r=EA(t.runner,"resolveName"),o=vA(r)?r:null;vv(wA,this,async function(){const r=await Promise.all(e.inputs.map((t,e)=>null==n[e]?null:t.walkAsync(n[e],(t,e)=>"address"===t?Array.isArray(e)?Promise.all(e.map(t=>ax(t,o))):ax(e,o):e)));return t.interface.encodeFilterTopics(e,r)}())}getTopicFilter(){return mv(wA,this)}}function EA(t,e){return null==t?null:"function"===typeof t[e]?t:t.provider&&"function"===typeof t.provider[e]?t.provider:null}function AA(t){return null==t?null:t.provider||null}async function CA(t,e){const n=Rb.dereference(t,"overrides");Sv("object"===typeof n,"invalid overrides parameter","overrides",t);const r=QE(n);return Sv(null==r.to||(e||[]).indexOf("to")>=0,"cannot override to","overrides.to",r.to),Sv(null==r.data||(e||[]).indexOf("data")>=0,"cannot override data","overrides.data",r.data),r.from&&(r.from=r.from),r}function kA(t){const e=async function(e){const n=await CA(e,["data"]);n.to=await t.getAddress(),n.from&&(n.from=await ax(n.from,bA(t.runner)));const r=t.interface,o=Xv(n.value||pA,"overrides.value")===pA,i="0x"===(n.data||"0x");!r.fallback||r.fallback.payable||!r.receive||i||o||Sv(!1,"cannot send data to receive or send value to non-payable fallback","overrides",e),Sv(r.fallback||i,"cannot send data to receive-only contract","overrides.data",n.data);return Sv(r.receive||r.fallback&&r.fallback.payable||o,"cannot send value to non-payable fallback","overrides.value",n.value),Sv(r.fallback||i,"cannot send data to receive-only contract","overrides.data",n.data),n},n=async function(n){const r=t.runner;kv(yA(r),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const o=await r.sendTransaction(await e(n)),i=AA(t.runner);return new hA(t.interface,i,o)},r=async t=>await n(t);return wv(r,{_contract:t,estimateGas:async function(n){const r=EA(t.runner,"estimateGas");return kv(mA(r),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await r.estimateGas(await e(n))},populateTransaction:e,send:n,staticCall:async function(n){const r=EA(t.runner,"call");kv(gA(r),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const o=await e(n);try{return await r.call(o)}catch(i){if(Av(i)&&i.data)throw t.interface.makeError(i.data,o);throw i}}}),r}function SA(t,e){const n=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const i=t.interface.getFunction(e,r);return kv(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:r}}),i},r=async function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];const i=n(...r);let a={};if(i.inputs.length+1===r.length&&(a=await CA(r.pop()),a.from&&(a.from=await ax(a.from,bA(t.runner)))),i.inputs.length!==r.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const s=await async function(t,e,n){const r=EA(t,"resolveName"),o=vA(r)?r:null;return await Promise.all(e.map((t,e)=>t.walkAsync(n[e],(t,e)=>(e=Rb.dereference(e,t),"address"===t?ax(e,o):e))))}(t.runner,i.inputs,r);return Object.assign({},a,await bv({to:t.getAddress(),data:t.interface.encodeFunctionData(i,s)}))},o=async function(){const t=await a(...arguments);return 1===t.length?t[0]:t},i=async function(){const e=t.runner;kv(yA(e),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const n=await e.sendTransaction(await r(...arguments)),o=AA(t.runner);return new hA(t.interface,o,n)},a=async function(){const e=EA(t.runner,"call");kv(gA(e),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const o=await r(...arguments);let i="0x";try{i=await e.call(o)}catch(s){if(Av(s)&&s.data)throw t.interface.makeError(s.data,o);throw s}const a=n(...arguments);return t.interface.decodeFunctionResult(a,i)},s=async function(){return n(...arguments).constant?await o(...arguments):await i(...arguments)};return wv(s,{name:t.interface.getFunctionName(e),_contract:t,_key:e,getFragment:n,estimateGas:async function(){const e=EA(t.runner,"estimateGas");return kv(mA(e),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await e.estimateGas(await r(...arguments))},populateTransaction:r,send:i,staticCall:o,staticCallResult:a}),Object.defineProperty(s,"fragment",{configurable:!1,enumerable:!0,get:()=>{const n=t.interface.getFunction(e);return kv(n,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),n}}),s}const IA=Symbol.for("_ethersInternal_contract"),RA=new WeakMap;function TA(t){return RA.get(t[IA])}async function NA(t,e){let n,r=null;if(Array.isArray(e)){const r=function(e){if(Ov(e,32))return e;const n=t.interface.getEvent(e);return Sv(n,"unknown fragment","name",e),n.topicHash};n=e.map(t=>null==t?null:Array.isArray(t)?t.map(r):r(t))}else"*"===e?n=[null]:"string"===typeof e?Ov(e,32)?n=[e]:(r=t.interface.getEvent(e),Sv(r,"unknown fragment","event",e),n=[r.topicHash]):(o=e)&&"object"===typeof o&&"getTopicFilter"in o&&"function"===typeof o.getTopicFilter&&o.fragment?n=await e.getTopicFilter():"fragment"in e?(r=e.fragment,n=[r.topicHash]):Sv(!1,"unknown event name","event",e);var o;n=n.map(t=>{if(null==t)return null;if(Array.isArray(t)){const e=Array.from(new Set(t.map(t=>t.toLowerCase())).values());return 1===e.length?e[0]:(e.sort(),e)}return t.toLowerCase()});const i=n.map(t=>null==t?"null":Array.isArray(t)?t.join("|"):t).join("&");return{fragment:r,tag:i,topics:n}}async function _A(t,e){const{subs:n}=TA(t);return n.get((await NA(t,e)).tag)||null}async function PA(t,e,n){const r=AA(t.runner);kv(r,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:e});const{fragment:o,tag:i,topics:a}=await NA(t,n),{addr:s,subs:u}=TA(t);let c=u.get(i);if(!c){const e={address:s||t,topics:a},l=e=>{let r=o;if(null==r)try{r=t.interface.getEvent(e.topics[0])}catch(i){}if(r){const i=r,a=o?t.interface.decodeEventLog(o,e.data,e.topics):[];OA(t,n,a,r=>new fA(t,r,n,i,e))}else OA(t,n,[],r=>new dA(t,r,n,e))};let h=[];c={tag:i,listeners:[],start:()=>{h.length||h.push(r.on(e,l))},stop:async()=>{if(0==h.length)return;let t=h;h=[],await Promise.all(t),r.off(e,l)}},u.set(i,c)}return c}let DA=Promise.resolve();async function OA(t,e,n,r){try{await DA}catch(i){}const o=async function(t,e,n,r){await DA;const o=await _A(t,e);if(!o)return!1;const a=o.listeners.length;return o.listeners=o.listeners.filter(e=>{let{listener:o,once:a}=e;const s=Array.from(n);r&&s.push(r(a?null:o));try{o.call(t,...s)}catch(i){}return!a}),0===o.listeners.length&&(o.stop(),TA(t).subs.delete(o.tag)),a>0}(t,e,n,r);return DA=o,await o}const FA=["then"];class MA{constructor(t,e,n,r){St(this,"target",void 0),St(this,"interface",void 0),St(this,"runner",void 0),St(this,"filters",void 0),St(this,IA,void 0),St(this,"fallback",void 0),Sv("string"===typeof t||ox(t),"invalid value for Contract target","target",t),null==n&&(n=null);const o=zE.from(e);let i;wv(this,{target:t,runner:n,interface:o}),Object.defineProperty(this,IA,{value:{}});let a=null,s=null;if(r){const t=AA(n);s=new hA(this.interface,t,r)}let u=new Map;if("string"===typeof t)if(Ov(t))a=t,i=Promise.resolve(t);else{const e=EA(n,"resolveName");if(!vA(e))throw Cv("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});i=e.resolveName(t).then(e=>{if(null==e)throw Cv("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:t});return TA(this).addr=e,e})}else i=t.getAddress().then(t=>{if(null==t)throw new Error("TODO");return TA(this).addr=t,t});var c,l;c=this,l={addrPromise:i,addr:a,deployTx:s,subs:u},RA.set(c[IA],l);const h=new Proxy({},{get:(t,e,n)=>{if("symbol"===typeof e||FA.indexOf(e)>=0)return Reflect.get(t,e,n);try{return this.getEvent(e)}catch(r){if(!Ev(r,"INVALID_ARGUMENT")||"key"!==r.argument)throw r}},has:(t,e)=>FA.indexOf(e)>=0?Reflect.has(t,e):Reflect.has(t,e)||this.interface.hasEvent(String(e))});return wv(this,{filters:h}),wv(this,{fallback:o.receive||o.fallback?kA(this):null}),new Proxy(this,{get:(t,e,n)=>{if("symbol"===typeof e||e in t||FA.indexOf(e)>=0)return Reflect.get(t,e,n);try{return t.getFunction(e)}catch(r){if(!Ev(r,"INVALID_ARGUMENT")||"key"!==r.argument)throw r}},has:(t,e)=>"symbol"===typeof e||e in t||FA.indexOf(e)>=0?Reflect.has(t,e):t.interface.hasFunction(e)})}connect(t){return new MA(this.target,this.interface,t)}attach(t){return new MA(t,this.interface,this.runner)}async getAddress(){return await TA(this).addrPromise}async getDeployedCode(){const t=AA(this.runner);kv(t,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const e=await t.getCode(await this.getAddress());return"0x"===e?null:e}async waitForDeployment(){const t=this.deploymentTransaction();if(t)return await t.wait(),this;if(null!=await this.getDeployedCode())return this;const e=AA(this.runner);return kv(null!=e,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((t,n)=>{const r=async()=>{try{if(null!=await this.getDeployedCode())return t(this);e.once("block",r)}catch(o){n(o)}};r()})}deploymentTransaction(){return TA(this).deployTx}getFunction(t){"string"!==typeof t&&(t=t.format());return SA(this,t)}getEvent(t){return"string"!==typeof t&&(t=t.format()),function(t,e){const n=function(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const i=t.interface.getEvent(e,r);return kv(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:r}}),i},r=function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return new xA(t,n(...r),r)};return wv(r,{name:t.interface.getEventName(e),_contract:t,_key:e,getFragment:n}),Object.defineProperty(r,"fragment",{configurable:!1,enumerable:!0,get:()=>{const n=t.interface.getEvent(e);return kv(n,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),n}}),r}(this,t)}async queryTransaction(t){throw new Error("@TODO")}async queryFilter(t,e,n){null==e&&(e=0),null==n&&(n="latest");const{addr:r,addrPromise:o}=TA(this),i=r||await o,{fragment:a,topics:s}=await NA(this,t),u={address:i,topics:s,fromBlock:e,toBlock:n},c=AA(this.runner);return kv(c,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await c.getLogs(u)).map(t=>{let e=a;if(null==e)try{e=this.interface.getEvent(t.topics[0])}catch(n){}if(e)try{return new aA(t,this.interface,e)}catch(n){return new sA(t,n)}return new YE(t,c)})}async on(t,e){const n=await PA(this,"on",t);return n.listeners.push({listener:e,once:!1}),n.start(),this}async once(t,e){const n=await PA(this,"once",t);return n.listeners.push({listener:e,once:!0}),n.start(),this}async emit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return await OA(this,t,n,null)}async listenerCount(t){if(t){const e=await _A(this,t);return e?e.listeners.length:0}const{subs:e}=TA(this);let n=0;for(const{listeners:r}of e.values())n+=r.length;return n}async listeners(t){if(t){const e=await _A(this,t);return e?e.listeners.map(t=>{let{listener:e}=t;return e}):[]}const{subs:e}=TA(this);let n=[];for(const{listeners:r}of e.values())n=n.concat(r.map(t=>{let{listener:e}=t;return e}));return n}async off(t,e){const n=await _A(this,t);if(!n)return this;if(e){const t=n.listeners.map(t=>{let{listener:e}=t;return e}).indexOf(e);t>=0&&n.listeners.splice(t,1)}return null!=e&&0!==n.listeners.length||(n.stop(),TA(this).subs.delete(n.tag)),this}async removeAllListeners(t){if(t){const e=await _A(this,t);if(!e)return this;e.stop(),TA(this).subs.delete(e.tag)}else{const{subs:t}=TA(this);for(const{tag:e,stop:n}of t.values())n(),t.delete(e)}return this}async addListener(t,e){return await this.on(t,e)}async removeListener(t,e){return await this.off(t,e)}static buildClass(t){return class extends MA{constructor(e){super(e,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}}}static from(t,e,n){null==n&&(n=null);return new this(t,e,n)}}class BA extends(function(){return MA}()){}const LA=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]);function UA(t){return function(t){let e=0;return()=>t[e++]}(function(t){let e=0;function n(){return t[e++]<<8|t[e++]}let r=n(),o=1,i=[0,1];for(let w=1;w<r;w++)i.push(o+=n());let a=n(),s=e;e+=a;let u=0,c=0;function l(){return 0==u&&(c=c<<8|t[e++],u=8),c>>--u&1}const h=2**31,d=h>>>1,f=d>>1,p=h-1;let g=0;for(let w=0;w<31;w++)g=g<<1|l();let m=[],v=0,y=h;for(;;){let t=Math.floor(((g-v+1)*o-1)/y),e=0,n=r;for(;n-e>1;){let r=e+n>>>1;t<i[r]?n=r:e=r}if(0==e)break;m.push(e);let a=v+Math.floor(y*i[e]/o),s=v+Math.floor(y*i[e+1]/o)-1;for(;0==((a^s)&d);)g=g<<1&p|l(),a=a<<1&p,s=s<<1&p|1;for(;a&~s&f;)g=g&d|g<<1&p>>>1|l(),a=a<<1^d,s=(s^d)<<1|d|1;v=a,y=1+s-a}let b=r-4;return m.map(e=>{switch(e-b){case 3:return b+65792+(t[s++]<<16|t[s++]<<8|t[s++]);case 2:return b+256+(t[s++]<<8|t[s++]);case 1:return b+t[s++];default:return e-1}})}(function(t){let e=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((t,n)=>e[t.charCodeAt(0)]=n);let n=t.length,r=new Uint8Array(6*n>>3);for(let o=0,i=0,a=0,s=0;o<n;o++)s=s<<6|e[t.charCodeAt(o)],a+=6,a>=8&&(r[i++]=s>>(a-=8));return r}(t)))}function WA(t){return 1&t?~t>>1:t>>1}function zA(t,e){let n=Array(t);for(let r=0,o=0;r<t;r++)n[r]=o+=WA(e());return n}function VA(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];for(;;){let r=t(),o=t();if(!o)break;e+=r;for(let t=0;t<o;t++)n.push(e+t);e+=o+1}return n}function jA(t){return HA(()=>{let e=VA(t);if(e.length)return e})}function GA(t){let e=[];for(;;){let n=t();if(0==n)break;e.push(KA(n,t))}for(;;){let n=t()-1;if(n<0)break;e.push(QA(n,t))}return e.flat()}function HA(t){let e=[];for(;;){let n=t(e.length);if(!n)break;e.push(n)}return e}function qA(t,e,n){let r=Array(t).fill().map(()=>[]);for(let o=0;o<e;o++)zA(t,n).forEach((t,e)=>r[e].push(t));return r}function KA(t,e){let n=1+e(),r=e(),o=HA(e);return qA(o.length,1+t,e).flatMap((t,e)=>{let[i,...a]=t;return Array(o[e]).fill().map((t,e)=>{let o=e*r;return[i+e*n,a.map(t=>t+o)]})})}function QA(t,e){return qA(1+e(),1+t,e).map(t=>[t[0],t.slice(1)])}function XA(t){return"{".concat(function(t){return t.toString(16).toUpperCase().padStart(2,"0")}(t),"}")}function JA(t){let e=[];for(let n=0,r=t.length;n<r;){let r=t.codePointAt(n);n+=r<65536?1:2,e.push(r)}return e}function YA(t){let e=t.length;if(e<4096)return String.fromCodePoint(...t);let n=[];for(let r=0;r<e;)n.push(String.fromCodePoint(...t.slice(r,r+=4096)));return n.join("")}function ZA(t,e){let n=t.length,r=n-e.length;for(let o=0;0==r&&o<n;o++)r=t[o]-e[o];return r}const $A=44032,tC=4352,eC=4449,nC=4519,rC=28,oC=588;function iC(t){return t>>24&255}function aC(t){return 16777215&t}let sC,uC,cC,lC;function hC(t){return t>=$A&&t<55204}function dC(t,e){if(t>=tC&&t<4371&&e>=eC&&e<4470)return $A+(t-tC)*oC+(e-eC)*rC;if(hC(t)&&e>nC&&e<4547&&(t-$A)%rC==0)return t+(e-nC);{let n=lC.get(t);return n&&(n=n.get(e),n)?n:-1}}function fC(t){sC||function(){let t=UA("AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g");sC=new Map(jA(t).flatMap((t,e)=>t.map(t=>[t,e+1<<24]))),uC=new Set(VA(t)),cC=new Map,lC=new Map;for(let[e,n]of GA(t)){if(!uC.has(e)&&2==n.length){let[t,r]=n,o=lC.get(t);o||(o=new Map,lC.set(t,o)),o.set(r,e)}cC.set(e,n.reverse())}}();let e=[],n=[],r=!1;function o(t){let n=sC.get(t);n&&(r=!0,t|=n),e.push(t)}for(let i of t)for(;;){if(i<128)e.push(i);else if(hC(i)){let t=i-$A,e=t%oC/rC|0,n=t%rC;o(tC+(t/oC|0)),o(eC+e),n>0&&o(nC+n)}else{let t=cC.get(i);t?n.push(...t):o(i)}if(!n.length)break;i=n.pop()}if(r&&e.length>1){let t=iC(e[0]);for(let n=1;n<e.length;n++){let r=iC(e[n]);if(0==r||t<=r){t=r;continue}let o=n-1;for(;;){let n=e[o+1];if(e[o+1]=e[o],e[o]=n,!o)break;if(t=iC(e[--o]),t<=r)break}t=iC(e[n])}}return e}function pC(t){return fC(t).map(aC)}function gC(t){return function(t){let e=[],n=[],r=-1,o=0;for(let i of t){let t=iC(i),a=aC(i);if(-1==r)0==t?r=a:e.push(a);else if(o>0&&o>=t)0==t?(e.push(r,...n),n.length=0,r=a):n.push(a),o=t;else{let i=dC(r,a);i>=0?r=i:0==o&&0==t?(e.push(r),r=a):(n.push(a),o=t)}}return r>=0&&e.push(r,...n),e}(fC(t))}const mC=".",vC=t=>Array.from(t);function yC(t,e){return t.P.has(e)||t.Q.has(e)}class bC extends Array{get is_emoji(){return!0}}let wC,xC,EC,AC,CC,kC,SC,IC,RC,TC,NC,_C;function PC(){if(wC)return;let t=UA("AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI");const e=()=>VA(t),n=()=>new Set(e()),r=(t,e)=>e.forEach(e=>t.add(e));wC=new Map(GA(t)),xC=n(),EC=e(),AC=new Set(e().map(t=>EC[t])),EC=new Set(EC),CC=n(),kC=n();let o=jA(t),i=t();const a=()=>{let t=new Set;return e().forEach(e=>r(t,o[e])),r(t,e()),t};SC=HA(e=>{let n=HA(t).map(t=>t+96);if(n.length){let r=e>=i;return n[0]-=32,n=YA(n),r&&(n="Restricted[".concat(n,"]")),{N:n,P:a(),Q:a(),M:!t(),R:r}}}),IC=n(),RC=new Map;let s=e().concat(vC(IC)).sort((t,e)=>t-e);s.forEach((e,n)=>{let r=t(),o=s[n]=r?s[n-r]:{V:[],M:new Map};o.V.push(e),IC.has(e)||RC.set(e,o)});for(let{V:l,M:h}of new Set(RC.values())){let t=[];for(let n of l){let e=SC.filter(t=>yC(t,n)),o=t.find(t=>{let{G:n}=t;return e.some(t=>n.has(t))});o||(o={G:new Set,V:[]},t.push(o)),o.V.push(n),r(o.G,e)}let e=t.flatMap(t=>vC(t.G));for(let{G:n,V:r}of t){let t=new Set(e.filter(t=>!n.has(t)));for(let e of r)h.set(e,t)}}TC=new Set;let u=new Set;const c=t=>TC.has(t)?u.add(t):TC.add(t);for(let l of SC){for(let t of l.P)c(t);for(let t of l.Q)c(t)}for(let l of TC)RC.has(l)||u.has(l)||RC.set(l,1);r(TC,pC(TC)),NC=function(t){let e=[],n=VA(t);return function t(n,r,o){let{S:i,B:a}=n;if(!(4&i&&o===r[r.length-1])){2&i&&(o=r[r.length-1]),1&i&&e.push(r);for(let e of a)for(let n of e.Q)t(e,[...r,n],o)}}(function e(r){let o=t(),i=HA(()=>{let r=VA(t).map(t=>n[t]);if(r.length)return e(r)});return{S:o,B:i,Q:r}}([]),[]),e}(t).map(t=>bC.from(t)).sort(ZA),_C=new Map;for(let l of NC){let t=[_C];for(let e of l){let n=t.map(t=>{let n=t.get(e);return n||(n=new Map,t.set(e,n)),n});65039===e?t.push(...n):t=n}for(let e of t)e.V=l}}function DC(t){return(MC(t)?"":"".concat(OC(FC([t]))," "))+XA(t)}function OC(t){return'"'.concat(t,'"\u200e')}function FC(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:XA,r=[];var o;o=t[0],PC(),EC.has(o)&&r.push("\u25cc"),t.length>e&&(e>>=1,t=[...t.slice(0,e),8230,...t.slice(-e)]);let i=0,a=t.length;for(let s=0;s<a;s++){let e=t[s];MC(e)&&(r.push(YA(t.slice(i,s))),r.push(n(e)),i=s+1)}return r.push(YA(t.slice(i,a))),r.join("")}function MC(t){return PC(),CC.has(t)}function BC(t,e,n){if(!t)return[];PC();let r=0;return t.split(mC).map(t=>{let o=JA(t),i={input:o,offset:r};r+=o.length+1;try{let t,r=i.tokens=VC(o,e,n),a=r.length;if(!a)throw new Error("empty label");let s=i.output=r.flat();if(function(t){for(let e=t.lastIndexOf(95);e>0;)if(95!==t[--e])throw new Error("underscore allowed only at start")}(s),!(i.emoji=a>1||r[0].is_emoji)&&s.every(t=>t<128))!function(t){if(t.length>=4&&45==t[2]&&45==t[3])throw new Error('invalid label extension: "'.concat(YA(t.slice(0,4)),'"'))}(s),t="ASCII";else{let e=r.flatMap(t=>t.is_emoji?[]:t);if(e.length){if(EC.has(s[0]))throw zC("leading combining mark");for(let t=1;t<a;t++){let e=r[t];if(!e.is_emoji&&EC.has(e[0]))throw zC('emoji + combining mark: "'.concat(YA(r[t-1])," + ").concat(FC([e[0]]),'"'))}!function(t){let e=t[0],n=LA.get(e);if(n)throw zC("leading ".concat(n));let r=t.length,o=-1;for(let i=1;i<r;i++){e=t[i];let r=LA.get(e);if(r){if(o==i)throw zC("".concat(n," + ").concat(r));o=i+1,n=r}}if(o==r)throw zC("trailing ".concat(n))}(s);let n=vC(new Set(e)),[o]=function(t){let e=SC;for(let n of t){let t=e.filter(t=>yC(t,n));if(!t.length)throw SC.some(t=>yC(t,n))?WC(e[0],n):UC(n);if(e=t,1==t.length)break}return e}(n);!function(t,e){for(let n of e)if(!yC(t,n))throw WC(t,n);if(t.M){let t=pC(e);for(let e=1,n=t.length;e<n;e++)if(AC.has(t[e])){let r=e+1;for(let o;r<n&&AC.has(o=t[r]);r++)for(let n=e;n<r;n++)if(t[n]==o)throw new Error("duplicate non-spacing marks: ".concat(DC(o)));if(r-e>4)throw new Error("excessive non-spacing marks: ".concat(OC(FC(t.slice(e-1,r)))," (").concat(r-e,"/").concat(4,")"));e=r}}}(o,e),function(t,e){let n,r=[];for(let o of e){let t=RC.get(o);if(1===t)return;if(t){let e=t.M.get(o);if(n=n?n.filter(t=>e.has(t)):vC(e),!n.length)return}else r.push(o)}if(n)for(let o of n)if(r.every(t=>yC(o,t)))throw new Error("whole-script confusable: ".concat(t.N,"/").concat(o.N))}(o,n),t=o.N}else t="Emoji"}i.type=t}catch(a){i.error=a}return i})}function LC(t){return t.map(e=>{let{input:n,error:r,output:o}=e;if(r){let e=r.message;throw new Error(1==t.length?e:"Invalid label ".concat(OC(FC(n,63)),": ").concat(e))}return YA(o)}).join(mC)}function UC(t){return new Error("disallowed character: ".concat(DC(t)))}function WC(t,e){let n=DC(e),r=SC.find(t=>t.P.has(e));return r&&(n="".concat(r.N," ").concat(n)),new Error("illegal mixture: ".concat(t.N," + ").concat(n))}function zC(t){return new Error("illegal placement: ".concat(t))}function VC(t,e,n){let r=[],o=[];for(t=t.slice().reverse();t.length;){let i=GC(t);if(i)o.length&&(r.push(e(o)),o=[]),r.push(n(i));else{let e=t.pop();if(TC.has(e))o.push(e);else{let t=wC.get(e);if(t)o.push(...t);else if(!xC.has(e))throw UC(e)}}}return o.length&&r.push(e(o)),r}function jC(t){return t.filter(t=>65039!=t)}function GC(t,e){let n,r=_C,o=t.length;for(;o&&(r=r.get(t[--o]),r);){let{V:i}=r;i&&(n=i,e&&e.push(...t.slice(o).reverse()),t.length=o)}return n}const HC=new Uint8Array(32);function qC(t){return Sv(0!==t.length,"invalid ENS name; empty component","comp",t),t}function KC(t){const e=Kb(function(t){try{if(0===t.length)throw new Error("empty label");return function(t){return LC(BC(t,gC,jC))}(t)}catch(e){Sv(!1,"invalid ENS name (".concat(e.message,")"),"name",t)}}(t)),n=[];if(0===t.length)return n;let r=0;for(let o=0;o<e.length;o++){46===e[o]&&(n.push(qC(e.slice(r,o))),r=o+1)}return Sv(r<e.length,"invalid ENS name; empty component","name",t),n.push(qC(e.slice(r))),n}function QC(t){Sv("string"===typeof t,"invalid ENS name; not a string","name",t),Sv(t.length,"invalid ENS name (empty label)","name",t);let e=HC;const n=KC(t);for(;n.length;)e=gb(Lv([e,gb(n.pop())]));return Bv(e)}function XC(t,e){const n=null!=e?e:63;return Sv(n<=255,"DNS encoded label cannot exceed 255","length",n),Bv(Lv(KC(t).map(e=>{Sv(e.length<=n,"label ".concat(JSON.stringify(t)," exceeds ").concat(n," bytes"),"name",t);const r=new Uint8Array(e.length+1);return r.set(e,1),r[0]=r.length-1,r})))+"00"}HC.fill(0);class JC extends Qy{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Hy(this.buffer)}update(t){Py(this);const{view:e,buffer:n,blockLen:r}=this,o=(t=Ky(t)).length;for(let i=0;i<o;){const a=Math.min(r-this.pos,o-i);if(a===r){const e=Hy(t);for(;r<=o-i;i+=r)this.process(e,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===r&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Py(this),Dy(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let l=i;l<r;l++)e[l]=0;!function(t,e,n,r){if("function"===typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),i=BigInt(4294967295),a=Number(n>>o&i),s=Number(n&i),u=r?4:0,c=r?0:4;t.setUint32(e+u,a,r),t.setUint32(e+c,s,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const a=Hy(t),s=this.outputLen;if(s%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=s/4,c=this.get();if(u>c.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,c[l],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:o,destroyed:i,pos:a}=this;return t.length=r,t.pos=a,t.finished=o,t.destroyed=i,r%e&&t.buffer.set(n),t}}const YC=(t,e,n)=>t&e^~t&n,ZC=(t,e,n)=>t&e^t&n^e&n,$C=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),tk=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ek=new Uint32Array(64);class nk extends JC{constructor(){super(64,32,8,!1),this.A=0|tk[0],this.B=0|tk[1],this.C=0|tk[2],this.D=0|tk[3],this.E=0|tk[4],this.F=0|tk[5],this.G=0|tk[6],this.H=0|tk[7]}get(){const{A:t,B:e,C:n,D:r,E:o,F:i,G:a,H:s}=this;return[t,e,n,r,o,i,a,s]}set(t,e,n,r,o,i,a,s){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|a,this.H=0|s}process(t,e){for(let l=0;l<16;l++,e+=4)ek[l]=t.getUint32(e,!1);for(let l=16;l<64;l++){const t=ek[l-15],e=ek[l-2],n=qy(t,7)^qy(t,18)^t>>>3,r=qy(e,17)^qy(e,19)^e>>>10;ek[l]=r+ek[l-7]+n+ek[l-16]|0}let{A:n,B:r,C:o,D:i,E:a,F:s,G:u,H:c}=this;for(let l=0;l<64;l++){const t=c+(qy(a,6)^qy(a,11)^qy(a,25))+YC(a,s,u)+$C[l]+ek[l]|0,e=(qy(n,2)^qy(n,13)^qy(n,22))+ZC(n,r,o)|0;c=u,u=s,s=a,a=i+t|0,i=o,o=r,r=n,n=t+e|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,a=a+this.E|0,s=s+this.F|0,u=u+this.G|0,c=c+this.H|0,this.set(n,r,o,i,a,s,u,c)}roundClean(){ek.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const rk=Xy(()=>new nk),[ok,ik]=(()=>jy.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))))(),ak=new Uint32Array(80),sk=new Uint32Array(80);class uk extends JC{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:t,Al:e,Bh:n,Bl:r,Ch:o,Cl:i,Dh:a,Dl:s,Eh:u,El:c,Fh:l,Fl:h,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[t,e,n,r,o,i,a,s,u,c,l,h,d,f,p,g]}set(t,e,n,r,o,i,a,s,u,c,l,h,d,f,p,g){this.Ah=0|t,this.Al=0|e,this.Bh=0|n,this.Bl=0|r,this.Ch=0|o,this.Cl=0|i,this.Dh=0|a,this.Dl=0|s,this.Eh=0|u,this.El=0|c,this.Fh=0|l,this.Fl=0|h,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(t,e){for(let y=0;y<16;y++,e+=4)ak[y]=t.getUint32(e),sk[y]=t.getUint32(e+=4);for(let y=16;y<80;y++){const t=0|ak[y-15],e=0|sk[y-15],n=jy.rotrSH(t,e,1)^jy.rotrSH(t,e,8)^jy.shrSH(t,e,7),r=jy.rotrSL(t,e,1)^jy.rotrSL(t,e,8)^jy.shrSL(t,e,7),o=0|ak[y-2],i=0|sk[y-2],a=jy.rotrSH(o,i,19)^jy.rotrBH(o,i,61)^jy.shrSH(o,i,6),s=jy.rotrSL(o,i,19)^jy.rotrBL(o,i,61)^jy.shrSL(o,i,6),u=jy.add4L(r,s,sk[y-7],sk[y-16]),c=jy.add4H(u,n,a,ak[y-7],ak[y-16]);ak[y]=0|c,sk[y]=0|u}let{Ah:n,Al:r,Bh:o,Bl:i,Ch:a,Cl:s,Dh:u,Dl:c,Eh:l,El:h,Fh:d,Fl:f,Gh:p,Gl:g,Hh:m,Hl:v}=this;for(let y=0;y<80;y++){const t=jy.rotrSH(l,h,14)^jy.rotrSH(l,h,18)^jy.rotrBH(l,h,41),e=jy.rotrSL(l,h,14)^jy.rotrSL(l,h,18)^jy.rotrBL(l,h,41),b=l&d^~l&p,w=h&f^~h&g,x=jy.add5L(v,e,w,ik[y],sk[y]),E=jy.add5H(x,m,t,b,ok[y],ak[y]),A=0|x,C=jy.rotrSH(n,r,28)^jy.rotrBH(n,r,34)^jy.rotrBH(n,r,39),k=jy.rotrSL(n,r,28)^jy.rotrBL(n,r,34)^jy.rotrBL(n,r,39),S=n&o^n&a^o&a,I=r&i^r&s^i&s;m=0|p,v=0|g,p=0|d,g=0|f,d=0|l,f=0|h,({h:l,l:h}=jy.add(0|u,0|c,0|E,0|A)),u=0|a,c=0|s,a=0|o,s=0|i,o=0|n,i=0|r;const R=jy.add3L(A,k,I);n=jy.add3H(R,E,C,S),r=0|R}({h:n,l:r}=jy.add(0|this.Ah,0|this.Al,0|n,0|r)),({h:o,l:i}=jy.add(0|this.Bh,0|this.Bl,0|o,0|i)),({h:a,l:s}=jy.add(0|this.Ch,0|this.Cl,0|a,0|s)),({h:u,l:c}=jy.add(0|this.Dh,0|this.Dl,0|u,0|c)),({h:l,l:h}=jy.add(0|this.Eh,0|this.El,0|l,0|h)),({h:d,l:f}=jy.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=jy.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:m,l:v}=jy.add(0|this.Hh,0|this.Hl,0|m,0|v)),this.set(n,r,o,i,a,s,u,c,l,h,d,f,p,g,m,v)}roundClean(){ak.fill(0),sk.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const ck=Xy(()=>new uk);const lk=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof global)return global;throw new Error("unable to locate global object")}();lk.crypto||lk.msCrypto;function hk(t){switch(t){case"sha256":return rk.create();case"sha512":return ck.create()}Sv(!1,"invalid hashing algorithm name","algorithm",t)}const dk=function(t){return hk("sha256").update(t).digest()},fk=function(t){return hk("sha512").update(t).digest()};let pk=dk,gk=fk,mk=!1,vk=!1;function yk(t){const e=Pv(t,"data");return Bv(pk(e))}function bk(t){const e=Pv(t,"data");return Bv(gk(e))}function wk(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("Wrong positive integer: ".concat(t))}function xk(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(n.length>0&&!n.includes(t.length))throw new Error("Expected Uint8Array of length ".concat(n,", not of length=").concat(t.length))}function Ek(t){if("function"!==typeof t||"function"!==typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");wk(t.outputLen),wk(t.blockLen)}function Ak(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ck(t,e){xk(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least ".concat(n))}yk._=dk,yk.lock=function(){mk=!0},yk.register=function(t){if(mk)throw new Error("sha256 is locked");pk=t},Object.freeze(yk),bk._=fk,bk.lock=function(){vk=!0},bk.register=function(t){if(vk)throw new Error("sha512 is locked");gk=t},Object.freeze(yk);const kk="object"===typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Sk=t=>t instanceof Uint8Array,Ik=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Rk=(t,e)=>t<<32-e|t>>>e;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Tk(t){if("string"===typeof t&&(t=function(t){if("string"!==typeof t)throw new Error("utf8ToBytes expected string, got ".concat(typeof t));return new Uint8Array((new TextEncoder).encode(t))}(t)),!Sk(t))throw new Error("expected Uint8Array, got ".concat(typeof t));return t}class Nk{clone(){return this._cloneInto()}}function _k(t){const e=e=>t().update(Tk(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Pk(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(kk&&"function"===typeof kk.getRandomValues)return kk.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class Dk extends Nk{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Ik(this.buffer)}update(t){Ak(this);const{view:e,buffer:n,blockLen:r}=this,o=(t=Tk(t)).length;for(let i=0;i<o;){const a=Math.min(r-this.pos,o-i);if(a===r){const e=Ik(t);for(;r<=o-i;i+=r)this.process(e,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===r&&(this.process(e,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ak(this),Ck(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:o}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let l=i;l<r;l++)e[l]=0;!function(t,e,n,r){if("function"===typeof t.setBigUint64)return t.setBigUint64(e,n,r);const o=BigInt(32),i=BigInt(4294967295),a=Number(n>>o&i),s=Number(n&i),u=r?4:0,c=r?0:4;t.setUint32(e+u,a,r),t.setUint32(e+c,s,r)}(n,r-8,BigInt(8*this.length),o),this.process(n,0);const a=Ik(t),s=this.outputLen;if(s%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=s/4,c=this.get();if(u>c.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)a.setUint32(4*l,c[l],o)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:o,destroyed:i,pos:a}=this;return t.length=r,t.pos=a,t.finished=o,t.destroyed=i,r%e&&t.buffer.set(n),t}}const Ok=(t,e,n)=>t&e^~t&n,Fk=(t,e,n)=>t&e^t&n^e&n,Mk=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Bk=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Lk=new Uint32Array(64);class Uk extends Dk{constructor(){super(64,32,8,!1),this.A=0|Bk[0],this.B=0|Bk[1],this.C=0|Bk[2],this.D=0|Bk[3],this.E=0|Bk[4],this.F=0|Bk[5],this.G=0|Bk[6],this.H=0|Bk[7]}get(){const{A:t,B:e,C:n,D:r,E:o,F:i,G:a,H:s}=this;return[t,e,n,r,o,i,a,s]}set(t,e,n,r,o,i,a,s){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|o,this.F=0|i,this.G=0|a,this.H=0|s}process(t,e){for(let l=0;l<16;l++,e+=4)Lk[l]=t.getUint32(e,!1);for(let l=16;l<64;l++){const t=Lk[l-15],e=Lk[l-2],n=Rk(t,7)^Rk(t,18)^t>>>3,r=Rk(e,17)^Rk(e,19)^e>>>10;Lk[l]=r+Lk[l-7]+n+Lk[l-16]|0}let{A:n,B:r,C:o,D:i,E:a,F:s,G:u,H:c}=this;for(let l=0;l<64;l++){const t=c+(Rk(a,6)^Rk(a,11)^Rk(a,25))+Ok(a,s,u)+Mk[l]+Lk[l]|0,e=(Rk(n,2)^Rk(n,13)^Rk(n,22))+Fk(n,r,o)|0;c=u,u=s,s=a,a=i+t|0,i=o,o=r,r=n,n=t+e|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,i=i+this.D|0,a=a+this.E|0,s=s+this.F|0,u=u+this.G|0,c=c+this.H|0,this.set(n,r,o,i,a,s,u,c)}roundClean(){Lk.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Wk=_k(()=>new Uk),zk=(BigInt(0),BigInt(1)),Vk=BigInt(2),jk=t=>t instanceof Uint8Array,Gk=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Hk(t){if(!jk(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Gk[t[n]];return e}function qk(t){if("string"!==typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":"0x".concat(t))}function Kk(t){if("string"!==typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const e=2*r,o=t.slice(e,e+2),i=Number.parseInt(o,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function Qk(t){return qk(Hk(t))}function Xk(t){if(!jk(t))throw new Error("Uint8Array expected");return qk(Hk(Uint8Array.from(t).reverse()))}function Jk(t,e){return Kk(t.toString(16).padStart(2*e,"0"))}function Yk(t,e){return Jk(t,e).reverse()}function Zk(t,e,n){let r;if("string"===typeof e)try{r=Kk(e)}catch(Nt){throw new Error("".concat(t,' must be valid hex string, got "').concat(e,'". Cause: ').concat(Nt))}else{if(!jk(e))throw new Error("".concat(t," must be hex string or Uint8Array"));r=Uint8Array.from(e)}const o=r.length;if("number"===typeof n&&o!==n)throw new Error("".concat(t," expected ").concat(n," bytes, got ").concat(o));return r}function $k(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=new Uint8Array(e.reduce((t,e)=>t+e.length,0));let o=0;return e.forEach(t=>{if(!jk(t))throw new Error("Uint8Array expected");r.set(t,o),o+=t.length}),r}const tS=t=>(Vk<<BigInt(t-1))-zk,eS=t=>new Uint8Array(t),nS=t=>Uint8Array.from(t);function rS(t,e,n){if("number"!==typeof t||t<2)throw new Error("hashLen must be a number");if("number"!==typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!==typeof n)throw new Error("hmacFn must be a function");let r=eS(t),o=eS(t),i=0;const a=()=>{r.fill(1),o.fill(0),i=0},s=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return n(o,r,...e)},u=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:eS();o=s(nS([0]),t),r=s(),0!==t.length&&(o=s(nS([1]),t),r=s())},c=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=s();const e=r.slice();n.push(e),t+=r.length}return $k(...n)};return(t,e)=>{let n;for(a(),u(t);!(n=e(c()));)u();return a(),n}}const oS={bigint:t=>"bigint"===typeof t,function:t=>"function"===typeof t,boolean:t=>"boolean"===typeof t,string:t=>"string"===typeof t,stringOrUint8Array:t=>"string"===typeof t||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"===typeof t&&Number.isSafeInteger(t.outputLen)};function iS(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(e,n,r)=>{const o=oS[n];if("function"!==typeof o)throw new Error('Invalid validator "'.concat(n,'", expected function'));const i=t[e];if((!r||void 0!==i)&&!o(i,t))throw new Error("Invalid param ".concat(String(e),"=").concat(i," (").concat(typeof i,"), expected ").concat(n))};for(const[o,i]of Object.entries(e))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return t}const aS=BigInt(0),sS=BigInt(1),uS=BigInt(2),cS=BigInt(3),lS=BigInt(4),hS=BigInt(5),dS=BigInt(8);BigInt(9),BigInt(16);function fS(t,e){const n=t%e;return n>=aS?n:e+n}function pS(t,e,n){if(n<=aS||e<aS)throw new Error("Expected power/modulo > 0");if(n===sS)return aS;let r=sS;for(;e>aS;)e&sS&&(r=r*t%n),t=t*t%n,e>>=sS;return r}function gS(t,e,n){let r=t;for(;e-- >aS;)r*=r,r%=n;return r}function mS(t,e){if(t===aS||e<=aS)throw new Error("invert: expected positive integers, got n=".concat(t," mod=").concat(e));let n=fS(t,e),r=e,o=aS,i=sS,a=sS,s=aS;for(;n!==aS;){const t=r/n,e=r%n,u=o-a*t,c=i-s*t;r=n,n=e,o=a,i=s,a=u,s=c}if(r!==sS)throw new Error("invert: does not exist");return fS(o,e)}function vS(t){if(t%lS===cS){const e=(t+sS)/lS;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%dS===hS){const e=(t-hS)/dS;return function(t,n){const r=t.mul(n,uS),o=t.pow(r,e),i=t.mul(n,o),a=t.mul(t.mul(i,uS),o),s=t.mul(i,t.sub(a,t.ONE));if(!t.eql(t.sqr(s),n))throw new Error("Cannot find square root");return s}}return function(t){const e=(t-sS)/uS;let n,r,o;for(n=t-sS,r=0;n%uS===aS;n/=uS,r++);for(o=uS;o<t&&pS(o,e,t)!==t-sS;o++);if(1===r){const e=(t+sS)/lS;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const i=(n+sS)/uS;return function(t,a){if(t.pow(a,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let s=r,u=t.pow(t.mul(t.ONE,o),n),c=t.pow(a,i),l=t.pow(a,n);for(;!t.eql(l,t.ONE);){if(t.eql(l,t.ZERO))return t.ZERO;let e=1;for(let r=t.sqr(l);e<s&&!t.eql(r,t.ONE);e++)r=t.sqr(r);const n=t.pow(u,sS<<BigInt(s-e-1));u=t.sqr(n),c=t.mul(c,n),l=t.mul(l,u),s=e}return c}}(t)}const yS=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function bS(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function wS(t){if("bigint"!==typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function xS(t){const e=wS(t);return e+Math.ceil(e/2)}class ES extends Nk{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Ek(t);const n=Tk(e);if(this.iHash=t.create(),"function"!==typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,o=new Uint8Array(r);o.set(n.length>r?t.create().update(n).digest():n);for(let i=0;i<o.length;i++)o[i]^=54;this.iHash.update(o),this.oHash=t.create();for(let i=0;i<o.length;i++)o[i]^=106;this.oHash.update(o),o.fill(0)}update(t){return Ak(this),this.iHash.update(t),this}digestInto(t){Ak(this),xk(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:o,blockLen:i,outputLen:a}=this;return t.finished=r,t.destroyed=o,t.blockLen=i,t.outputLen=a,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const AS=(t,e,n)=>new ES(t,e).update(n).digest();AS.create=(t,e)=>new ES(t,e);const CS=BigInt(0),kS=BigInt(1);function SS(t){return iS(t.Fp,yS.reduce((t,e)=>(t[e]="function",t),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),iS(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(Rt(Rt(Rt({},bS(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}const{Ph:IS,aT:RS}=t,TS={Err:class extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}},_parseInt(t){const{Err:e}=TS;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:IS(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=TS,n="string"===typeof t?RS(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:o,l:i}=TS._parseInt(n.subarray(2)),{d:a,l:s}=TS._parseInt(i);if(s.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s:a}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,n=t=>{const e=t.toString(16);return 1&e.length?"0".concat(e):e},r=e(n(t.s)),o=e(n(t.r)),i=r.length/2,a=o.length/2,s=n(i),u=n(a);return"30".concat(n(a+i+4),"02").concat(u).concat(o,"02").concat(s).concat(r)}},NS=BigInt(0),_S=BigInt(1),PS=(BigInt(2),BigInt(3));BigInt(4);function DS(t){const e=function(t){const e=SS(t);iS(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!==typeof n||"bigint"!==typeof n.beta||"function"!==typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze(Rt({},e))}(t),{Fp:n}=e,r=e.toBytes||((t,e,r)=>{const o=e.toAffine();return $k(Uint8Array.from([4]),n.toBytes(o.x),n.toBytes(o.y))}),o=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function i(t){const{a:r,b:o}=e,i=n.sqr(t),a=n.mul(i,t);return n.add(n.add(a,n.mul(t,r)),o)}if(!n.eql(n.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function a(t){return"bigint"===typeof t&&NS<t&&t<e.n}function s(t){if(!a(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function u(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:o,n:i}=e;if(n&&"bigint"!==typeof t){if(t instanceof Uint8Array&&(t=Hk(t)),"string"!==typeof t||!n.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*r,"0")}let a;try{a="bigint"===typeof t?t:Qk(Zk("private key",t,r))}catch(u){throw new Error("private key must be ".concat(r," bytes, hex or bigint, not ").concat(typeof t))}return o&&(a=fS(a,i)),s(a),a}const c=new Map;function l(t){if(!(t instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof h)throw new Error("projective point not allowed");const o=t=>n.eql(t,n.ZERO);return o(e)&&o(r)?h.ZERO:new h(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map(t=>t.pz));return t.map((t,n)=>t.toAffine(e[n])).map(h.fromAffine)}static fromHex(t){const e=h.fromAffine(o(Zk("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return h.BASE.multiply(u(t))}_setWindowSize(t){this._WINDOW_SIZE=t,c.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:r}=this.toAffine();if(!n.isValid(t)||!n.isValid(r))throw new Error("bad point: x or y not FE");const o=n.sqr(r),a=i(t);if(!n.eql(o,a))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){l(t);const{px:e,py:r,pz:o}=this,{px:i,py:a,pz:s}=t,u=n.eql(n.mul(e,s),n.mul(i,o)),c=n.eql(n.mul(r,s),n.mul(a,o));return u&&c}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,o=n.mul(r,PS),{px:i,py:a,pz:s}=this;let u=n.ZERO,c=n.ZERO,l=n.ZERO,d=n.mul(i,i),f=n.mul(a,a),p=n.mul(s,s),g=n.mul(i,a);return g=n.add(g,g),l=n.mul(i,s),l=n.add(l,l),u=n.mul(t,l),c=n.mul(o,p),c=n.add(u,c),u=n.sub(f,c),c=n.add(f,c),c=n.mul(u,c),u=n.mul(g,u),l=n.mul(o,l),p=n.mul(t,p),g=n.sub(d,p),g=n.mul(t,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),c=n.add(c,d),p=n.mul(a,s),p=n.add(p,p),d=n.mul(p,g),u=n.sub(u,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new h(u,c,l)}add(t){l(t);const{px:r,py:o,pz:i}=this,{px:a,py:s,pz:u}=t;let c=n.ZERO,d=n.ZERO,f=n.ZERO;const p=e.a,g=n.mul(e.b,PS);let m=n.mul(r,a),v=n.mul(o,s),y=n.mul(i,u),b=n.add(r,o),w=n.add(a,s);b=n.mul(b,w),w=n.add(m,v),b=n.sub(b,w),w=n.add(r,i);let x=n.add(a,u);return w=n.mul(w,x),x=n.add(m,y),w=n.sub(w,x),x=n.add(o,i),c=n.add(s,u),x=n.mul(x,c),c=n.add(v,y),x=n.sub(x,c),f=n.mul(p,w),c=n.mul(g,y),f=n.add(c,f),c=n.sub(v,f),f=n.add(v,f),d=n.mul(c,f),v=n.add(m,m),v=n.add(v,m),y=n.mul(p,y),w=n.mul(g,w),v=n.add(v,y),y=n.sub(m,y),y=n.mul(p,y),w=n.add(w,y),m=n.mul(v,w),d=n.add(d,m),m=n.mul(x,w),c=n.mul(b,c),c=n.sub(c,m),m=n.mul(b,v),f=n.mul(x,f),f=n.add(f,m),new h(c,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(h.ZERO)}wNAF(t){return f.wNAFCached(this,c,t,t=>{const e=n.invertBatch(t.map(t=>t.pz));return t.map((t,n)=>t.toAffine(e[n])).map(h.fromAffine)})}multiplyUnsafe(t){const r=h.ZERO;if(t===NS)return r;if(s(t),t===_S)return this;const{endo:o}=e;if(!o)return f.unsafeLadder(this,t);let{k1neg:i,k1:a,k2neg:u,k2:c}=o.splitScalar(t),l=r,d=r,p=this;for(;a>NS||c>NS;)a&_S&&(l=l.add(p)),c&_S&&(d=d.add(p)),p=p.double(),a>>=_S,c>>=_S;return i&&(l=l.negate()),u&&(d=d.negate()),d=new h(n.mul(d.px,o.beta),d.py,d.pz),l.add(d)}multiply(t){s(t);let r,o,i=t;const{endo:a}=e;if(a){const{k1neg:t,k1:e,k2neg:s,k2:u}=a.splitScalar(i);let{p:c,f:l}=this.wNAF(e),{p:d,f:p}=this.wNAF(u);c=f.constTimeNegate(t,c),d=f.constTimeNegate(s,d),d=new h(n.mul(d.px,a.beta),d.py,d.pz),r=c.add(d),o=l.add(p)}else{const{p:t,f:e}=this.wNAF(i);r=t,o=e}return h.normalizeZ([r,o])[0]}multiplyAndAddUnsafe(t,e,n){const r=h.BASE,o=(t,e)=>e!==NS&&e!==_S&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),i=o(this,e).add(o(t,n));return i.is0()?void 0:i}toAffine(t){const{px:e,py:r,pz:o}=this,i=this.is0();null==t&&(t=i?n.ONE:n.inv(o));const a=n.mul(e,t),s=n.mul(r,t),u=n.mul(o,t);if(i)return{x:n.ZERO,y:n.ZERO};if(!n.eql(u,n.ONE))throw new Error("invZ was invalid");return{x:a,y:s}}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===_S)return!0;if(n)return n(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===_S?this:n?n(h,this):this.multiplyUnsafe(e.h)}toRawBytes(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.assertValidity(),r(h,this,t)}toHex(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Hk(this.toRawBytes(t))}}h.BASE=new h(e.Gx,e.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,f=function(t,e){const n=(t,e)=>{const n=e.negate();return t?n:e},r=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:n,unsafeLadder(e,n){let r=t.ZERO,o=e;for(;n>CS;)n&kS&&(r=r.add(o)),o=o.double(),n>>=kS;return r},precomputeWindow(t,e){const{windows:n,windowSize:o}=r(e),i=[];let a=t,s=a;for(let r=0;r<n;r++){s=a,i.push(s);for(let t=1;t<o;t++)s=s.add(a),i.push(s);a=s.double()}return i},wNAF(e,o,i){const{windows:a,windowSize:s}=r(e);let u=t.ZERO,c=t.BASE;const l=BigInt(2**e-1),h=2**e,d=BigInt(e);for(let t=0;t<a;t++){const e=t*s;let r=Number(i&l);i>>=d,r>s&&(r-=h,i+=kS);const a=e,f=e+Math.abs(r)-1,p=t%2!==0,g=r<0;0===r?c=c.add(n(p,o[a])):u=u.add(n(g,o[f]))}return{p:u,f:c}},wNAFCached(t,e,n,r){const o=t._WINDOW_SIZE||1;let i=e.get(t);return i||(i=this.precomputeWindow(t,o),1!==o&&e.set(t,r(i))),this.wNAF(o,i,n)}}}(h,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:u,weierstrassEquation:i,isWithinCurveOrder:a}}function OS(t){const e=function(t){const e=SS(t);return iS(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(Rt({lowS:!0},e))}(t),{Fp:n,n:r}=e,o=n.BYTES+1,i=2*n.BYTES+1;function a(t){return fS(t,r)}function s(t){return mS(t,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:l,isWithinCurveOrder:h}=DS(Rt(Rt({},e),{},{toBytes(t,e,r){const o=e.toAffine(),i=n.toBytes(o.x),a=$k;return r?a(Uint8Array.from([e.hasEvenY()?2:3]),i):a(Uint8Array.from([4]),i,n.toBytes(o.y))},fromBytes(t){const e=t.length,r=t[0],a=t.subarray(1);if(e!==o||2!==r&&3!==r){if(e===i&&4===r){return{x:n.fromBytes(a.subarray(0,n.BYTES)),y:n.fromBytes(a.subarray(n.BYTES,2*n.BYTES))}}throw new Error("Point of length ".concat(e," was invalid. Expected ").concat(o," compressed bytes or ").concat(i," uncompressed bytes"))}{const t=Qk(a);if(!(NS<(s=t)&&s<n.ORDER))throw new Error("Point is not on curve");const e=l(t);let o=n.sqrt(e);return 1===(1&r)!==((o&_S)===_S)&&(o=n.neg(o)),{x:t,y:o}}var s}})),d=t=>Hk(Jk(t,e.nByteLength));function f(t){return t>r>>_S}const p=(t,e,n)=>Qk(t.slice(e,n));class g{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=Zk("compactSignature",t,2*n),new g(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=TS.toSig(Zk("DER",t));return new g(e,n)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new g(this.r,this.s,t)}recoverPublicKey(t){const{r:r,s:o,recovery:i}=this,c=b(Zk("msgHash",t));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const l=2===i||3===i?r+e.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const h=0===(1&i)?"02":"03",f=u.fromHex(h+d(l)),p=s(l),g=a(-c*p),m=a(o*p),v=u.BASE.multiplyAndAddUnsafe(f,g,m);if(!v)throw new Error("point at infinify");return v.assertValidity(),v}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Kk(this.toDERHex())}toDERHex(){return TS.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Kk(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const m={isValidPrivateKey(t){try{return c(t),!0}catch(e){return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const t=xS(e.n);return function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=t.length,o=wS(e),i=xS(e);if(r<16||r<i||r>1024)throw new Error("expected ".concat(i,"-1024 bytes of input, got ").concat(r));const a=fS(n?Qk(t):Xk(t),e-sS)+sS;return n?Yk(a,o):Jk(a,o)}(e.randomBytes(t),e.n)},precompute(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.BASE;return e._setWindowSize(t),e.multiply(BigInt(3)),e}};function v(t){const e=t instanceof Uint8Array,n="string"===typeof t,r=(e||n)&&t.length;return e?r===o||r===i:n?r===2*o||r===2*i:t instanceof u}const y=e.bits2int||function(t){const n=Qk(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},b=e.bits2int_modN||function(t){return a(y(t))},w=tS(e.nBitLength);function x(t){if("bigint"!==typeof t)throw new Error("bigint expected");if(!(NS<=t&&t<w))throw new Error("bigint expected < 2^".concat(e.nBitLength));return Jk(t,e.nByteLength)}function E(t,r){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A;if(["recovered","canonical"].some(t=>t in o))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:l}=e;let{lowS:d,prehash:p,extraEntropy:m}=o;null==d&&(d=!0),t=Zk("msgHash",t),p&&(t=Zk("prehashed msgHash",i(t)));const v=b(t),w=c(r),E=[x(w),x(v)];if(null!=m){const t=!0===m?l(n.BYTES):m;E.push(Zk("extraEntropy",t))}const C=$k(...E),k=v;return{seed:C,k2sig:function(t){const e=y(t);if(!h(e))return;const n=s(e),r=u.BASE.multiply(e).toAffine(),o=a(r.x);if(o===NS)return;const i=a(n*a(k+o*w));if(i===NS)return;let c=(r.x===o?0:2)|Number(r.y&_S),l=i;return d&&f(i)&&(l=function(t){return f(t)?a(-t):t}(i),c^=1),new g(o,l,c)}}}const A={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};return u.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return u.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(v(t))throw new Error("first arg must be private key");if(!v(e))throw new Error("second arg must be public key");return u.fromHex(e).multiply(c(t)).toRawBytes(n)},sign:function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A;const{seed:o,k2sig:i}=E(t,n,r),a=e;return rS(a.hash.outputLen,a.nByteLength,a.hmac)(o,i)},verify:function(t,n,r){var o;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C;const c=t;if(n=Zk("msgHash",n),r=Zk("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:l,prehash:h}=i;let d,f;try{if("string"===typeof c||c instanceof Uint8Array)try{d=g.fromDER(c)}catch(A){if(!(A instanceof TS.Err))throw A;d=g.fromCompact(c)}else{if("object"!==typeof c||"bigint"!==typeof c.r||"bigint"!==typeof c.s)throw new Error("PARSE");{const{r:t,s:e}=c;d=new g(t,e)}}f=u.fromHex(r)}catch(k){if("PARSE"===k.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(l&&d.hasHighS())return!1;h&&(n=e.hash(n));const{r:p,s:m}=d,v=b(n),y=s(m),w=a(v*y),x=a(p*y),E=null===(o=u.BASE.multiplyAndAddUnsafe(f,w,x))||void 0===o?void 0:o.toAffine();return!!E&&a(E.x)===p},ProjectivePoint:u,Signature:g,utils:m}}function FS(t){return{hash:t,hmac:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return AS(t,e,function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=new Uint8Array(e.reduce((t,e)=>t+e.length,0));let o=0;return e.forEach(t=>{if(!Sk(t))throw new Error("Uint8Array expected");r.set(t,o),o+=t.length}),r}(...r))},randomBytes:Pk}}const MS=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),BS=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),LS=BigInt(1),US=BigInt(2),WS=(t,e)=>(t+e/US)/e;function zS(t){const e=MS,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),a=BigInt(23),s=BigInt(44),u=BigInt(88),c=t*t*t%e,l=c*c*t%e,h=gS(l,n,e)*l%e,d=gS(h,n,e)*l%e,f=gS(d,US,e)*c%e,p=gS(f,o,e)*f%e,g=gS(p,i,e)*p%e,m=gS(g,s,e)*g%e,v=gS(m,u,e)*m%e,y=gS(v,s,e)*g%e,b=gS(y,n,e)*l%e,w=gS(b,a,e)*p%e,x=gS(w,r,e)*c%e,E=gS(x,US,e);if(!VS.eql(VS.sqr(E),t))throw new Error("Cannot find square root");return E}const VS=function(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t<=aS)throw new Error("Expected Field ORDER > 0, got ".concat(t));const{nBitLength:o,nByteLength:i}=bS(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const a=vS(t),s=Object.freeze({ORDER:t,BITS:o,BYTES:i,MASK:tS(o),ZERO:aS,ONE:sS,create:e=>fS(e,t),isValid:e=>{if("bigint"!==typeof e)throw new Error("Invalid field element: expected bigint, got ".concat(typeof e));return aS<=e&&e<t},is0:t=>t===aS,isOdd:t=>(t&sS)===sS,neg:e=>fS(-e,t),eql:(t,e)=>t===e,sqr:e=>fS(e*e,t),add:(e,n)=>fS(e+n,t),sub:(e,n)=>fS(e-n,t),mul:(e,n)=>fS(e*n,t),pow:(t,e)=>function(t,e,n){if(n<aS)throw new Error("Expected power > 0");if(n===aS)return t.ONE;if(n===sS)return e;let r=t.ONE,o=e;for(;n>aS;)n&sS&&(r=t.mul(r,o)),o=t.sqr(o),n>>=sS;return r}(s,t,e),div:(e,n)=>fS(e*mS(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>mS(e,t),sqrt:r.sqrt||(t=>a(s,t)),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce((e,r,o)=>t.is0(r)?e:(n[o]=e,t.mul(e,r)),t.ONE),o=t.inv(r);return e.reduceRight((e,r,o)=>t.is0(r)?e:(n[o]=t.mul(e,n[o]),t.mul(e,r)),o),n}(s,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?Yk(t,i):Jk(t,i),fromBytes:t=>{if(t.length!==i)throw new Error("Fp.fromBytes: expected ".concat(i,", got ").concat(t.length));return n?Xk(t):Qk(t)}});return Object.freeze(s)}(MS,void 0,void 0,{sqrt:zS}),jS=function(t,e){const n=e=>OS(Rt(Rt({},t),FS(e)));return Object.freeze(Rt(Rt({},n(e)),{},{create:n}))}({a:BigInt(0),b:BigInt(7),Fp:VS,n:BS,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=BS,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-LS*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,a=BigInt("0x100000000000000000000000000000000"),s=WS(i*t,e),u=WS(-r*t,e);let c=fS(t-s*n-u*o,e),l=fS(-s*r-u*i,e);const h=c>a,d=l>a;if(h&&(c=e-c),d&&(l=e-l),c>a||l>a)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:c,k2neg:d,k2:l}}}},Wk);BigInt(0);jS.ProjectivePoint;var GS=new WeakMap;class HS{constructor(t){pv(this,GS,void 0),Sv(32===Uv(t),"invalid private key","privateKey","[REDACTED]"),vv(GS,this,Bv(t))}get privateKey(){return mv(GS,this)}get publicKey(){return HS.computePublicKey(mv(GS,this))}get compressedPublicKey(){return HS.computePublicKey(mv(GS,this),!0)}sign(t){Sv(32===Uv(t),"invalid digest length","digest",t);const e=jS.sign(Dv(t),Dv(mv(GS,this)),{lowS:!0});return Vx.from({r:ty(e.r,32),s:ty(e.s,32),v:e.recovery?28:27})}computeSharedSecret(t){const e=HS.computePublicKey(t);return Bv(jS.getSharedSecret(Dv(mv(GS,this)),Pv(e),!1))}static computePublicKey(t,e){let n=Pv(t,"key");if(32===n.length){return Bv(jS.getPublicKey(n,!!e))}if(64===n.length){const t=new Uint8Array(65);t[0]=4,t.set(n,1),n=t}return Bv(jS.ProjectivePoint.fromHex(n).toRawBytes(e))}static recoverPublicKey(t,e){Sv(32===Uv(t),"invalid digest length","digest",t);const n=Vx.from(e);let r=jS.Signature.fromCompact(Dv(Lv([n.r,n.s])));r=r.addRecoveryBit(n.yParity);const o=r.recoverPublicKey(Dv(t));return Sv(null!=o,"invalid signature for digest","signature",e),"0x"+o.toHex(!1)}static addPoints(t,e,n){const r=jS.ProjectivePoint.fromHex(HS.computePublicKey(t).substring(2)),o=jS.ProjectivePoint.fromHex(HS.computePublicKey(e).substring(2));return"0x"+r.add(o).toHex(!!n)}}function qS(t){let e=t.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function KS(t,e,n){let r=0;for(let o=0;o<n;o++)r=256*r+t[e+o];return r}function QS(t,e,n,r){const o=[];for(;n<e+1+r;){const i=XS(t,n);o.push(i.result),kv((n+=i.consumed)<=e+1+r,"child data too short","BUFFER_OVERRUN",{buffer:t,length:r,offset:e})}return{consumed:1+r,result:o}}function XS(t,e){kv(0!==t.length,"data too short","BUFFER_OVERRUN",{buffer:t,length:0,offset:1});const n=e=>{kv(e<=t.length,"data short segment too short","BUFFER_OVERRUN",{buffer:t,length:t.length,offset:e})};if(t[e]>=248){const r=t[e]-247;n(e+1+r);const o=KS(t,e+1,r);return n(e+1+r+o),QS(t,e,e+1+r,r+o)}if(t[e]>=192){const r=t[e]-192;return n(e+1+r),QS(t,e,e+1,r)}if(t[e]>=184){const r=t[e]-183;n(e+1+r);const o=KS(t,e+1,r);n(e+1+r+o);return{consumed:1+r+o,result:Bv(t.slice(e+1+r,e+1+r+o))}}if(t[e]>=128){const r=t[e]-128;n(e+1+r);return{consumed:1+r,result:Bv(t.slice(e+1,e+1+r))}}return{consumed:1,result:qS(t[e])}}function JS(t){const e=Pv(t,"data"),n=XS(e,0);return Sv(n.consumed===e.length,"unexpected junk after rlp payload","data",t),n.result}function YS(t){const e=[];for(;t;)e.unshift(255&t),t>>=8;return e}function ZS(t){if(Array.isArray(t)){let e=[];if(t.forEach(function(t){e=e.concat(ZS(t))}),e.length<=55)return e.unshift(192+e.length),e;const n=YS(e.length);return n.unshift(247+n.length),n.concat(e)}const e=Array.prototype.slice.call(Pv(t,"object"));if(1===e.length&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const n=YS(e.length);return n.unshift(183+n.length),n.concat(e)}const $S="0123456789abcdef";function tI(t){let e="0x";for(const n of ZS(t))e+=$S[n>>4],e+=$S[15&n];return e}function eI(t,e){return function(t){let e;return e="string"===typeof t?HS.computePublicKey(t,!1):t.publicKey,Eb(gb("0x"+e.substring(4)).substring(26))}(HS.recoverPublicKey(t,e))}const nI=BigInt(0),rI=BigInt(2),oI=BigInt(27),iI=BigInt(28),aI=BigInt(35),sI=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),uI=131072;function cI(t,e){let n=t.toString(16);for(;n.length<2;)n="0"+n;return n+=yk(e).substring(4),"0x"+n}function lI(t){return"0x"===t?null:Eb(t)}function hI(t,e){try{return Rx(t)}catch(n){Sv(!1,n.message,e,t)}}function dI(t,e){try{if(!Array.isArray(t))throw new Error("authorizationList: invalid array");const e=[];for(let n=0;n<t.length;n++){const r=t[n];if(!Array.isArray(r))throw new Error("authorization[".concat(n,"]: invalid array"));if(6!==r.length)throw new Error("authorization[".concat(n,"]: wrong length"));if(!r[1])throw new Error("authorization[".concat(n,"]: null address"));e.push({address:lI(r[1]),nonce:pI(r[2],"nonce"),chainId:pI(r[0],"chainId"),signature:Vx.from({yParity:fI(r[3],"yParity"),r:Vv(r[4],32),s:Vv(r[5],32)})})}return e}catch(n){Sv(!1,n.message,e,t)}}function fI(t,e){return"0x"===t?0:$v(t,e)}function pI(t,e){if("0x"===t)return nI;const n=Xv(t,e);return Sv(n<=sI,"value exceeds uint size",e,n),n}function gI(t,e){const n=Xv(t,"value"),r=ey(n);return Sv(r.length<=32,"value too large","tx.".concat(e),n),r}function mI(t){return Rx(t).map(t=>[t.address,t.storageKeys])}function vI(t,e){Sv(Array.isArray(t),"invalid ".concat(e),"value",t);for(let n=0;n<t.length;n++)Sv(Ov(t[n],32),"invalid ${ param } hash","value[".concat(n,"]"),t[n]);return t}function yI(t,e){let n;try{if(n=fI(e[0],"yParity"),0!==n&&1!==n)throw new Error("bad yParity")}catch(a){Sv(!1,"invalid yParity","yParity",e[0])}const r=Vv(e[1],32),o=Vv(e[2],32),i=Vx.from({r:r,s:o,yParity:n});t.signature=i}var bI=new WeakMap,wI=new WeakMap,xI=new WeakMap,EI=new WeakMap,AI=new WeakMap,CI=new WeakMap,kI=new WeakMap,SI=new WeakMap,II=new WeakMap,RI=new WeakMap,TI=new WeakMap,NI=new WeakMap,_I=new WeakMap,PI=new WeakMap,DI=new WeakMap,OI=new WeakMap,FI=new WeakMap,MI=new WeakSet;class BI{get type(){return mv(bI,this)}set type(t){switch(t){case null:vv(bI,this,null);break;case 0:case"legacy":vv(bI,this,0);break;case 1:case"berlin":case"eip-2930":vv(bI,this,1);break;case 2:case"london":case"eip-1559":vv(bI,this,2);break;case 3:case"cancun":case"eip-4844":vv(bI,this,3);break;case 4:case"pectra":case"eip-7702":vv(bI,this,4);break;default:Sv(!1,"unsupported transaction type","type",t)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const t=mv(wI,this);return null==t&&3===this.type?TE:t}set to(t){vv(wI,this,null==t?null:Eb(t))}get nonce(){return mv(EI,this)}set nonce(t){vv(EI,this,$v(t,"value"))}get gasLimit(){return mv(AI,this)}set gasLimit(t){vv(AI,this,Xv(t))}get gasPrice(){const t=mv(CI,this);return null!=t||0!==this.type&&1!==this.type?t:nI}set gasPrice(t){vv(CI,this,null==t?null:Xv(t,"gasPrice"))}get maxPriorityFeePerGas(){const t=mv(kI,this);return null==t?2===this.type||3===this.type?nI:null:t}set maxPriorityFeePerGas(t){vv(kI,this,null==t?null:Xv(t,"maxPriorityFeePerGas"))}get maxFeePerGas(){const t=mv(SI,this);return null==t?2===this.type||3===this.type?nI:null:t}set maxFeePerGas(t){vv(SI,this,null==t?null:Xv(t,"maxFeePerGas"))}get data(){return mv(xI,this)}set data(t){vv(xI,this,Bv(t))}get value(){return mv(II,this)}set value(t){vv(II,this,Xv(t,"value"))}get chainId(){return mv(RI,this)}set chainId(t){vv(RI,this,Xv(t))}get signature(){return mv(TI,this)||null}set signature(t){vv(TI,this,null==t?null:Vx.from(t))}get accessList(){const t=mv(NI,this)||null;return null==t?1===this.type||2===this.type||3===this.type?[]:null:t}set accessList(t){vv(NI,this,null==t?null:Rx(t))}get authorizationList(){const t=mv(FI,this)||null;return null==t&&4===this.type?[]:t}set authorizationList(t){vv(FI,this,null==t?null:t.map(t=>jx(t)))}get maxFeePerBlobGas(){const t=mv(_I,this);return null==t&&3===this.type?nI:t}set maxFeePerBlobGas(t){vv(_I,this,null==t?null:Xv(t,"maxFeePerBlobGas"))}get blobVersionedHashes(){let t=mv(PI,this);return null==t&&3===this.type?[]:t}set blobVersionedHashes(t){if(null!=t){Sv(Array.isArray(t),"blobVersionedHashes must be an Array","value",t),t=t.slice();for(let e=0;e<t.length;e++)Sv(Ov(t[e],32),"invalid blobVersionedHash","value[".concat(e,"]"),t[e])}vv(PI,this,t)}get blobs(){return null==mv(OI,this)?null:mv(OI,this).map(t=>Object.assign({},t))}set blobs(t){if(null==t)return void vv(OI,this,null);const e=[],n=[];for(let r=0;r<t.length;r++){const o=t[r];if(Fv(o)){kv(mv(DI,this),"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let t=Pv(o);if(Sv(t.length<=uI,"blob is too large","blobs[".concat(r,"]"),o),t.length!==uI){const e=new Uint8Array(uI);e.set(t),t=e}const i=mv(DI,this).blobToKzgCommitment(t),a=Bv(mv(DI,this).computeBlobKzgProof(t,i));e.push({data:Bv(t),commitment:Bv(i),proof:a}),n.push(cI(1,i))}else{const t=Bv(o.commitment);e.push({data:Bv(o.data),commitment:t,proof:Bv(o.proof)}),n.push(cI(1,t))}}vv(OI,this,e),vv(PI,this,n)}get kzg(){return mv(DI,this)}set kzg(t){vv(DI,this,null==t?null:function(t){return{blobToKzgCommitment:e=>{if("computeBlobProof"in t){if("blobToKzgCommitment"in t&&"function"===typeof t.blobToKzgCommitment)return Pv(t.blobToKzgCommitment(Bv(e)))}else if("blobToKzgCommitment"in t&&"function"===typeof t.blobToKzgCommitment)return Pv(t.blobToKzgCommitment(e));if("blobToKZGCommitment"in t&&"function"===typeof t.blobToKZGCommitment)return Pv(t.blobToKZGCommitment(Bv(e)));Sv(!1,"unsupported KZG library","kzg",t)},computeBlobKzgProof:(e,n)=>"computeBlobProof"in t&&"function"===typeof t.computeBlobProof?Pv(t.computeBlobProof(Bv(e),Bv(n))):"computeBlobKzgProof"in t&&"function"===typeof t.computeBlobKzgProof?t.computeBlobKzgProof(e,n):"computeBlobKZGProof"in t&&"function"===typeof t.computeBlobKZGProof?Pv(t.computeBlobKZGProof(Bv(e),Bv(n))):void Sv(!1,"unsupported KZG library","kzg",t)}}(t))}constructor(){Nv(this,MI),pv(this,bI,void 0),pv(this,wI,void 0),pv(this,xI,void 0),pv(this,EI,void 0),pv(this,AI,void 0),pv(this,CI,void 0),pv(this,kI,void 0),pv(this,SI,void 0),pv(this,II,void 0),pv(this,RI,void 0),pv(this,TI,void 0),pv(this,NI,void 0),pv(this,_I,void 0),pv(this,PI,void 0),pv(this,DI,void 0),pv(this,OI,void 0),pv(this,FI,void 0),vv(bI,this,null),vv(wI,this,null),vv(EI,this,0),vv(AI,this,nI),vv(CI,this,null),vv(kI,this,null),vv(SI,this,null),vv(xI,this,"0x"),vv(II,this,nI),vv(RI,this,nI),vv(TI,this,null),vv(NI,this,null),vv(_I,this,null),vv(PI,this,null),vv(DI,this,null),vv(OI,this,null),vv(FI,this,null)}get hash(){return null==this.signature?null:gb(gv(MI,this,LI).call(this,!0,!1))}get unsignedHash(){return gb(this.unsignedSerialized)}get from(){return null==this.signature?null:eI(this.unsignedHash,this.signature)}get fromPublicKey(){return null==this.signature?null:HS.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return null!=this.signature}get serialized(){return gv(MI,this,LI).call(this,!0,!0)}get unsignedSerialized(){return gv(MI,this,LI).call(this,!1,!1)}inferType(){const t=this.inferTypes();return t.indexOf(2)>=0?2:t.pop()}inferTypes(){const t=null!=this.gasPrice,e=null!=this.maxFeePerGas||null!=this.maxPriorityFeePerGas,n=null!=this.accessList,r=null!=mv(_I,this)||mv(PI,this);null!=this.maxFeePerGas&&null!=this.maxPriorityFeePerGas&&kv(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),kv(!e||0!==this.type&&1!==this.type,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),kv(0!==this.type||!n,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const o=[];return null!=this.type?o.push(this.type):this.authorizationList&&this.authorizationList.length?o.push(4):e?o.push(2):t?(o.push(1),n||o.push(0)):n?(o.push(1),o.push(2)):(r&&this.to||(o.push(0),o.push(1),o.push(2)),o.push(3)),o.sort(),o}isLegacy(){return 0===this.type}isBerlin(){return 1===this.type}isLondon(){return 2===this.type}isCancun(){return 3===this.type}clone(){return BI.from(this)}toJSON(){const t=t=>null==t?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:t(this.gasLimit),gasPrice:t(this.gasPrice),maxPriorityFeePerGas:t(this.maxPriorityFeePerGas),maxFeePerGas:t(this.maxFeePerGas),value:t(this.value),chainId:t(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(t){if(null==t)return new BI;if("string"===typeof t){const e=Pv(t);if(e[0]>=127)return BI.from(function(t){const e=JS(t);Sv(Array.isArray(e)&&(9===e.length||6===e.length),"invalid field count for legacy transaction","data",t);const n={type:0,nonce:fI(e[0],"nonce"),gasPrice:pI(e[1],"gasPrice"),gasLimit:pI(e[2],"gasLimit"),to:lI(e[3]),value:pI(e[4],"value"),data:Bv(e[5]),chainId:nI};if(6===e.length)return n;const r=pI(e[6],"v"),o=pI(e[7],"r"),i=pI(e[8],"s");if(o===nI&&i===nI)n.chainId=r;else{let t=(r-aI)/rI;t<nI&&(t=nI),n.chainId=t,Sv(t!==nI||r===oI||r===iI,"non-canonical legacy v","v",e[6]),n.signature=Vx.from({r:Vv(e[7],32),s:Vv(e[8],32),v:r})}return n}(e));switch(e[0]){case 1:return BI.from(function(t){const e=JS(Pv(t).slice(1));Sv(Array.isArray(e)&&(8===e.length||11===e.length),"invalid field count for transaction type: 1","data",Bv(t));const n={type:1,chainId:pI(e[0],"chainId"),nonce:fI(e[1],"nonce"),gasPrice:pI(e[2],"gasPrice"),gasLimit:pI(e[3],"gasLimit"),to:lI(e[4]),value:pI(e[5],"value"),data:Bv(e[6]),accessList:hI(e[7],"accessList")};return 8===e.length||yI(n,e.slice(8)),n}(e));case 2:return BI.from(function(t){const e=JS(Pv(t).slice(1));Sv(Array.isArray(e)&&(9===e.length||12===e.length),"invalid field count for transaction type: 2","data",Bv(t));const n={type:2,chainId:pI(e[0],"chainId"),nonce:fI(e[1],"nonce"),maxPriorityFeePerGas:pI(e[2],"maxPriorityFeePerGas"),maxFeePerGas:pI(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:pI(e[4],"gasLimit"),to:lI(e[5]),value:pI(e[6],"value"),data:Bv(e[7]),accessList:hI(e[8],"accessList")};return 9===e.length||yI(n,e.slice(9)),n}(e));case 3:return BI.from(function(t){let e=JS(Pv(t).slice(1)),n="3",r=null;if(4===e.length&&Array.isArray(e[0])){n="3 (network format)";const t=e[1],o=e[2],i=e[3];Sv(Array.isArray(t),"invalid network format: blobs not an array","fields[1]",t),Sv(Array.isArray(o),"invalid network format: commitments not an array","fields[2]",o),Sv(Array.isArray(i),"invalid network format: proofs not an array","fields[3]",i),Sv(t.length===o.length,"invalid network format: blobs/commitments length mismatch","fields",e),Sv(t.length===i.length,"invalid network format: blobs/proofs length mismatch","fields",e),r=[];for(let n=0;n<e[1].length;n++)r.push({data:t[n],commitment:o[n],proof:i[n]});e=e[0]}Sv(Array.isArray(e)&&(11===e.length||14===e.length),"invalid field count for transaction type: ".concat(n),"data",Bv(t));const o={type:3,chainId:pI(e[0],"chainId"),nonce:fI(e[1],"nonce"),maxPriorityFeePerGas:pI(e[2],"maxPriorityFeePerGas"),maxFeePerGas:pI(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:pI(e[4],"gasLimit"),to:lI(e[5]),value:pI(e[6],"value"),data:Bv(e[7]),accessList:hI(e[8],"accessList"),maxFeePerBlobGas:pI(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};r&&(o.blobs=r),Sv(null!=o.to,"invalid address for transaction type: ".concat(n),"data",t),Sv(Array.isArray(o.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",t);for(let i=0;i<o.blobVersionedHashes.length;i++)Sv(Ov(o.blobVersionedHashes[i],32),"invalid blobVersionedHash at index ".concat(i,": must be length 32"),"data",t);return 11===e.length||yI(o,e.slice(11)),o}(e));case 4:return BI.from(function(t){const e=JS(Pv(t).slice(1));Sv(Array.isArray(e)&&(10===e.length||13===e.length),"invalid field count for transaction type: 4","data",Bv(t));const n={type:4,chainId:pI(e[0],"chainId"),nonce:fI(e[1],"nonce"),maxPriorityFeePerGas:pI(e[2],"maxPriorityFeePerGas"),maxFeePerGas:pI(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:pI(e[4],"gasLimit"),to:lI(e[5]),value:pI(e[6],"value"),data:Bv(e[7]),accessList:hI(e[8],"accessList"),authorizationList:dI(e[9],"authorizationList")};return 10===e.length||yI(n,e.slice(10)),n}(e))}kv(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const e=new BI;return null!=t.type&&(e.type=t.type),null!=t.to&&(e.to=t.to),null!=t.nonce&&(e.nonce=t.nonce),null!=t.gasLimit&&(e.gasLimit=t.gasLimit),null!=t.gasPrice&&(e.gasPrice=t.gasPrice),null!=t.maxPriorityFeePerGas&&(e.maxPriorityFeePerGas=t.maxPriorityFeePerGas),null!=t.maxFeePerGas&&(e.maxFeePerGas=t.maxFeePerGas),null!=t.maxFeePerBlobGas&&(e.maxFeePerBlobGas=t.maxFeePerBlobGas),null!=t.data&&(e.data=t.data),null!=t.value&&(e.value=t.value),null!=t.chainId&&(e.chainId=t.chainId),null!=t.signature&&(e.signature=Vx.from(t.signature)),null!=t.accessList&&(e.accessList=t.accessList),null!=t.authorizationList&&(e.authorizationList=t.authorizationList),null!=t.blobVersionedHashes&&(e.blobVersionedHashes=t.blobVersionedHashes),null!=t.kzg&&(e.kzg=t.kzg),null!=t.blobs&&(e.blobs=t.blobs),null!=t.hash&&(Sv(e.isSigned(),"unsigned transaction cannot define '.hash'","tx",t),Sv(e.hash===t.hash,"hash mismatch","tx",t)),null!=t.from&&(Sv(e.isSigned(),"unsigned transaction cannot define '.from'","tx",t),Sv(e.from.toLowerCase()===(t.from||"").toLowerCase(),"from mismatch","tx",t)),e}}function LI(t,e){kv(!t||null!=this.signature,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const n=t?this.signature:null;switch(this.inferType()){case 0:return function(t,e){const n=[gI(t.nonce,"nonce"),gI(t.gasPrice||0,"gasPrice"),gI(t.gasLimit,"gasLimit"),t.to||"0x",gI(t.value,"value"),t.data];let r=nI;if(t.chainId!=nI)r=Xv(t.chainId,"tx.chainId"),Sv(!e||null==e.networkV||e.legacyChainId===r,"tx.chainId/sig.v mismatch","sig",e);else if(t.signature){const e=t.signature.legacyChainId;null!=e&&(r=e)}if(!e)return r!==nI&&(n.push(ey(r)),n.push("0x"),n.push("0x")),tI(n);let o=BigInt(27+e.yParity);return r!==nI?o=Vx.getChainIdV(r,e.v):BigInt(e.v)!==o&&Sv(!1,"tx.chainId/sig.v mismatch","sig",e),n.push(ey(o)),n.push(ey(e.r)),n.push(ey(e.s)),tI(n)}(this,n);case 1:return function(t,e){const n=[gI(t.chainId,"chainId"),gI(t.nonce,"nonce"),gI(t.gasPrice||0,"gasPrice"),gI(t.gasLimit,"gasLimit"),t.to||"0x",gI(t.value,"value"),t.data,mI(t.accessList||[])];return e&&(n.push(gI(e.yParity,"recoveryParam")),n.push(ey(e.r)),n.push(ey(e.s))),Lv(["0x01",tI(n)])}(this,n);case 2:return function(t,e){const n=[gI(t.chainId,"chainId"),gI(t.nonce,"nonce"),gI(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),gI(t.maxFeePerGas||0,"maxFeePerGas"),gI(t.gasLimit,"gasLimit"),t.to||"0x",gI(t.value,"value"),t.data,mI(t.accessList||[])];return e&&(n.push(gI(e.yParity,"yParity")),n.push(ey(e.r)),n.push(ey(e.s))),Lv(["0x02",tI(n)])}(this,n);case 3:return function(t,e,n){const r=[gI(t.chainId,"chainId"),gI(t.nonce,"nonce"),gI(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),gI(t.maxFeePerGas||0,"maxFeePerGas"),gI(t.gasLimit,"gasLimit"),t.to||TE,gI(t.value,"value"),t.data,mI(t.accessList||[]),gI(t.maxFeePerBlobGas||0,"maxFeePerBlobGas"),vI(t.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(r.push(gI(e.yParity,"yParity")),r.push(ey(e.r)),r.push(ey(e.s)),n)?Lv(["0x03",tI([r,n.map(t=>t.data),n.map(t=>t.commitment),n.map(t=>t.proof)])]):Lv(["0x03",tI(r)])}(this,n,e?this.blobs:null);case 4:return function(t,e){const n=[gI(t.chainId,"chainId"),gI(t.nonce,"nonce"),gI(t.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),gI(t.maxFeePerGas||0,"maxFeePerGas"),gI(t.gasLimit,"gasLimit"),t.to||"0x",gI(t.value,"value"),t.data,mI(t.accessList||[]),(r=t.authorizationList||[],r.map(t=>[gI(t.chainId,"chainId"),t.address,gI(t.nonce,"nonce"),gI(t.signature.yParity,"yParity"),ey(t.signature.r),ey(t.signature.s)]))];var r;return e&&(n.push(gI(e.yParity,"yParity")),n.push(ey(e.r)),n.push(ey(e.s))),Lv(["0x04",tI(n)])}(this,n)}kv(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})}const UI="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";BigInt(0);const WI=BigInt(58);var zI;function VI(t){return t.match(/^ipfs:\/\/ipfs\//i)?t=t.substring(12):t.match(/^ipfs:\/\//i)?t=t.substring(7):Sv(!1,"unsupported IPFS format","link",t),"https://gateway.ipfs.io/ipfs/".concat(t)}class jI{constructor(t){St(this,"name",void 0),wv(this,{name:t})}connect(t){return this}supportsCoinType(t){return!1}async encodeAddress(t,e){throw new Error("unsupported coin")}async decodeAddress(t,e){throw new Error("unsupported coin")}}const GI=new RegExp("^(ipfs)://(.*)$","i"),HI=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),GI,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];var qI=new WeakMap,KI=new WeakMap,QI=new WeakSet;class XI{constructor(t,e,n){Nv(this,QI),St(this,"provider",void 0),St(this,"address",void 0),St(this,"name",void 0),pv(this,qI,void 0),pv(this,KI,void 0),wv(this,{provider:t,address:e,name:n}),vv(qI,this,null),vv(KI,this,new BA(e,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],t))}async supportsWildcard(){return null==mv(qI,this)&&vv(qI,this,(async()=>{try{return await mv(KI,this).supportsInterface("0x9061b923")}catch(t){if(Ev(t,"CALL_EXCEPTION"))return!1;throw vv(qI,this,null),t}})()),await mv(qI,this)}async getAddress(t){if(null==t&&(t=60),60===t)try{const t=await gv(QI,this,JI).call(this,"addr(bytes32)");return null==t||t===TE?null:t}catch(o){if(Ev(o,"CALL_EXCEPTION"))return null;throw o}if(t>=0&&t<2147483648){let e=t+2147483648;const n=await gv(QI,this,JI).call(this,"addr(bytes32,uint)",[e]);if(Ov(n,20))return Eb(n)}let e=null;for(const i of this.provider.plugins)if(i instanceof jI&&i.supportsCoinType(t)){e=i;break}if(null==e)return null;const n=await gv(QI,this,JI).call(this,"addr(bytes32,uint)",[t]);if(null==n||"0x"===n)return null;const r=await e.decodeAddress(t,n);if(null!=r)return r;kv(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:"getAddress(".concat(t,")"),info:{coinType:t,data:n}})}async getText(t){const e=await gv(QI,this,JI).call(this,"text(bytes32,string)",[t]);return null==e||"0x"===e?null:e}async getContentHash(){const t=await gv(QI,this,JI).call(this,"contenthash(bytes32)");if(null==t||"0x"===t)return null;const e=t.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(e){const t="e3010170"===e[1]?"ipfs":"ipns",n=parseInt(e[4],16);if(e[5].length===2*n)return"".concat(t,"://").concat(function(t){const e=Pv(t);let n=Zv(e),r="";for(;n;)r=UI[Number(n%WI)]+r,n/=WI;for(let o=0;o<e.length&&!e[o];o++)r=UI[0]+r;return r}("0x"+e[2]))}const n=t.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(n&&64===n[1].length)return"bzz://".concat(n[1]);kv(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:t}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const t=[{type:"name",value:this.name}];try{const n=await this.getText("avatar");if(null==n)return t.push({type:"!avatar",value:""}),{url:null,linkage:t};t.push({type:"avatar",value:n});for(let r=0;r<HI.length;r++){const o=n.match(HI[r]);if(null==o)continue;const i=o[1].toLowerCase();switch(i){case"https":case"data":return t.push({type:"url",value:n}),{linkage:t,url:n};case"ipfs":{const e=VI(n);return t.push({type:"ipfs",value:n}),t.push({type:"url",value:e}),{linkage:t,url:e}}case"erc721":case"erc1155":{const r="erc721"===i?"tokenURI(uint256)":"uri(uint256)";t.push({type:i,value:n});const a=await this.getAddress();if(null==a)return t.push({type:"!owner",value:""}),{url:null,linkage:t};const s=(o[2]||"").split("/");if(2!==s.length)return t.push({type:"!".concat(i,"caip"),value:o[2]||""}),{url:null,linkage:t};const u=s[1],c=new BA(s[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if("erc721"===i){const e=await c.ownerOf(u);if(a!==e)return t.push({type:"!owner",value:e}),{url:null,linkage:t};t.push({type:"owner",value:e})}else if("erc1155"===i){const e=await c.balanceOf(a,u);if(!e)return t.push({type:"!balance",value:"0"}),{url:null,linkage:t};t.push({type:"balance",value:e.toString()})}let l=await c[r](u);if(null==l||"0x"===l)return t.push({type:"!metadata-url",value:""}),{url:null,linkage:t};t.push({type:"metadata-url-base",value:l}),"erc1155"===i&&(l=l.replace("{id}",ty(u,32).substring(2)),t.push({type:"metadata-url-expanded",value:l})),l.match(/^ipfs:/i)&&(l=VI(l)),t.push({type:"metadata-url",value:l});let h={};const d=await new bE(l).send();d.assertOk();try{h=d.bodyJson}catch(e){try{t.push({type:"!metadata",value:d.bodyText})}catch(e){const n=d.body;return n&&t.push({type:"!metadata",value:Bv(n)}),{url:null,linkage:t}}return{url:null,linkage:t}}if(!h)return t.push({type:"!metadata",value:""}),{url:null,linkage:t};t.push({type:"metadata",value:JSON.stringify(h)});let f=h.image;if("string"!==typeof f)return t.push({type:"!imageUrl",value:""}),{url:null,linkage:t};if(f.match(/^(https:\/\/|data:)/i));else{if(null==f.match(GI))return t.push({type:"!imageUrl-ipfs",value:f}),{url:null,linkage:t};t.push({type:"imageUrl-ipfs",value:f}),f=VI(f)}return t.push({type:"url",value:f}),{linkage:t,url:f}}}}}catch(e){}return{linkage:t,url:null}}static async getEnsAddress(t){const e=await t.getNetwork(),n=e.getPlugin("org.ethers.plugins.network.Ens");return kv(n,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:e}}),n.address}static async fromName(t,e){let n=e;for(;;){if(""===n||"."===n)return null;if("eth"!==e&&"eth"===n)return null;const r=await YI.call(XI,t,n);if(null!=r){const o=new XI(t,r,e);return n===e||await o.supportsWildcard()?o:null}n=n.split(".").slice(1).join(".")}}}async function JI(t,e){e=(e||[]).slice();const n=mv(KI,this).interface;e.unshift(QC(this.name));let r=null;await this.supportsWildcard()&&(r=n.getFunction(t),kv(r,"missing fragment","UNKNOWN_ERROR",{info:{funcName:t}}),e=[XC(this.name,255),n.encodeFunctionData(r,e)],t="resolve(bytes,bytes)"),e.push({enableCcipRead:!0});try{const o=await mv(KI,this)[t](...e);return r?n.decodeFunctionResult(r,o)[0]:o}catch(o){if(!Ev(o,"CALL_EXCEPTION"))throw o}return null}async function YI(t,e){const n=await zI.getEnsAddress(t);try{const r=new BA(n,["function resolver(bytes32) view returns (address)"],t),o=await r.resolver(QC(e),{enableCcipRead:!0});return o===TE?null:o}catch(r){throw r}}zI=XI;const ZI=BigInt(0);function $I(t,e){return function(n){return null==n?e:t(n)}}function tR(t,e){return n=>{if(e&&null==n)return null;if(!Array.isArray(n))throw new Error("not an array");return n.map(e=>t(e))}}function eR(t,e){return n=>{const r={};for(const i in t){let a=i;if(e&&i in e&&!(a in n))for(const t of e[i])if(t in n){a=t;break}try{const e=t[i](n[a]);void 0!==e&&(r[i]=e)}catch(o){const t=o instanceof Error?o.message:"not-an-error";kv(!1,"invalid value for value.".concat(i," (").concat(t,")"),"BAD_DATA",{value:n})}}return r}}function nR(t){return Sv(Ov(t,!0),"invalid data","value",t),t}function rR(t){return Sv(Ov(t,32),"invalid hash","value",t),t}const oR=eR({address:Eb,blockHash:rR,blockNumber:$v,data:nR,index:$v,removed:$I(function(t){switch(t){case!0:case"true":return!0;case!1:case"false":return!1}Sv(!1,"invalid boolean; ".concat(JSON.stringify(t)),"value",t)},!1),topics:tR(rR),transactionHash:rR,transactionIndex:$v},{index:["logIndex"]});const iR=eR({hash:$I(rR),parentHash:rR,parentBeaconBlockRoot:$I(rR,null),number:$v,timestamp:$v,nonce:$I(nR),difficulty:Xv,gasLimit:Xv,gasUsed:Xv,stateRoot:$I(rR,null),receiptsRoot:$I(rR,null),blobGasUsed:$I(Xv,null),excessBlobGas:$I(Xv,null),miner:$I(Eb),prevRandao:$I(rR,null),extraData:nR,baseFeePerGas:$I(Xv)},{prevRandao:["mixHash"]});const aR=eR({transactionIndex:$v,blockNumber:$v,transactionHash:rR,address:Eb,topics:tR(rR),data:nR,index:$v,blockHash:rR},{index:["logIndex"]});const sR=eR({to:$I(Eb,null),from:$I(Eb,null),contractAddress:$I(Eb,null),index:$v,root:$I(Bv),gasUsed:Xv,blobGasUsed:$I(Xv,null),logsBloom:$I(nR),blockHash:rR,hash:rR,logs:tR(function(t){return aR(t)}),blockNumber:$v,cumulativeGasUsed:Xv,effectiveGasPrice:$I(Xv),blobGasPrice:$I(Xv,null),status:$I($v),type:$I($v,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function uR(t){t.to&&Xv(t.to)===ZI&&(t.to="0x0000000000000000000000000000000000000000");const e=eR({hash:rR,index:$I($v,void 0),type:t=>"0x"===t||null==t?0:$v(t),accessList:$I(Rx,null),blobVersionedHashes:$I(tR(rR,!0),null),authorizationList:$I(tR(t=>{let e;if(t.signature)e=t.signature;else{let n=t.yParity;"0x1b"===n?n=0:"0x1c"===n&&(n=1),e=Object.assign({},t,{yParity:n})}return{address:Eb(t.address),chainId:Xv(t.chainId),nonce:Xv(t.nonce),signature:Vx.from(e)}},!1),null),blockHash:$I(rR,null),blockNumber:$I($v,null),transactionIndex:$I($v,null),from:Eb,gasPrice:$I(Xv),maxPriorityFeePerGas:$I(Xv),maxFeePerGas:$I(Xv),maxFeePerBlobGas:$I(Xv,null),gasLimit:Xv,to:$I(Eb,null),value:Xv,nonce:$v,data:nR,creates:$I(Eb,null),chainId:$I(Xv,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(t);if(null==e.to&&null==e.creates&&(e.creates=function(t){const e=Eb(t.from);let n=Xv(t.nonce,"tx.nonce").toString(16);return n="0"===n?"0x":n.length%2?"0x0"+n:"0x"+n,Eb(Wv(gb(tI([e,n])),12))}(e)),1!==t.type&&2!==t.type||null!=t.accessList||(e.accessList=[]),t.signature?e.signature=Vx.from(t.signature):e.signature=Vx.from(t),null==e.chainId){const t=e.signature.legacyChainId;null!=t&&(e.chainId=t)}return e.blockHash&&Xv(e.blockHash)===ZI&&(e.blockHash=null),e}class cR{constructor(t){St(this,"name",void 0),wv(this,{name:t})}clone(){return new cR(this.name)}}class lR extends cR{constructor(t,e){null==t&&(t=0),super("org.ethers.network.plugins.GasCost#".concat(t||0)),St(this,"effectiveBlock",void 0),St(this,"txBase",void 0),St(this,"txCreate",void 0),St(this,"txDataZero",void 0),St(this,"txDataNonzero",void 0),St(this,"txAccessListStorageKey",void 0),St(this,"txAccessListAddress",void 0);const n={effectiveBlock:t};function r(t,r){let o=(e||{})[t];null==o&&(o=r),Sv("number"===typeof o,"invalud value for ".concat(t),"costs",e),n[t]=o}r("txBase",21e3),r("txCreate",32e3),r("txDataZero",4),r("txDataNonzero",16),r("txAccessListStorageKey",1900),r("txAccessListAddress",2400),wv(this,n)}clone(){return new lR(this.effectiveBlock,this)}}class hR extends cR{constructor(t,e){super("org.ethers.plugins.network.Ens"),St(this,"address",void 0),St(this,"targetNetwork",void 0),wv(this,{address:t||"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e",targetNetwork:null==e?1:e})}clone(){return new hR(this.address,this.targetNetwork)}}var dR=new WeakMap,fR=new WeakMap;class pR extends cR{get url(){return mv(dR,this)}get processFunc(){return mv(fR,this)}constructor(t,e){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin"),pv(this,dR,void 0),pv(this,fR,void 0),vv(dR,this,t),vv(fR,this,e)}clone(){return this}}const gR=new Map;var mR=new WeakMap,vR=new WeakMap,yR=new WeakMap;class bR{constructor(t,e){pv(this,mR,void 0),pv(this,vR,void 0),pv(this,yR,void 0),vv(mR,this,t),vv(vR,this,Xv(e)),vv(yR,this,new Map)}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return mv(mR,this)}set name(t){vv(mR,this,t)}get chainId(){return mv(vR,this)}set chainId(t){vv(vR,this,Xv(t,"chainId"))}matches(t){if(null==t)return!1;if("string"===typeof t){try{return this.chainId===Xv(t)}catch(e){}return this.name===t}if("number"===typeof t||"bigint"===typeof t){try{return this.chainId===Xv(t)}catch(e){}return!1}if("object"===typeof t){if(null!=t.chainId){try{return this.chainId===Xv(t.chainId)}catch(e){}return!1}return null!=t.name&&this.name===t.name}return!1}get plugins(){return Array.from(mv(yR,this).values())}attachPlugin(t){if(mv(yR,this).get(t.name))throw new Error("cannot replace existing plugin: ".concat(t.name," "));return mv(yR,this).set(t.name,t.clone()),this}getPlugin(t){return mv(yR,this).get(t)||null}getPlugins(t){return this.plugins.filter(e=>e.name.split("#")[0]===t)}clone(){const t=new bR(this.name,this.chainId);return this.plugins.forEach(e=>{t.attachPlugin(e.clone())}),t}computeIntrinsicGas(t){const e=this.getPlugin("org.ethers.plugins.network.GasCost")||new lR;let n=e.txBase;if(null==t.to&&(n+=e.txCreate),t.data)for(let r=2;r<t.data.length;r+=2)"00"===t.data.substring(r,r+2)?n+=e.txDataZero:n+=e.txDataNonzero;if(t.accessList){const r=Rx(t.accessList);for(const t in r)n+=e.txAccessListAddress+e.txAccessListStorageKey*r[t].storageKeys.length}return n}static from(t){if(function(){if(ER)return;function t(t,e,n){const r=function(){const r=new bR(t,e);return null!=n.ensNetwork&&r.attachPlugin(new hR(null,n.ensNetwork)),r.attachPlugin(new lR),(n.plugins||[]).forEach(t=>{r.attachPlugin(t)}),r};bR.register(t,r),bR.register(e,r),n.altNames&&n.altNames.forEach(t=>{bR.register(t,r)})}ER=!0,t("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),t("ropsten",3,{ensNetwork:3}),t("rinkeby",4,{ensNetwork:4}),t("goerli",5,{ensNetwork:5}),t("kovan",42,{ensNetwork:42}),t("sepolia",11155111,{ensNetwork:11155111}),t("holesky",17e3,{ensNetwork:17e3}),t("classic",61,{}),t("classicKotti",6,{}),t("arbitrum",42161,{ensNetwork:1}),t("arbitrum-goerli",421613,{}),t("arbitrum-sepolia",421614,{}),t("base",8453,{ensNetwork:1}),t("base-goerli",84531,{}),t("base-sepolia",84532,{}),t("bnb",56,{ensNetwork:1}),t("bnbt",97,{}),t("linea",59144,{ensNetwork:1}),t("linea-goerli",59140,{}),t("linea-sepolia",59141,{}),t("matic",137,{ensNetwork:1,plugins:[xR("https://gasstation.polygon.technology/v2")]}),t("matic-amoy",80002,{}),t("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[xR("https://gasstation-testnet.polygon.technology/v2")]}),t("optimism",10,{ensNetwork:1,plugins:[]}),t("optimism-goerli",420,{}),t("optimism-sepolia",11155420,{}),t("xdai",100,{ensNetwork:1})}(),null==t)return bR.from("mainnet");if("number"===typeof t&&(t=BigInt(t)),"string"===typeof t||"bigint"===typeof t){const e=gR.get(t);if(e)return e();if("bigint"===typeof t)return new bR("unknown",t);Sv(!1,"unknown network","network",t)}if("function"===typeof t.clone){return t.clone()}if("object"===typeof t){Sv("string"===typeof t.name&&"number"===typeof t.chainId,"invalid network object name or chainId","network",t);const e=new bR(t.name,t.chainId);return(t.ensAddress||null!=t.ensNetwork)&&e.attachPlugin(new hR(t.ensAddress,t.ensNetwork)),e}Sv(!1,"invalid network","network",t)}static register(t,e){"number"===typeof t&&(t=BigInt(t));const n=gR.get(t);n&&Sv(!1,"conflicting network for ".concat(JSON.stringify(n.name)),"nameOrChainId",t),gR.set(t,e)}}function wR(t,e){const n=String(t);if(!n.match(/^[0-9.]+$/))throw new Error("invalid gwei value: ".concat(t));const r=n.split(".");if(1===r.length&&r.push(""),2!==r.length)throw new Error("invalid gwei value: ".concat(t));for(;r[1].length<e;)r[1]+="0";if(r[1].length>9){let t=BigInt(r[1].substring(0,9));r[1].substring(9).match(/^0+$/)||t++,r[1]=t.toString()}return BigInt(r[0]+r[1])}function xR(t){return new pR(t,async(t,e,n)=>{let r;n.setHeader("User-Agent","ethers");try{const[e,o]=await Promise.all([n.send(),t()]);r=e;const i=r.bodyJson.standard;return{gasPrice:o.gasPrice,maxFeePerGas:wR(i.maxFee,9),maxPriorityFeePerGas:wR(i.maxPriorityFee,9)}}catch(o){kv(!1,"error encountered with polygon gas station (".concat(JSON.stringify(n.url),")"),"SERVER_ERROR",{request:n,response:r,error:o})}})}let ER=!1;function AR(t){return JSON.parse(JSON.stringify(t))}var CR=new WeakMap,kR=new WeakMap,SR=new WeakMap,IR=new WeakMap,RR=new WeakSet;class TR{constructor(t){Nv(this,RR),pv(this,CR,void 0),pv(this,kR,void 0),pv(this,SR,void 0),pv(this,IR,void 0),vv(CR,this,t),vv(kR,this,null),vv(SR,this,4e3),vv(IR,this,-2)}get pollingInterval(){return mv(SR,this)}set pollingInterval(t){vv(SR,this,t)}start(){mv(kR,this)||(vv(kR,this,mv(CR,this)._setTimeout(gv(RR,this,NR).bind(this),mv(SR,this))),gv(RR,this,NR).call(this))}stop(){mv(kR,this)&&(mv(CR,this)._clearTimeout(mv(kR,this)),vv(kR,this,null))}pause(t){this.stop(),t&&vv(IR,this,-2)}resume(){this.start()}}async function NR(){try{const t=await mv(CR,this).getBlockNumber();if(-2===mv(IR,this))return void vv(IR,this,t);if(t!==mv(IR,this)){for(let e=mv(IR,this)+1;e<=t;e++){if(null==mv(kR,this))return;await mv(CR,this).emit("block",e)}vv(IR,this,t)}}catch(t){}null!=mv(kR,this)&&vv(kR,this,mv(CR,this)._setTimeout(gv(RR,this,NR).bind(this),mv(SR,this)))}var _R=new WeakMap,PR=new WeakMap,DR=new WeakMap;class OR{constructor(t){pv(this,_R,void 0),pv(this,PR,void 0),pv(this,DR,void 0),vv(_R,this,t),vv(DR,this,!1),vv(PR,this,t=>{this._poll(t,mv(_R,this))})}async _poll(t,e){throw new Error("sub-classes must override this")}start(){mv(DR,this)||(vv(DR,this,!0),mv(PR,this).call(this,-2),mv(_R,this).on("block",mv(PR,this)))}stop(){mv(DR,this)&&(vv(DR,this,!1),mv(_R,this).off("block",mv(PR,this)))}pause(t){this.stop()}resume(){this.start()}}var FR=new WeakMap,MR=new WeakMap;class BR extends OR{constructor(t,e){super(t),pv(this,FR,void 0),pv(this,MR,void 0),vv(FR,this,e),vv(MR,this,-2)}pause(t){t&&vv(MR,this,-2),super.pause(t)}async _poll(t,e){const n=await e.getBlock(mv(FR,this));null!=n&&(-2===mv(MR,this)?vv(MR,this,n.number):n.number>mv(MR,this)&&(e.emit(mv(FR,this),n.number),vv(MR,this,n.number)))}}var LR=new WeakMap;class UR extends OR{constructor(t,e){super(t),pv(this,LR,void 0),vv(LR,this,AR(e))}async _poll(t,e){throw new Error("@TODO")}}var WR=new WeakMap;class zR extends OR{constructor(t,e){super(t),pv(this,WR,void 0),vv(WR,this,e)}async _poll(t,e){const n=await e.getTransactionReceipt(mv(WR,this));n&&e.emit(mv(WR,this),n)}}var VR=new WeakMap,jR=new WeakMap,GR=new WeakMap,HR=new WeakMap,qR=new WeakMap,KR=new WeakSet;class QR{constructor(t,e){Nv(this,KR),pv(this,VR,void 0),pv(this,jR,void 0),pv(this,GR,void 0),pv(this,HR,void 0),pv(this,qR,void 0),vv(VR,this,t),vv(jR,this,AR(e)),vv(GR,this,gv(KR,this,XR).bind(this)),vv(HR,this,!1),vv(qR,this,-2)}start(){mv(HR,this)||(vv(HR,this,!0),-2===mv(qR,this)&&mv(VR,this).getBlockNumber().then(t=>{vv(qR,this,t)}),mv(VR,this).on("block",mv(GR,this)))}stop(){mv(HR,this)&&(vv(HR,this,!1),mv(VR,this).off("block",mv(GR,this)))}pause(t){this.stop(),t&&vv(qR,this,-2)}resume(){this.start()}}async function XR(t){if(-2===mv(qR,this))return;const e=AR(mv(jR,this));e.fromBlock=mv(qR,this)+1,e.toBlock=t;const n=await mv(VR,this).getLogs(e);if(0!==n.length)for(const r of n)mv(VR,this).emit(mv(jR,this),r),vv(qR,this,r.blockNumber);else mv(qR,this)<t-60&&vv(qR,this,t-60)}const JR=BigInt(2);function YR(t){return t&&"function"===typeof t.then}function ZR(t,e){return t+":"+JSON.stringify(e,(t,e)=>{if(null==e)return"null";if("bigint"===typeof e)return"bigint:".concat(e.toString());if("string"===typeof e)return e.toLowerCase();if("object"===typeof e&&!Array.isArray(e)){const t=Object.keys(e);return t.sort(),t.reduce((t,n)=>(t[n]=e[n],t),{})}return e})}class $R{constructor(t){St(this,"name",void 0),wv(this,{name:t})}start(){}stop(){}pause(t){}resume(){}}function tT(t){return(t=Array.from(new Set(t).values())).sort(),t}async function eT(t,e){if(null==t)throw new Error("invalid event");if(Array.isArray(t)&&(t={topics:t}),"string"===typeof t)switch(t){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:t,tag:t}}if(Ov(t,32)){const e=t.toLowerCase();return{type:"transaction",tag:ZR("tx",{hash:e}),hash:e}}if(t.orphan){const e=t;return{type:"orphan",tag:ZR("orphan",e),filter:(n=e,JSON.parse(JSON.stringify(n)))}}var n;if(t.address||t.topics){const n=t,r={topics:(n.topics||[]).map(t=>null==t?null:Array.isArray(t)?tT(t.map(t=>t.toLowerCase())):t.toLowerCase())};if(n.address){const t=[],o=[],i=n=>{Ov(n)?t.push(n):o.push((async()=>{t.push(await ax(n,e))})())};Array.isArray(n.address)?n.address.forEach(i):i(n.address),o.length&&await Promise.all(o),r.address=tT(t.map(t=>t.toLowerCase()))}return{filter:r,tag:ZR("event",r),type:"event"}}Sv(!1,"unknown ProviderEvent","event",t)}function nT(){return(new Date).getTime()}const rT={cacheTimeout:250,pollingInterval:4e3};var oT=new WeakMap,iT=new WeakMap,aT=new WeakMap,sT=new WeakMap,uT=new WeakMap,cT=new WeakMap,lT=new WeakMap,hT=new WeakMap,dT=new WeakMap,fT=new WeakMap,pT=new WeakMap,gT=new WeakMap,mT=new WeakSet;class vT{constructor(t,e){if(Nv(this,mT),pv(this,oT,void 0),pv(this,iT,void 0),pv(this,aT,void 0),pv(this,sT,void 0),pv(this,uT,void 0),pv(this,cT,void 0),pv(this,lT,void 0),pv(this,hT,void 0),pv(this,dT,void 0),pv(this,fT,void 0),pv(this,pT,void 0),pv(this,gT,void 0),vv(gT,this,Object.assign({},rT,e||{})),"any"===t)vv(cT,this,!0),vv(uT,this,null);else if(t){const e=bR.from(t);vv(cT,this,!1),vv(uT,this,Promise.resolve(e)),setTimeout(()=>{this.emit("network",e,null)},0)}else vv(cT,this,!1),vv(uT,this,null);vv(hT,this,-1),vv(lT,this,new Map),vv(oT,this,new Map),vv(iT,this,new Map),vv(aT,this,null),vv(sT,this,!1),vv(dT,this,1),vv(fT,this,new Map),vv(pT,this,!1)}get pollingInterval(){return mv(gT,this).pollingInterval}get provider(){return this}get plugins(){return Array.from(mv(iT,this).values())}attachPlugin(t){if(mv(iT,this).get(t.name))throw new Error("cannot replace existing plugin: ".concat(t.name," "));return mv(iT,this).set(t.name,t.connect(this)),this}getPlugin(t){return mv(iT,this).get(t)||null}get disableCcipRead(){return mv(pT,this)}set disableCcipRead(t){vv(pT,this,!!t)}async ccipReadFetch(t,e,n){if(this.disableCcipRead||0===n.length||null==t.to)return null;const r=t.to.toLowerCase(),o=e.toLowerCase(),i=[];for(let s=0;s<n.length;s++){const e=n[s],u=e.replace("{sender}",r).replace("{data}",o),c=new bE(u);-1===e.indexOf("{data}")&&(c.body={data:o,sender:r}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:c,index:s,urls:n});let l,h="unknown error";try{l=await c.send()}catch(a){i.push(a.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:c,result:{error:a}});continue}try{const t=l.bodyJson;if(t.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:c,result:t}),t.data;t.message&&(h=t.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:c,result:t})}catch(a){}kv(l.statusCode<400||l.statusCode>=500,"response not found during CCIP fetch: ".concat(h),"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:t,info:{url:e,errorMessage:h}}),i.push(h)}kv(!1,"error encountered during CCIP fetch: ".concat(i.map(t=>JSON.stringify(t)).join(", ")),"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:t,info:{urls:n,errorMessages:i}})}_wrapBlock(t,e){return new JE(function(t){const e=iR(t);return e.transactions=t.transactions.map(t=>"string"===typeof t?t:uR(t)),e}(t),this)}_wrapLog(t,e){return new YE(function(t){return oR(t)}(t),this)}_wrapTransactionReceipt(t,e){return new $E(function(t){return sR(t)}(t),this)}_wrapTransactionResponse(t,e){return new eA(uR(t),this)}_detectNetwork(){kv(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(t){kv(!1,"unsupported method: ".concat(t.method),"UNSUPPORTED_OPERATION",{operation:t.method,info:t})}async getBlockNumber(){const t=$v(await gv(mT,this,yT).call(this,{method:"getBlockNumber"}),"%response");return mv(hT,this)>=0&&vv(hT,this,t),t}_getAddress(t){return ax(t,this)}_getBlockTag(t){if(null==t)return"latest";switch(t){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return t}return Ov(t)?Ov(t,32)?t:ny(t):("bigint"===typeof t&&(t=$v(t,"blockTag")),"number"===typeof t?t>=0?ny(t):mv(hT,this)>=0?ny(mv(hT,this)+t):this.getBlockNumber().then(e=>ny(e+t)):void Sv(!1,"invalid blockTag","blockTag",t))}_getFilter(t){const e=(t.topics||[]).map(t=>null==t?null:Array.isArray(t)?tT(t.map(t=>t.toLowerCase())):t.toLowerCase()),n="blockHash"in t?t.blockHash:void 0,r=(t,r,o)=>{let i;switch(t.length){case 0:break;case 1:i=t[0];break;default:t.sort(),i=t}if(n&&(null!=r||null!=o))throw new Error("invalid filter");const a={};return i&&(a.address=i),e.length&&(a.topics=e),r&&(a.fromBlock=r),o&&(a.toBlock=o),n&&(a.blockHash=n),a};let o,i,a=[];if(t.address)if(Array.isArray(t.address))for(const s of t.address)a.push(this._getAddress(s));else a.push(this._getAddress(t.address));return"fromBlock"in t&&(o=this._getBlockTag(t.fromBlock)),"toBlock"in t&&(i=this._getBlockTag(t.toBlock)),a.filter(t=>"string"!==typeof t).length||null!=o&&"string"!==typeof o||null!=i&&"string"!==typeof i?Promise.all([Promise.all(a),o,i]).then(t=>r(t[0],t[1],t[2])):r(a,o,i)}_getTransactionRequest(t){const e=QE(t),n=[];if(["to","from"].forEach(t=>{if(null==e[t])return;const r=ax(e[t],this);YR(r)?n.push(async function(){e[t]=await r}()):e[t]=r}),null!=e.blockTag){const t=this._getBlockTag(e.blockTag);YR(t)?n.push(async function(){e.blockTag=await t}()):e.blockTag=t}return n.length?async function(){return await Promise.all(n),e}():e}async getNetwork(){if(null==mv(uT,this)){const t=(async()=>{try{const t=await this._detectNetwork();return this.emit("network",t,null),t}catch(e){throw mv(uT,this)===t&&vv(uT,this,null),e}})();return vv(uT,this,t),(await t).clone()}const t=mv(uT,this),[e,n]=await Promise.all([t,this._detectNetwork()]);return e.chainId!==n.chainId&&(mv(cT,this)?(this.emit("network",n,e),mv(uT,this)===t&&vv(uT,this,Promise.resolve(n))):kv(!1,"network changed: ".concat(e.chainId," => ").concat(n.chainId," "),"NETWORK_ERROR",{event:"changed"})),e.clone()}async getFeeData(){const t=await this.getNetwork(),e=async()=>{const{_block:e,gasPrice:n,priorityFee:r}=await bv({_block:gv(mT,this,ET).call(this,"latest",!1),gasPrice:(async()=>{try{return Xv(await gv(mT,this,yT).call(this,{method:"getGasPrice"}),"%response")}catch(t){}return null})(),priorityFee:(async()=>{try{return Xv(await gv(mT,this,yT).call(this,{method:"getPriorityFee"}),"%response")}catch(t){}return null})()});let o=null,i=null;const a=this._wrapBlock(e,t);return a&&a.baseFeePerGas&&(i=null!=r?r:BigInt("1000000000"),o=a.baseFeePerGas*JR+i),new KE(n,o,i)},n=t.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(n){const t=new bE(n.url),r=await n.processFunc(e,this,t);return new KE(r.gasPrice,r.maxFeePerGas,r.maxPriorityFeePerGas)}return await e()}async estimateGas(t){let e=this._getTransactionRequest(t);return YR(e)&&(e=await e),Xv(await gv(mT,this,yT).call(this,{method:"estimateGas",transaction:e}),"%response")}async call(t){const{tx:e,blockTag:n}=await bv({tx:this._getTransactionRequest(t),blockTag:this._getBlockTag(t.blockTag)});return await gv(mT,this,wT).call(this,gv(mT,this,bT).call(this,e,n,t.enableCcipRead?0:-1))}async getBalance(t,e){return Xv(await gv(mT,this,xT).call(this,{method:"getBalance"},t,e),"%response")}async getTransactionCount(t,e){return $v(await gv(mT,this,xT).call(this,{method:"getTransactionCount"},t,e),"%response")}async getCode(t,e){return Bv(await gv(mT,this,xT).call(this,{method:"getCode"},t,e))}async getStorage(t,e,n){const r=Xv(e,"position");return Bv(await gv(mT,this,xT).call(this,{method:"getStorage",position:r},t,n))}async broadcastTransaction(t){const{blockNumber:e,hash:n,network:r}=await bv({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:t}),network:this.getNetwork()}),o=BI.from(t);if(o.hash!==n)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(o,r).replaceableTransaction(e)}async getBlock(t,e){const{network:n,params:r}=await bv({network:this.getNetwork(),params:gv(mT,this,ET).call(this,t,!!e)});return null==r?null:this._wrapBlock(r,n)}async getTransaction(t){const{network:e,params:n}=await bv({network:this.getNetwork(),params:gv(mT,this,yT).call(this,{method:"getTransaction",hash:t})});return null==n?null:this._wrapTransactionResponse(n,e)}async getTransactionReceipt(t){const{network:e,params:n}=await bv({network:this.getNetwork(),params:gv(mT,this,yT).call(this,{method:"getTransactionReceipt",hash:t})});if(null==n)return null;if(null==n.gasPrice&&null==n.effectiveGasPrice){const e=await gv(mT,this,yT).call(this,{method:"getTransaction",hash:t});if(null==e)throw new Error("report this; could not find tx or effectiveGasPrice");n.effectiveGasPrice=e.gasPrice}return this._wrapTransactionReceipt(n,e)}async getTransactionResult(t){const{result:e}=await bv({network:this.getNetwork(),result:gv(mT,this,yT).call(this,{method:"getTransactionResult",hash:t})});return null==e?null:Bv(e)}async getLogs(t){let e=this._getFilter(t);YR(e)&&(e=await e);const{network:n,params:r}=await bv({network:this.getNetwork(),params:gv(mT,this,yT).call(this,{method:"getLogs",filter:e})});return r.map(t=>this._wrapLog(t,n))}_getProvider(t){kv(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(t){return await XI.fromName(this,t)}async getAvatar(t){const e=await this.getResolver(t);return e?await e.getAvatar():null}async resolveName(t){const e=await this.getResolver(t);return e?await e.getAddress():null}async lookupAddress(t){const e=QC((t=Eb(t)).substring(2).toLowerCase()+".addr.reverse");try{const n=await XI.getEnsAddress(this),r=new BA(n,["function resolver(bytes32) view returns (address)"],this),o=await r.resolver(e);if(null==o||o===TE)return null;const i=new BA(o,["function name(bytes32) view returns (string)"],this),a=await i.name(e);return await this.resolveName(a)!==t?null:a}catch(n){if(Ev(n,"BAD_DATA")&&"0x"===n.value)return null;if(Ev(n,"CALL_EXCEPTION"))return null;throw n}}async waitForTransaction(t,e,n){const r=null!=e?e:1;return 0===r?this.getTransactionReceipt(t):new Promise(async(e,o)=>{let i=null;const a=async n=>{try{const o=await this.getTransactionReceipt(t);if(null!=o&&n-o.blockNumber+1>=r)return e(o),void(i&&(clearTimeout(i),i=null))}catch(o){console.log("EEE",o)}this.once("block",a)};null!=n&&(i=setTimeout(()=>{null!=i&&(i=null,this.off("block",a),o(Cv("timeout","TIMEOUT",{reason:"timeout"})))},n)),a(await this.getBlockNumber())})}async waitForBlock(t){kv(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(t){const e=mv(fT,this).get(t);e&&(e.timer&&clearTimeout(e.timer),mv(fT,this).delete(t))}_setTimeout(t,e){var n,r;null==e&&(e=0);const o=(vv(dT,this,(n=mv(dT,this),r=n++,n)),r),i=()=>{mv(fT,this).delete(o),t()};if(this.paused)mv(fT,this).set(o,{timer:null,func:i,time:e});else{const t=setTimeout(i,e);mv(fT,this).set(o,{timer:t,func:i,time:nT()})}return o}_forEachSubscriber(t){for(const e of mv(oT,this).values())t(e.subscriber)}_getSubscriber(t){switch(t.type){case"debug":case"error":case"network":return new $R(t.type);case"block":{const t=new TR(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new BR(this,t.type);case"event":return new QR(this,t.filter);case"transaction":return new zR(this,t.hash);case"orphan":return new UR(this,t.filter)}throw new Error("unsupported event: ".concat(t.type))}_recoverSubscriber(t,e){for(const n of mv(oT,this).values())if(n.subscriber===t){n.started&&n.subscriber.stop(),n.subscriber=e,n.started&&e.start(),null!=mv(aT,this)&&e.pause(mv(aT,this));break}}async on(t,e){const n=await gv(mT,this,CT).call(this,t);return n.listeners.push({listener:e,once:!1}),n.started||(n.subscriber.start(),n.started=!0,null!=mv(aT,this)&&n.subscriber.pause(mv(aT,this))),this}async once(t,e){const n=await gv(mT,this,CT).call(this,t);return n.listeners.push({listener:e,once:!0}),n.started||(n.subscriber.start(),n.started=!0,null!=mv(aT,this)&&n.subscriber.pause(mv(aT,this))),this}async emit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const o=await gv(mT,this,AT).call(this,t,n);if(!o||0===o.listeners.length)return!1;const i=o.listeners.length;return o.listeners=o.listeners.filter(e=>{let{listener:r,once:o}=e;const i=new iA(this,o?null:r,t);try{r.call(this,...n,i)}catch(a){}return!o}),0===o.listeners.length&&(o.started&&o.subscriber.stop(),mv(oT,this).delete(o.tag)),i>0}async listenerCount(t){if(t){const e=await gv(mT,this,AT).call(this,t);return e?e.listeners.length:0}let e=0;for(const{listeners:n}of mv(oT,this).values())e+=n.length;return e}async listeners(t){if(t){const e=await gv(mT,this,AT).call(this,t);return e?e.listeners.map(t=>{let{listener:e}=t;return e}):[]}let e=[];for(const{listeners:n}of mv(oT,this).values())e=e.concat(n.map(t=>{let{listener:e}=t;return e}));return e}async off(t,e){const n=await gv(mT,this,AT).call(this,t);if(!n)return this;if(e){const t=n.listeners.map(t=>{let{listener:e}=t;return e}).indexOf(e);t>=0&&n.listeners.splice(t,1)}return e&&0!==n.listeners.length||(n.started&&n.subscriber.stop(),mv(oT,this).delete(n.tag)),this}async removeAllListeners(t){if(t){const{tag:e,started:n,subscriber:r}=await gv(mT,this,CT).call(this,t);n&&r.stop(),mv(oT,this).delete(e)}else for(const[e,{started:n,subscriber:r}]of mv(oT,this))n&&r.stop(),mv(oT,this).delete(e);return this}async addListener(t,e){return await this.on(t,e)}async removeListener(t,e){return this.off(t,e)}get destroyed(){return mv(sT,this)}destroy(){this.removeAllListeners();for(const t of mv(fT,this).keys())this._clearTimeout(t);vv(sT,this,!0)}get paused(){return null!=mv(aT,this)}set paused(t){!!t!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(t){if(vv(hT,this,-1),null!=mv(aT,this)){if(mv(aT,this)==!!t)return;kv(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(e=>e.pause(t)),vv(aT,this,!!t);for(const e of mv(fT,this).values())e.timer&&clearTimeout(e.timer),e.time=nT()-e.time}resume(){if(null!=mv(aT,this)){this._forEachSubscriber(t=>t.resume()),vv(aT,this,null);for(const t of mv(fT,this).values()){let e=t.time;e<0&&(e=0),t.time=nT(),setTimeout(t.func,e)}}}}async function yT(t){const e=mv(gT,this).cacheTimeout;if(e<0)return await this._perform(t);const n=ZR(t.method,t);let r=mv(lT,this).get(n);return r||(r=this._perform(t),mv(lT,this).set(n,r),setTimeout(()=>{mv(lT,this).get(n)===r&&mv(lT,this).delete(n)},e)),await r}async function bT(t,e,n){kv(n<10,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},t,{blockTag:e,enableCcipRead:!0})});const r=QE(t);try{return Bv(await this._perform({method:"call",transaction:r,blockTag:e}))}catch(o){if(!this.disableCcipRead&&Av(o)&&o.data&&n>=0&&"latest"===e&&null!=r.to&&"0x556f1830"===Wv(o.data,0,4)){const t=o.data,i=await ax(r.to,this);let a;try{a=function(t){const e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};kv(Uv(t)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const n=Wv(t,0,32);kv(Wv(n,0,12)===Wv(_T,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=Wv(n,12);try{const n=[],r=$v(Wv(t,32,64)),o=$v(Wv(t,r,r+32)),i=Wv(t,r+32);for(let t=0;t<o;t++){const e=kT(i,32*t);if(null==e)throw new Error("abort");n.push(e)}e.urls=n}catch(o){kv(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const n=ST(t,64);if(null==n)throw new Error("abort");e.calldata=n}catch(o){kv(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}kv(Wv(t,100,128)===Wv(_T,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=Wv(t,96,100);try{const n=ST(t,128);if(null==n)throw new Error("abort");e.extraData=n}catch(o){kv(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(t=>e[t]),e}(Wv(o.data,4))}catch(o){kv(!1,o.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:r,info:{data:t}})}kv(a.sender.toLowerCase()===i.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:t,reason:"OffchainLookup",transaction:r,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:a.errorArgs}});const s=await this.ccipReadFetch(r,a.calldata,a.urls);kv(null!=s,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:r,info:{data:o.data,errorArgs:a.errorArgs}});const u={to:i,data:Lv([a.selector,NT([s,a.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:u});try{const t=await gv(mT,this,bT).call(this,u,e,n+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},u),result:t}),t}catch(o){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},u),error:o}),o}}throw o}}async function wT(t){const{value:e}=await bv({network:this.getNetwork(),value:t});return e}async function xT(t,e,n){let r=this._getAddress(e),o=this._getBlockTag(n);return"string"===typeof r&&"string"===typeof o||([r,o]=await Promise.all([r,o])),await gv(mT,this,wT).call(this,gv(mT,this,yT).call(this,Object.assign(t,{address:r,blockTag:o})))}async function ET(t,e){if(Ov(t,32))return await gv(mT,this,yT).call(this,{method:"getBlock",blockHash:t,includeTransactions:e});let n=this._getBlockTag(t);return"string"!==typeof n&&(n=await n),await gv(mT,this,yT).call(this,{method:"getBlock",blockTag:n,includeTransactions:e})}async function AT(t,e){let n=await eT(t,this);return"event"===n.type&&e&&e.length>0&&!0===e[0].removed&&(n=await eT({orphan:"drop-log",log:e[0]},this)),mv(oT,this).get(n.tag)||null}async function CT(t){const e=await eT(t,this),n=e.tag;let r=mv(oT,this).get(n);if(!r){r={subscriber:this._getSubscriber(e),tag:n,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},mv(oT,this).set(n,r)}return r}function kT(t,e){try{const n=ST(t,e);if(n)return Qb(n)}catch(n){}return null}function ST(t,e){if("0x"===t)return null;try{const n=$v(Wv(t,e,e+32)),r=$v(Wv(t,n,n+32));return Wv(t,n+32,n+32+r)}catch(n){}return null}function IT(t){const e=ey(t);if(e.length>32)throw new Error("internal; should not happen");const n=new Uint8Array(32);return n.set(e,32-e.length),n}function RT(t){if(t.length%32===0)return t;const e=new Uint8Array(32*Math.ceil(t.length/32));return e.set(t),e}const TT=new Uint8Array([]);function NT(t){const e=[];let n=0;for(let r=0;r<t.length;r++)e.push(TT),n+=32;for(let r=0;r<t.length;r++){const o=Pv(t[r]);e[r]=IT(n),e.push(IT(o.length)),e.push(RT(o)),n+=32+32*Math.ceil(o.length/32)}return Lv(e)}const _T="0x0000000000000000000000000000000000000000000000000000000000000000";function PT(t,e){if(t.provider)return t.provider;kv(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function DT(t,e){let n=QE(e);if(null!=n.to&&(n.to=ax(n.to,t)),null!=n.from){const e=n.from;n.from=Promise.all([t.getAddress(),ax(e,t)]).then(t=>{let[e,n]=t;return Sv(e.toLowerCase()===n.toLowerCase(),"transaction from mismatch","tx.from",n),e})}else n.from=t.getAddress();return await bv(n)}class OT{constructor(t){St(this,"provider",void 0),wv(this,{provider:t||null})}async getNonce(t){return PT(this,"getTransactionCount").getTransactionCount(await this.getAddress(),t)}async populateCall(t){return await DT(this,t)}async populateTransaction(t){const e=PT(this,"populateTransaction"),n=await DT(this,t);null==n.nonce&&(n.nonce=await this.getNonce("pending")),null==n.gasLimit&&(n.gasLimit=await this.estimateGas(n));const r=await this.provider.getNetwork();if(null!=n.chainId){Sv(Xv(n.chainId)===r.chainId,"transaction chainId mismatch","tx.chainId",t.chainId)}else n.chainId=r.chainId;const o=null!=n.maxFeePerGas||null!=n.maxPriorityFeePerGas;if(null==n.gasPrice||2!==n.type&&!o?0!==n.type&&1!==n.type||!o||Sv(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",t):Sv(!1,"eip-1559 transaction do not support gasPrice","tx",t),2!==n.type&&null!=n.type||null==n.maxFeePerGas||null==n.maxPriorityFeePerGas)if(0===n.type||1===n.type){const t=await e.getFeeData();kv(null!=t.gasPrice,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),null==n.gasPrice&&(n.gasPrice=t.gasPrice)}else{const t=await e.getFeeData();if(null==n.type)if(null!=t.maxFeePerGas&&null!=t.maxPriorityFeePerGas)if(n.authorizationList&&n.authorizationList.length?n.type=4:n.type=2,null!=n.gasPrice){const t=n.gasPrice;delete n.gasPrice,n.maxFeePerGas=t,n.maxPriorityFeePerGas=t}else null==n.maxFeePerGas&&(n.maxFeePerGas=t.maxFeePerGas),null==n.maxPriorityFeePerGas&&(n.maxPriorityFeePerGas=t.maxPriorityFeePerGas);else null!=t.gasPrice?(kv(!o,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),null==n.gasPrice&&(n.gasPrice=t.gasPrice),n.type=0):kv(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else 2!==n.type&&3!==n.type&&4!==n.type||(null==n.maxFeePerGas&&(n.maxFeePerGas=t.maxFeePerGas),null==n.maxPriorityFeePerGas&&(n.maxPriorityFeePerGas=t.maxPriorityFeePerGas))}else n.type=2;return await bv(n)}async populateAuthorization(t){const e=Object.assign({},t);return null==e.chainId&&(e.chainId=(await PT(this,"getNetwork").getNetwork()).chainId),null==e.nonce&&(e.nonce=await this.getNonce()),e}async estimateGas(t){return PT(this,"estimateGas").estimateGas(await this.populateCall(t))}async call(t){return PT(this,"call").call(await this.populateCall(t))}async resolveName(t){const e=PT(this,"resolveName");return await e.resolveName(t)}async sendTransaction(t){const e=PT(this,"sendTransaction"),n=await this.populateTransaction(t);delete n.from;const r=BI.from(n);return await e.broadcastTransaction(await this.signTransaction(r))}authorize(t){kv(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}var FT=new WeakMap,MT=new WeakMap,BT=new WeakMap,LT=new WeakMap,UT=new WeakMap,WT=new WeakMap,zT=new WeakSet;class VT{constructor(t){Nv(this,zT),pv(this,FT,void 0),pv(this,MT,void 0),pv(this,BT,void 0),pv(this,LT,void 0),pv(this,UT,void 0),pv(this,WT,void 0),vv(FT,this,t),vv(MT,this,null),vv(BT,this,gv(zT,this,jT).bind(this)),vv(LT,this,!1),vv(UT,this,null),vv(WT,this,!1)}_subscribe(t){throw new Error("subclasses must override this")}_emitResults(t,e){throw new Error("subclasses must override this")}_recover(t){throw new Error("subclasses must override this")}start(){mv(LT,this)||(vv(LT,this,!0),gv(zT,this,jT).call(this,-2))}stop(){mv(LT,this)&&(vv(LT,this,!1),vv(WT,this,!0),gv(zT,this,GT).call(this),mv(FT,this).off("block",mv(BT,this)))}pause(t){t&&gv(zT,this,GT).call(this),mv(FT,this).off("block",mv(BT,this))}resume(){this.start()}}async function jT(t){try{null==mv(MT,this)&&vv(MT,this,this._subscribe(mv(FT,this)));let t=null;try{t=await mv(MT,this)}catch(e){if(!Ev(e,"UNSUPPORTED_OPERATION")||"eth_newFilter"!==e.operation)throw e}if(null==t)return vv(MT,this,null),void mv(FT,this)._recoverSubscriber(this,this._recover(mv(FT,this)));const n=await mv(FT,this).getNetwork();if(mv(UT,this)||vv(UT,this,n),mv(UT,this).chainId!==n.chainId)throw new Error("chaid changed");if(mv(WT,this))return;const r=await mv(FT,this).send("eth_getFilterChanges",[t]);await this._emitResults(mv(FT,this),r)}catch(e){console.log("@TODO",e)}mv(FT,this).once("block",mv(BT,this))}function GT(){const t=mv(MT,this);t&&(vv(MT,this,null),t.then(t=>{mv(FT,this).destroyed||mv(FT,this).send("eth_uninstallFilter",[t])}))}var HT=new WeakMap;class qT extends VT{constructor(t,e){var n;super(t),pv(this,HT,void 0),vv(HT,this,(n=e,JSON.parse(JSON.stringify(n))))}_recover(t){return new QR(t,mv(HT,this))}async _subscribe(t){return await t.send("eth_newFilter",[mv(HT,this)])}async _emitResults(t,e){for(const n of e)t.emit(mv(HT,this),t._wrapLog(n,t._network))}}class KT extends VT{async _subscribe(t){return await t.send("eth_newPendingTransactionFilter",[])}async _emitResults(t,e){for(const n of e)t.emit("pending",n)}}const QT="bigint,boolean,function,number,string,symbol".split(/,/g);function XT(t){if(null==t||QT.indexOf(typeof t)>=0)return t;if("function"===typeof t.getAddress)return t;if(Array.isArray(t))return t.map(XT);if("object"===typeof t)return Object.keys(t).reduce((e,n)=>(e[n]=t[n],e),{});throw new Error("should not happen: ".concat(t," (").concat(typeof t,")"))}function JT(t){return new Promise(e=>{setTimeout(e,t)})}function YT(t){return t?t.toLowerCase():t}function ZT(t){return t&&"number"===typeof t.pollingInterval}const $T={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class tN extends OT{constructor(t,e){super(t),St(this,"address",void 0),wv(this,{address:e=Eb(e)})}connect(t){kv(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const e=XT(t),n=[];if(e.from){const r=e.from;n.push((async()=>{const n=await ax(r,this.provider);Sv(null!=n&&n.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),e.from=n})())}else e.from=this.address;if(null==e.gasLimit&&n.push((async()=>{e.gasLimit=await this.provider.estimateGas(Rt(Rt({},e),{},{from:this.address}))})()),null!=e.to){const t=e.to;n.push((async()=>{e.to=await ax(t,this.provider)})())}n.length&&await Promise.all(n);const r=this.provider.getRpcTransaction(e);return this.provider.send("eth_sendTransaction",[r])}async sendTransaction(t){const e=await this.provider.getBlockNumber(),n=await this.sendUncheckedTransaction(t);return await new Promise((t,r)=>{const o=[1e3,100];let i=0;const a=async()=>{try{const r=await this.provider.getTransaction(n);if(null!=r)return void t(r.replaceableTransaction(e))}catch(s){if(Ev(s,"CANCELLED")||Ev(s,"BAD_DATA")||Ev(s,"NETWORK_ERROR")||Ev(s,"UNSUPPORTED_OPERATION"))return null==s.info&&(s.info={}),s.info.sendTransactionHash=n,void r(s);if(Ev(s,"INVALID_ARGUMENT")&&(i++,null==s.info&&(s.info={}),s.info.sendTransactionHash=n,i>10))return void r(s);this.provider.emit("error",Cv("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:s}))}this.provider._setTimeout(()=>{a()},o.pop()||4e3)};a()})}async signTransaction(t){const e=XT(t);if(e.from){const n=await ax(e.from,this.provider);Sv(null!=n&&n.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),e.from=n}else e.from=this.address;const n=this.provider.getRpcTransaction(e);return await this.provider.send("eth_signTransaction",[n])}async signMessage(t){const e="string"===typeof t?Kb(t):t;return await this.provider.send("personal_sign",[Bv(e),this.address.toLowerCase()])}async signTypedData(t,e,n){const r=XT(n),o=await kx.resolveNames(t,e,r,async t=>{const e=await ax(t);return Sv(null!=e,"TypedData does not support null address","value",t),e});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(kx.getPayload(o.domain,e,o.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const e="string"===typeof t?Kb(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),Bv(e)])}}var eN=new WeakMap,nN=new WeakMap,rN=new WeakMap,oN=new WeakMap,iN=new WeakMap,aN=new WeakMap,sN=new WeakMap,uN=new WeakSet;class cN extends vT{constructor(t,e){super(t,e),Nv(this,uN),pv(this,eN,void 0),pv(this,nN,void 0),pv(this,rN,void 0),pv(this,oN,void 0),pv(this,iN,void 0),pv(this,aN,void 0),pv(this,sN,void 0),vv(nN,this,1),vv(eN,this,Object.assign({},$T,e||{})),vv(rN,this,[]),vv(oN,this,null),vv(aN,this,null),vv(sN,this,null);{let t=null;const e=new Promise(e=>{t=e});vv(iN,this,{promise:e,resolve:t})}const n=this._getOption("staticNetwork");"boolean"===typeof n?(Sv(!n||"any"!==t,"staticNetwork cannot be used on special network 'any'","options",e),n&&null!=t&&vv(aN,this,bR.from(t))):n&&(Sv(null==t||n.matches(t),"staticNetwork MUST match network object","options",e),vv(aN,this,n))}_getOption(t){return mv(eN,this)[t]}get _network(){return kv(mv(aN,this),"network is not available yet","NETWORK_ERROR"),mv(aN,this)}async _perform(t){if("call"===t.method||"estimateGas"===t.method){let e=t.transaction;if(e&&null!=e.type&&Xv(e.type)&&null==e.maxFeePerGas&&null==e.maxPriorityFeePerGas){const n=await this.getFeeData();null==n.maxFeePerGas&&null==n.maxPriorityFeePerGas&&(t=Object.assign({},t,{transaction:Object.assign({},e,{type:void 0})}))}}const e=this.getRpcRequest(t);return null!=e?await this.send(e.method,e.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t){if(!0!==t)return t;if(mv(aN,this))return mv(aN,this)}return mv(sN,this)?await mv(sN,this):this.ready?(vv(sN,this,(async()=>{try{const t=bR.from(Xv(await this.send("eth_chainId",[])));return vv(sN,this,null),t}catch(t){throw vv(sN,this,null),t}})()),await mv(sN,this)):(vv(sN,this,(async(t,e)=>{const n={id:(vv(nN,this,(t=mv(nN,this),e=t++,t)),e),method:"eth_chainId",params:[],jsonrpc:"2.0"};let r;this.emit("debug",{action:"sendRpcPayload",payload:n});try{r=(await this._send(n))[0],vv(sN,this,null)}catch(o){throw vv(sN,this,null),this.emit("debug",{action:"receiveRpcError",error:o}),o}if(this.emit("debug",{action:"receiveRpcResult",result:r}),"result"in r)return bR.from(Xv(r.result));throw this.getRpcError(n,r)})()),await mv(sN,this))}_start(){null!=mv(iN,this)&&null!=mv(iN,this).resolve&&(mv(iN,this).resolve(),vv(iN,this,null),(async()=>{for(;null==mv(aN,this)&&!this.destroyed;)try{vv(aN,this,await this._detectNetwork())}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",Cv("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await JT(1e3)}gv(uN,this,lN).call(this)})())}async _waitUntilReady(){if(null!=mv(iN,this))return await mv(iN,this).promise}_getSubscriber(t){return"pending"===t.type?new KT(this):"event"===t.type?this._getOption("polling")?new QR(this,t.filter):new qT(this,t.filter):"orphan"===t.type&&"drop-log"===t.filter.orphan?new $R("orphan"):super._getSubscriber(t)}get ready(){return null==mv(iN,this)}getRpcTransaction(t){const e={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(n=>{if(null==t[n])return;let r=n;"gasLimit"===n&&(r="gas"),e[r]=ny(Xv(t[n],"tx.".concat(n)))}),["from","to","data"].forEach(n=>{null!=t[n]&&(e[n]=Bv(t[n]))}),t.accessList&&(e.accessList=Rx(t.accessList)),t.blobVersionedHashes&&(e.blobVersionedHashes=t.blobVersionedHashes.map(t=>t.toLowerCase())),t.authorizationList&&(e.authorizationList=t.authorizationList.map(t=>{const e=jx(t);return{address:e.address,nonce:ny(e.nonce),chainId:ny(e.chainId),yParity:ny(e.signature.yParity),r:ny(e.signature.r),s:ny(e.signature.s)}})),e}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[YT(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[YT(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[YT(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[YT(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&null!=t.filter.address&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(YT):t.filter.address=YT(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,e){const{method:n}=t,{error:r}=e;if("eth_estimateGas"===n&&r.message){const e=r.message;if(!e.match(/revert/i)&&e.match(/insufficient funds/i))return Cv("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:r}});if(e.match(/nonce/i)&&e.match(/too low/i))return Cv("nonce has already been used","NONCE_EXPIRED",{transaction:t.params[0],info:{payload:t,error:r}})}if("eth_call"===n||"eth_estimateGas"===n){const e=gN(r),o=nx.getBuiltinCallException("eth_call"===n?"call":"estimateGas",t.params[0],e?e.data:null);return o.info={error:r,payload:t},o}const o=JSON.stringify(function(t){const e=[];return mN(t,e),e}(r));if("string"===typeof r.message&&r.message.match(/user denied|ethers-user-denied/i)){return Cv("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[n]||"unknown",reason:"rejected",info:{payload:t,error:r}})}if("eth_sendRawTransaction"===n||"eth_sendTransaction"===n){const e=t.params[0];if(o.match(/insufficient funds|base fee exceeds gas limit/i))return Cv("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:e,info:{error:r}});if(o.match(/nonce/i)&&o.match(/too low/i))return Cv("nonce has already been used","NONCE_EXPIRED",{transaction:e,info:{error:r}});if(o.match(/replacement transaction/i)&&o.match(/underpriced/i))return Cv("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:e,info:{error:r}});if(o.match(/only replay-protected/i))return Cv("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:n,info:{transaction:e,info:{error:r}}})}let i=!!o.match(/the method .* does not exist/i);return i||r&&r.details&&r.details.startsWith("Unauthorized method:")&&(i=!0),i?Cv("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:r,payload:t}}):Cv("could not coalesce error","UNKNOWN_ERROR",{error:r,payload:t})}send(t,e){var n,r;if(this.destroyed)return Promise.reject(Cv("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const o=(vv(nN,this,(n=mv(nN,this),r=n++,n)),r),i=new Promise((n,r)=>{mv(rN,this).push({resolve:n,reject:r,payload:{method:t,params:e,id:o,jsonrpc:"2.0"}})});return gv(uN,this,lN).call(this),i}async getSigner(t){null==t&&(t=0);const e=this.send("eth_accounts",[]);if("number"===typeof t){const n=await e;if(t>=n.length)throw new Error("no such account");return new tN(this,n[t])}const{accounts:n}=await bv({network:this.getNetwork(),accounts:e});t=Eb(t);for(const r of n)if(Eb(r)===t)return new tN(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(t=>new tN(this,t))}destroy(){mv(oN,this)&&(clearTimeout(mv(oN,this)),vv(oN,this,null));for(const{payload:t,reject:e}of mv(rN,this))e(Cv("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));vv(rN,this,[]),super.destroy()}}function lN(){if(mv(oN,this))return;const t=1===this._getOption("batchMaxCount")?0:this._getOption("batchStallTime");vv(oN,this,setTimeout(()=>{vv(oN,this,null);const t=mv(rN,this);for(vv(rN,this,[]);t.length;){const e=[t.shift()];for(;t.length&&e.length!==mv(eN,this).batchMaxCount;){e.push(t.shift());const n=JSON.stringify(e.map(t=>t.payload));if(n.length>mv(eN,this).batchMaxSize){t.unshift(e.pop());break}}(async()=>{const t=1===e.length?e[0].payload:e.map(t=>t.payload);this.emit("debug",{action:"sendRpcPayload",payload:t});try{const n=await this._send(t);this.emit("debug",{action:"receiveRpcResult",result:n});for(const{resolve:t,reject:r,payload:o}of e){if(this.destroyed){r(Cv("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:o.method}));continue}const e=n.filter(t=>t.id===o.id)[0];if(null==e){const t=Cv("missing response for request","BAD_DATA",{value:n,info:{payload:o}});this.emit("error",t),r(t);continue}"error"in e?r(this.getRpcError(o,e)):t(e.result)}}catch(n){this.emit("debug",{action:"receiveRpcError",error:n});for(const{reject:t}of e)t(n)}})()}},t))}var hN=new WeakMap;class dN extends cN{constructor(t,e){super(t,e),pv(this,hN,void 0);let n=this._getOption("pollingInterval");null==n&&(n=$T.pollingInterval),vv(hN,this,n)}_getSubscriber(t){const e=super._getSubscriber(t);return ZT(e)&&(e.pollingInterval=mv(hN,this)),e}get pollingInterval(){return mv(hN,this)}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");vv(hN,this,t),this._forEachSubscriber(t=>{ZT(t)&&(t.pollingInterval=mv(hN,this))})}}var fN=new WeakMap;class pN extends dN{constructor(t,e,n){null==t&&(t="http://localhost:8545"),super(e,n),pv(this,fN,void 0),vv(fN,this,"string"===typeof t?new bE(t):t.clone())}_getConnection(){return mv(fN,this).clone()}async send(t,e){return await this._start(),await super.send(t,e)}async _send(t){const e=this._getConnection();e.body=JSON.stringify(t),e.setHeader("content-type","application/json");const n=await e.send();n.assertOk();let r=n.bodyJson;return Array.isArray(r)||(r=[r]),r}}function gN(t){if(null==t)return null;if("string"===typeof t.message&&t.message.match(/revert/i)&&Ov(t.data))return{message:t.message,data:t.data};if("object"===typeof t){for(const e in t){const n=gN(t[e]);if(n)return n}return null}if("string"===typeof t)try{return gN(JSON.parse(t))}catch(e){}return null}function mN(t,e){if(null!=t){if("string"===typeof t.message&&e.push(t.message),"object"===typeof t)for(const n in t)mN(t[n],e);if("string"===typeof t)try{return mN(JSON.parse(t),e)}catch(n){}}}var vN,yN=new WeakMap,bN=new WeakMap;class wN extends dN{constructor(t,e,n){const r=Object.assign({},null!=n?n:{},{batchMaxCount:1});Sv(t&&t.request,"invalid EIP-1193 provider","ethereum",t),super(e,r),pv(this,yN,void 0),pv(this,bN,void 0),vv(bN,this,null),n&&n.providerInfo&&vv(bN,this,n.providerInfo),vv(yN,this,async(e,n)=>{const r={method:e,params:n};this.emit("debug",{action:"sendEip1193Request",payload:r});try{const e=await t.request(r);return this.emit("debug",{action:"receiveEip1193Result",result:e}),e}catch(Nt){const e=new Error(Nt.message);throw e.code=Nt.code,e.data=Nt.data,e.payload=r,this.emit("debug",{action:"receiveEip1193Error",error:e}),e}})}get providerInfo(){return mv(bN,this)}async send(t,e){return await this._start(),await super.send(t,e)}async _send(t){Sv(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const e=await mv(yN,this).call(this,t.method,t.params||[]);return[{id:t.id,result:e}]}catch(Nt){return[{id:t.id,error:{code:Nt.code,data:Nt.data,message:Nt.message}}]}}getRpcError(t,e){switch((e=JSON.parse(JSON.stringify(e))).error.code||-1){case 4001:e.error.message="ethers-user-denied: ".concat(e.error.message);break;case 4200:e.error.message="ethers-unsupported: ".concat(e.error.message)}return super.getRpcError(t,e)}async hasSigner(t){null==t&&(t=0);const e=await this.send("eth_accounts",[]);return"number"===typeof t?e.length>t:(t=t.toLowerCase(),0!==e.filter(e=>e.toLowerCase()===t).length)}async getSigner(t){if(null==t&&(t=0),!await this.hasSigner(t))try{await mv(yN,this).call(this,"eth_requestAccounts",[])}catch(e){const t=e.payload;throw this.getRpcError(t,{id:t.id,error:e})}return await super.getSigner(t)}static async discover(t){if(null==t&&(t={}),t.provider)return new wN(t.provider);const e=t.window?t.window:"undefined"!==typeof window?window:null;if(null==e)return null;const n=t.anyProvider;if(n&&e.ethereum)return new wN(e.ethereum);if(!("addEventListener"in e&&"dispatchEvent"in e&&"removeEventListener"in e))return null;const r=t.timeout?t.timeout:300;return 0===r?null:await new Promise((o,i)=>{let a=[];const s=t=>{a.push(t.detail),n&&u()},u=()=>{if(clearTimeout(c),a.length)if(t&&t.filter){const e=t.filter(a.map(t=>Object.assign({},t.info)));if(null==e)o(null);else if(e instanceof wN)o(e);else{let t=null;if(e.uuid){const n=a.filter(t=>e.uuid===t.info.uuid);t=n[0]}if(t){const{provider:e,info:n}=t;o(new wN(e,void 0,{providerInfo:n}))}else i(Cv("filter returned unknown info","UNSUPPORTED_OPERATION",{value:e}))}}else{const{provider:t,info:e}=a[0];o(new wN(t,void 0,{providerInfo:e}))}else o(null);e.removeEventListener("eip6963:announceProvider",s)},c=setTimeout(()=>{u()},r);e.addEventListener("eip6963:announceProvider",s),e.dispatchEvent(new Event("eip6963:requestProvider"))})}}const xN=BigInt(-1),EN=BigInt(0),AN=BigInt(1),CN=BigInt(5),kN={};let SN="0000";for(;SN.length<80;)SN+=SN;function IN(t){let e=SN;for(;e.length<t;)e+=e;return BigInt("1"+e.substring(0,t))}function RN(t,e,n){const r=BigInt(e.width);if(e.signed){const e=AN<<r-AN;kv(null==n||t>=-e&&t<e,"overflow","NUMERIC_FAULT",{operation:n,fault:"overflow",value:t}),t=t>EN?qv(Qv(t,r),r):-qv(Qv(-t,r),r)}else{const e=AN<<r;kv(null==n||t>=0&&t<e,"overflow","NUMERIC_FAULT",{operation:n,fault:"overflow",value:t}),t=(t%e+e)%e&e-AN}return t}function TN(t){"number"===typeof t&&(t="fixed128x".concat(t));let e=!0,n=128,r=18;if("string"===typeof t)if("fixed"===t);else if("ufixed"===t)e=!1;else{const o=t.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);Sv(o,"invalid fixed format","format",t),e="u"!==o[1],n=parseInt(o[2]),r=parseInt(o[3])}else if(t){const o=t,i=(t,e,n)=>null==o[t]?n:(Sv(typeof o[t]===e,"invalid fixed format ("+t+" not "+e+")","format."+t,o[t]),o[t]);e=i("signed","boolean",e),n=i("width","number",n),r=i("decimals","number",r)}Sv(n%8===0,"invalid FixedNumber width (not byte aligned)","format.width",n),Sv(r<=80,"invalid FixedNumber decimals (too large)","format.decimals",r);return{signed:e,width:n,decimals:r,name:(e?"":"u")+"fixed"+String(n)+"x"+String(r)}}var NN=new WeakMap,_N=new WeakMap,PN=new WeakMap,DN=new WeakSet;class ON{constructor(t,e,n){Nv(this,DN),St(this,"format",void 0),pv(this,NN,void 0),pv(this,_N,void 0),pv(this,PN,void 0),St(this,"_value",void 0),Tv(t,kN,"FixedNumber"),vv(_N,this,e),vv(NN,this,n);const r=function(t,e){let n="";t<EN&&(n="-",t*=xN);let r=t.toString();if(0===e)return n+r;for(;r.length<=e;)r=SN+r;const o=r.length-e;for(r=r.substring(0,o)+"."+r.substring(o);"0"===r[0]&&"."!==r[1];)r=r.substring(1);for(;"0"===r[r.length-1]&&"."!==r[r.length-2];)r=r.substring(0,r.length-1);return n+r}(e,n.decimals);wv(this,{format:n.name,_value:r}),vv(PN,this,IN(n.decimals))}get signed(){return mv(NN,this).signed}get width(){return mv(NN,this).width}get decimals(){return mv(NN,this).decimals}get value(){return mv(_N,this)}addUnsafe(t){return gv(DN,this,BN).call(this,t)}add(t){return gv(DN,this,BN).call(this,t,"add")}subUnsafe(t){return gv(DN,this,LN).call(this,t)}sub(t){return gv(DN,this,LN).call(this,t,"sub")}mulUnsafe(t){return gv(DN,this,UN).call(this,t)}mul(t){return gv(DN,this,UN).call(this,t,"mul")}mulSignal(t){gv(DN,this,FN).call(this,t);const e=mv(_N,this)*mv(_N,t);return kv(e%mv(PN,this)===EN,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),gv(DN,this,MN).call(this,e/mv(PN,this),"mulSignal")}divUnsafe(t){return gv(DN,this,WN).call(this,t)}div(t){return gv(DN,this,WN).call(this,t,"div")}divSignal(t){kv(mv(_N,t)!==EN,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),gv(DN,this,FN).call(this,t);const e=mv(_N,this)*mv(PN,this);return kv(e%mv(_N,t)===EN,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),gv(DN,this,MN).call(this,e/mv(_N,t),"divSignal")}cmp(t){let e=this.value,n=t.value;const r=this.decimals-t.decimals;return r>0?n*=IN(r):r<0&&(e*=IN(-r)),e<n?-1:e>n?1:0}eq(t){return 0===this.cmp(t)}lt(t){return this.cmp(t)<0}lte(t){return this.cmp(t)<=0}gt(t){return this.cmp(t)>0}gte(t){return this.cmp(t)>=0}floor(){let t=mv(_N,this);return mv(_N,this)<EN&&(t-=mv(PN,this)-AN),t=mv(_N,this)/mv(PN,this)*mv(PN,this),gv(DN,this,MN).call(this,t,"floor")}ceiling(){let t=mv(_N,this);return mv(_N,this)>EN&&(t+=mv(PN,this)-AN),t=mv(_N,this)/mv(PN,this)*mv(PN,this),gv(DN,this,MN).call(this,t,"ceiling")}round(t){if(null==t&&(t=0),t>=this.decimals)return this;const e=this.decimals-t,n=CN*IN(e-1);let r=this.value+n;const o=IN(e);return r=r/o*o,RN(r,mv(NN,this),"round"),new ON(kN,r,mv(NN,this))}isZero(){return mv(_N,this)===EN}isNegative(){return mv(_N,this)<EN}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(t){return ON.fromString(this.toString(),t)}static fromValue(t,e,n){const r=null==e?0:$v(e),o=TN(n);let i=Xv(t,"value");const a=r-o.decimals;if(a>0){const e=IN(a);kv(i%e===EN,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:t}),i/=e}else a<0&&(i*=IN(-a));return RN(i,o,"fromValue"),new ON(kN,i,o)}static fromString(t,e){const n=t.match(/^(-?)([0-9]*)\.?([0-9]*)$/);Sv(n&&n[2].length+n[3].length>0,"invalid FixedNumber string value","value",t);const r=TN(e);let o=n[2]||"0",i=n[3]||"";for(;i.length<r.decimals;)i+=SN;kv(i.substring(r.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:t}),i=i.substring(0,r.decimals);const a=BigInt(n[1]+o+i);return RN(a,r,"fromString"),new ON(kN,a,r)}static fromBytes(t,e){let n=Zv(Pv(t,"value"));const r=TN(e);return r.signed&&(n=qv(n,r.width)),RN(n,r,"fromBytes"),new ON(kN,n,r)}}function FN(t){Sv(this.format===t.format,"incompatible format; use fixedNumber.toFormat","other",t)}function MN(t,e){return t=RN(t,mv(NN,this),e),new vN(kN,t,mv(NN,this))}function BN(t,e){return gv(DN,this,FN).call(this,t),gv(DN,this,MN).call(this,mv(_N,this)+mv(_N,t),e)}function LN(t,e){return gv(DN,this,FN).call(this,t),gv(DN,this,MN).call(this,mv(_N,this)-mv(_N,t),e)}function UN(t,e){return gv(DN,this,FN).call(this,t),gv(DN,this,MN).call(this,mv(_N,this)*mv(_N,t)/mv(PN,this),e)}function WN(t,e){return kv(mv(_N,t)!==EN,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),gv(DN,this,FN).call(this,t),gv(DN,this,MN).call(this,mv(_N,this)*mv(PN,this)/mv(_N,t),e)}vN=ON;const zN=["wei","kwei","mwei","gwei","szabo","finney","ether"];function VN(t){return function(t,e){let n=18;if("string"===typeof e){const t=zN.indexOf(e);Sv(t>=0,"invalid unit","unit",e),n=3*t}else null!=e&&(n=$v(e,"unit"));return ON.fromValue(t,n,{decimals:n,width:512}).toString()}(t,18)}var jN=n(254),GN=n.n(jN);const HN=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"candidateId",type:"uint256"},{indexed:!1,internalType:"string",name:"name",type:"string"}],name:"CandidateAdded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint256",name:"candidateId",type:"uint256"}],name:"CandidateRemoved",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"voter",type:"address"},{indexed:!0,internalType:"uint256",name:"candidateId",type:"uint256"}],name:"VoteCast",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"startTime",type:"uint256"},{indexed:!1,internalType:"uint256",name:"endTime",type:"uint256"}],name:"VotingPeriodSet",type:"event"},{inputs:[{internalType:"string",name:"_name",type:"string"}],name:"addCandidate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_candidateId",type:"uint256"}],name:"removeCandidate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_startTime",type:"uint256"},{internalType:"uint256",name:"_endTime",type:"uint256"}],name:"setVotingPeriod",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_candidateId",type:"uint256"}],name:"vote",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"getCandidateCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCandidates",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"string[]",name:"",type:"string[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getResults",outputs:[{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"string[]",name:"",type:"string[]"},{internalType:"uint256[]",name:"",type:"uint256[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getVotingPeriod",outputs:[{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"bool",name:"isActive",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"getWinner",outputs:[{internalType:"string",name:"winnerName",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_voter",type:"address"}],name:"hasVoted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"isVotingPeriodActive",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}];class qN{constructor(){this.provider=null,this.signer=null,this.contract=null,this.contractAddress="",this.account="",this.initializeProvider()}async initializeProvider(){try{const t=await GN()({mustBeMetaMask:!1,silent:!0,timeout:3e3});if(t)this.provider=new wN(t);else{const t={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ADMIN_ADDRESSES:"0xe80b4B815428f337d8713da553FA183e4704012A"}.REACT_APP_RPC_URL||"http://127.0.0.1:8545";console.warn("No injected provider detected; falling back to JSON-RPC at",t),this.provider=new pN(t)}await this.loadContract()}catch(t){console.error("Failed to initialize provider:",t)}}async loadContract(){try{let e;try{const t=await fetch("/contractInfo.json");if(t.ok){e=(await t.json()).address}}catch(t){}if(this.contractAddress=e||{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ADMIN_ADDRESSES:"0xe80b4B815428f337d8713da553FA183e4704012A"}.REACT_APP_CONTRACT_ADDRESS||"",!this.contractAddress||!this.contractAddress.startsWith("0x")||42!==this.contractAddress.length)return console.error("Contract address is missing or invalid. Set public/contractInfo.json or REACT_APP_CONTRACT_ADDRESS."),void(this.contract=null);const n=this.signer||this.provider;if(!n)return void(this.contract=null);this.contract=new BA(this.contractAddress,HN,n)}catch(e){console.error("Failed to load contract:",e),this.contract=null}}async connectWallet(){try{if(!this.provider&&(await this.initializeProvider(),!this.provider))throw new Error("No Web3 provider available. Please install MetaMask or use a Web3-enabled browser.");try{const t=await this.provider.send("eth_requestAccounts",[]);if(0===t.length)throw new Error("No accounts found");return this.account=t[0],this.signer=await this.provider.getSigner(),await this.loadContract(),this.account}catch(t){throw 4001===t.code?new Error("User rejected the connection request. Please try again."):-32002===t.code?new Error("Please check your MetaMask extension for pending connection requests."):new Error("Failed to connect wallet: "+t.message)}}catch(t){throw console.error("Failed to connect wallet:",t),t}}async getWalletInfo(){try{if(!this.provider||!this.account)return null;const t=await this.provider.getBalance(this.account),e=await this.provider.getNetwork();return{address:this.account,balance:VN(t),chainId:e.chainId.toString(),networkName:e.name||"Unknown"}}catch(t){return console.error("Failed to get wallet info:",t),null}}async isOwner(){try{if(!this.account)return!1;if("true"===({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_ADMIN_ADDRESSES:"0xe80b4B815428f337d8713da553FA183e4704012A"}.REACT_APP_ADMIN_OVERRIDE||"").toLowerCase())return!0;const t="0xe80b4B815428f337d8713da553FA183e4704012A".split(",").map(t=>t.trim().toLowerCase()).filter(Boolean);if(t.length>0&&t.includes(this.account.toLowerCase()))return!0;if(!this.contract)return!1;const[e,n]=await Promise.all([this.contract.owner(),this.contract.admin?this.contract.admin():Promise.resolve("0x0000000000000000000000000000000000000000")]),r=this.account.toLowerCase();return e.toLowerCase()===r||n.toLowerCase()===r}catch(t){return console.error("Failed to check ownership:",t),!1}}async getOwnerAddress(){try{if(!this.contract)return null;return await this.contract.owner()}catch(t){return null}}async getAdminAddress(){try{if(!this.contract||!this.contract.admin)return null;return await this.contract.admin()}catch(t){return null}}async addCandidate(t){try{if(this.contract||!this.signer&&!this.provider||await this.loadContract(),!this.contract||!this.signer)throw new Error("Contract not initialized or wallet not connected");const e=this.contract.connect(this.signer),n=await e.addCandidate(t),r=await n.wait();if(null!==r&&void 0!==r&&r.hash)return r.hash;throw new Error("Transaction failed")}catch(e){throw console.error("Failed to add candidate:",e),4001===e.code?new Error("Transaction rejected by user"):-32603===e.code?new Error("Insufficient funds for transaction"):new Error("Failed to add candidate: "+(e.message||e.reason))}}async removeCandidate(t){try{if(this.contract||!this.signer&&!this.provider||await this.loadContract(),!this.contract||!this.signer)throw new Error("Contract not initialized or wallet not connected");const e=this.contract.connect(this.signer),n=await e.removeCandidate(t),r=await n.wait();if(null!==r&&void 0!==r&&r.hash)return r.hash;throw new Error("Transaction failed")}catch(e){throw console.error("Failed to remove candidate:",e),4001===e.code?new Error("Transaction rejected by user"):new Error("Failed to remove candidate: "+(e.message||e.reason))}}async setVotingPeriod(t,e){try{if(this.contract||!this.signer&&!this.provider||await this.loadContract(),!this.contract||!this.signer)throw new Error("Contract not initialized or wallet not connected");const n=this.contract.connect(this.signer),r=await n.setVotingPeriod(t,e),o=await r.wait();if(null!==o&&void 0!==o&&o.hash)return o.hash;throw new Error("Transaction failed")}catch(n){throw console.error("Failed to set voting period:",n),4001===n.code?new Error("Transaction rejected by user"):new Error("Failed to set voting period: "+(n.message||n.reason))}}async vote(t){try{if(this.contract||!this.signer&&!this.provider||await this.loadContract(),!this.contract||!this.signer)throw new Error("Contract not initialized or wallet not connected");const e=this.contract.connect(this.signer),n=await e.vote(t),r=await n.wait();if(null!==r&&void 0!==r&&r.hash)return r.hash;throw new Error("Transaction failed")}catch(n){var e;throw console.error("Failed to vote:",n),4001===n.code?new Error("Transaction rejected by user"):null!==(e=n.message)&&void 0!==e&&e.includes("already voted")?new Error("You have already voted"):new Error("Failed to vote: "+(n.message||n.reason))}}async hasVoted(t){try{if(!this.contract)return!1;const e=t||this.account;if(!e)return!1;return await this.contract.hasVoted(e)}catch(e){return console.error("Failed to check if voted:",e),!1}}async getCandidates(){try{if(!this.contract)return{ids:[],names:[]};const t=await this.contract.getCandidates();return{ids:t[0].map(t=>Number(t)),names:t[1]}}catch(t){return console.error("Failed to get candidates:",t),{ids:[],names:[]}}}async getResults(){try{if(!this.contract)return{ids:[],names:[],votes:[]};const t=await this.contract.getResults();return{ids:t[0].map(t=>Number(t)),names:t[1],votes:t[2].map(t=>Number(t))}}catch(t){return console.error("Failed to get results:",t),{ids:[],names:[],votes:[]}}}async getWinner(){try{if(!this.contract)return"No candidates";return await this.contract.getWinner()}catch(t){return console.error("Failed to get winner:",t),"No candidates"}}async getVotingPeriod(){try{if(!this.contract)return{startTime:0,endTime:0,isActive:!1};const t=await this.contract.getVotingPeriod();return{startTime:Number(t[0]),endTime:Number(t[1]),isActive:t[2]}}catch(t){return console.error("Failed to get voting period:",t),{startTime:0,endTime:0,isActive:!1}}}isReady(){return null!==this.contract&&null!==this.provider}isConnected(){return""!==this.account&&null!==this.signer}isWeb3Supported(){return qN.isWeb3Supported()}getBrowserInfo(){return qN.getBrowserInfo()}getAccount(){return this.account}getContractAddress(){return this.contractAddress}async getNetworkInfo(){try{if(!this.provider)return null;const t=await this.provider.getNetwork();return{chainId:t.chainId.toString(),name:t.name||"Unknown"}}catch(t){return console.error("Failed to get network info:",t),null}}async switchNetwork(t){try{return!!this.provider&&(await this.provider.send("wallet_switchEthereumChain",[{chainId:"0x".concat(parseInt(t).toString(16))}]),!0)}catch(e){if(console.error("Failed to switch network:",e),4902===e.code)throw new Error("Network not found in MetaMask. Please add it manually.");return!1}}async addNetwork(t){try{return!!this.provider&&(await this.provider.send("wallet_addEthereumChain",[t]),!0)}catch(e){return console.error("Failed to add network:",e),!1}}static isWeb3Supported(){return"undefined"!==typeof window&&("undefined"!==typeof window.ethereum||"undefined"!==typeof window.web3||/ethereum|web3/i.test(navigator.userAgent))}static getBrowserInfo(){const t=n(470).A,e=t.getDeviceInfo(),r=t.isCompatible(),o=t.getCompatibilityScore();let i="";return i=r?t.getConnectionInstructions():"Your device has limited Web3 support. Consider using a different browser or device.",{supported:r&&this.isWeb3Supported(),recommendation:i,browserName:e.browser,deviceType:e.type,compatibilityScore:o}}}const KN=new qN;var QN=n(579);const XN={container:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},loginBox:{background:"white",borderRadius:"20px",padding:"40px",boxShadow:"0 20px 40px rgba(0,0,0,0.1)",maxWidth:"500px",width:"100%",textAlign:"center"},title:{margin:"0 0 10px 0",color:"#333",fontSize:"2rem",fontWeight:"bold"},subtitle:{margin:"0 0 30px 0",color:"#666",fontSize:"1rem"},videoContainer:{position:"relative",width:"300px",height:"300px",margin:"0 auto 30px auto",borderRadius:"50%",overflow:"hidden",border:"4px solid #667eea"},video:{width:"100%",height:"100%",objectFit:"cover"},videoPlaceholder:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f8f9fa",color:"#666"},cameraIcon:{fontSize:"3rem",marginBottom:"10px"},faceOverlay:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},faceCircle:{width:"200px",height:"200px",border:"3px solid #4CAF50",borderRadius:"50%",boxShadow:"0 0 20px rgba(76, 175, 80, 0.5)"},messageContainer:{margin:"20px 0",minHeight:"60px"},message:{margin:"0 0 10px 0",color:"#333",fontSize:"1rem",lineHeight:"1.5"},error:{margin:"0 0 10px 0",color:"#e74c3c",fontSize:"0.9rem",backgroundColor:"#ffeaea",padding:"10px",borderRadius:"8px"},photoCounter:{margin:"0",color:"#667eea",fontSize:"1.1rem",fontWeight:"bold"},buttonContainer:{display:"flex",flexDirection:"column",gap:"15px",margin:"20px 0"},primaryButton:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",padding:"15px 30px",borderRadius:"25px",fontSize:"1rem",fontWeight:"bold",cursor:"pointer",transition:"transform 0.2s"},secondaryButton:{background:"white",color:"#667eea",border:"2px solid #667eea",padding:"15px 30px",borderRadius:"25px",fontSize:"1rem",fontWeight:"bold",cursor:"pointer",transition:"all 0.2s"},adminLink:{marginTop:"20px"},link:{color:"#667eea",textDecoration:"none",fontSize:"0.9rem"},privacyNotice:{marginTop:"30px",padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"10px"},privacyText:{margin:"0",color:"#666",fontSize:"0.8rem"}},JN=()=>{const t=et(),e=(0,r.useRef)(null),[n,o]=(0,r.useState)({isRegistering:!1,isAuthenticating:!1,cameraActive:!1,message:"Welcome to BlockDFace Voting System",voterId:null,photoCount:0,error:null}),[i,a]=(0,r.useState)(!0);(0,r.useEffect)(()=>{s();const t=setInterval(()=>{dv.isReady()&&(a(!1),clearInterval(t))},1e3);return()=>{c(),clearInterval(t)}},[]);const s=async()=>{try{const t=localStorage.getItem(hv);if(t){await dv.getVoterById(t)&&o(e=>Rt(Rt({},e),{},{voterId:t,message:"Welcome back! You can login with your face"}))}}catch(t){console.error("Error checking existing registration:",t)}},u=async()=>{if(!e.current)return o(t=>Rt(Rt({},t),{},{error:"Camera not available"})),!1;try{return await dv.startCamera(e.current)?(o(t=>Rt(Rt({},t),{},{cameraActive:!0,error:null})),!0):(o(t=>Rt(Rt({},t),{},{error:lv})),!1)}catch(t){return console.error("Error starting camera:",t),o(t=>Rt(Rt({},t),{},{error:"Failed to start camera"})),!1}},c=()=>{dv.stopCamera(),o(t=>Rt(Rt({},t),{},{cameraActive:!1}))},l=async()=>{await u()&&(o(t=>Rt(Rt({},t),{},{isAuthenticating:!0,message:"Position your face in the circle for authentication",error:null})),setTimeout(()=>h(),2e3))},h=async()=>{try{const t=await dv.authenticateVoter();t?(o(t=>Rt(Rt({},t),{},{message:"Face recognized! Connecting your wallet...",error:null})),await d(t)):(o(t=>Rt(Rt({},t),{},{message:cv,error:"Face not recognized. Please try again or register if you are a new user."})),n.isAuthenticating&&setTimeout(()=>h(),2e3))}catch(t){console.error("Authentication failed:",t),o(t=>Rt(Rt({},t),{},{isAuthenticating:!1,message:"Authentication failed. Please try again.",error:"Authentication error occurred."})),c()}},d=async e=>{try{await KN.connectWallet()?(o(t=>Rt(Rt({},t),{},{message:"Wallet connected! Redirecting to voting...",isAuthenticating:!1})),c(),localStorage.setItem(hv,e),setTimeout(()=>t("/vote"),1500)):(o(t=>Rt(Rt({},t),{},{isAuthenticating:!1,message:"Wallet connection required",error:sv})),c())}catch(n){console.error("Wallet connection failed:",n),o(t=>Rt(Rt({},t),{},{isAuthenticating:!1,message:"Wallet connection failed",error:"Failed to connect wallet. Please try again."})),c()}},f=()=>{c(),o(t=>Rt(Rt({},t),{},{isRegistering:!1,isAuthenticating:!1,message:n.voterId?"Welcome back! You can login with your face":"Welcome to BlockDFace Voting System",photoCount:0,error:null}))};return(0,QN.jsx)("div",{style:XN.container,children:(0,QN.jsxs)("div",{style:XN.loginBox,children:[(0,QN.jsx)("h1",{style:XN.title,children:"BlockDFace Voting"}),(0,QN.jsx)("p",{style:XN.subtitle,children:"Decentralized Voting with Face Authentication"}),(0,QN.jsxs)("div",{style:XN.videoContainer,children:[(0,QN.jsx)("video",{ref:e,style:XN.video,autoPlay:!0,playsInline:!0,muted:!0}),!n.cameraActive&&(0,QN.jsxs)("div",{style:XN.videoPlaceholder,children:[(0,QN.jsx)("div",{style:XN.cameraIcon,children:"\ud83d\udcf7"}),(0,QN.jsx)("p",{children:"Camera will appear here"})]}),n.cameraActive&&(0,QN.jsx)("div",{style:XN.faceOverlay,children:(0,QN.jsx)("div",{style:XN.faceCircle})})]}),(0,QN.jsxs)("div",{style:XN.messageContainer,children:[(0,QN.jsx)("p",{style:XN.message,children:n.message}),n.error&&(0,QN.jsx)("p",{style:XN.error,children:n.error}),n.isRegistering&&(0,QN.jsxs)("p",{style:XN.photoCounter,children:["Photo ",n.photoCount," / ",rv]})]}),(0,QN.jsxs)("div",{style:XN.buttonContainer,children:[!n.cameraActive&&!n.isRegistering&&!n.isAuthenticating&&(0,QN.jsx)(QN.Fragment,{children:n.voterId?(0,QN.jsx)("button",{style:XN.primaryButton,onClick:l,disabled:i,children:i?"Loading Models...":"Login with Face"}):(0,QN.jsxs)(QN.Fragment,{children:[(0,QN.jsx)("button",{style:XN.primaryButton,onClick:async()=>{await u()&&o(t=>Rt(Rt({},t),{},{isRegistering:!0,message:"Position your face in the circle and get ready for photos",photoCount:0,error:null}))},disabled:i,children:i?"Loading Models...":"Register Face"}),(0,QN.jsx)("button",{style:XN.secondaryButton,onClick:l,disabled:i,children:i?"Loading Models...":"I'm Already Registered"})]})}),n.isRegistering&&(0,QN.jsxs)(QN.Fragment,{children:[(0,QN.jsx)("button",{style:XN.primaryButton,onClick:async()=>{try{o(t=>Rt(Rt({},t),{},{message:"Capturing face photo ".concat(t.photoCount+1," of ").concat(rv,"..."),error:null}));const t=await dv.captureFacePhotos(rv);o(t=>Rt(Rt({},t),{},{message:"Processing your face data...",photoCount:rv}));const e=await dv.registerVoter(t);localStorage.setItem(hv,e),o(t=>Rt(Rt({},t),{},{voterId:e,isRegistering:!1,message:"Registration successful! You can now login with your face.",photoCount:0})),c()}catch(t){console.error("Registration failed:",t),o(t=>Rt(Rt({},t),{},{isRegistering:!1,message:"Registration failed. Please try again.",photoCount:0,error:"Failed to capture face properly. Please ensure good lighting and try again."})),c()}},children:"Start Face Capture"}),(0,QN.jsx)("button",{style:XN.secondaryButton,onClick:f,children:"Cancel"})]}),n.isAuthenticating&&(0,QN.jsx)("button",{style:XN.secondaryButton,onClick:f,children:"Cancel Authentication"})]}),(0,QN.jsx)("div",{style:XN.adminLink,children:(0,QN.jsx)("a",{href:"/admin",style:XN.link,children:"Admin Panel"})}),(0,QN.jsx)("div",{style:XN.privacyNotice,children:(0,QN.jsx)("p",{style:XN.privacyText,children:"\ud83d\udd12 Your face data is processed locally and never leaves your device"})})]})})},YN={container:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},dashboard:{maxWidth:"1200px",margin:"0 auto",color:"#333"},loadingBox:{background:"white",borderRadius:"20px",padding:"60px",textAlign:"center",boxShadow:"0 20px 40px rgba(0,0,0,0.1)"},errorBox:{background:"white",borderRadius:"20px",padding:"60px",textAlign:"center",boxShadow:"0 20px 40px rgba(0,0,0,0.1)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"30px",background:"white",padding:"20px",borderRadius:"15px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)"},walletInfo:{display:"flex",alignItems:"center",gap:"20px"},link:{color:"#667eea",textDecoration:"none",fontWeight:"bold"},successMessage:{background:"#d4edda",color:"#155724",padding:"15px",borderRadius:"8px",marginBottom:"20px",border:"1px solid #c3e6cb"},errorMessage:{background:"#f8d7da",color:"#721c24",padding:"15px",borderRadius:"8px",marginBottom:"20px",border:"1px solid #f5c6cb"},grid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"20px"},card:{background:"white",borderRadius:"15px",padding:"25px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)"},form:{marginBottom:"20px"},formGroup:{marginBottom:"15px"},input:{width:"100%",padding:"12px",border:"2px solid #e1e8ed",borderRadius:"8px",fontSize:"16px",marginBottom:"10px"},primaryButton:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",width:"100%",transition:"transform 0.2s"},secondaryButton:{background:"white",color:"#667eea",border:"2px solid #667eea",padding:"12px 24px",borderRadius:"8px",fontSize:"16px",fontWeight:"bold",cursor:"pointer",width:"100%",marginBottom:"20px",transition:"all 0.2s"},dangerButton:{background:"#e74c3c",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},candidateList:{maxHeight:"200px",overflowY:"auto"},candidateItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px",borderBottom:"1px solid #eee"},voteCount:{color:"#667eea",fontWeight:"bold"},emptyMessage:{color:"#666",fontStyle:"italic",textAlign:"center",padding:"20px"},periodInfo:{background:"#f8f9fa",padding:"15px",borderRadius:"8px",marginTop:"15px"},winnerAnnouncement:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",padding:"20px",borderRadius:"10px",textAlign:"center",margin:"20px 0"},resultsList:{marginTop:"20px"},resultItem:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px",background:"#f8f9fa",borderRadius:"8px",marginBottom:"8px"}},ZN=()=>{const[t,e]=(0,r.useState)([]),[n,o]=(0,r.useState)({startTime:0,endTime:0,isActive:!1}),[i,a]=(0,r.useState)(""),[s,u]=(0,r.useState)(""),[c,l]=(0,r.useState)(""),[h,d]=(0,r.useState)(!1),[f,p]=(0,r.useState)(""),[g,m]=(0,r.useState)(!0),[v,y]=(0,r.useState)(""),[b,w]=(0,r.useState)(""),[x,E]=(0,r.useState)("");(0,r.useEffect)(()=>{A()},[]);const A=async()=>{try{const t=await KN.connectWallet();if(!t)return w(sv),void m(!1);p(t);if(!await KN.isOwner())return w(uv),void m(!1);d(!0),await C()}catch(b){console.error("Dashboard initialization failed:",b),w("Failed to initialize dashboard")}finally{m(!1)}},C=async()=>{try{const t=await KN.getCandidates(),n=t.ids.map((e,n)=>({id:e,name:t.names[n]}));e(n);const r=await KN.getVotingPeriod();if(o(r),r.startTime>0&&(u(new Date(1e3*r.startTime).toISOString().slice(0,16)),l(new Date(1e3*r.endTime).toISOString().slice(0,16))),r.endTime>0&&Date.now()>1e3*r.endTime){const t=await KN.getWinner();E(t)}}catch(b){console.error("Failed to load data:",b),w("Failed to load contract data")}},k=t=>new Date(1e3*t).toLocaleString();return g?(0,QN.jsx)("div",{style:YN.container,children:(0,QN.jsxs)("div",{style:YN.loadingBox,children:[(0,QN.jsx)("h2",{children:"Initializing Admin Dashboard..."}),(0,QN.jsx)("p",{children:"Please connect your MetaMask wallet"})]})}):h?(0,QN.jsx)("div",{style:YN.container,children:(0,QN.jsxs)("div",{style:YN.dashboard,children:[(0,QN.jsxs)("header",{style:YN.header,children:[(0,QN.jsx)("h1",{children:"Admin Dashboard"}),(0,QN.jsxs)("div",{style:YN.walletInfo,children:[(0,QN.jsxs)("span",{children:["Connected: ",(S=f,"".concat(S.slice(0,6),"...").concat(S.slice(-4)))]}),(0,QN.jsx)("a",{href:ov,style:YN.link,children:"Logout"})]})]}),v&&(0,QN.jsx)("div",{style:YN.successMessage,children:v}),b&&(0,QN.jsx)("div",{style:YN.errorMessage,children:b}),(0,QN.jsxs)("div",{style:YN.grid,children:[(0,QN.jsxs)("div",{style:YN.card,children:[(0,QN.jsx)("h2",{children:"Candidate Management"}),(0,QN.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),i.trim())try{y("Adding candidate..."),w(""),await KN.addCandidate(i.trim()),a(""),y('Candidate "'.concat(i,'" added successfully!')),await C(),setTimeout(()=>y(""),3e3)}catch(b){console.error("Failed to add candidate:",b),w(b.message||"Failed to add candidate"),y("")}else w("Candidate name cannot be empty")},style:YN.form,children:[(0,QN.jsx)("input",{type:"text",placeholder:"Enter candidate name",value:i,onChange:t=>a(t.target.value),style:YN.input,disabled:n.isActive}),(0,QN.jsx)("button",{type:"submit",style:YN.primaryButton,disabled:n.isActive,children:"Add Candidate"})]}),(0,QN.jsx)("div",{style:YN.candidateList,children:0===t.length?(0,QN.jsx)("p",{style:YN.emptyMessage,children:"No candidates added yet"}):t.map(t=>(0,QN.jsxs)("div",{style:YN.candidateItem,children:[(0,QN.jsxs)("span",{children:[t.name,void 0!==t.voteCount&&(0,QN.jsxs)("span",{style:YN.voteCount,children:[" - ",t.voteCount," votes"]})]}),(0,QN.jsx)("button",{onClick:()=>(async(t,e)=>{if(window.confirm('Are you sure you want to remove "'.concat(e,'"?')))try{y("Removing candidate..."),w(""),await KN.removeCandidate(t),y('Candidate "'.concat(e,'" removed successfully!')),await C(),setTimeout(()=>y(""),3e3)}catch(b){console.error("Failed to remove candidate:",b),w(b.message||"Failed to remove candidate"),y("")}})(t.id,t.name),style:YN.dangerButton,disabled:n.isActive,children:"Remove"})]},t.id))})]}),(0,QN.jsxs)("div",{style:YN.card,children:[(0,QN.jsx)("h2",{children:"Voting Period Settings"}),(0,QN.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),!s||!c)return void w("Please select both start and end times");const e=Math.floor(new Date(s).getTime()/1e3),n=Math.floor(new Date(c).getTime()/1e3);if(n<=e)return void w("End time must be after start time");if(n-e<3600)w("Voting period must be at least 1 hour");else try{y("Setting voting period..."),w(""),await KN.setVotingPeriod(e,n),y("Voting period set successfully!"),await C(),setTimeout(()=>y(""),3e3)}catch(b){console.error("Failed to set voting period:",b),w(b.message||"Failed to set voting period"),y("")}},style:YN.form,children:[(0,QN.jsxs)("div",{style:YN.formGroup,children:[(0,QN.jsx)("label",{children:"Start Time:"}),(0,QN.jsx)("input",{type:"datetime-local",value:s,onChange:t=>u(t.target.value),style:YN.input,min:(new Date).toISOString().slice(0,16)})]}),(0,QN.jsxs)("div",{style:YN.formGroup,children:[(0,QN.jsx)("label",{children:"End Time:"}),(0,QN.jsx)("input",{type:"datetime-local",value:c,onChange:t=>l(t.target.value),style:YN.input,min:s})]}),(0,QN.jsx)("button",{type:"submit",style:YN.primaryButton,children:"Set Voting Period"})]}),n.startTime>0&&(0,QN.jsxs)("div",{style:YN.periodInfo,children:[(0,QN.jsx)("h3",{children:"Current Voting Period"}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Start:"})," ",k(n.startTime)]}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"End:"})," ",k(n.endTime)]}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Status:"}),(0,QN.jsx)("span",{style:{color:n.isActive?"#27ae60":"#e74c3c",fontWeight:"bold"},children:n.isActive?" Active":" Inactive"})]}),n.isActive&&(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Time Remaining:"})," ",(()=>{if(!n.endTime)return"";const t=Math.floor(Date.now()/1e3),e=n.endTime-t;if(e<=0)return"Voting ended";const r=Math.floor(e/3600),o=Math.floor(e%3600/60);return"".concat(r,"h ").concat(o,"m remaining")})()]})]})]}),(0,QN.jsxs)("div",{style:YN.card,children:[(0,QN.jsx)("h2",{children:"Voting Results"}),(0,QN.jsx)("button",{onClick:async()=>{try{const t=await KN.getResults(),n=t.ids.map((e,n)=>({id:e,name:t.names[n],voteCount:t.votes[n]}));e(n)}catch(b){console.error("Failed to load results:",b),w("Failed to load voting results")}},style:YN.secondaryButton,children:"Load Results"}),x&&"No candidates"!==x&&(0,QN.jsx)("div",{style:YN.winnerAnnouncement,children:(0,QN.jsxs)("h3",{children:["\ud83c\udf89 Winner: ",x," \ud83c\udf89"]})}),t.some(t=>void 0!==t.voteCount)?(0,QN.jsx)("div",{style:YN.resultsList,children:t.filter(t=>void 0!==t.voteCount).sort((t,e)=>(e.voteCount||0)-(t.voteCount||0)).map(t=>(0,QN.jsxs)("div",{style:YN.resultItem,children:[(0,QN.jsx)("span",{children:t.name}),(0,QN.jsxs)("span",{style:YN.voteCount,children:[t.voteCount," votes"]})]},t.id))}):(0,QN.jsx)("p",{style:YN.emptyMessage,children:'Click "Load Results" to view voting statistics'})]}),(0,QN.jsxs)("div",{style:YN.card,children:[(0,QN.jsx)("h2",{children:"Contract Information"}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Address:"})," ",KN.getContractAddress()]}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Network:"})," Local Ganache (Chain ID: 1337)"]}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Candidates:"})," ",t.length]}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Status:"}),(0,QN.jsx)("span",{style:{color:"#27ae60",fontWeight:"bold"},children:" Connected"})]})]})]})]})}):(0,QN.jsx)("div",{style:YN.container,children:(0,QN.jsxs)("div",{style:YN.errorBox,children:[(0,QN.jsx)("h2",{children:"Access Denied"}),(0,QN.jsx)("p",{children:b}),(0,QN.jsx)("a",{href:ov,style:YN.link,children:"Back to Home"})]})});var S},$N={container:{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},votingBox:{maxWidth:"800px",margin:"0 auto",color:"#333"},loadingBox:{background:"white",borderRadius:"20px",padding:"60px",textAlign:"center",boxShadow:"0 20px 40px rgba(0,0,0,0.1)"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"30px",background:"white",padding:"20px",borderRadius:"15px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)"},walletInfo:{display:"flex",alignItems:"center",gap:"15px"},disconnectButton:{background:"#e74c3c",color:"white",border:"none",padding:"8px 16px",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},successMessage:{background:"#d4edda",color:"#155724",padding:"15px",borderRadius:"8px",marginBottom:"20px",border:"1px solid #c3e6cb",textAlign:"center"},errorMessage:{background:"#f8d7da",color:"#721c24",padding:"15px",borderRadius:"8px",marginBottom:"20px",border:"1px solid #f5c6cb",textAlign:"center"},statusCard:{background:"white",borderRadius:"15px",padding:"25px",marginBottom:"20px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)"},countdown:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"20px",borderRadius:"10px",textAlign:"center",marginTop:"15px"},timeDisplay:{fontSize:"2rem",fontWeight:"bold",margin:"10px 0"},resultsCard:{background:"white",borderRadius:"15px",padding:"25px",marginBottom:"20px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)"},winnerAnnouncement:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",color:"white",padding:"30px",borderRadius:"15px",textAlign:"center"},confetti:{fontSize:"2rem",marginTop:"15px"},votingCard:{background:"white",borderRadius:"15px",padding:"25px",marginBottom:"20px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)"},alreadyVoted:{textAlign:"center",padding:"40px",background:"#d4edda",borderRadius:"10px",border:"2px solid #c3e6cb"},notActive:{textAlign:"center",padding:"40px",background:"#fff3cd",borderRadius:"10px",border:"2px solid #ffeaa7"},notStartedMessage:{color:"#f39c12",textAlign:"center",fontSize:"1.1rem",margin:"20px 0"},endedMessage:{color:"#e74c3c",textAlign:"center",fontSize:"1.1rem",margin:"20px 0"},noCandidates:{textAlign:"center",color:"#666",fontStyle:"italic",padding:"20px"},candidatesList:{marginBottom:"25px"},candidateOption:{display:"flex",alignItems:"center",padding:"20px",margin:"10px 0",border:"2px solid #e1e8ed",borderRadius:"10px",cursor:"pointer",transition:"all 0.2s"},selectedCandidate:{borderColor:"#667eea",background:"#f8f9ff"},candidateInfo:{display:"flex",alignItems:"center",gap:"15px"},radioButton:{width:"20px",height:"20px",border:"2px solid #667eea",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},radioButtonSelected:{width:"12px",height:"12px",background:"#667eea",borderRadius:"50%"},candidateName:{fontSize:"1.1rem",fontWeight:"500"},voteButton:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",border:"none",padding:"15px 40px",borderRadius:"25px",fontSize:"1.1rem",fontWeight:"bold",cursor:"pointer",width:"100%",transition:"transform 0.2s"},voteButtonDisabled:{background:"#ccc",cursor:"not-allowed"},disclaimer:{textAlign:"center",color:"#666",fontSize:"0.9rem",marginTop:"20px",fontStyle:"italic"},infoCard:{background:"white",borderRadius:"15px",padding:"20px",boxShadow:"0 10px 30px rgba(0,0,0,0.1)"}},t_=()=>{const t=et(),[e,n]=(0,r.useState)([]),[o,i]=(0,r.useState)({startTime:0,endTime:0,isActive:!1}),[a,s]=(0,r.useState)(null),[u,c]=(0,r.useState)(""),[l,h]=(0,r.useState)(!1),[d,f]=(0,r.useState)(!0),[p,g]=(0,r.useState)(!1),[m,v]=(0,r.useState)(""),[y,b]=(0,r.useState)(""),[w,x]=(0,r.useState)(""),[E,A]=(0,r.useState)("");(0,r.useEffect)(()=>{C()},[]),(0,r.useEffect)(()=>{if(o.endTime>0){const t=setInterval(()=>{S()},1e3);return()=>clearInterval(t)}},[o]);const C=async()=>{try{if(!localStorage.getItem("blockdface_voter_id"))return void t(ov);const e=await KN.connectWallet();if(!e)return b(sv),void f(!1);c(e),await k();const n=await KN.hasVoted();h(n)}catch(y){console.error("Failed to initialize voter interface:",y),b("Failed to initialize voting interface")}finally{f(!1)}},k=async()=>{try{const t=await KN.getCandidates(),e=t.ids.map((e,n)=>({id:e,name:t.names[n]}));n(e);const r=await KN.getVotingPeriod();if(i(r),r.endTime>0&&Date.now()>1e3*r.endTime){const t=await KN.getWinner();x(t)}}catch(y){console.error("Failed to load data:",y),b("Failed to load voting data")}},S=()=>{if(!o.endTime)return;const t=Math.floor(Date.now()/1e3),e=o.endTime-t;if(e<=0)return A("Voting has ended"),void(w||I());const n=Math.floor(e/86400),r=Math.floor(e%86400/3600),i=Math.floor(e%3600/60),a=e%60;A(n>0?"".concat(n,"d ").concat(r,"h ").concat(i,"m ").concat(a,"s"):r>0?"".concat(r,"h ").concat(i,"m ").concat(a,"s"):i>0?"".concat(i,"m ").concat(a,"s"):"".concat(a,"s"))},I=async()=>{try{const t=await KN.getWinner();x(t)}catch(y){console.error("Failed to load winner:",y)}},R=t=>new Date(1e3*t).toLocaleString();if(d)return(0,QN.jsx)("div",{style:$N.container,children:(0,QN.jsxs)("div",{style:$N.loadingBox,children:[(0,QN.jsx)("h2",{children:"Loading Voting Interface..."}),(0,QN.jsx)("p",{children:"Preparing your secure voting experience"})]})});const T=!o.isActive&&o.endTime>0&&Date.now()>1e3*o.endTime;return(0,QN.jsx)("div",{style:$N.container,children:(0,QN.jsxs)("div",{style:$N.votingBox,children:[(0,QN.jsxs)("header",{style:$N.header,children:[(0,QN.jsx)("h1",{children:"\ud83d\uddf3\ufe0f Voting Portal"}),(0,QN.jsxs)("div",{style:$N.walletInfo,children:[(0,QN.jsxs)("span",{children:["Wallet: ",(N=u,"".concat(N.slice(0,6),"...").concat(N.slice(-4)))]}),(0,QN.jsx)("button",{onClick:()=>{localStorage.removeItem("blockdface_voter_id"),t(ov)},style:$N.disconnectButton,children:"Disconnect"})]})]}),m&&(0,QN.jsx)("div",{style:$N.successMessage,children:m}),y&&(0,QN.jsx)("div",{style:$N.errorMessage,children:y}),(0,QN.jsxs)("div",{style:$N.statusCard,children:[(0,QN.jsx)("h2",{children:"Voting Status"}),o.startTime>0?(0,QN.jsxs)(QN.Fragment,{children:[(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Start:"})," ",R(o.startTime)]}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"End:"})," ",R(o.endTime)]}),(0,QN.jsxs)("p",{children:[(0,QN.jsx)("strong",{children:"Status:"}),(0,QN.jsx)("span",{style:{color:o.isActive?"#27ae60":"#e74c3c",fontWeight:"bold",marginLeft:"10px"},children:o.isActive?"\ud83d\udfe2 Active":"\ud83d\udd34 Inactive"})]}),o.isActive&&(0,QN.jsxs)("div",{style:$N.countdown,children:[(0,QN.jsx)("h3",{children:"\u23f0 Time Remaining"}),(0,QN.jsx)("div",{style:$N.timeDisplay,children:E})]}),!o.isActive&&o.endTime>0&&Date.now()<1e3*o.endTime&&(0,QN.jsx)("p",{style:$N.notStartedMessage,children:"\ud83d\udcc5 Voting has not started yet"}),!o.isActive&&o.endTime>0&&Date.now()>1e3*o.endTime&&(0,QN.jsx)("p",{style:$N.endedMessage,children:"\ud83c\udfc1 Voting has ended"})]}):(0,QN.jsx)("p",{style:$N.notStartedMessage,children:"\u23f3 Voting period has not been set yet"})]}),T&&w&&(0,QN.jsxs)("div",{style:$N.resultsCard,children:[(0,QN.jsx)("h2",{children:"\ud83c\udf89 Election Results"}),(0,QN.jsxs)("div",{style:$N.winnerAnnouncement,children:[(0,QN.jsxs)("h3",{children:["Winner: ",w]}),(0,QN.jsx)("div",{style:$N.confetti,children:"\ud83c\udf8a \ud83c\udf89 \ud83c\udf8a \ud83c\udf89 \ud83c\udf8a"})]})]}),!T&&(0,QN.jsxs)("div",{style:$N.votingCard,children:[(0,QN.jsx)("h2",{children:"Cast Your Vote"}),l?(0,QN.jsxs)("div",{style:$N.alreadyVoted,children:[(0,QN.jsx)("h3",{children:"\u2705 Vote Recorded"}),(0,QN.jsx)("p",{children:"You have successfully cast your vote. Thank you for participating!"}),o.isActive&&(0,QN.jsx)("p",{children:"Results will be announced after the voting period ends."})]}):(0,QN.jsx)(QN.Fragment,{children:o.isActive?(0,QN.jsx)(QN.Fragment,{children:0===e.length?(0,QN.jsx)("p",{style:$N.noCandidates,children:"No candidates available for this election."}):(0,QN.jsxs)(QN.Fragment,{children:[(0,QN.jsx)("div",{style:$N.candidatesList,children:e.map(t=>(0,QN.jsx)("div",{style:Rt(Rt({},$N.candidateOption),a===t.id?$N.selectedCandidate:{}),onClick:()=>s(t.id),children:(0,QN.jsxs)("div",{style:$N.candidateInfo,children:[(0,QN.jsx)("div",{style:$N.radioButton,children:a===t.id&&(0,QN.jsx)("div",{style:$N.radioButtonSelected})}),(0,QN.jsx)("span",{style:$N.candidateName,children:t.name})]})},t.id))}),(0,QN.jsx)("button",{onClick:async()=>{if(null!==a)try{g(!0),v("Casting your vote..."),b("");const t=await KN.vote(a);v("Vote cast successfully! Transaction: ".concat(t)),h(!0),setTimeout(()=>v(""),5e3)}catch(y){console.error("Failed to vote:",y),b(y.message||"Failed to cast vote"),v("")}finally{g(!1)}else b("Please select a candidate before voting")},style:Rt(Rt({},$N.voteButton),null===a?$N.voteButtonDisabled:{}),disabled:null===a||p,children:p?"Casting Vote...":"Cast Vote"}),(0,QN.jsx)("p",{style:$N.disclaimer,children:"\u26a0\ufe0f This action is permanent and cannot be undone. Your vote will be recorded on the blockchain."})]})}):(0,QN.jsx)("div",{style:$N.notActive,children:o.startTime>0?(0,QN.jsxs)(QN.Fragment,{children:[(0,QN.jsx)("h3",{children:"\u23f0 Voting Not Active"}),Date.now()<1e3*o.startTime?(0,QN.jsx)("p",{children:"Voting has not started yet. Please check back during the voting period."}):(0,QN.jsx)("p",{children:"Voting has ended. Please check the results above."})]}):(0,QN.jsx)("p",{children:"Voting period has not been set by the administrator."})})})]}),(0,QN.jsxs)("div",{style:$N.infoCard,children:[(0,QN.jsx)("h3",{children:"Secure Voting Information"}),(0,QN.jsx)("p",{children:"\u2022 Your vote is anonymous and recorded on the blockchain"}),(0,QN.jsx)("p",{children:"\u2022 Each wallet can vote only once per election"}),(0,QN.jsx)("p",{children:"\u2022 All transactions are transparent and verifiable"}),(0,QN.jsx)("p",{children:"\u2022 Results are automatically calculated when voting ends"})]})]})});var N},e_=()=>(0,QN.jsx)(xt,{children:(0,QN.jsx)("div",{style:{minHeight:"100vh"},children:(0,QN.jsxs)(yt,{children:[(0,QN.jsx)(mt,{path:ov,element:(0,QN.jsx)(JN,{})}),(0,QN.jsx)(mt,{path:iv,element:(0,QN.jsx)(ZN,{})}),(0,QN.jsx)(mt,{path:av,element:(0,QN.jsx)(t_,{})}),(0,QN.jsx)(mt,{path:"*",element:(0,QN.jsx)(gt,{to:ov,replace:!0})})]})})});i.createRoot(document.getElementById("root")).render((0,QN.jsx)(r.StrictMode,{children:(0,QN.jsx)(e_,{})}))})()})();
//# sourceMappingURL=main.957e40df.js.map